<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="5ä¸ªæ–¹é¢ çº¿ç¨‹æ¨¡å‹ã€æ•°æ®ç»“æ„ã€å…±äº«å¯¹è±¡æ± ã€è¿‡æœŸè®¾è®¡ã€æ•°æ®æŒä¹…åŒ–è®¾è®¡\nä¸€ã€çº¿ç¨‹æ¨¡å‹ Redis ä½¿ç”¨å•çº¿ç¨‹æ¨¡å‹æ¥å¤„ç†æ‰€æœ‰çš„å®¢æˆ·ç«¯è¯·æ±‚ã€‚\nè™½ç„¶çœ‹ä¼¼å•çº¿ç¨‹ç®€å•ï¼Œä½†è¿™ç§è®¾è®¡å‡å°‘äº†ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œé”çš„å¼€é”€ï¼Œé¿å…äº†å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­çš„å¤æ‚æ€§ã€‚\n"><title>Redisæœ‰å“ªäº›å·§å¦™çš„è®¾è®¡ï¼Œä¸¾å‡ ä¸ªä¾‹å­</title><link rel=canonical href=https://0607pass.github.io/Blog/p/redis%E6%9C%89%E5%93%AA%E4%BA%9B%E5%B7%A7%E5%A6%99%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%BE%E5%87%A0%E4%B8%AA%E4%BE%8B%E5%AD%90/><link rel=stylesheet href=/Blog/scss/style.min.dfff3e85e1b089d3ffb7989c6a0d6c7657148ae86220ad22340ec6971a2e21f4.css><meta property='og:title' content="Redisæœ‰å“ªäº›å·§å¦™çš„è®¾è®¡ï¼Œä¸¾å‡ ä¸ªä¾‹å­"><meta property='og:description' content="5ä¸ªæ–¹é¢ çº¿ç¨‹æ¨¡å‹ã€æ•°æ®ç»“æ„ã€å…±äº«å¯¹è±¡æ± ã€è¿‡æœŸè®¾è®¡ã€æ•°æ®æŒä¹…åŒ–è®¾è®¡\nä¸€ã€çº¿ç¨‹æ¨¡å‹ Redis ä½¿ç”¨å•çº¿ç¨‹æ¨¡å‹æ¥å¤„ç†æ‰€æœ‰çš„å®¢æˆ·ç«¯è¯·æ±‚ã€‚\nè™½ç„¶çœ‹ä¼¼å•çº¿ç¨‹ç®€å•ï¼Œä½†è¿™ç§è®¾è®¡å‡å°‘äº†ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œé”çš„å¼€é”€ï¼Œé¿å…äº†å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­çš„å¤æ‚æ€§ã€‚\n"><meta property='og:url' content='https://0607pass.github.io/Blog/p/redis%E6%9C%89%E5%93%AA%E4%BA%9B%E5%B7%A7%E5%A6%99%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%BE%E5%87%A0%E4%B8%AA%E4%BE%8B%E5%AD%90/'><meta property='og:site_name' content='XFFF çš„ç‹¬ç«‹åšå®¢'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Redis'><meta property='article:published_time' content='2025-12-11T14:54:01+08:00'><meta property='og:image' content='https://0607pass.github.io/Blog/images/postCover/redis.png'><meta name=twitter:title content="Redisæœ‰å“ªäº›å·§å¦™çš„è®¾è®¡ï¼Œä¸¾å‡ ä¸ªä¾‹å­"><meta name=twitter:description content="5ä¸ªæ–¹é¢ çº¿ç¨‹æ¨¡å‹ã€æ•°æ®ç»“æ„ã€å…±äº«å¯¹è±¡æ± ã€è¿‡æœŸè®¾è®¡ã€æ•°æ®æŒä¹…åŒ–è®¾è®¡\nä¸€ã€çº¿ç¨‹æ¨¡å‹ Redis ä½¿ç”¨å•çº¿ç¨‹æ¨¡å‹æ¥å¤„ç†æ‰€æœ‰çš„å®¢æˆ·ç«¯è¯·æ±‚ã€‚\nè™½ç„¶çœ‹ä¼¼å•çº¿ç¨‹ç®€å•ï¼Œä½†è¿™ç§è®¾è®¡å‡å°‘äº†ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œé”çš„å¼€é”€ï¼Œé¿å…äº†å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­çš„å¤æ‚æ€§ã€‚\n"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://0607pass.github.io/Blog/images/postCover/redis.png'></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/Blog/><img src=/Blog/img/avatar_hu_99759e9126fee3e2.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸš€</span></figure><div class=site-meta><h1 class=site-name><a href=/Blog>XFFF çš„ç‹¬ç«‹åšå®¢</a></h1><h2 class=site-description>è®°å½•ç‹¬ç«‹å¼€å‘ä¸ AI å­¦ä¹ çš„ç‚¹æ»´</h2></div></header><ol class=menu-social><li><a href=https://github.com/0607pass target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/Blog/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>ä¸»é¡µ | Home</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ul><li><a href=#ä¸€çº¿ç¨‹æ¨¡å‹>ä¸€ã€çº¿ç¨‹æ¨¡å‹</a></li><li><a href=#äºŒæ•°æ®ç»“æ„>äºŒã€æ•°æ®ç»“æ„</a><ul><li><a href=#sdssimple-dynamic-string>SDS(Simple Dynamic String)</a></li><li><a href=#ziplistå‹ç¼©åˆ—è¡¨>ziplist(å‹ç¼©åˆ—è¡¨)</a></li></ul></li><li><a href=#3å…±äº«å¯¹è±¡æ± >3ã€å…±äº«å¯¹è±¡æ± </a></li><li><a href=#4è¿‡æœŸè®¾è®¡>4ã€è¿‡æœŸè®¾è®¡</a></li><li><a href=#5æ•°æ®æŒä¹…åŒ–aof-é‡å†™æœºåˆ¶>5ã€æ•°æ®æŒä¹…åŒ–ï¼šAOF é‡å†™æœºåˆ¶</a></li></ul></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/Blog/p/redis%E6%9C%89%E5%93%AA%E4%BA%9B%E5%B7%A7%E5%A6%99%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%BE%E5%87%A0%E4%B8%AA%E4%BE%8B%E5%AD%90/><img src=/Blog/images/postCover/redis.png loading=lazy alt="Featured image of post Redisæœ‰å“ªäº›å·§å¦™çš„è®¾è®¡ï¼Œä¸¾å‡ ä¸ªä¾‹å­"></a></div><div class=article-details><header class=article-category><a href=/Blog/categories/redis/>Redis</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/Blog/p/redis%E6%9C%89%E5%93%AA%E4%BA%9B%E5%B7%A7%E5%A6%99%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%BE%E5%87%A0%E4%B8%AA%E4%BE%8B%E5%AD%90/>Redisæœ‰å“ªäº›å·§å¦™çš„è®¾è®¡ï¼Œä¸¾å‡ ä¸ªä¾‹å­</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2025-12-11T14:54:01+08:00>2025-12-11</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 5 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><h1 id=5ä¸ªæ–¹é¢>5ä¸ªæ–¹é¢</h1><p><strong>çº¿ç¨‹æ¨¡å‹ã€æ•°æ®ç»“æ„ã€å…±äº«å¯¹è±¡æ± ã€è¿‡æœŸè®¾è®¡ã€æ•°æ®æŒä¹…åŒ–è®¾è®¡</strong></p><h2 id=ä¸€çº¿ç¨‹æ¨¡å‹>ä¸€ã€çº¿ç¨‹æ¨¡å‹</h2><p>Redis ä½¿ç”¨<strong>å•çº¿ç¨‹æ¨¡å‹</strong>æ¥å¤„ç†æ‰€æœ‰çš„å®¢æˆ·ç«¯è¯·æ±‚ã€‚</p><p>è™½ç„¶çœ‹ä¼¼å•çº¿ç¨‹ç®€å•ï¼Œä½†è¿™ç§è®¾è®¡å‡å°‘äº†ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œé”çš„å¼€é”€ï¼Œé¿å…äº†å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­çš„å¤æ‚æ€§ã€‚</p><p>å¹¶ä¸”é€šè¿‡<strong>å¤šè·¯å¤ç”¨</strong>ï¼ˆepollã€select ç­‰ï¼‰+ <strong>äº‹ä»¶é©±åŠ¨</strong>æœºåˆ¶ï¼ŒRedis ä»ç„¶èƒ½å¤Ÿå¤„ç†å¤§é‡çš„å¹¶å‘è¿æ¥ã€‚</p><h2 id=äºŒæ•°æ®ç»“æ„>äºŒã€æ•°æ®ç»“æ„</h2><p>Redis å¯¹å¾ˆå¤šæ•°æ®ç»“æ„è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¾‹å¦‚ sdsã€ziplistï¼Œè¿˜æœ‰å“ˆå¸Œè¡¨çš„æ‰©å®¹æœºåˆ¶ã€‚</p><h3 id=sdssimple-dynamic-string>SDS(Simple Dynamic String)</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>struct</span> <span class=nf>__attribute__</span> <span class=p>((</span><span class=n>__packed__</span><span class=p>))</span> <span class=n>sdshdr16</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint16_t</span> <span class=n>len</span><span class=p>;</span> <span class=cm>/* used */</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint16_t</span> <span class=n>alloc</span><span class=p>;</span> <span class=cm>/* excluding the header and null terminator */</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>flags</span><span class=p>;</span> <span class=cm>/* 3 lsb of type, 5 unused bits */</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>buf</span><span class=p>[];</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><ol><li><strong>åŠ¨æ€æ‰©å±•å’Œç©ºé—´é¢„åˆ†é…</strong>ï¼šSDS æ”¯æŒè‡ªåŠ¨æ‰©å±•ã€‚å½“å­—ç¬¦ä¸²é•¿åº¦å¢åŠ æ—¶ï¼ŒSDS ä¼šè‡ªåŠ¨åˆ†é…æ›´å¤§çš„å†…å­˜ç©ºé—´ï¼Œå¹¶ä¸”é€šå¸¸ä¼šé¢å¤–é¢„ç•™ä¸€éƒ¨åˆ†ç©ºé—´ï¼Œå‡å°‘é¢‘ç¹çš„å†…å­˜åˆ†é…æ“ä½œï¼Œè¿™æ ·å°±é¿å…äº†æ¯æ¬¡ä¿®æ”¹å­—ç¬¦ä¸²æ—¶éƒ½éœ€è¦é‡æ–°åˆ†é…å†…å­˜çš„å¼€é”€ã€‚</li><li><strong>äºŒè¿›åˆ¶å®‰å…¨:</strong> ä¸ C å­—ç¬¦ä¸²ä¸åŒï¼ŒSDS æ”¯æŒå­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ï¼Œå› ä¸ºå®ƒä¸ä¼šä¾èµ–äºç©ºå­—ç¬¦ï¼ˆ&rsquo;\0&rsquo;ï¼‰æ¥æ ‡è¯†å­—ç¬¦ä¸²çš„ç»“æŸã€‚è¿™ä½¿å¾— SDS å¯ä»¥å®‰å…¨åœ°å­˜å‚¨å’Œå¤„ç†ä»»æ„äºŒè¿›åˆ¶æ•°æ®ã€‚</li><li><strong>å¸¸æ•°æ—¶é—´è·å–å­—ç¬¦ä¸²çš„é•¿åº¦</strong> ï¼šSDS ç»“æ„ä¸­ä¼šé¢å¤–å­˜å‚¨å­—ç¬¦ä¸²çš„å½“å‰é•¿åº¦ï¼Œè¿™ä½¿å¾—è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ“ä½œå¯ä»¥åœ¨ O(1) æ—¶é—´å†…å®Œæˆï¼Œè€Œä¸åƒ C å­—ç¬¦ä¸²é‚£æ ·éœ€è¦éå†æ•´ä¸ªå­—ç¬¦ä¸²æ¥è®¡ç®—é•¿åº¦ã€‚</li><li><strong>é˜²æ­¢ç¼“å†²åŒºæº¢å‡º</strong>ï¼šSDS é€šè¿‡ç»´æŠ¤åˆ†é…ç©ºé—´çš„æ€»é•¿åº¦å’Œå·²ç”¨é•¿åº¦ï¼Œèƒ½å¤Ÿæœ‰æ•ˆé˜²æ­¢ç¼“å†²åŒºæº¢å‡ºé—®é¢˜ã€‚è¿™åœ¨ä½¿ç”¨ C å­—ç¬¦ä¸²æ—¶æ˜¯ä¸€ä¸ªå¸¸è§çš„å®‰å…¨éšæ‚£ï¼Œä½†åœ¨ SDS ä¸­å¾—åˆ°äº†å¾ˆå¥½è§£å†³ã€‚</li><li><strong>æƒ°æ€§ç©ºé—´é‡Šæ”¾</strong> ï¼š å½“ SDS ä¸­çš„å­—ç¬¦ä¸²é•¿åº¦ç¼©çŸ­æ—¶ï¼Œå¹¶ä¸ä¼šç«‹å³ç¼©å‡å†…å­˜ç©ºé—´ï¼Œè€Œæ˜¯ä¼šä¿ç•™éƒ¨åˆ†ç¼©çŸ­åçš„ç©ºé—´ï¼Œè¿™æ ·å¯ä»¥é¿å…é¢‘ç¹çš„å†…å­˜é‡æ–°åˆ†é…æ“ä½œã€‚è¿™ç§ç­–ç•¥ä¹Ÿæ˜¯ Redis çš„å†…å­˜ä¼˜åŒ–çš„ä¸€éƒ¨åˆ†ã€‚</li></ol><h3 id=ziplistå‹ç¼©åˆ—è¡¨>ziplist(å‹ç¼©åˆ—è¡¨)</h3><p>å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰æ˜¯ Redis ç”¨äºå®ç°åˆ—è¡¨å’Œå“ˆå¸Œè¡¨çš„åº•å±‚æ•°æ®ç»“æ„ä¹‹ä¸€ã€‚</p><p>å½“åˆ—è¡¨æˆ–å“ˆå¸Œè¡¨ä¸­çš„æ•°æ®é‡è¾ƒå°ï¼Œä¸”å…ƒç´ é•¿åº¦è¾ƒçŸ­æ—¶ï¼ŒRedis ä¼šé€‰æ‹©ä½¿ç”¨å‹ç¼©åˆ—è¡¨æ¥å­˜å‚¨æ•°æ®ï¼Œ<strong>è¾¾åˆ°èŠ‚çœå†…å­˜æ¶ˆè€—çš„ç›®çš„</strong>ã€‚</p><p>å…³é”®è®¾è®¡å¦‚ä¸‹ï¼š</p><ul><li><p>å†…å­˜ç´§å‡‘ï¼šå‹ç¼©åˆ—è¡¨å°†æ‰€æœ‰å…ƒç´ ç´§å‡‘åœ°å­˜å‚¨åœ¨ä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œæ²¡æœ‰æŒ‡é’ˆç­‰é¢å¤–å¼€é”€ã€‚æ¯ä¸ªå…ƒç´ å‰éƒ½æœ‰ä¸€ä¸ªå‰å‘ç¼–ç å’Œåå‘ç¼–ç ï¼Œç”¨äºæŒ‡ç¤ºå‰ä¸€ä¸ªå…ƒç´ çš„é•¿åº¦ï¼Œè¿™æ ·å¯ä»¥å¿«é€Ÿåœ°è¿›è¡Œå‰åéå†ï¼Œé¿å…äº†é“¾è¡¨ä¸­æŒ‡é’ˆçš„é¢å¤–å¼€é”€ã€‚</p></li><li><p>çµæ´»æ€§ï¼šå‹ç¼©åˆ—è¡¨æ ¹æ®å­˜å‚¨çš„å…ƒç´ é•¿åº¦åŠ¨æ€è°ƒæ•´ç¼–ç æ–¹å¼ï¼Œå°äº 1 å­—èŠ‚çš„æ•´æ•°ã€1 å­—èŠ‚çš„æ•´æ•°ã€3 å­—èŠ‚çš„æ•´æ•°ç­‰ä¸åŒé•¿åº¦çš„ç¼–ç æ–¹å¼ï¼Œèƒ½å¤Ÿæå¤§åœ°èŠ‚çœå†…å­˜ã€‚</p></li><li><p>æ€§èƒ½ä¸ç©ºé—´çš„å¹³è¡¡ï¼šå½“åˆ—è¡¨æˆ–å“ˆå¸Œè¡¨å˜å¾—å¾ˆå¤§æ—¶ï¼ŒRedis ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°æ›´é«˜æ•ˆçš„é“¾è¡¨æˆ–å“ˆå¸Œè¡¨ç»“æ„ã€‚è¿™ç§æŒ‰éœ€è°ƒæ•´çš„æ•°æ®ç»“æ„è®¾è®¡ï¼Œç¡®ä¿äº†åœ¨ä¸åŒåœºæ™¯ä¸‹çš„æ€§èƒ½æœ€ä¼˜ã€‚</p><h4 id=æ•´ä½“ç»“æ„å¸ƒå±€>æ•´ä½“ç»“æ„å¸ƒå±€</h4><pre tabindex=0><code>area |&lt;---- ziplist header ----&gt;|&lt;----------- entries -------------&gt;|&lt;-end-&gt;|
size    4 bytes  4 bytes  2 bytes      ?        ?        ?      1 byte
    +---------+--------+-------+--------+--------+--------+-------+
    | zlbytes | zltail | zllen | entry1 | entry2 | ...    | zlend |
    +---------+--------+-------+--------+--------+--------+-------+
</code></pre><p>####Header éƒ¨åˆ†è¯¦è§£</p><div class=table-wrapper><table><thead><tr><th>å­—æ®µå</th><th>é•¿åº¦/ç±»å‹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>zlbytes</td><td>uint32_t (4å­—èŠ‚)</td><td>æ•´ä¸ª ziplist å ç”¨çš„å†…å­˜å­—èŠ‚æ•°ï¼Œç”¨äºå†…å­˜é‡åˆ†é…å’Œè®¡ç®—æœ«ç«¯</td></tr><tr><td>zltail</td><td>uint32_t (4å­—èŠ‚)</td><td>åˆ°è¾¾ ziplist è¡¨å°¾èŠ‚ç‚¹çš„åç§»é‡ï¼Œå¯ä»¥ç›´æ¥å®šä½åˆ°å°¾èŠ‚ç‚¹</td></tr><tr><td>zllen</td><td>uint16_t (2å­—èŠ‚)</td><td>ziplist ä¸­èŠ‚ç‚¹çš„æ•°é‡ã€‚å½“å€¼å°äº 65535 æ—¶ä¸ºå®é™…æ•°é‡ï¼›ç­‰äº 65535 æ—¶éœ€è¦éå†è®¡ç®—</td></tr><tr><td>zlend</td><td>uint8_t (1å­—èŠ‚)</td><td>å€¼ä¸º 255(0xFF)ï¼Œæ ‡è®° ziplist çš„æœ«ç«¯</td></tr></tbody></table></div></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cm>/* We use this function to receive information about a ziplist entry.
</span></span></span><span class=line><span class=cl><span class=cm> * Note that this is not how the data is actually encoded, is just what we
</span></span></span><span class=line><span class=cl><span class=cm> * get filled by a function in order to operate more easily. */</span>
</span></span><span class=line><span class=cl><span class=k>typedef</span> <span class=k>struct</span> <span class=n>zlentry</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>prevrawlensize</span><span class=p>;</span> <span class=cm>/* Bytes used to encode the previous entry len*/</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>prevrawlen</span><span class=p>;</span>     <span class=cm>/* Previous entry len. */</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>lensize</span><span class=p>;</span>        <span class=cm>/* Bytes used to encode this entry type/len.
</span></span></span><span class=line><span class=cl><span class=cm>                                    For example strings have a 1, 2 or 5 bytes
</span></span></span><span class=line><span class=cl><span class=cm>                                    header. Integers always use a single byte.*/</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>len</span><span class=p>;</span>            <span class=cm>/* Bytes used to represent the actual entry.
</span></span></span><span class=line><span class=cl><span class=cm>                                    For strings this is just the string length
</span></span></span><span class=line><span class=cl><span class=cm>                                    while for integers it is 1, 2, 3, 4, 8 or
</span></span></span><span class=line><span class=cl><span class=cm>                                    0 (for 4 bit immediate) depending on the
</span></span></span><span class=line><span class=cl><span class=cm>                                    number range. */</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>headersize</span><span class=p>;</span>     <span class=cm>/* prevrawlensize + lensize. */</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>encoding</span><span class=p>;</span>      <span class=cm>/* Set to ZIP_STR_* or ZIP_INT_* depending on
</span></span></span><span class=line><span class=cl><span class=cm>                                    the entry encoding. However for 4 bits
</span></span></span><span class=line><span class=cl><span class=cm>                                    immediate integers this can assume a range
</span></span></span><span class=line><span class=cl><span class=cm>                                    of values and must be range-checked. */</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>char</span> <span class=o>*</span><span class=n>p</span><span class=p>;</span>            <span class=cm>/* Pointer to the very start of the entry, that
</span></span></span><span class=line><span class=cl><span class=cm>                                    is, this points to prev-entry-len field. */</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=n>zlentry</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=æ¸è¿›å¼-rehash>æ¸è¿›å¼ rehash</h4><p>Redis çš„å“ˆå¸Œè¡¨åœ¨æ‰©å®¹æˆ–ç¼©å®¹æ—¶ä¸ä¼šä¸€æ¬¡æ€§è¿›è¡Œå…¨é‡ rehashã€‚</p><p>ç›¸åï¼Œå®ƒé‡‡å–äº†<strong>æ¸è¿›å¼ rehash çš„æ–¹å¼</strong>ï¼Œå°† rehash æ“ä½œåˆ†æ‘Šåˆ°åç»­çš„å¢åˆ æ”¹æŸ¥æ“ä½œä¸­ï¼Œä»è€Œé¿å…äº†é›†ä¸­çš„æ€§èƒ½æŠ–åŠ¨ã€‚</p><h2 id=3å…±äº«å¯¹è±¡æ± >3ã€å…±äº«å¯¹è±¡æ± </h2><p>Redis ä¸­æœ‰è®¸å¤šå¸¸ç”¨çš„å°æ•´æ•°ï¼Œä¾‹å¦‚ 0 åˆ° 9999ã€‚è¿™äº›æ•´æ•°é¢‘ç¹åœ°å‡ºç°åœ¨å„ç§å‘½ä»¤å’Œæ•°æ®æ“ä½œä¸­ã€‚</p><p>ä¸ºäº†å‡å°‘å†…å­˜åˆ†é…å’Œé‡Šæ”¾çš„å¼€é”€ï¼ŒRedis ä½¿ç”¨äº† <strong>å…±äº«å¯¹è±¡æ± ï¼ˆShared Object Poolï¼‰</strong>ï¼Œå®ç°äº†ï¼š</p><ul><li><p>å¯¹è±¡å¤ç”¨ï¼šå¯¹äºå¸¸ç”¨çš„å°æ•´æ•°ï¼ŒRedis ä¼šåœ¨å¯åŠ¨æ—¶é¢„å…ˆåˆ›å»ºè¿™äº›å¯¹è±¡ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨ä¸€ä¸ªå…±äº«å¯¹è±¡æ± ä¸­ã€‚å½“ç³»ç»Ÿéœ€è¦è¿™äº›æ•´æ•°å¯¹è±¡æ—¶ï¼Œç›´æ¥ä»æ± ä¸­è·å–ï¼Œè€Œä¸éœ€è¦é‡å¤åˆ†é…å†…å­˜ã€‚è¿™å¤§å¤§å‡å°‘äº†å†…å­˜åˆ†é…å’Œé‡Šæ”¾çš„å¼€é”€ï¼Œæé«˜äº†ç³»ç»Ÿçš„æ•ˆç‡ã€‚</p></li><li><p>å†…å­˜èŠ‚çœï¼šå…±äº«å¯¹è±¡æ± æœ‰æ•ˆåœ°èŠ‚çœäº†å†…å­˜ï¼Œå°¤å…¶æ˜¯åœ¨å¤§è§„æ¨¡ä½¿ç”¨è¿™äº›å¸¸é‡çš„åœºæ™¯ä¸­ã€‚é€šè¿‡å¯¹è±¡å¤ç”¨ï¼Œé¿å…äº†é¢‘ç¹çš„å†…å­˜ç”³è¯·å’Œåƒåœ¾å›æ”¶ã€‚</p></li></ul><h2 id=4è¿‡æœŸè®¾è®¡>4ã€è¿‡æœŸè®¾è®¡</h2><p>Redis æ”¯æŒä¸ºé”®è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚å½“é”®è¿‡æœŸåï¼Œå®ƒåº”è¯¥è¢«è‡ªåŠ¨åˆ é™¤ã€‚</p><p>ç„¶è€Œï¼Œè¿‡æœŸé”®çš„å¤„ç†éœ€è¦åœ¨æ€§èƒ½å’Œå‡†ç¡®æ€§ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ã€‚Redis é‡‡ç”¨äº†ä¸€ç§ <strong>æƒ°æ€§åˆ é™¤ä¸å®šæœŸåˆ é™¤ç›¸ç»“åˆçš„ç­–ç•¥</strong> æ¥å¤„ç†è¿‡æœŸé”®ï¼š</p><ul><li>æƒ°æ€§åˆ é™¤ï¼šå½“å®¢æˆ·ç«¯è®¿é—®ä¸€ä¸ªé”®æ—¶ï¼ŒRedis ä¼šæ£€æŸ¥è¯¥é”®æ˜¯å¦å·²ç»è¿‡æœŸã€‚å¦‚æœè¿‡æœŸï¼Œåˆ™ç«‹å³åˆ é™¤ã€‚è¿™ç§æ–¹å¼ä¸ä¼šå¢åŠ ç³»ç»Ÿè´Ÿæ‹…ï¼Œå› ä¸ºåªåœ¨è®¿é—®æ—¶æ‰æ£€æŸ¥é”®çš„çŠ¶æ€ã€‚</li><li>å®šæœŸåˆ é™¤ï¼šRedis æ¯éš”ä¸€æ®µæ—¶é—´ä¼šéšæœºæŠ½å–ä¸€éƒ¨åˆ†é”®è¿›è¡Œè¿‡æœŸæ£€æŸ¥ï¼Œå¹¶åˆ é™¤å…¶ä¸­å·²è¿‡æœŸçš„é”®ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒRedis å¯ä»¥é¿å…ç³»ç»Ÿä¸­å¤§é‡å­˜åœ¨è¿‡æœŸé”®è€Œæ— æ³•åŠæ—¶æ¸…ç†çš„æƒ…å†µã€‚</li></ul><p>æƒ°æ€§åˆ é™¤ç¡®ä¿è®¿é—®æ€§èƒ½ï¼Œå®šæœŸåˆ é™¤é¿å…å†…å­˜æ³„æ¼ã€‚é€šè¿‡æƒ°æ€§åˆ é™¤å’Œå®šæœŸåˆ é™¤ç›¸ç»“åˆï¼ŒRedis å®ç°äº†è¿‡æœŸé”®çš„é«˜æ•ˆç®¡ç†ã€‚</p><h2 id=5æ•°æ®æŒä¹…åŒ–aof-é‡å†™æœºåˆ¶>5ã€æ•°æ®æŒä¹…åŒ–ï¼šAOF é‡å†™æœºåˆ¶</h2><p>AOFï¼ˆAppend Only Fileï¼‰ æ˜¯ Redis çš„ä¸€ç§æ•°æ®æŒä¹…åŒ–æ–¹å¼ã€‚</p><p>Redis ä¼šå°†æ‰€æœ‰å†™æ“ä½œä»¥è¿½åŠ çš„æ–¹å¼è®°å½•åˆ° AOF æ–‡ä»¶ä¸­ï¼Œä»¥ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚ç„¶è€Œï¼Œ<strong>éšç€æ—¶é—´æ¨ç§»ï¼ŒAOF æ–‡ä»¶å¯èƒ½ä¼šå˜å¾—éå¸¸å¤§</strong>ï¼Œå½±å“æ¢å¤é€Ÿåº¦ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRedis å¼•å…¥äº† <strong>AOF é‡å†™ï¼ˆAOF Rewriteï¼‰</strong> æœºåˆ¶ï¼š</p><ul><li>å¢é‡é‡å†™ï¼šAOF é‡å†™å¹¶ä¸ä¼šä¸­æ–­æ­£å¸¸çš„å†™æ“ä½œã€‚åœ¨é‡å†™æœŸé—´ï¼ŒRedis ä»ç„¶å¯ä»¥å°†æ–°çš„å†™æ“ä½œç»§ç»­è¿½åŠ åˆ°æ—§çš„ AOF æ–‡ä»¶ä¸­ï¼Œç¡®ä¿äº†é«˜å¹¶å‘å†™å…¥æ—¶çš„æŒä¹…åŒ–æ€§èƒ½ã€‚</li><li>ç©ºé—´ä¼˜åŒ–ï¼šAOF é‡å†™è¿‡ç¨‹ä¸­ï¼ŒRedis å¹¶ä¸ä¼šç®€å•åœ°å¤åˆ¶æ‰€æœ‰å‘½ä»¤ï¼Œè€Œæ˜¯æ ¹æ®å½“å‰çš„æ•°æ®çŠ¶æ€ï¼Œç”Ÿæˆæœ€ç²¾ç®€çš„å‘½ä»¤é›†ã€‚å³ä½¿ä¸€ä¸ªé”®å€¼ç»è¿‡å¤šæ¬¡ä¿®æ”¹ï¼Œæœ€ç»ˆçš„ AOF æ–‡ä»¶ä¸­åªä¼šä¿ç•™ä¸€æ¡æœ€æœ‰æ•ˆçš„å‘½ä»¤ï¼Œä»è€Œå¤§å¹…å‡å°‘äº†æ–‡ä»¶å¤§å°ã€‚</li><li>å¼‚æ­¥æ‰§è¡Œï¼šAOF é‡å†™æ˜¯é€šè¿‡å­è¿›ç¨‹å¼‚æ­¥æ‰§è¡Œçš„ï¼Œä¸»è¿›ç¨‹ä¸ä¼šå—åˆ°å½±å“ï¼Œè¿™ä¿è¯äº†åœ¨æ‰§è¡Œé‡å†™çš„åŒæ—¶ï¼ŒRedis ä»ç„¶å¯ä»¥æä¾›é«˜æ•ˆçš„æœåŠ¡ã€‚</li></ul><p>ğŸ˜‚ğŸ˜‚ğŸ˜‚</p></section><footer class=article-footer><section class=article-tags><a href=/Blog/tags/redis/>Redis</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>CC BY-NC 4.0</span></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>æœ€åæ›´æ–°äº 0001-01-01 00:00 UTC</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/Blog/p/redis%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB/><div class=article-image><img src=/Blog/images/postCover/redis.png loading=lazy data-key data-hash=/Blog/images/postCover/redis.png></div><div class=article-details><h2 class=article-title>Redisä¸ºä»€ä¹ˆå¿«</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2024 -
2025 Â© {year} XFFF</section><section class=powerby>ç”¨ Hugo + GitHub Pages é©±åŠ¨<br>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.32.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/Blog/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><style>#TableOfContents>ul,ol{ul, ol { display: none; } .open { display: block; }}#backTopBtn{display:none;position:fixed;bottom:30px;right:30px;z-index:99;cursor:pointer;width:30px;height:30px;background:var(--accent-color);border-radius:50%;background-size:contain;background-repeat:no-repeat}#backTopBtn:before{content:"â†‘";color:var(--accent-color-text);display:flex;align-items:center;justify-content:center;width:100%;height:100%;font-size:20px}.highlight{max-height:400px;overflow:hidden;position:relative}.code-show{max-height:none!important}.code-more-box{width:100%;padding-top:78px;background-image:-webkit-gradient(linear,left top,left bottom,from(rgba(255,255,255,0)),to(#fff));position:absolute;left:0;right:0;bottom:0;z-index:1}[data-scheme=dark] .code-more-box{background-image:-webkit-gradient(linear,left top,left bottom,from(rgba(66,66,66,0)),to(#424242))}.code-more-btn{display:block;margin:auto;width:44px;height:22px;background:#f0f0f5;border-top-left-radius:8px;border-top-right-radius:8px;padding-top:6px;cursor:pointer}[data-scheme=dark] .code-more-btn{background:#545454}.code-more-img{cursor:pointer!important;display:block;margin:auto;width:22px;height:16px}body{background:url(https://0607pass.github.io/Blog/background/bg.jpg)no-repeat 50% 0;background-size:cover;background-attachment:fixed}#particles-js{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;pointer-events:none}#aplayer{z-index:9999}.aplayer{z-index:9999!important}</style><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css><div id=aplayer></div><script src=https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js></script><script src=https://cdn.jsdelivr.net/npm/pjax/pjax.min.js></script><script>const BG_IMAGE_URL="https://0607pass.github.io/Blog/background/bg.jpg",SAKURA_URL="https://0607pass.github.io/Blog/background/sakura.js",PARTICLES_SCRIPT_URL="https://0607pass.github.io/Blog/background/particles.min.js",PARTICLES_CONFIG_URL="https://0607pass.github.io/Blog/background/particlesjs-config.json";function initTocHide(){let e=document.querySelector(".widget--toc");if(!e)return;window.addEventListener("scroll",function(){let n=document.querySelectorAll(".open");n.length>0&&n.forEach(e=>e.classList.remove("open"));let t=document.querySelector(".active-class");if(!t)return;t.children.length>1&&t.children[1].classList.add("open");let e=t.parentElement;do e.classList.add("open"),e=e.parentElement.parentElement;while(e!==0[0]&&(e.localName==="ul"||e.localName==="ol"))})}function initScrollTop(){let t=document.querySelector(".right-sidebar");if(!t)return;let e=document.createElement("div");e.id="backTopBtn",e.onclick=backToTop,t.appendChild(e),window.onscroll=function(){document.body.scrollTop>20||document.documentElement.scrollTop>20?e.style.display="block":e.style.display="none"}}function backToTop(){window.scrollTo({top:0,behavior:"smooth"})}function initCodeMoreBox(){let e=document.querySelectorAll(".highlight");if(!e)return;e.forEach(e=>{if(e.scrollHeight<=e.clientHeight)return;let n=document.createElement("div");n.classList.add("code-more-box");let t=document.createElement("span");t.classList.add("code-more-btn"),t.addEventListener("click",()=>{e.classList.add("code-show"),n.style.display="none",window.dispatchEvent(new Event("resize"))}),t.textContent="å±•å¼€",t.style.padding="4px 8px",t.style.fontSize="12px",n.appendChild(t),e.appendChild(n)})}function initBackground(){if(BG_IMAGE_URL&&document.body&&(document.body.style.backgroundImage=`url(${BG_IMAGE_URL})`,document.body.style.backgroundRepeat="no-repeat",document.body.style.backgroundPosition="center top",document.body.style.backgroundSize="cover",document.body.style.backgroundAttachment="fixed"),SAKURA_URL){if(window.__sakuraInstance&&typeof window.__sakuraInstance.destroy=="function")try{window.__sakuraInstance.destroy()}catch{}const t=document.querySelector('script[src="'+SAKURA_URL+'"]');t&&t.remove();const e=document.createElement("script");e.src=SAKURA_URL,e.onload=()=>{window.__sakuraInstance=!0},document.body.appendChild(e)}if(PARTICLES_SCRIPT_URL&&PARTICLES_CONFIG_URL){let e=document.getElementById("particles-js");if(e||(e=document.createElement("div"),e.id="particles-js",document.body.prepend(e)),window.pJSDom&&window.pJSDom.length&&(window.pJSDom.forEach(e=>{e.pJS&&e.pJS.fn&&e.pJS.fn.vendors&&e.pJS.fn.vendors.destroypJS&&e.pJS.fn.vendors.destroypJS()}),window.pJSDom=[]),window.__particlesScriptLoaded)window.particlesJS&&setTimeout(()=>{window.particlesJS&&document.getElementById("particles-js")&&window.particlesJS.load("particles-js",PARTICLES_CONFIG_URL)},100);else{window.__particlesScriptLoaded=!0;const e=document.createElement("script");e.src=PARTICLES_SCRIPT_URL,e.onload=()=>{window.particlesJS&&window.particlesJS.load("particles-js",PARTICLES_CONFIG_URL)},document.body.appendChild(e)}}}function initAll(){initTocHide(),initScrollTop(),initCodeMoreBox(),initBackground(),window.Stack&&typeof window.Stack.init=="function"&&window.Stack.init()}initAll(),function(){if(window.__aplayerInstance)return;const a=document.getElementById("aplayer");if(!a||!window.APlayer)return;const c="https://0607pass.github.io/Blog/",n=e=>`${c}mp3/${encodeURIComponent(e)}`,s=[{name:"å¯æƒœæ²¡å¦‚æœ",artist:"æ—ä¿Šæ°",url:n("æ—ä¿Šæ°-å¯æƒœæ²¡å¦‚æœ.mp3"),cover:"https://picsum.photos/200/200?random=13"},{name:"æŸ¥æ— æ­¤å­—",artist:"æ—å¥•åŒ¡",url:n("æŸ¥æ— æ­¤å­—-æ—å¥•åŒ¡#eQSOo.mp3"),cover:"https://picsum.photos/200/200?random=11"},{name:"æˆ‘æ€€å¿µçš„",artist:"å­™ç‡•å§¿",url:n("å­™ç‡•å§¿-æˆ‘æ€€å¿µçš„.mp3"),cover:"https://picsum.photos/200/200?random=12"},{name:"è€ç”·å­©",artist:"ç­·å­å…„å¼Ÿ",url:n("ç­·å­å…„å¼Ÿ-è€ç”·å­©.mp3"),cover:"https://picsum.photos/200/200?random=14"}];if(!s.length)return;const r="aplayer-play-info";let o=null;try{const e=localStorage.getItem(r);o=e?JSON.parse(e):null}catch(e){console.error("APlayer restore parse error",e)}const t=new APlayer({container:a,fixed:!0,autoplay:!1,lrcType:0,theme:"#409EFF",audio:s});window.__aplayerInstance=t;const i=()=>{if(!t.audio)return;localStorage.setItem(r,JSON.stringify({index:t.list.index||0,currentTime:t.audio.currentTime||0,paused:t.audio.paused}))};if(window.addEventListener("beforeunload",i),window.addEventListener("pagehide",i),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&i()}),o){const{index:e=0,currentTime:n=0,paused:i=!0}=o;t.on("canplay",function o(){t.off("canplay",o);try{e>=0&&e<s.length&&t.list.switch(e),t.seek(n||0),i===!1?t.play():t.pause()}catch(e){console.error("APlayer restore failed",e)}})}}(),function(){if(window.__pjaxInstance||!window.Pjax)return;if(window.Pjax&&window.Pjax.prototype){const e=window.Pjax.prototype.handleResponse;window.Pjax.prototype.handleResponse=function(t,n,s,o){try{if(n&&n.responseText&&n.responseText.match("<html")){const t=new DOMParser,s=t.parseFromString(n.responseText,"text/html"),e=s.body.className;e&&document.body.className!==e&&(document.body.className=e)}}catch(e){console.warn("PJAX handleResponse error:",e)}return e.call(this,t,n,s,o)}}window.__pjaxInstance=new Pjax({selectors:["title",".main-container"],cacheBust:!1}),document.addEventListener("pjax:complete",()=>{setTimeout(()=>{initTocHide(),initScrollTop(),initCodeMoreBox(),initBackground(),window.Stack&&typeof window.Stack.init=="function"&&window.Stack.init()},50)}),document.addEventListener("pjax:send",()=>{const e=document.getElementById("particles-js");e&&(e.style.display="block"),BG_IMAGE_URL&&document.body&&(document.body.style.backgroundImage=`url(${BG_IMAGE_URL})`,document.body.style.backgroundRepeat="no-repeat",document.body.style.backgroundPosition="center top",document.body.style.backgroundSize="cover",document.body.style.backgroundAttachment="fixed")})}()</script></body></html>