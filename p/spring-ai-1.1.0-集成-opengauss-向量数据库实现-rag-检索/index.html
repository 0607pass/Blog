<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="1ã€å‰è¨€ æœ€è¿‘åœ¨åš RAG é¡¹ç›®æ—¶ï¼Œå‘ç°å¾ˆå¤šäººè¿˜åœ¨ç”¨ PGVector æˆ–è€… Milvusï¼Œå…¶å®å›½äº§æ•°æ®åº“ OpenGauss çš„å‘é‡èƒ½åŠ›å·²ç»ç›¸å½“æˆç†Ÿäº†ã€‚ç‰¹åˆ«æ˜¯å®ƒçš„å‘é‡ç´¢å¼•å’ŒæŸ¥è¯¢ä¼˜åŒ–ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒçš„è¡¨ç°æ¯”é¢„æœŸè¦å¥½ä¸å°‘ã€‚\n"><title>Spring AI 1.1.0 é›†æˆ OpenGauss å‘é‡æ•°æ®åº“å®ç° RAG æ£€ç´¢</title><link rel=canonical href=https://0607pass.github.io/Blog/p/spring-ai-1.1.0-%E9%9B%86%E6%88%90-opengauss-%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E7%8E%B0-rag-%E6%A3%80%E7%B4%A2/><link rel=stylesheet href=/Blog/scss/style.min.dfff3e85e1b089d3ffb7989c6a0d6c7657148ae86220ad22340ec6971a2e21f4.css><meta property='og:title' content="Spring AI 1.1.0 é›†æˆ OpenGauss å‘é‡æ•°æ®åº“å®ç° RAG æ£€ç´¢"><meta property='og:description' content="1ã€å‰è¨€ æœ€è¿‘åœ¨åš RAG é¡¹ç›®æ—¶ï¼Œå‘ç°å¾ˆå¤šäººè¿˜åœ¨ç”¨ PGVector æˆ–è€… Milvusï¼Œå…¶å®å›½äº§æ•°æ®åº“ OpenGauss çš„å‘é‡èƒ½åŠ›å·²ç»ç›¸å½“æˆç†Ÿäº†ã€‚ç‰¹åˆ«æ˜¯å®ƒçš„å‘é‡ç´¢å¼•å’ŒæŸ¥è¯¢ä¼˜åŒ–ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒçš„è¡¨ç°æ¯”é¢„æœŸè¦å¥½ä¸å°‘ã€‚\n"><meta property='og:url' content='https://0607pass.github.io/Blog/p/spring-ai-1.1.0-%E9%9B%86%E6%88%90-opengauss-%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E7%8E%B0-rag-%E6%A3%80%E7%B4%A2/'><meta property='og:site_name' content='XFFF çš„ç‹¬ç«‹åšå®¢'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='RAG'><meta property='article:tag' content='SpringAI'><meta property='article:published_time' content='2025-12-20T10:19:03+08:00'><meta property='article:modified_time' content='2025-12-20T10:19:03+08:00'><meta property='og:image' content='https://0607pass.github.io/Blog/images/postCover/spring.png'><meta name=twitter:title content="Spring AI 1.1.0 é›†æˆ OpenGauss å‘é‡æ•°æ®åº“å®ç° RAG æ£€ç´¢"><meta name=twitter:description content="1ã€å‰è¨€ æœ€è¿‘åœ¨åš RAG é¡¹ç›®æ—¶ï¼Œå‘ç°å¾ˆå¤šäººè¿˜åœ¨ç”¨ PGVector æˆ–è€… Milvusï¼Œå…¶å®å›½äº§æ•°æ®åº“ OpenGauss çš„å‘é‡èƒ½åŠ›å·²ç»ç›¸å½“æˆç†Ÿäº†ã€‚ç‰¹åˆ«æ˜¯å®ƒçš„å‘é‡ç´¢å¼•å’ŒæŸ¥è¯¢ä¼˜åŒ–ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒçš„è¡¨ç°æ¯”é¢„æœŸè¦å¥½ä¸å°‘ã€‚\n"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://0607pass.github.io/Blog/images/postCover/spring.png'></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/Blog/><img src=/Blog/img/avatar_hu_99759e9126fee3e2.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸš€</span></figure><div class=site-meta><h1 class=site-name><a href=/Blog>XFFF çš„ç‹¬ç«‹åšå®¢</a></h1><h2 class=site-description>è®°å½•ç‹¬ç«‹å¼€å‘ä¸ AI å­¦ä¹ çš„ç‚¹æ»´</h2></div></header><ol class=menu-social><li><a href=https://github.com/0607pass target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/Blog/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>ä¸»é¡µ | Home</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ul><li><a href=#21-å‘é‡ç±»å‹æ”¯æŒ>2.1 å‘é‡ç±»å‹æ”¯æŒ</a></li><li><a href=#22-ç´¢å¼•ç±»å‹é€‰æ‹©>2.2 ç´¢å¼•ç±»å‹é€‰æ‹©</a></li><li><a href=#23-ç›¸ä¼¼åº¦è®¡ç®—>2.3 ç›¸ä¼¼åº¦è®¡ç®—</a></li></ul><ul><li><a href=#31-ä¾èµ–é…ç½®>3.1 ä¾èµ–é…ç½®</a></li><li><a href=#32-å‘é‡å­˜å‚¨å®ç°>3.2 å‘é‡å­˜å‚¨å®ç°</a></li><li><a href=#33-rag-æœåŠ¡å°è£…>3.3 RAG æœåŠ¡å°è£…</a></li></ul><ul><li><a href=#41-ç´¢å¼•è°ƒä¼˜>4.1 ç´¢å¼•è°ƒä¼˜</a></li><li><a href=#42-æ‰¹é‡æ“ä½œä¼˜åŒ–>4.2 æ‰¹é‡æ“ä½œä¼˜åŒ–</a></li><li><a href=#43-å†·çƒ­åˆ†ç¦»>4.3 å†·çƒ­åˆ†ç¦»</a></li></ul><ul><li><a href=#51-å‘é‡ç»´åº¦ä¸åŒ¹é…>5.1 å‘é‡ç»´åº¦ä¸åŒ¹é…</a></li><li><a href=#52-é©±åŠ¨å…¼å®¹æ€§é—®é¢˜>5.2 é©±åŠ¨å…¼å®¹æ€§é—®é¢˜</a></li><li><a href=#53-å†…å­˜å ç”¨>5.3 å†…å­˜å ç”¨</a></li></ul></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/Blog/p/spring-ai-1.1.0-%E9%9B%86%E6%88%90-opengauss-%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E7%8E%B0-rag-%E6%A3%80%E7%B4%A2/><img src=/Blog/images/postCover/spring.png loading=lazy alt="Featured image of post Spring AI 1.1.0 é›†æˆ OpenGauss å‘é‡æ•°æ®åº“å®ç° RAG æ£€ç´¢"></a></div><div class=article-details><header class=article-category><a href=/Blog/categories/springai/>SpringAI</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/Blog/p/spring-ai-1.1.0-%E9%9B%86%E6%88%90-opengauss-%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E7%8E%B0-rag-%E6%A3%80%E7%B4%A2/>Spring AI 1.1.0 é›†æˆ OpenGauss å‘é‡æ•°æ®åº“å®ç° RAG æ£€ç´¢</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2025-12-20T10:19:03+08:00>2025-12-20</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 5 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><h1 id=1å‰è¨€>1ã€å‰è¨€</h1><p>æœ€è¿‘åœ¨åš RAG é¡¹ç›®æ—¶ï¼Œå‘ç°å¾ˆå¤šäººè¿˜åœ¨ç”¨ PGVector æˆ–è€… Milvusï¼Œå…¶å®å›½äº§æ•°æ®åº“ OpenGauss çš„å‘é‡èƒ½åŠ›å·²ç»ç›¸å½“æˆç†Ÿäº†ã€‚ç‰¹åˆ«æ˜¯å®ƒçš„å‘é‡ç´¢å¼•å’ŒæŸ¥è¯¢ä¼˜åŒ–ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒçš„è¡¨ç°æ¯”é¢„æœŸè¦å¥½ä¸å°‘ã€‚</p><p>è¿™ç¯‡æ–‡ç« ä¸»è¦è®°å½•ä¸€ä¸‹å¦‚ä½•ç”¨ Spring AI 1.1.0 é›†æˆ OpenGauss çš„å‘é‡æ£€ç´¢èƒ½åŠ›ï¼Œä»¥åŠ OpenGauss åœ¨å‘é‡å­˜å‚¨æ–¹é¢çš„ä¸€äº›ç‰¹æ€§ã€‚ä¸æé‚£äº›è™šçš„ï¼Œç›´æ¥ä¸Šæ‰‹å¹²ã€‚</p><h1 id=2opengauss-å‘é‡æ•°æ®åº“ç‰¹æ€§>2ã€OpenGauss å‘é‡æ•°æ®åº“ç‰¹æ€§</h1><h2 id=21-å‘é‡ç±»å‹æ”¯æŒ>2.1 å‘é‡ç±»å‹æ”¯æŒ</h2><p>OpenGauss åŸç”Ÿæ”¯æŒä¸‰ç§å‘é‡ç±»å‹ï¼Œè¿™ä¸ªè®¾è®¡è¿˜æŒºæœ‰æ„æ€çš„ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- æµ®ç‚¹å‘é‡ï¼Œæœ€å¸¸ç”¨ï¼Œæ”¯æŒåˆ° 16000 ç»´
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>docs</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=n>BIGSERIAL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>content</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>embedding</span><span class=w> </span><span class=n>VECTOR</span><span class=p>(</span><span class=mi>1536</span><span class=p>)</span><span class=w>  </span><span class=c1>-- OpenAI åµŒå…¥ç»´åº¦
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- ä½å‘é‡ï¼Œé€‚åˆäºŒè¿›åˆ¶å“ˆå¸Œ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>binary_index</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>BIGINT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>hash_bits</span><span class=w> </span><span class=n>BITVEC</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- ç¨€ç–å‘é‡ï¼Œé€‚åˆé«˜ç»´ç¨€ç–åœºæ™¯
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>sparse_data</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>BIGINT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>features</span><span class=w> </span><span class=n>SPARSEVEC</span><span class=p>(</span><span class=mi>1000000</span><span class=p>)</span><span class=w>  </span><span class=c1>-- ç†è®ºç»´åº¦å¾ˆå¤§ï¼Œä½†éé›¶å…ƒç´ æœ€å¤š 16000 ä¸ª
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å®é™…é¡¹ç›®ä¸­ï¼Œ<code>VECTOR</code> ç±»å‹ç”¨å¾—æœ€å¤šï¼Œç‰¹åˆ«æ˜¯é…åˆ OpenAI çš„ text-embedding-3-small æˆ–è€… bge-small è¿™ç±»æ¨¡å‹ï¼Œ1536 ç»´åˆšåˆšå¥½ã€‚</p><h2 id=22-ç´¢å¼•ç±»å‹é€‰æ‹©>2.2 ç´¢å¼•ç±»å‹é€‰æ‹©</h2><p>OpenGauss æä¾›äº†å››ç§å‘é‡ç´¢å¼•ï¼Œå„æœ‰é€‚ç”¨åœºæ™¯ï¼š</p><p><strong>IVFFLAT</strong> - ç®€å•ç²—æš´ï¼Œé€‚åˆæ•°æ®é‡ä¸å¤§ï¼ˆ&lt;100ä¸‡ï¼‰çš„åœºæ™¯</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_ivfflat</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>docs</span><span class=w> </span><span class=k>USING</span><span class=w> </span><span class=n>ivfflat</span><span class=w> </span><span class=p>(</span><span class=n>embedding</span><span class=w> </span><span class=n>vector_l2_ops</span><span class=p>)</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=p>(</span><span class=n>lists</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>100</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>IVF-PQ</strong> - é‡åŒ–å‹ç¼©ï¼Œçœå†…å­˜ä½†ç²¾åº¦æœ‰æŸå¤±</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_ivf_pq</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>docs</span><span class=w> </span><span class=k>USING</span><span class=w> </span><span class=n>ivfflat</span><span class=w> </span><span class=p>(</span><span class=n>embedding</span><span class=w> </span><span class=n>vector_l2_ops</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WITH</span><span class=w> </span><span class=p>(</span><span class=n>lists</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>100</span><span class=p>,</span><span class=w> </span><span class=k>encoding</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;pq&#39;</span><span class=p>,</span><span class=w> </span><span class=n>encoding_params</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;dim=1536,subquant=8&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>HNSW</strong> - å½“å‰æœ€ç«çš„å›¾ç´¢å¼•ï¼ŒæŸ¥è¯¢å¿«ä½†æ„å»ºæ…¢</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_hnsw</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>docs</span><span class=w> </span><span class=k>USING</span><span class=w> </span><span class=n>hnsw</span><span class=w> </span><span class=p>(</span><span class=n>embedding</span><span class=w> </span><span class=n>vector_l2_ops</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WITH</span><span class=w> </span><span class=p>(</span><span class=n>m</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>16</span><span class=p>,</span><span class=w> </span><span class=n>ef_construction</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>200</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><strong>HNSW-PQ</strong> - HNSW + é‡åŒ–ï¼Œå¹³è¡¡å‹é€‰æ‹©</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_hnsw_pq</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>docs</span><span class=w> </span><span class=k>USING</span><span class=w> </span><span class=n>hnsw</span><span class=w> </span><span class=p>(</span><span class=n>embedding</span><span class=w> </span><span class=n>vector_l2_ops</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WITH</span><span class=w> </span><span class=p>(</span><span class=n>m</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>16</span><span class=p>,</span><span class=w> </span><span class=n>ef_construction</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>200</span><span class=p>,</span><span class=w> </span><span class=k>encoding</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;pq&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ç”Ÿäº§ç¯å¢ƒå»ºè®®ï¼š<strong>HNSW</strong> æ˜¯æœ€ç¨³å¦¥çš„é€‰æ‹©ï¼Œè™½ç„¶æ„å»ºæ—¶é—´é•¿ç‚¹ï¼Œä½†æŸ¥è¯¢æ€§èƒ½ç¡®å®é¦™ã€‚</p><h2 id=23-ç›¸ä¼¼åº¦è®¡ç®—>2.3 ç›¸ä¼¼åº¦è®¡ç®—</h2><p>OpenGauss æ”¯æŒä¸‰ç§è·ç¦»ç®—æ³•ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- L2 è·ç¦»ï¼ˆæ¬§æ°è·ç¦»ï¼‰ï¼Œæ•°å€¼è¶Šå°è¶Šç›¸ä¼¼
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>docs</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>embedding</span><span class=w> </span><span class=o>&lt;-&gt;</span><span class=w> </span><span class=s1>&#39;[0.1,0.2,...]&#39;</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>5</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- ä½™å¼¦è·ç¦»ï¼Œæ•°å€¼è¶Šå°è¶Šç›¸ä¼¼ï¼ˆæ³¨æ„æ˜¯è·ç¦»ï¼Œä¸æ˜¯ç›¸ä¼¼åº¦ï¼‰
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>docs</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>embedding</span><span class=w> </span><span class=o>&lt;=&gt;</span><span class=w> </span><span class=s1>&#39;[0.1,0.2,...]&#39;</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>5</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- å†…ç§¯ï¼Œæ•°å€¼è¶Šå¤§è¶Šç›¸ä¼¼
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>docs</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>embedding</span><span class=w> </span><span class=o>&lt;#&gt;</span><span class=w> </span><span class=s1>&#39;[0.1,0.2,...]&#39;</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>5</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å¦‚æœæ˜¯ç”¨ OpenAI æˆ–è€… BGE ç³»åˆ—çš„åµŒå…¥å‘é‡ï¼Œæ¨èç”¨ä½™å¼¦è·ç¦»ï¼ˆ<code>&lt;=></code>ï¼‰ï¼Œå› ä¸ºè¿™äº›æ¨¡å‹è®­ç»ƒæ—¶å°±æ˜¯ä¼˜åŒ–ä½™å¼¦ç›¸ä¼¼åº¦ã€‚</p><h1 id=3spring-ai-110-é›†æˆå®æˆ˜>3ã€Spring AI 1.1.0 é›†æˆå®æˆ˜</h1><h2 id=31-ä¾èµ–é…ç½®>3.1 ä¾èµ–é…ç½®</h2><p>Spring AI 1.1.0 å¯¹ OpenGauss çš„æ”¯æŒè¿˜åœ¨å®Œå–„ä¸­ï¼Œç›®å‰éœ€è¦é€šè¿‡ JDBC æ–¹å¼æ¥å…¥ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependencies&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- Spring AI æ ¸å¿ƒ --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>org.springframework.ai<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>spring-ai-core<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;version&gt;</span>1.1.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- æ•°æ®åº“è¿æ¥ --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>org.postgresql<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>postgresql<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;version&gt;</span>42.7.2<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- è¿æ¥æ±  --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>com.zaxxer<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>HikariCP<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependencies&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>æ³¨æ„ï¼šOpenGauss çš„ JDBC é©±åŠ¨å’Œ PostgreSQL å…¼å®¹ï¼Œç›´æ¥ç”¨ PG çš„é©±åŠ¨å°±è¡Œã€‚</p><h2 id=32-å‘é‡å­˜å‚¨å®ç°>3.2 å‘é‡å­˜å‚¨å®ç°</h2><p>Spring AI çš„ <code>VectorStore</code> æ¥å£éœ€è¦è‡ªå·±å®ç°ï¼Œè¿™é‡Œç»™ä¸ªå®Œæ•´çš„ä¾‹å­ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OpenGaussVectorStore</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>VectorStore</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>JdbcTemplate</span><span class=w> </span><span class=n>jdbcTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>EmbeddingClient</span><span class=w> </span><span class=n>embeddingClient</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>OpenGaussVectorStore</span><span class=p>(</span><span class=n>JdbcTemplate</span><span class=w> </span><span class=n>jdbcTemplate</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                               </span><span class=n>EmbeddingClient</span><span class=w> </span><span class=n>embeddingClient</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>jdbcTemplate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jdbcTemplate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>embeddingClient</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>embeddingClient</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>add</span><span class=p>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Document</span><span class=o>&gt;</span><span class=w> </span><span class=n>documents</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>Document</span><span class=w> </span><span class=n>doc</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>documents</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// ç”ŸæˆåµŒå…¥å‘é‡</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kt>float</span><span class=o>[]</span><span class=w> </span><span class=n>embedding</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>embeddingClient</span><span class=p>.</span><span class=na>embed</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=na>getText</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// å­˜å…¥æ•°æ®åº“</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>jdbcTemplate</span><span class=p>.</span><span class=na>update</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;INSERT INTO documents (content, embedding, metadata) VALUES (?, ?, ?)&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>doc</span><span class=p>.</span><span class=na>getText</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>new</span><span class=w> </span><span class=n>Vector</span><span class=p>(</span><span class=n>embedding</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>doc</span><span class=p>.</span><span class=na>getMetadata</span><span class=p>().</span><span class=na>toString</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Document</span><span class=o>&gt;</span><span class=w> </span><span class=nf>similaritySearch</span><span class=p>(</span><span class=n>SearchRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>float</span><span class=o>[]</span><span class=w> </span><span class=n>queryEmbedding</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>embeddingClient</span><span class=p>.</span><span class=na>embed</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getQuery</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>sql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s>            SELECT id, content, metadata, embedding &lt;=&gt; ? as distance
</span></span></span><span class=line><span class=cl><span class=s>            FROM documents
</span></span></span><span class=line><span class=cl><span class=s>            ORDER BY embedding &lt;=&gt; ?
</span></span></span><span class=line><span class=cl><span class=s>            LIMIT ?
</span></span></span><span class=line><span class=cl><span class=s>            &#34;&#34;&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>jdbcTemplate</span><span class=p>.</span><span class=na>query</span><span class=p>(</span><span class=n>sql</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>(</span><span class=n>rs</span><span class=p>,</span><span class=w> </span><span class=n>rowNum</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Document</span><span class=w> </span><span class=n>doc</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Document</span><span class=p>(</span><span class=n>rs</span><span class=p>.</span><span class=na>getString</span><span class=p>(</span><span class=s>&#34;content&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>doc</span><span class=p>.</span><span class=na>getMetadata</span><span class=p>().</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>rs</span><span class=p>.</span><span class=na>getLong</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>doc</span><span class=p>.</span><span class=na>getMetadata</span><span class=p>().</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;distance&#34;</span><span class=p>,</span><span class=w> </span><span class=n>rs</span><span class=p>.</span><span class=na>getFloat</span><span class=p>(</span><span class=s>&#34;distance&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>doc</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>Vector</span><span class=p>(</span><span class=n>queryEmbedding</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>Vector</span><span class=p>(</span><span class=n>queryEmbedding</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>request</span><span class=p>.</span><span class=na>getTopK</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>delete</span><span class=p>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>docIds</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>sql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;DELETE FROM documents WHERE id = ?&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>docIds</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>jdbcTemplate</span><span class=p>.</span><span class=na>update</span><span class=p>(</span><span class=n>sql</span><span class=p>,</span><span class=w> </span><span class=n>Long</span><span class=p>.</span><span class=na>parseLong</span><span class=p>(</span><span class=n>id</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>è¿™é‡Œæœ‰ä¸ªå°å‘ï¼šSpring AI çš„ <code>Vector</code> ç±»å‹éœ€è¦è‡ªå·±å¤„ç†ï¼ŒOpenGauss çš„ JDBC é©±åŠ¨å¯¹å‘é‡ç±»å‹æ”¯æŒè¿˜ä¸å¤Ÿå®Œå–„ï¼Œå»ºè®®ç”¨ <code>float[]</code> æ•°ç»„é…åˆè‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨ã€‚</p><h2 id=33-rag-æœåŠ¡å°è£…>3.3 RAG æœåŠ¡å°è£…</h2><p>æœ‰äº†å‘é‡å­˜å‚¨ï¼ŒRAG æœåŠ¡å°±ç®€å•äº†ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>RagService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>OpenGaussVectorStore</span><span class=w> </span><span class=n>vectorStore</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ChatClient</span><span class=w> </span><span class=n>chatClient</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>RagService</span><span class=p>(</span><span class=n>OpenGaussVectorStore</span><span class=w> </span><span class=n>vectorStore</span><span class=p>,</span><span class=w> </span><span class=n>ChatClient</span><span class=w> </span><span class=n>chatClient</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>vectorStore</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vectorStore</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>chatClient</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>chatClient</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>query</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>question</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 1. å‘é‡æ£€ç´¢</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Document</span><span class=o>&gt;</span><span class=w> </span><span class=n>documents</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vectorStore</span><span class=p>.</span><span class=na>similaritySearch</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>SearchRequest</span><span class=p>.</span><span class=na>query</span><span class=p>(</span><span class=n>question</span><span class=p>).</span><span class=na>withTopK</span><span class=p>(</span><span class=n>5</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 2. æ„å»ºæç¤ºè¯</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>context</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>documents</span><span class=p>.</span><span class=na>stream</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>Document</span><span class=p>::</span><span class=n>getText</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>joining</span><span class=p>(</span><span class=s>&#34;\n\n&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>prompt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s>            åŸºäºä»¥ä¸‹ä¸Šä¸‹æ–‡ä¿¡æ¯å›ç­”é—®é¢˜ï¼š
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>            ä¸Šä¸‹æ–‡ï¼š
</span></span></span><span class=line><span class=cl><span class=s>            %s
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>            é—®é¢˜ï¼š%s
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>            è¯·ç»™å‡ºå‡†ç¡®ã€ç®€æ´çš„å›ç­”ã€‚
</span></span></span><span class=line><span class=cl><span class=s>            &#34;&#34;&#34;</span><span class=p>,</span><span class=w> </span><span class=n>context</span><span class=p>,</span><span class=w> </span><span class=n>question</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 3. è°ƒç”¨å¤§æ¨¡å‹</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>chatClient</span><span class=p>.</span><span class=na>call</span><span class=p>(</span><span class=n>prompt</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// æ‰¹é‡å¯¼å…¥æ–‡æ¡£</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>importDocuments</span><span class=p>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>texts</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Document</span><span class=o>&gt;</span><span class=w> </span><span class=n>docs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>texts</span><span class=p>.</span><span class=na>stream</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>text</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Document</span><span class=p>(</span><span class=n>text</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>toList</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>vectorStore</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>docs</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h1 id=4æ€§èƒ½ä¼˜åŒ–å®è·µ>4ã€æ€§èƒ½ä¼˜åŒ–å®è·µ</h1><h2 id=41-ç´¢å¼•è°ƒä¼˜>4.1 ç´¢å¼•è°ƒä¼˜</h2><p>åœ¨å®é™…æµ‹è¯•ä¸­ï¼ŒHNSW ç´¢å¼•çš„å‚æ•°è°ƒä¼˜å¾ˆå…³é”®ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- m: æ¯ä¸ªèŠ‚ç‚¹çš„é‚»å±…æ•°ï¼Œè¶Šå¤§è¶Šç²¾ç¡®ä½†ç´¢å¼•è¶Šå¤§ï¼Œé€šå¸¸ 16-32
</span></span></span><span class=line><span class=cl><span class=c1>-- ef_construction: æ„å»ºæ—¶çš„æœç´¢èŒƒå›´ï¼Œè¶Šå¤§è´¨é‡è¶Šå¥½ä½†æ„å»ºæ…¢
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_hnsw_optimized</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>documents</span><span class=w> </span><span class=k>USING</span><span class=w> </span><span class=n>hnsw</span><span class=w> </span><span class=p>(</span><span class=n>embedding</span><span class=w> </span><span class=n>vector_l2_ops</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WITH</span><span class=w> </span><span class=p>(</span><span class=n>m</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>24</span><span class=p>,</span><span class=w> </span><span class=n>ef_construction</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>300</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- æŸ¥è¯¢æ—¶çš„æ‰©å±•å› å­ï¼Œè¶Šå¤§è¶Šç²¾ç¡®ä½†æŸ¥è¯¢æ…¢
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SET</span><span class=w> </span><span class=n>hnsw</span><span class=p>.</span><span class=n>ef_search</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>100</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å®æµ‹æ•°æ®ï¼š100ä¸‡æ¡å‘é‡ï¼Œm=24, ef_construction=300 æ—¶ï¼ŒæŸ¥è¯¢å»¶è¿Ÿåœ¨ 10-20msï¼Œå¬å›ç‡ 95%+ã€‚</p><h2 id=42-æ‰¹é‡æ“ä½œä¼˜åŒ–>4.2 æ‰¹é‡æ“ä½œä¼˜åŒ–</h2><p>å‘é‡æ’å…¥æ˜¯æ€§èƒ½ç“¶é¢ˆï¼Œå»ºè®®æ‰¹é‡å¤„ç†ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>batchAdd</span><span class=p>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Document</span><span class=o>&gt;</span><span class=w> </span><span class=n>documents</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>batchSize</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Document</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>batches</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Lists</span><span class=p>.</span><span class=na>partition</span><span class=p>(</span><span class=n>documents</span><span class=p>,</span><span class=w> </span><span class=n>batchSize</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Document</span><span class=o>&gt;</span><span class=w> </span><span class=n>batch</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>batches</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jdbcTemplate</span><span class=p>.</span><span class=na>batchUpdate</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;INSERT INTO documents (content, embedding) VALUES (?, ?)&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>BatchPreparedStatementSetter</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setValues</span><span class=p>(</span><span class=n>PreparedStatement</span><span class=w> </span><span class=n>ps</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>SQLException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>Document</span><span class=w> </span><span class=n>doc</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>batch</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>i</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=kt>float</span><span class=o>[]</span><span class=w> </span><span class=n>embedding</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>embeddingClient</span><span class=p>.</span><span class=na>embed</span><span class=p>(</span><span class=n>doc</span><span class=p>.</span><span class=na>getText</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>ps</span><span class=p>.</span><span class=na>setString</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>doc</span><span class=p>.</span><span class=na>getText</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>ps</span><span class=p>.</span><span class=na>setObject</span><span class=p>(</span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Vector</span><span class=p>(</span><span class=n>embedding</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>public</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>getBatchSize</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=n>batch</span><span class=p>.</span><span class=na>size</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=43-å†·çƒ­åˆ†ç¦»>4.3 å†·çƒ­åˆ†ç¦»</h2><p>å¯¹äºè¶…å¤§è§„æ¨¡æ•°æ®ï¼Œå¯ä»¥è€ƒè™‘å†·çƒ­åˆ†ç¦»ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- çƒ­æ•°æ®ï¼šæœ€è¿‘ 7 å¤©ï¼Œç”¨ HNSW ç´¢å¼•
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>documents_hot</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=n>BIGSERIAL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>content</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>embedding</span><span class=w> </span><span class=n>VECTOR</span><span class=p>(</span><span class=mi>1536</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>created_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>NOW</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_hnsw_hot</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>documents_hot</span><span class=w> </span><span class=k>USING</span><span class=w> </span><span class=n>hnsw</span><span class=w> </span><span class=p>(</span><span class=n>embedding</span><span class=w> </span><span class=n>vector_l2_ops</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- å†·æ•°æ®ï¼šå†å²æ•°æ®ï¼Œç”¨ IVFFLAT ç´¢å¼•çœå†…å­˜
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>documents_cold</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=n>BIGSERIAL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>content</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>embedding</span><span class=w> </span><span class=n>VECTOR</span><span class=p>(</span><span class=mi>1536</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>created_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_ivfflat_cold</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>documents_cold</span><span class=w> </span><span class=k>USING</span><span class=w> </span><span class=n>ivfflat</span><span class=w> </span><span class=p>(</span><span class=n>embedding</span><span class=w> </span><span class=n>vector_l2_ops</span><span class=p>)</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=p>(</span><span class=n>lists</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>500</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>æŸ¥è¯¢æ—¶å…ˆæŸ¥çƒ­è¡¨ï¼Œç»“æœä¸è¶³å†æŸ¥å†·è¡¨ã€‚</p><h1 id=5è¸©å‘è®°å½•>5ã€è¸©å‘è®°å½•</h1><h2 id=51-å‘é‡ç»´åº¦ä¸åŒ¹é…>5.1 å‘é‡ç»´åº¦ä¸åŒ¹é…</h2><p>OpenGauss åˆ›å»ºè¡¨æ—¶æŒ‡å®šäº†å‘é‡ç»´åº¦ï¼Œæ’å…¥æ—¶å¿…é¡»ä¸¥æ ¼åŒ¹é…ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- é”™è¯¯ï¼šç»´åº¦ä¸åŒ¹é…
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>docs</span><span class=w> </span><span class=p>(</span><span class=n>embedding</span><span class=w> </span><span class=n>VECTOR</span><span class=p>(</span><span class=mi>768</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>docs</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;[0.1,0.2]&#39;</span><span class=p>);</span><span class=w>  </span><span class=c1>-- 2ç»´ï¼ŒæŠ¥é”™
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- æ­£ç¡®ï¼šç»´åº¦ä¸€è‡´
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>docs</span><span class=w> </span><span class=p>(</span><span class=n>embedding</span><span class=w> </span><span class=n>VECTOR</span><span class=p>(</span><span class=mi>1536</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>docs</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=nb>ARRAY</span><span class=p>[</span><span class=mi>0</span><span class=p>.</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>.</span><span class=mi>2</span><span class=p>,...]::</span><span class=nb>float</span><span class=p>[]);</span><span class=w>  </span><span class=c1>-- 1536ç»´
</span></span></span></code></pre></td></tr></table></div></div><h2 id=52-é©±åŠ¨å…¼å®¹æ€§é—®é¢˜>5.2 é©±åŠ¨å…¼å®¹æ€§é—®é¢˜</h2><p>OpenGauss çš„å‘é‡ç±»å‹åœ¨æ ‡å‡† PG é©±åŠ¨ä¸­ä¸è¢«è¯†åˆ«ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>VectorTypeHandler</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>TypeHandler</span><span class=o>&lt;</span><span class=kt>float</span><span class=o>[]&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setParameter</span><span class=p>(</span><span class=n>PreparedStatement</span><span class=w> </span><span class=n>ps</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=kt>float</span><span class=o>[]</span><span class=w> </span><span class=n>parameter</span><span class=p>,</span><span class=w> </span><span class=n>JdbcType</span><span class=w> </span><span class=n>jdbcType</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>SQLException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// è½¬æ¢ä¸º PostgreSQL æ•°ç»„æ ¼å¼</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>arrayStr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Arrays</span><span class=p>.</span><span class=na>toString</span><span class=p>(</span><span class=n>parameter</span><span class=p>).</span><span class=na>replace</span><span class=p>(</span><span class=s>&#34;[&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;{&#34;</span><span class=p>).</span><span class=na>replace</span><span class=p>(</span><span class=s>&#34;]&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;}&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ps</span><span class=p>.</span><span class=na>setObject</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>arrayStr</span><span class=p>,</span><span class=w> </span><span class=n>Types</span><span class=p>.</span><span class=na>OTHER</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>float</span><span class=o>[]</span><span class=w> </span><span class=nf>getResult</span><span class=p>(</span><span class=n>ResultSet</span><span class=w> </span><span class=n>rs</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>columnName</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>SQLException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>arrayStr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rs</span><span class=p>.</span><span class=na>getString</span><span class=p>(</span><span class=n>columnName</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>parseVector</span><span class=p>(</span><span class=n>arrayStr</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=53-å†…å­˜å ç”¨>5.3 å†…å­˜å ç”¨</h2><p>HNSW ç´¢å¼•è™½ç„¶æŸ¥è¯¢å¿«ï¼Œä½†å†…å­˜å ç”¨ä¸å°ã€‚100ä¸‡æ¡ 1536 ç»´å‘é‡ï¼Œå¤§çº¦éœ€è¦ 8-10GB å†…å­˜ã€‚å¦‚æœå†…å­˜ç´§å¼ ï¼Œå¯ä»¥è€ƒè™‘ï¼š</p><ul><li>ç”¨ IVF-PQ å‹ç¼©</li><li>é™ä½å‘é‡ç»´åº¦ï¼ˆç”¨ PCA é™ç»´ï¼‰</li><li>åˆ†ç‰‡å­˜å‚¨</li></ul><h1 id=6æ€»ç»“>6ã€æ€»ç»“</h1><p>OpenGauss çš„å‘é‡èƒ½åŠ›ç¡®å®ä¸é”™ï¼Œç‰¹åˆ«æ˜¯ HNSW ç´¢å¼•çš„æ€§èƒ½è¡¨ç°ã€‚å’Œ Spring AI é›†æˆæ—¶ï¼Œä¸»è¦å·¥ä½œé‡åœ¨ JDBC é©±åŠ¨é€‚é…å’Œç±»å‹å¤„ç†ä¸Šã€‚</p><p>ç›¸æ¯”å…¶ä»–å‘é‡æ•°æ®åº“ï¼ŒOpenGauss çš„ä¼˜åŠ¿åœ¨äºï¼š</p><ul><li>åŸç”Ÿ SQL æ”¯æŒï¼Œå­¦ä¹ æˆæœ¬ä½</li><li>äº‹åŠ¡ä¸€è‡´æ€§ï¼Œæ•°æ®å¯é æ€§é«˜</li><li>å›½äº§åŒ–ï¼Œåˆè§„æ€§å¥½</li></ul><p>ç¼ºç‚¹æ˜¯ç”Ÿæ€è¿˜åœ¨å®Œå–„ä¸­ï¼Œä¸€äº›é«˜çº§åŠŸèƒ½éœ€è¦è‡ªå·±é€ è½®å­ã€‚</p><p>å¯¹äºæƒ³åœ¨ç°æœ‰ç³»ç»Ÿä¸­åŠ å…¥ RAG èƒ½åŠ›çš„å›¢é˜Ÿï¼ŒOpenGauss æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œç‰¹åˆ«æ˜¯å·²ç»åœ¨ç”¨ PG æˆ–è€… OpenGauss çš„åœºæ™¯ï¼Œè¿ç§»æˆæœ¬å¾ˆä½ã€‚</p><p>ä»£ç ç¤ºä¾‹å’Œå®Œæ•´é¡¹ç›®ç»“æ„ï¼Œå¯ä»¥å‚è€ƒä¸Šé¢çš„å®ç°æ€è·¯ï¼Œæ ¹æ®å…·ä½“ä¸šåŠ¡è°ƒæ•´å³å¯ã€‚</p></section><footer class=article-footer><section class=article-tags><a href=/Blog/tags/rag/>RAG</a>
<a href=/Blog/tags/springai/>SpringAI</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>CC BY-NC 4.0</span></section></footer></article><footer class=site-footer><section class=copyright>&copy;
2024 -
2026 Â© {year} XFFF</section><section class=powerby>ç”¨ Hugo + GitHub Pages é©±åŠ¨<br>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.32.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/Blog/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><style>#TableOfContents>ul,ol{ul, ol { display: none; } .open { display: block; }}#backTopBtn{display:none;position:fixed;bottom:30px;right:30px;z-index:99;cursor:pointer;width:30px;height:30px;background:var(--accent-color);border-radius:50%;background-size:contain;background-repeat:no-repeat}#backTopBtn:before{content:"â†‘";color:var(--accent-color-text);display:flex;align-items:center;justify-content:center;width:100%;height:100%;font-size:20px}.highlight{max-height:400px;overflow:hidden;position:relative}.code-show{max-height:none!important}.code-more-box{width:100%;padding-top:78px;background-image:-webkit-gradient(linear,left top,left bottom,from(rgba(255,255,255,0)),to(#fff));position:absolute;left:0;right:0;bottom:0;z-index:1}[data-scheme=dark] .code-more-box{background-image:-webkit-gradient(linear,left top,left bottom,from(rgba(66,66,66,0)),to(#424242))}.code-more-btn{display:block;margin:auto;width:44px;height:22px;background:#f0f0f5;border-top-left-radius:8px;border-top-right-radius:8px;padding-top:6px;cursor:pointer}[data-scheme=dark] .code-more-btn{background:#545454}.code-more-img{cursor:pointer!important;display:block;margin:auto;width:22px;height:16px}body{background:url(https://0607pass.github.io/Blog/background/bg.jpg)no-repeat 50% 0;background-size:cover;background-attachment:fixed}#particles-js{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;pointer-events:none}#aplayer{z-index:9999}.aplayer{z-index:9999!important}.article-content p:has(>img:only-child){line-height:0!important;margin-bottom:20px!important}.article-content figure.gallery-image{margin:0;padding:0;display:block}.pswp{transition:none!important}.article-content a[href*=".png"],.article-content a[href*=".jpg"],.article-content a[href*=".jpeg"],.article-content a[href*=".gif"]{display:inline-block;line-height:0}</style><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css><div id=aplayer></div><script src=https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js></script><script src=https://cdn.jsdelivr.net/npm/pjax/pjax.min.js></script><script src=/Blog/js/gallery-fix.js></script><script>const BG_IMAGE_URL="https://0607pass.github.io/Blog/background/bg.jpg",SAKURA_URL="https://0607pass.github.io/Blog/background/sakura.js",PARTICLES_SCRIPT_URL="https://0607pass.github.io/Blog/background/particles.min.js",PARTICLES_CONFIG_URL="https://0607pass.github.io/Blog/background/particlesjs-config.json";function initTocHide(){let e=document.querySelector(".widget--toc");if(!e)return;window.addEventListener("scroll",function(){let n=document.querySelectorAll(".open");n.length>0&&n.forEach(e=>e.classList.remove("open"));let t=document.querySelector(".active-class");if(!t)return;t.children.length>1&&t.children[1].classList.add("open");let e=t.parentElement;do e.classList.add("open"),e=e.parentElement.parentElement;while(e!==0[0]&&(e.localName==="ul"||e.localName==="ol"))})}function initScrollTop(){let t=document.querySelector(".right-sidebar");if(!t)return;let e=document.createElement("div");e.id="backTopBtn",e.onclick=backToTop,t.appendChild(e),window.onscroll=function(){document.body.scrollTop>20||document.documentElement.scrollTop>20?e.style.display="block":e.style.display="none"}}function backToTop(){window.scrollTo({top:0,behavior:"smooth"})}function initCodeMoreBox(){let e=document.querySelectorAll(".highlight");if(!e)return;e.forEach(e=>{if(e.scrollHeight<=e.clientHeight)return;let n=document.createElement("div");n.classList.add("code-more-box");let t=document.createElement("span");t.classList.add("code-more-btn"),t.addEventListener("click",()=>{e.classList.add("code-show"),n.style.display="none",window.dispatchEvent(new Event("resize"))}),t.textContent="å±•å¼€",t.style.padding="4px 8px",t.style.fontSize="12px",n.appendChild(t),e.appendChild(n)})}function initBackground(){if(BG_IMAGE_URL&&document.body&&(document.body.style.backgroundImage=`url(${BG_IMAGE_URL})`,document.body.style.backgroundRepeat="no-repeat",document.body.style.backgroundPosition="center top",document.body.style.backgroundSize="cover",document.body.style.backgroundAttachment="fixed"),SAKURA_URL){if(window.__sakuraInstance&&typeof window.__sakuraInstance.destroy=="function")try{window.__sakuraInstance.destroy()}catch{}const t=document.querySelector('script[src="'+SAKURA_URL+'"]');t&&t.remove();const e=document.createElement("script");e.src=SAKURA_URL,e.onload=()=>{window.__sakuraInstance=!0},document.body.appendChild(e)}if(PARTICLES_SCRIPT_URL&&PARTICLES_CONFIG_URL){let e=document.getElementById("particles-js");if(e||(e=document.createElement("div"),e.id="particles-js",document.body.prepend(e)),window.pJSDom&&window.pJSDom.length&&(window.pJSDom.forEach(e=>{e.pJS&&e.pJS.fn&&e.pJS.fn.vendors&&e.pJS.fn.vendors.destroypJS&&e.pJS.fn.vendors.destroypJS()}),window.pJSDom=[]),window.__particlesScriptLoaded)window.particlesJS&&setTimeout(()=>{window.particlesJS&&document.getElementById("particles-js")&&window.particlesJS.load("particles-js",PARTICLES_CONFIG_URL)},100);else{window.__particlesScriptLoaded=!0;const e=document.createElement("script");e.src=PARTICLES_SCRIPT_URL,e.onload=()=>{window.particlesJS&&window.particlesJS.load("particles-js",PARTICLES_CONFIG_URL)},document.body.appendChild(e)}}}function initAll(){initTocHide(),initScrollTop(),initCodeMoreBox(),initBackground(),window.Stack&&typeof window.Stack.init=="function"&&window.Stack.init(),window.applyGalleryFix&&window.applyGalleryFix()}initAll(),function(){if(window.__aplayerInstance)return;const a=document.getElementById("aplayer");if(!a||!window.APlayer)return;const c="https://0607pass.github.io/Blog/",n=e=>`${c}mp3/${encodeURIComponent(e)}`,s=[{name:"å¯æƒœæ²¡å¦‚æœ",artist:"æ—ä¿Šæ°",url:n("æ—ä¿Šæ°-å¯æƒœæ²¡å¦‚æœ.mp3"),cover:"https://picsum.photos/200/200?random=13"},{name:"æŸ¥æ— æ­¤å­—",artist:"æ—å¥•åŒ¡",url:n("æŸ¥æ— æ­¤å­—-æ—å¥•åŒ¡#eQSOo.mp3"),cover:"https://picsum.photos/200/200?random=11"},{name:"æˆ‘æ€€å¿µçš„",artist:"å­™ç‡•å§¿",url:n("å­™ç‡•å§¿-æˆ‘æ€€å¿µçš„.mp3"),cover:"https://picsum.photos/200/200?random=12"},{name:"è€ç”·å­©",artist:"ç­·å­å…„å¼Ÿ",url:n("ç­·å­å…„å¼Ÿ-è€ç”·å­©.mp3"),cover:"https://picsum.photos/200/200?random=196"},{name:"å‡ºç°åˆç¦»å¼€ï¼ˆLiveï¼‰",artist:"æ¢åš",url:n("å‡ºç°åˆç¦»å¼€.mp3"),cover:"https://picsum.photos/200/200?random=19"}];if(!s.length)return;const r="aplayer-play-info";let o=null;try{const e=localStorage.getItem(r);o=e?JSON.parse(e):null}catch(e){console.error("APlayer restore parse error",e)}const t=new APlayer({container:a,fixed:!0,autoplay:!1,lrcType:0,theme:"#409EFF",audio:s});window.__aplayerInstance=t;const i=()=>{if(!t.audio)return;localStorage.setItem(r,JSON.stringify({index:t.list.index||0,currentTime:t.audio.currentTime||0,paused:t.audio.paused}))};if(window.addEventListener("beforeunload",i),window.addEventListener("pagehide",i),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&i()}),o){const{index:e=0,currentTime:n=0,paused:i=!0}=o;t.on("canplay",function o(){t.off("canplay",o);try{e>=0&&e<s.length&&t.list.switch(e),t.seek(n||0),i===!1?t.play():t.pause()}catch(e){console.error("APlayer restore failed",e)}})}}(),function(){if(window.__pjaxInstance||!window.Pjax)return;if(window.Pjax&&window.Pjax.prototype){const e=window.Pjax.prototype.handleResponse;window.Pjax.prototype.handleResponse=function(t,n,s,o){try{if(n&&n.responseText&&n.responseText.match("<html")){const t=new DOMParser,s=t.parseFromString(n.responseText,"text/html"),e=s.body.className;e&&document.body.className!==e&&(document.body.className=e)}}catch(e){console.warn("PJAX handleResponse error:",e)}return e.call(this,t,n,s,o)}}window.__pjaxInstance=new Pjax({selectors:["title",".main-container"],cacheBust:!1}),document.addEventListener("pjax:complete",()=>{setTimeout(()=>{initTocHide(),initScrollTop(),initCodeMoreBox(),initBackground(),window.Stack&&typeof window.Stack.init=="function"&&window.Stack.init()},50)}),document.addEventListener("pjax:send",()=>{const e=document.getElementById("particles-js");e&&(e.style.display="block"),BG_IMAGE_URL&&document.body&&(document.body.style.backgroundImage=`url(${BG_IMAGE_URL})`,document.body.style.backgroundRepeat="no-repeat",document.body.style.backgroundPosition="center top",document.body.style.backgroundSize="cover",document.body.style.backgroundAttachment="fixed")})}()</script></body></html>