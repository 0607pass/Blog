+++
date = '2026-01-03T22:11:02+08:00'
draft = false
title = 'Elasticsearch æ ¸å¿ƒæ¦‚å¿µ'
tags = ['Elasticsearch']
categories = ['ä¸­é—´ä»¶']
image = "images/postCover/es.png"
+++
---

# ğŸš€ Elasticsearch æ ¸å¿ƒçŸ¥è¯†æ‰‹å†Œ

## 1. ä»€ä¹ˆæ˜¯ Elasticsearchï¼Ÿ

Elasticsearch æ˜¯ä¸€ä¸ªåŸºäº **Apache Lucene** æ„å»ºçš„å¼€æºã€åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ã€‚å®ƒèƒ½å¤Ÿå¯¹æµ·é‡æ•°æ®è¿›è¡Œè¿‘å®æ—¶çš„å­˜å‚¨ã€æœç´¢å’Œåˆ†æã€‚

###  æ ¸å¿ƒç‰¹æ€§

* **åˆ†å¸ƒå¼æ¶æ„**ï¼šå¤©ç”Ÿæ”¯æŒé›†ç¾¤æ¨¡å¼ï¼Œå¯æ°´å¹³æ‰©å±•è‡³æ•°ç™¾ä¸ªèŠ‚ç‚¹ã€‚
* **å®æ—¶æœç´¢**ï¼šæ•°æ®ä»å†™å…¥åˆ°å¯è¢«æœç´¢ä»…éœ€ç§’çº§å»¶è¿Ÿã€‚
* **å…¨æ–‡æ£€ç´¢**ï¼šæ”¯æŒå¤æ‚çš„æ¨¡ç³ŠåŒ¹é…ã€åˆ†è¯ã€é«˜äº®æ˜¾ç¤ºã€‚
* **RESTful API**ï¼šé€šè¿‡æ ‡å‡†çš„ HTTP æ¥å£å³å¯å®Œæˆæ‰€æœ‰æ“ä½œã€‚
* **é«˜åº¦å¯å®šåˆ¶**ï¼šçµæ´»çš„åˆ†è¯å™¨ã€æŸ¥è¯¢è¯­æ³•ï¼Œé€‚åº”å¤šå˜ä¸šåŠ¡ã€‚

---

## 2. æ ¸å¿ƒæ¦‚å¿µå¯¹æ¯”

ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥å°† Elasticsearch çš„æ¦‚å¿µä¸ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚ MySQLï¼‰è¿›è¡Œç±»æ¯”ï¼š

| Elasticsearch | å…³ç³»å‹æ•°æ®åº“ (RDBMS) | è¯´æ˜ |
| --- | --- | --- |
| **Index (ç´¢å¼•)** | Table (è¡¨) | æ•°æ®çš„é€»è¾‘å®¹å™¨ |
| **Document (æ–‡æ¡£)** | Row (è¡Œ) | æœ€å°çš„æ•°æ®å•ä½ï¼ˆJSON æ ¼å¼ï¼‰ |
| **Field (å­—æ®µ)** | Column (åˆ—) | æ–‡æ¡£çš„å±æ€§ |
| **Mapping (æ˜ å°„)** | Schema (è¡¨ç»“æ„) | å®šä¹‰å­—æ®µç±»å‹åŠå…¶è¡Œä¸º |
| **DSL (æŸ¥è¯¢è¯­è¨€)** | SQL | æœç´¢æ•°æ®çš„ä¸“ç”¨è¯­è¨€ |

### æ‰©å±•æ¦‚å¿µï¼š

* **Clusterï¼ˆé›†ç¾¤ï¼‰**ï¼šç”±ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ç»„æˆï¼Œå…±åŒæ‰¿æ‹…å‹åŠ›ã€‚
* **Nodeï¼ˆèŠ‚ç‚¹ï¼‰**ï¼šé›†ç¾¤ä¸­çš„å•ä¸ªè¿è¡Œå®ä¾‹ã€‚
* **Shardï¼ˆåˆ†ç‰‡ï¼‰**ï¼šå°†ç´¢å¼•æ°´å¹³åˆ‡åˆ†ï¼Œåˆ†å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹ä»¥æå‡æ€§èƒ½ã€‚
* **Replicaï¼ˆå‰¯æœ¬ï¼‰**ï¼šåˆ†ç‰‡çš„æ‹·è´ï¼Œæä¾›å†—ä½™å¤‡ä»½å¹¶æå‡æŸ¥è¯¢ååé‡ã€‚

---

## 3. å¿«é€Ÿéƒ¨ç½² (Docker)

### å¯åŠ¨ Elasticsearch

```bash
docker run -d \
  --name es7 \
  -p 9200:9200 -p 9300:9300 \
  -e "discovery.type=single-node" \
  -e ES_JAVA_OPTS="-Xms1024m -Xmx1024m" \
  -v /home/xfff/docker/elasticsearch/config:/usr/share/elasticsearch/config \
  -v /home/xfff/docker/elasticsearch/data:/usr/share/elasticsearch/data \
  -v /home/xfff/docker/elasticsearch/plugins:/usr/share/elasticsearch/plugins \
  -v /home/xfff/docker/elasticsearch/logs:/usr/share/elasticsearch/logs \
  elasticsearch:7.3.0

```

### å¯åŠ¨ Kibana å¯è§†åŒ–å·¥å…·

Kibana ç”¨äºæ•°æ®æ¢ç´¢å’Œ Dev Tools è°ƒè¯•ã€‚

1. **å¯åŠ¨å®¹å™¨**ï¼š`docker run -d --name kibana -p 5601:5601 kibana:7.3.0`
2. **é…ç½®**ï¼šä¿®æ”¹ `kibana.yml` é…ç½®æ–‡ä»¶ã€‚
```yaml
server.name: kibana
server.host: "0.0.0.0"
elasticsearch.hosts: [ "http://<å®¿ä¸»æœºIP>:9200" ]
i18n.locale: "zh-CN" # è®¾ç½®ä¸­æ–‡ç•Œé¢

```


3. **è®¿é—®**ï¼š`http://æœåŠ¡å™¨IP:5601`

---

## 4. åŸºç¡€è¯­æ³•æ“ä½œ (Dev Tools)

### 4.1 ç´¢å¼•ç®¡ç†

* **åˆ›å»ºç´¢å¼•ï¼ˆæŒ‡å®šåˆ†ç‰‡ä¸å‰¯æœ¬ï¼‰**ï¼š
```http
PUT /note
{
   "settings": {
      "number_of_shards": 2,
      "number_of_replicas": 2
   }
}

```


* **ç»“æ„åŒ–åˆ›å»ºï¼ˆæŒ‡å®š Mappingï¼‰**ï¼š
```http
PUT /note
{
   "mappings": {
     "properties": {
       "title": {"type": "text"},
       "create_time": {
         "type": "date",
         "format": "yyyy-MM-dd HH:mm:ss"
       } 
     }
   }
}

```



### 4.2 æ–‡æ¡£ CRUD

* **æ·»åŠ /å…¨é‡æ›´æ–°**ï¼š`PUT /note/_doc/1 { "title": "å†…å®¹" }`
* **æŒ‡å®šå­—æ®µæ›´æ–°**ï¼š
```http
POST /note/_update/1
{ "doc": { "title": "æ–°æ ‡é¢˜" } }

```


* **å¼ºåˆ¶åˆ›å»ºï¼ˆå·²å­˜åœ¨åˆ™æŠ¥é”™ï¼‰**ï¼š`PUT /note/_create/1 { ... }`
* **åˆ é™¤**ï¼š`DELETE /note/_doc/1`

---

## 5. é«˜çº§æœç´¢ä¸è¿‡æ»¤

### 5.1 åˆ†é¡µä¸æ’åº

```http
GET /note/_search
{
  "query": { "match_all": {} },
  "from": 0,
  "size": 10,
  "sort": [ { "create_time": { "order": "desc" } } ]
}

```

### 5.2 æ ¸å¿ƒæŸ¥è¯¢åŒºåˆ«ï¼šMatch vs Term

* **`match`**ï¼šå…¨æ–‡æ£€ç´¢ã€‚ä¼šå°†æœç´¢è¯å…ˆåˆ†è¯ï¼Œå†åŒ¹é…ã€‚
* **`term`**ï¼šç²¾ç¡®åŒ¹é…ã€‚ä¸åˆ†è¯ï¼Œæœç´¢è¯å¿…é¡»ä¸ç´¢å¼•ä¸­çš„è¯é¡¹å®Œå…¨ä¸€è‡´ã€‚

> **âš ï¸ è¸©å‘æç¤º**ï¼šé»˜è®¤åˆ†è¯ä¸‹ï¼Œä¸­æ–‡ä¼šè¢«æ‹†åˆ†ä¸ºå•ä¸ªæ±‰å­—ã€‚è‹¥ç”¨ `term` æœç´¢â€œç§‹å­£â€ï¼Œè€Œç´¢å¼•ä¸­åªæœ‰â€œç§‹â€å’Œâ€œå­£â€ï¼Œåˆ™æ— æ³•åŒ¹é…ã€‚

### 5.3 Filter è¿‡æ»¤

`filter` åŒ…å«åœ¨ `bool` æŸ¥è¯¢ä¸­ï¼Œå…¶ç‰¹ç‚¹æ˜¯ä¸è®¡ç®—ç›¸å…³æ€§è¯„åˆ†ï¼Œ**æ€§èƒ½æ›´é«˜ä¸”æ”¯æŒç¼“å­˜**ã€‚

```http
GET /note/_search
{
  "query": {
    "bool": {
      "filter": { "match": { "title": "ç§‹å­£" } }
    }
  }
}

```

### 5.4 èšåˆæŸ¥è¯¢ (Aggregation)

ç±»ä¼¼äº SQL çš„ `GROUP BY`ã€‚

```http
GET /note/_search
{
  "aggs": {
    "group_by_time": {
      "terms": { "field": "create_time" }
    }
  }
}

```

---

## 6. åº”ç”¨åœºæ™¯

1. **ELK æ—¥å¿—åˆ†æ**ï¼šLogstash æ”¶é›†  ES å­˜å‚¨  Kibana å±•ç¤ºã€‚
2. **å‚ç›´æœç´¢**ï¼šç”µå•†å•†å“æœç´¢ã€ç«™å†…æœç´¢ã€‚
3. **æ—¶åºæ•°æ®**ï¼šç›‘æ§æŒ‡æ ‡å­˜å‚¨ä¸å®æ—¶å‘Šè­¦ã€‚
4. **æ¨èç³»ç»Ÿ**ï¼šåŸºäºèšåˆåˆ†æçš„ç”¨æˆ·ç”»åƒåˆ†æã€‚

---
