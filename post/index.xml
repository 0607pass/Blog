<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on XFFF çš„ç‹¬ç«‹åšå®¢</title><link>https://0607pass.github.io/Blog/post/</link><description>Recent content in Posts on XFFF çš„ç‹¬ç«‹åšå®¢</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><copyright>Â© {year} XFFF</copyright><lastBuildDate>Sun, 04 Jan 2026 21:32:26 +0800</lastBuildDate><atom:link href="https://0607pass.github.io/Blog/post/index.xml" rel="self" type="application/rss+xml"/><item><title>å€’æ’ç´¢å¼•ä¸åˆ†è¯æœºåˆ¶</title><link>https://0607pass.github.io/Blog/p/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95%E4%B8%8E%E5%88%86%E8%AF%8D%E6%9C%BA%E5%88%B6/</link><pubDate>Sun, 04 Jan 2026 21:32:26 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95%E4%B8%8E%E5%88%86%E8%AF%8D%E6%9C%BA%E5%88%B6/</guid><description>&lt;img src="https://0607pass.github.io/Blog/images/postCover/es.png" alt="Featured image of post å€’æ’ç´¢å¼•ä¸åˆ†è¯æœºåˆ¶" /&gt;&lt;hr&gt;
&lt;h1 id="elasticsearch-æ ¸å¿ƒåŸç†å€’æ’ç´¢å¼•ä¸åˆ†è¯æœºåˆ¶"&gt;Elasticsearch æ ¸å¿ƒåŸç†ï¼šå€’æ’ç´¢å¼•ä¸åˆ†è¯æœºåˆ¶
&lt;/h1&gt;&lt;p&gt;å€’æ’ç´¢å¼•ï¼ˆInverted Indexï¼‰æ˜¯ Elasticsearch å…¨æ–‡æœç´¢èƒ½åŠ›çš„åŸºç¡€ï¼Œä¹Ÿæ˜¯æœç´¢å¼•æ“æ™®éé‡‡ç”¨çš„ä¸€ç§é«˜æ•ˆæ•°æ®ç»“æ„ã€‚é€šè¿‡å€’æ’ç´¢å¼•ï¼ŒElasticsearch å¯ä»¥å¿«é€Ÿå®šä½åŒ…å«æŸä¸ªå…³é”®è¯çš„æ–‡æ¡£ï¼Œæå¤§åœ°æå‡äº†æœç´¢æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h2 id="1-ä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼•"&gt;1. ä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼•ï¼Ÿ
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;å€’æ’ç´¢å¼•&lt;/strong&gt;æ˜¯ä»&lt;strong&gt;å…³é”®è¯åˆ°æ–‡æ¡£&lt;/strong&gt;çš„æ˜ å°„ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ­£æ’ç´¢å¼•ï¼ˆForward Indexï¼‰ï¼š&lt;/strong&gt; å­˜å‚¨çš„æ˜¯â€œæ–‡æ¡£ ID å†…å®¹â€ï¼Œç±»ä¼¼äºä¹¦çš„ç›®å½•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å€’æ’ç´¢å¼•ï¼ˆInverted Indexï¼‰ï¼š&lt;/strong&gt; å­˜å‚¨çš„æ˜¯â€œå…³é”®è¯ æ–‡æ¡£ ID åˆ—è¡¨â€ï¼Œç±»ä¼¼äºä¹¦æœ«å°¾çš„ç´¢å¼•å…³é”®è¯è¡¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="ç®€å•ç¤ºä¾‹"&gt;ç®€å•ç¤ºä¾‹
&lt;/h3&gt;&lt;p&gt;å‡è®¾æœ‰ä»¥ä¸‹ä¸‰ä¸ªæ–‡æ¡£ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ–‡æ¡£ 1:&lt;/strong&gt; Elasticsearch æ˜¯åˆ†å¸ƒå¼å¼•æ“&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–‡æ¡£ 2:&lt;/strong&gt; åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ ¸å¿ƒæ˜¯æœç´¢&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–‡æ¡£ 3:&lt;/strong&gt; æœç´¢å¼•æ“çš„æœªæ¥æ˜¯æ™ºèƒ½åŒ–&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç”Ÿæˆçš„å€’æ’ç´¢å¼•å¦‚ä¸‹è¡¨ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å…³é”®è¯&lt;/th&gt;
&lt;th&gt;æ–‡æ¡£ ID åˆ—è¡¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;elasticsearch&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åˆ†å¸ƒå¼&lt;/td&gt;
&lt;td&gt;1, 2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç³»ç»Ÿ&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ ¸å¿ƒ&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æœç´¢&lt;/td&gt;
&lt;td&gt;2, 3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å¼•æ“&lt;/td&gt;
&lt;td&gt;1, 3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ™ºèƒ½åŒ–&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ•ˆæœï¼š&lt;/strong&gt; å½“ç”¨æˆ·æœç´¢â€œå¼•æ“â€æ—¶ï¼ŒElasticsearch æ— éœ€æ‰«ææ‰€æœ‰æ–‡æ¡£ï¼Œç›´æ¥é€šè¿‡ç´¢å¼•å³å¯é”å®šæ–‡æ¡£ 1 å’Œ 3ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h2 id="2-å€’æ’ç´¢å¼•çš„æ„å»ºè¿‡ç¨‹"&gt;2. å€’æ’ç´¢å¼•çš„æ„å»ºè¿‡ç¨‹
&lt;/h2&gt;&lt;p&gt;Elasticsearch æ„å»ºå€’æ’ç´¢å¼•ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š&lt;/p&gt;
&lt;h3 id="æ­¥éª¤ä¸€åˆ†è¯tokenization"&gt;æ­¥éª¤ä¸€ï¼šåˆ†è¯ï¼ˆTokenizationï¼‰
&lt;/h3&gt;&lt;p&gt;å°†æ–‡æœ¬å†…å®¹æ‹†åˆ†ä¸ºç‹¬ç«‹çš„å•è¯æˆ–çŸ­è¯­ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŸè¯­å¥ï¼š&lt;/strong&gt; &lt;code&gt;Elasticsearch æ˜¯åˆ†å¸ƒå¼å¼•æ“&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†è¯ç»“æœï¼š&lt;/strong&gt; &lt;code&gt;[Elasticsearch, æ˜¯, åˆ†å¸ƒå¼, å¼•æ“]&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="æ­¥éª¤äºŒå½’ä¸€åŒ–normalization"&gt;æ­¥éª¤äºŒï¼šå½’ä¸€åŒ–ï¼ˆNormalizationï¼‰
&lt;/h3&gt;&lt;p&gt;å¯¹åˆ†è¯ç»“æœè¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ï¼Œæé«˜åŒ¹é…æˆåŠŸç‡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è½¬å°å†™ï¼š&lt;/strong&gt; &lt;code&gt;Elasticsearch&lt;/code&gt; &lt;code&gt;elasticsearch&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å»é™¤åœç”¨è¯ï¼š&lt;/strong&gt; åˆ é™¤ â€œçš„â€ã€â€œæ˜¯â€ ç­‰å¯¹æœç´¢è´¡çŒ®è¾ƒå°çš„è¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¯å¹²æå–ï¼š&lt;/strong&gt; å°†è¯æ±‡å½’ä¸ºåŸºæœ¬å½¢å¼ï¼ˆå¦‚ &lt;code&gt;running&lt;/code&gt; &lt;code&gt;run&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="æ­¥éª¤ä¸‰åˆ›å»ºå¹¶å­˜å‚¨ç´¢å¼•"&gt;æ­¥éª¤ä¸‰ï¼šåˆ›å»ºå¹¶å­˜å‚¨ç´¢å¼•
&lt;/h3&gt;&lt;p&gt;æ ¹æ®å¤„ç†åçš„è¯é¡¹å»ºç«‹æ˜ å°„å…³ç³»ï¼Œæœ€ç»ˆå½¢æˆå¯ä¾›æŸ¥è¯¢çš„ç»“æ„ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;elasticsearch&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;åˆ†å¸ƒå¼&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;å¼•æ“&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;æœç´¢&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="3-ç”¨æˆ·å‘èµ·æœç´¢çš„è¿‡ç¨‹"&gt;3. ç”¨æˆ·å‘èµ·æœç´¢çš„è¿‡ç¨‹
&lt;/h2&gt;&lt;p&gt;å½“ç”¨æˆ·æ‰§è¡ŒæŸ¥è¯¢ï¼ˆå¦‚æœç´¢â€œåˆ†å¸ƒå¼æœç´¢â€ï¼‰æ—¶ï¼Œç³»ç»Ÿéµå¾ªä»¥ä¸‹é€»è¾‘ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è§£ææŸ¥è¯¢æ¡ä»¶ï¼š&lt;/strong&gt; å°†æœç´¢è¯è§£æä¸ºåˆ†è¯ç»“æœ &lt;code&gt;[åˆ†å¸ƒå¼, æœç´¢]&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥æ‰¾å€’æ’ç´¢å¼•ï¼š&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;åˆ†å¸ƒå¼&lt;/code&gt; &lt;code&gt;[1, 2]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;æœç´¢&lt;/code&gt; &lt;code&gt;[2, 3]&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;&lt;strong&gt;åˆå¹¶ç»“æœï¼š&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;AND æŸ¥è¯¢ï¼ˆäº¤é›†ï¼‰ï¼š&lt;/strong&gt; è¿”å› &lt;code&gt;[2]&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;OR æŸ¥è¯¢ï¼ˆå¹¶é›†ï¼‰ï¼š&lt;/strong&gt; è¿”å› &lt;code&gt;[1, 2, 3]&lt;/code&gt;ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="4"&gt;
&lt;li&gt;&lt;strong&gt;ç›¸å…³æ€§æ’åºï¼š&lt;/strong&gt; æ ¹æ®ç›¸å…³æ€§è¯„åˆ†ï¼ˆå¦‚ TF-IDF æˆ– BM25ï¼‰å¯¹ç»“æœæ’åºå¹¶è¿”å›ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2 id="4-elasticsearch-åˆ†è¯å™¨analyzer"&gt;4. Elasticsearch åˆ†è¯å™¨ï¼ˆAnalyzerï¼‰
&lt;/h2&gt;&lt;p&gt;åˆ†è¯å™¨æ˜¯å¤„ç†æ–‡æœ¬çš„æ ¸å¿ƒç»„ä»¶ï¼Œå†³å®šäº†æ•°æ®å¦‚ä½•è¢«â€œåˆ‡åˆ†â€å’Œâ€œæ¸…æ´—â€ã€‚&lt;/p&gt;
&lt;h3 id="åˆ†è¯å™¨çš„ä¸‰ä¸ªç»„æˆéƒ¨åˆ†"&gt;åˆ†è¯å™¨çš„ä¸‰ä¸ªç»„æˆéƒ¨åˆ†
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å­—ç¬¦è¿‡æ»¤ï¼ˆCharacter Filtersï¼‰ï¼š&lt;/strong&gt; é¢„å¤„ç†ï¼Œå¦‚å»é™¤ HTML æ ‡ç­¾ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†è¯ï¼ˆTokenizerï¼‰ï¼š&lt;/strong&gt; æ ¸å¿ƒåˆ‡åˆ†é€»è¾‘ï¼ŒæŒ‰ç©ºæ ¼æˆ–ç¬¦å·æ‹†åˆ†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¯é¡¹è¿‡æ»¤ï¼ˆToken Filtersï¼‰ï¼š&lt;/strong&gt; åå¤„ç†ï¼Œå¦‚è½¬å°å†™ã€å»åœç”¨è¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="å¸¸è§å†…ç½®åˆ†è¯å™¨å¯¹æ¯”"&gt;å¸¸è§å†…ç½®åˆ†è¯å™¨å¯¹æ¯”
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åˆ†è¯å™¨ç±»å‹&lt;/th&gt;
&lt;th&gt;ç‰¹ç‚¹è¯´æ˜&lt;/th&gt;
&lt;th&gt;ç¤ºä¾‹è¾“å…¥&lt;/th&gt;
&lt;th&gt;åˆ†è¯ç»“æœ&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Standard&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é»˜è®¤åˆ†è¯å™¨ï¼ŒæŒ‰æ ‡å‡†è¯­æ³•åˆ‡åˆ†å¹¶è½¬å°å†™&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Elasticsearch is powerful.&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;[&amp;quot;elasticsearch&amp;quot;, &amp;quot;is&amp;quot;, &amp;quot;powerful&amp;quot;]&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Simple&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…æŒ‰éå­—æ¯å­—ç¬¦åˆ‡åˆ†ï¼Œè¿‡æ»¤æ•°å­—å’Œç¬¦å·&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Text123 data!&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;[&amp;quot;text&amp;quot;, &amp;quot;data&amp;quot;]&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Whitespace&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä»…ä»¥ç©ºæ ¼åˆ†è¯ï¼Œä¸å¤„ç†å¤§å°å†™&lt;/td&gt;
&lt;td&gt;&lt;code&gt;The quick&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;[&amp;quot;The&amp;quot;, &amp;quot;quick&amp;quot;]&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Keyword&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ä¸åˆ†è¯ï¼Œå°†æ•´æ¡è¾“å…¥ä½œä¸ºä¸€ä¸ªè¯é¡¹&lt;/td&gt;
&lt;td&gt;&lt;code&gt;user_id:123&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;[&amp;quot;user_id:123&amp;quot;]&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Stop&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åœ¨ Standard åŸºç¡€ä¸Šç§»é™¤åœç”¨è¯&lt;/td&gt;
&lt;td&gt;&lt;code&gt;The quick&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;[&amp;quot;quick&amp;quot;]&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="éªŒè¯åˆ†è¯æ•ˆæœ"&gt;éªŒè¯åˆ†è¯æ•ˆæœ
&lt;/h3&gt;&lt;p&gt;åœ¨ Elasticsearch Dev Tools ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code&gt;_analyze&lt;/code&gt; API è¿›è¡Œæµ‹è¯•ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-http" data-lang="http"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;POST /_analyze
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;analyzer&amp;#34;: &amp;#34;standard&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;text&amp;#34;: &amp;#34;Elasticsearch is powerful.&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿™ä»½å…³äº &lt;strong&gt;IK ä¸­æ–‡åˆ†è¯å™¨&lt;/strong&gt; çš„è¯¦ç»†æ•™ç¨‹å·²æ•´ç†ä¸º Markdown æ ¼å¼ã€‚æˆ‘å·²æŒ‰ç…§æ‚¨çš„è¦æ±‚ï¼Œå°†ç¤ºä¾‹å†…å®¹æ›¿æ¢ä¸ºæ›´å…·é€šç”¨æ€§çš„æŠ€æœ¯æ–‡æœ¬ï¼ˆå»é™¤äº†åŸæœ‰çš„ç‰¹å®šåç§°ï¼‰ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id="elasticsearch-ik-ä¸­æ–‡åˆ†è¯å™¨è¯¦è§£"&gt;Elasticsearch ï¼šIK ä¸­æ–‡åˆ†è¯å™¨è¯¦è§£
&lt;/h1&gt;&lt;p&gt;åœ¨å¤„ç†è‹±æ–‡æ–‡æœ¬æ—¶ï¼Œç”±äºè¯ä¸è¯ä¹‹é—´æœ‰ç©ºæ ¼ï¼ŒæŒ‰ç©ºæ ¼åˆ†è¯éå¸¸æ–¹ä¾¿ã€‚ä½†ä¸­æ–‡å¥å­æ˜¯è¿ç»­çš„ï¼Œé»˜è®¤çš„ &lt;code&gt;standard&lt;/code&gt; åˆ†è¯å™¨åªèƒ½ç®€å•åœ°â€œä¸€å­—ä¸€åˆ†â€ï¼Œæ— æ³•è¯†åˆ«ä¸­æ–‡è¯æ±‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;IK åˆ†è¯å™¨ï¼ˆIK Analyzerï¼‰&lt;/strong&gt; æ˜¯ä¸€ä¸ªä¸“é—¨ä¸ºä¸­æ–‡è®¾è®¡çš„åˆ†è¯æ’ä»¶ï¼Œæ”¯æŒç»†ç²’åº¦åˆ†è¯å’Œæ™ºèƒ½åˆ†è¯ï¼Œæ˜¯ç›®å‰ Elasticsearch ä¸­æ–‡æœç´¢åœºæ™¯ä¸‹çš„é¦–é€‰æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h2 id="1-ä»€ä¹ˆæ˜¯-ik-ä¸­æ–‡åˆ†è¯å™¨"&gt;1. ä»€ä¹ˆæ˜¯ IK ä¸­æ–‡åˆ†è¯å™¨ï¼Ÿ
&lt;/h2&gt;&lt;p&gt;IK åˆ†è¯å™¨æ˜¯åŸºäº Apache Lucene çš„ä¸­æ–‡åˆ†è¯æ’ä»¶ï¼Œä¸“ä¸º Elasticsearch æä¾›æ”¯æŒã€‚å®ƒèƒ½æ ¹æ®å†…ç½®è¯å…¸å’Œè¯­ä¹‰è§„åˆ™ï¼Œå°†ä¸­æ–‡å¥å­æ‹†åˆ†ä¸ºå…·å¤‡å®é™…æ„ä¹‰çš„è¯æ¡ã€‚&lt;/p&gt;
&lt;h3 id="ä¸»è¦ç‰¹ç‚¹"&gt;ä¸»è¦ç‰¹ç‚¹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸¤ç§æ¨¡å¼ï¼š&lt;/strong&gt; æ”¯æŒç»†ç²’åº¦åˆ†è¯ï¼ˆ&lt;code&gt;ik_max_word&lt;/code&gt;ï¼‰å’Œæ™ºèƒ½åˆ†è¯ï¼ˆ&lt;code&gt;ik_smart&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰©å±•æ€§ï¼š&lt;/strong&gt; æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰æ‰©å±•è¯å…¸ï¼Œæ·»åŠ è¡Œä¸šæœ¯è¯­æˆ–ç½‘ç»œæµè¡Œè¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€è°ƒæ•´ï¼š&lt;/strong&gt; æ”¯æŒçƒ­æ›´æ–°è¯å…¸ï¼Œæ— éœ€é‡å¯æœåŠ¡å³å¯æ›´æ–°åˆ†è¯è§„åˆ™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="2-å®‰è£…-ik-æ’ä»¶docker-ç¯å¢ƒ"&gt;2. å®‰è£… IK æ’ä»¶ï¼ˆDocker ç¯å¢ƒï¼‰
&lt;/h2&gt;&lt;h3 id="ç¬¬ä¸€æ­¥è¿›å…¥å®¹å™¨å†…éƒ¨"&gt;ç¬¬ä¸€æ­¥ï¼šè¿›å…¥å®¹å™¨å†…éƒ¨
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker &lt;span class="nb"&gt;exec&lt;/span&gt; -it es7 /bin/sh
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿›å…¥åé€šè¿‡ &lt;code&gt;ls&lt;/code&gt; å‘½ä»¤å¯ä»¥ç¡®è®¤å½“å‰å¤„äº Elasticsearch çš„æ ¹ç›®å½•ã€‚&lt;/p&gt;
&lt;h3 id="ç¬¬äºŒæ­¥æ‰§è¡Œå®‰è£…å‘½ä»¤"&gt;ç¬¬äºŒæ­¥ï¼šæ‰§è¡Œå®‰è£…å‘½ä»¤
&lt;/h3&gt;&lt;p&gt;è¿è¡Œä»¥ä¸‹å‘½ä»¤ä¸‹è½½å¹¶å®‰è£… IK æ’ä»¶ï¼ˆè¯·æ ¹æ®æ‚¨çš„ ES ç‰ˆæœ¬è°ƒæ•´ç‰ˆæœ¬å·ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;bin/elasticsearch-plugin install https://get.infini.cloud/elasticsearch/analysis-ik/7.3.0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å®‰è£…è¿‡ç¨‹ä¸­æç¤ºç¡®è®¤æ—¶ï¼Œè¾“å…¥ &lt;code&gt;y&lt;/code&gt; å¹¶å›è½¦ã€‚&lt;/p&gt;
&lt;h3 id="ç¬¬ä¸‰æ­¥å¤‡ä»½æ’ä»¶æ–‡ä»¶å¯é€‰ä½†æ¨è"&gt;ç¬¬ä¸‰æ­¥ï¼šå¤‡ä»½æ’ä»¶æ–‡ä»¶ï¼ˆå¯é€‰ä½†æ¨èï¼‰
&lt;/h3&gt;&lt;p&gt;é€€å‡ºå®¹å™¨åï¼Œå°†æ’ä»¶åŠé…ç½®æ–‡ä»¶å¤åˆ¶åˆ°å®¿ä¸»æœºï¼Œé˜²æ­¢å®¹å™¨åˆ é™¤åæ•°æ®ä¸¢å¤±ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nb"&gt;exit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# å¤åˆ¶åˆ°å®¿ä¸»æœºå¯¹åº”ç›®å½•ï¼ˆç¤ºä¾‹è·¯å¾„ï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker cp es7:/usr/share/elasticsearch/plugins/analysis-ik /your/path/plugins
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker cp es7:/usr/share/elasticsearch/config/analysis-ik /your/path/config
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="ç¬¬å››æ­¥é‡å¯æœåŠ¡"&gt;ç¬¬å››æ­¥ï¼šé‡å¯æœåŠ¡
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker restart es7
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;éªŒè¯ï¼š&lt;/strong&gt; æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼Œè‹¥çœ‹åˆ° &lt;code&gt;loaded plugin [analysis-ik]&lt;/code&gt; å­—æ ·ï¼Œè¯´æ˜åŠ è½½æˆåŠŸã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="3-ik-åˆ†è¯æ¨¡å¼å¯¹æ¯”"&gt;3. IK åˆ†è¯æ¨¡å¼å¯¹æ¯”
&lt;/h2&gt;&lt;p&gt;IK åˆ†è¯å™¨æä¾›äº†ä¸¤ç§æ ¸å¿ƒåˆ†è¯æ¨¡å¼ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ¨¡å¼&lt;/th&gt;
&lt;th&gt;åç§°&lt;/th&gt;
&lt;th&gt;åˆ†è¯ç­–ç•¥&lt;/th&gt;
&lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;ik_smart&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;æ™ºèƒ½åˆ†è¯&lt;/td&gt;
&lt;td&gt;ç²—ç²’åº¦åˆ‡åˆ†ï¼Œè¿½æ±‚è¯­ä¹‰å®Œæ•´æ€§&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;æœç´¢æŸ¥è¯¢æ—¶&lt;/strong&gt;ä½¿ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;ik_max_word&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç»†ç²’åº¦åˆ†è¯&lt;/td&gt;
&lt;td&gt;ç©·ä¸¾æ‰€æœ‰å¯èƒ½çš„ç»„åˆï¼Œè¯é‡å¤§&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;å»ºç«‹ç´¢å¼•æ—¶&lt;/strong&gt;ä½¿ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2 id="4-æ•ˆæœæ¼”ç¤º"&gt;4. æ•ˆæœæ¼”ç¤º
&lt;/h2&gt;&lt;h3 id="åœºæ™¯ä¸€æ™ºèƒ½åˆ†è¯ik_smart"&gt;åœºæ™¯ä¸€ï¼šæ™ºèƒ½åˆ†è¯ï¼ˆik_smartï¼‰
&lt;/h3&gt;&lt;p&gt;æˆ‘ä»¬å°†æµ‹è¯•ä¸€æ®µæŠ€æœ¯æè¿°æ–‡å­—ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¯·æ±‚ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-http" data-lang="http"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;POST /_analyze
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;analyzer&amp;#34;: &amp;#34;ik_smart&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;text&amp;#34;: &amp;#34;åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„å¦‚ä½•è®¾è®¡ï¼Ÿ&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;é¢„æœŸåˆ†è¯ç»“æœï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;åˆ†å¸ƒå¼&lt;/code&gt; / &lt;code&gt;ç³»ç»Ÿ&lt;/code&gt; / &lt;code&gt;æ¶æ„&lt;/code&gt; / &lt;code&gt;å¦‚ä½•&lt;/code&gt; / &lt;code&gt;è®¾è®¡&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="åœºæ™¯äºŒé»˜è®¤åˆ†è¯å™¨å¯¹æ¯”standard"&gt;åœºæ™¯äºŒï¼šé»˜è®¤åˆ†è¯å™¨å¯¹æ¯”ï¼ˆstandardï¼‰
&lt;/h3&gt;&lt;p&gt;å¯¹æ¯” ES é»˜è®¤åˆ†è¯å™¨å¯¹ä¸­æ–‡çš„å¤„ç†æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¯·æ±‚ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-http" data-lang="http"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;POST /_analyze
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;analyzer&amp;#34;: &amp;#34;standard&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;text&amp;#34;: &amp;#34;åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„å¦‚ä½•è®¾è®¡ï¼Ÿ&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;é¢„æœŸåˆ†è¯ç»“æœï¼ˆé€å­—æ‹†åˆ†ï¼‰ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;åˆ†&lt;/code&gt; / &lt;code&gt;å¸ƒ&lt;/code&gt; / &lt;code&gt;å¼&lt;/code&gt; / &lt;code&gt;ç³»&lt;/code&gt; / &lt;code&gt;ç»Ÿ&lt;/code&gt; / &lt;code&gt;æ¶&lt;/code&gt; / &lt;code&gt;æ„&lt;/code&gt; / &lt;code&gt;å¦‚&lt;/code&gt; / &lt;code&gt;ä½•&lt;/code&gt; / &lt;code&gt;è®¾&lt;/code&gt; / &lt;code&gt;è®¡&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="åœºæ™¯ä¸‰ç»†ç²’åº¦åˆ†è¯ik_max_word"&gt;åœºæ™¯ä¸‰ï¼šç»†ç²’åº¦åˆ†è¯ï¼ˆik_max_wordï¼‰
&lt;/h3&gt;&lt;p&gt;å¯¹äºå¤æ‚çš„ä¸“æœ‰åè¯ï¼Œ&lt;code&gt;ik_max_word&lt;/code&gt; ä¼šè¿›è¡Œç©·ä¸¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¯·æ±‚ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-http" data-lang="http"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;POST /_analyze
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;analyzer&amp;#34;: &amp;#34;ik_max_word&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;text&amp;#34;: &amp;#34;åŒ—äº¬äº’è”ç½‘ç§‘æŠ€å…¬å¸&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;é¢„æœŸåˆ†è¯ç»“æœï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;åŒ—äº¬&lt;/code&gt; / &lt;code&gt;äº’è”ç½‘&lt;/code&gt; / &lt;code&gt;äº’è”&lt;/code&gt; / &lt;code&gt;ç½‘&lt;/code&gt; / &lt;code&gt;ç§‘æŠ€å…¬å¸&lt;/code&gt; / &lt;code&gt;ç§‘æŠ€&lt;/code&gt; / &lt;code&gt;å…¬å¸&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;IK åˆ†è¯å™¨é€šè¿‡ &lt;code&gt;ik_smart&lt;/code&gt; ä¿è¯äº†æœç´¢çš„&lt;strong&gt;å‡†ç¡®æ€§&lt;/strong&gt;ï¼Œé€šè¿‡ &lt;code&gt;ik_max_word&lt;/code&gt; ä¿è¯äº†ç´¢å¼•çš„&lt;strong&gt;è¦†ç›–é¢&lt;/strong&gt;ã€‚åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œé€šå¸¸é‡‡å–â€œç´¢å¼•æ—¶ç»†ç²’åº¦ï¼Œæœç´¢æ—¶æ™ºèƒ½åŒ–â€çš„ç­–ç•¥ï¼Œä»¥è¾¾åˆ°æœ€ä½³çš„æœç´¢ä½“éªŒã€‚&lt;/p&gt;
&lt;hr&gt;</description></item><item><title>Elasticsearch æ•°æ®ç±»å‹</title><link>https://0607pass.github.io/Blog/p/elasticsearch-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</link><pubDate>Sun, 04 Jan 2026 21:17:02 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/elasticsearch-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</guid><description>&lt;img src="https://0607pass.github.io/Blog/images/postCover/es.png" alt="Featured image of post Elasticsearch æ•°æ®ç±»å‹" /&gt;&lt;h2 id="elasticsearch-æ•°æ®ç±»å‹"&gt;&lt;strong&gt;Elasticsearch æ•°æ®ç±»å‹&lt;/strong&gt;
&lt;/h2&gt;&lt;p&gt;åœ¨ Elasticsearch ä¸­ï¼Œæ•°æ®ç±»å‹ å†³å®šäº†å­—æ®µçš„å­˜å‚¨å’Œç´¢å¼•æ–¹å¼ï¼Œä»¥åŠå®ƒä»¬æ”¯æŒçš„æŸ¥è¯¢ç±»å‹å’Œæ“ä½œæ–¹å¼ã€‚æ­£ç¡®ç†è§£å’Œé€‰æ‹©æ•°æ®ç±»å‹ï¼Œæ˜¯è®¾è®¡é«˜æ•ˆç´¢å¼•å’Œæœç´¢çš„é‡è¦å‰æã€‚&lt;/p&gt;
&lt;h3 id="æ•°æ®ç±»å‹åˆ†ç±»"&gt;æ•°æ®ç±»å‹åˆ†ç±»
&lt;/h3&gt;&lt;p&gt;Elasticsearch çš„å­—æ®µæ•°æ®ç±»å‹ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸºæœ¬æ•°æ®ç±»å‹ï¼šæ•°å€¼ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;å¤æ‚æ•°æ®ç±»å‹ï¼šå¦‚å¯¹è±¡ã€åµŒå¥—å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;åœ°ç†æ•°æ®ç±»å‹ï¼šç”¨äºå­˜å‚¨å’Œæœç´¢åœ°ç†ä½ç½®ç›¸å…³çš„æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;ç‰¹æ®Šæ•°æ®ç±»å‹ï¼šä¸“é—¨ä¸ºç‰¹å®šåœºæ™¯è®¾è®¡çš„æ•°æ®ç±»å‹ï¼Œå¦‚ IP åœ°å€ã€èŒƒå›´ç±»å‹ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä»½å…³äº Elasticsearch æ•°æ®ç±»å‹çš„æ•´ç†å·²ç»æŒ‰ç…§ Markdown æ ¼å¼è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¢åŠ äº†æ¸…æ™°çš„å±‚çº§ç»“æ„ã€ä»£ç å—æ ‡æ³¨ä»¥åŠå¯¹æ¯”è¯´æ˜ï¼Œæ–¹ä¾¿ä½ ç›´æ¥é˜…è¯»æˆ–å­˜æ¡£ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id="1-åŸºæœ¬æ•°æ®ç±»å‹"&gt;1. åŸºæœ¬æ•°æ®ç±»å‹
&lt;/h2&gt;&lt;h3 id="æ–‡æœ¬ç±»å‹"&gt;æ–‡æœ¬ç±»å‹
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;th&gt;åº”ç”¨åœºæ™¯&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;text&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç”¨äºå…¨æ–‡æœç´¢ã€‚æ”¯æŒåˆ†è¯ï¼ˆAnalysisï¼‰å¹¶å»ºç«‹å€’æ’ç´¢å¼•ã€‚&lt;/td&gt;
&lt;td&gt;é‚®ä»¶æ­£æ–‡ã€ç¬”è®°æ ‡é¢˜ã€äº§å“æè¿°ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;&lt;code&gt;keyword&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ç”¨äºç²¾ç¡®åŒ¹é…ã€‚ä¸å‚ä¸åˆ†è¯ï¼Œç›´æ¥å»ºç«‹ç´¢å¼•ã€‚&lt;/td&gt;
&lt;td&gt;çŠ¶æ€ç ï¼ˆOK/Failï¼‰ã€åˆ†ç±»æ ‡ç­¾ã€é‚®ç¼–ã€IDã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹å®šä¹‰ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s2"&gt;&amp;#34;mappings&amp;#34;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;properties&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;title&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;text&amp;#34;&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;status&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;keyword&amp;#34;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="æ•°å€¼ç±»å‹"&gt;æ•°å€¼ç±»å‹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ•´å‹&lt;/strong&gt;ï¼š&lt;code&gt;integer&lt;/code&gt; (32ä½), &lt;code&gt;long&lt;/code&gt; (64ä½), &lt;code&gt;short&lt;/code&gt; (16ä½), &lt;code&gt;byte&lt;/code&gt; (8ä½)ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æµ®ç‚¹å‹&lt;/strong&gt;ï¼š&lt;code&gt;double&lt;/code&gt; (åŒç²¾åº¦), &lt;code&gt;float&lt;/code&gt; (å•ç²¾åº¦), &lt;code&gt;half_float&lt;/code&gt;, &lt;code&gt;scaled_float&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹å®šä¹‰ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s2"&gt;&amp;#34;age&amp;#34;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;integer&amp;#34;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="err"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s2"&gt;&amp;#34;price&amp;#34;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;double&amp;#34;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="å¸ƒå°”ä¸æ—¥æœŸ"&gt;å¸ƒå°”ä¸æ—¥æœŸ
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;boolean&lt;/code&gt;&lt;/strong&gt;ï¼šå­˜å‚¨ &lt;code&gt;true&lt;/code&gt; æˆ– &lt;code&gt;false&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;date&lt;/code&gt;&lt;/strong&gt;ï¼šå­˜å‚¨æ—¥æœŸå’Œæ—¶é—´ã€‚é»˜è®¤æ”¯æŒ ISO 8601 æ ¼å¼ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ ¼å¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹å®šä¹‰ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s2"&gt;&amp;#34;created_at&amp;#34;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;date&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;format&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;yyyy-MM-dd HH:mm:ss||epoch_millis&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="2-å¤æ‚æ•°æ®ç±»å‹"&gt;2. å¤æ‚æ•°æ®ç±»å‹
&lt;/h2&gt;&lt;h3 id="å¯¹è±¡ç±»å‹-object"&gt;å¯¹è±¡ç±»å‹ (&lt;code&gt;object&lt;/code&gt;)
&lt;/h3&gt;&lt;p&gt;ç”¨äºå­˜å‚¨å•ä¸ª JSON å¯¹è±¡ã€‚åœ¨ ES å†…éƒ¨ä¼šè¢«æ‰å¹³åŒ–å¤„ç†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s2"&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;object&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;properties&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;name&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;text&amp;#34;&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;age&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;integer&amp;#34;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="åµŒå¥—ç±»å‹-nested"&gt;åµŒå¥—ç±»å‹ (&lt;code&gt;nested&lt;/code&gt;)
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;é‡è¦&lt;/strong&gt;ï¼šå¦‚æœéœ€è¦å­˜å‚¨â€œå¯¹è±¡æ•°ç»„â€å¹¶ä¿æŒå¯¹è±¡å†…å­—æ®µçš„å…³è”æ€§ï¼Œå¿…é¡»ä½¿ç”¨ &lt;code&gt;nested&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s2"&gt;&amp;#34;comments&amp;#34;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;nested&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;properties&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;author&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;keyword&amp;#34;&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;text&amp;#34;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="3-åœ°ç†æ•°æ®ç±»å‹"&gt;3. åœ°ç†æ•°æ®ç±»å‹
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;geo_point&lt;/code&gt;&lt;/strong&gt;ï¼šå­˜å‚¨ç»çº¬åº¦åæ ‡å¯¹ã€‚æ”¯æŒè·ç¦»æ’åºã€åœ°ç†å›´æ æŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;em&gt;ç¤ºä¾‹æ•°æ®&lt;/em&gt;ï¼š&lt;code&gt;&amp;quot;location&amp;quot;: { &amp;quot;lat&amp;quot;: 40.71, &amp;quot;lon&amp;quot;: -74.00 }&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;geo_shape&lt;/code&gt;&lt;/strong&gt;ï¼šå­˜å‚¨å¤æ‚çš„å‡ ä½•å›¾å½¢ï¼ˆå¦‚å¤šè¾¹å½¢ &lt;code&gt;Polygon&lt;/code&gt;ã€çº¿æ¡ &lt;code&gt;LineString&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;em&gt;ç¤ºä¾‹åœºæ™¯&lt;/em&gt;ï¼šè¡Œæ”¿åŒºåˆ’è¾¹ç•Œã€èˆªçº¿è½¨è¿¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="4-ç‰¹æ®Šæ•°æ®ç±»å‹"&gt;4. ç‰¹æ®Šæ•°æ®ç±»å‹
&lt;/h2&gt;&lt;h3 id="ip-åœ°å€-ip"&gt;IP åœ°å€ (&lt;code&gt;ip&lt;/code&gt;)
&lt;/h3&gt;&lt;p&gt;æ”¯æŒ IPv4 å’Œ IPv6ï¼Œå…è®¸é’ˆå¯¹ IP æ®µè¿›è¡Œæœç´¢ï¼ˆCIDR æ£€ç´¢ï¼‰ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s2"&gt;&amp;#34;client_ip&amp;#34;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nt"&gt;&amp;#34;type&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;ip&amp;#34;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="èŒƒå›´ç±»å‹-range"&gt;èŒƒå›´ç±»å‹ (&lt;code&gt;range&lt;/code&gt;)
&lt;/h3&gt;&lt;p&gt;å­˜å‚¨ä¸€ä¸ªåŒºé—´å€¼ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å­ç±»å‹&lt;/strong&gt;ï¼š&lt;code&gt;integer_range&lt;/code&gt;, &lt;code&gt;float_range&lt;/code&gt;, &lt;code&gt;long_range&lt;/code&gt;, &lt;code&gt;date_range&lt;/code&gt;, &lt;code&gt;ip_range&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-json" data-lang="json"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s2"&gt;&amp;#34;price_range&amp;#34;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;gte&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;#34;lte&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;200&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="æ€»ç»“ä¸å»ºè®®"&gt;æ€»ç»“ä¸å»ºè®®
&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;éœ€æ±‚&lt;/th&gt;
&lt;th&gt;æ¨èç±»å‹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;éœ€è¦åˆ†è¯æœç´¢&lt;/td&gt;
&lt;td&gt;&lt;code&gt;text&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;éœ€è¦èšåˆï¼ˆAggregationï¼‰æˆ–æ’åº&lt;/td&gt;
&lt;td&gt;&lt;code&gt;keyword&lt;/code&gt; æˆ–æ•°å€¼ç±»å‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å­˜å‚¨ JSON å¯¹è±¡ä¸”éœ€è¦ç‹¬ç«‹æŸ¥è¯¢æ•°ç»„æˆå‘˜&lt;/td&gt;
&lt;td&gt;&lt;code&gt;nested&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å­˜å‚¨ç»çº¬åº¦&lt;/td&gt;
&lt;td&gt;&lt;code&gt;geo_point&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¤šå­—æ®µé…ç½®&lt;/strong&gt;ï¼šåŒä¸€ä¸ªå­—æ®µå¯ä»¥æ—¢æ˜¯ &lt;code&gt;text&lt;/code&gt;ï¼ˆç”¨äºæœç´¢ï¼‰åˆæ˜¯ &lt;code&gt;keyword&lt;/code&gt;ï¼ˆç”¨äºèšåˆï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ˜ç¡®å®šä¹‰&lt;/strong&gt;ï¼šå°½é‡é¿å…ä¾é  ES çš„åŠ¨æ€æ˜ å°„ï¼ˆDynamic Mappingï¼‰ï¼Œæ‰‹åŠ¨å®šä¹‰ Mapping èƒ½æ›´å¥½åœ°æ§åˆ¶å­˜å‚¨ç©ºé—´å’Œç´¢å¼•æ•ˆç‡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;</description></item><item><title>Elasticsearch æ ¸å¿ƒæ¦‚å¿µ</title><link>https://0607pass.github.io/Blog/p/elasticsearch-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/</link><pubDate>Sat, 03 Jan 2026 22:11:02 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/elasticsearch-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/</guid><description>&lt;img src="https://0607pass.github.io/Blog/images/postCover/es.png" alt="Featured image of post Elasticsearch æ ¸å¿ƒæ¦‚å¿µ" /&gt;&lt;hr&gt;
&lt;h1 id="-elasticsearch-æ ¸å¿ƒçŸ¥è¯†æ‰‹å†Œ"&gt;ğŸš€ Elasticsearch æ ¸å¿ƒçŸ¥è¯†æ‰‹å†Œ
&lt;/h1&gt;&lt;h2 id="1-ä»€ä¹ˆæ˜¯-elasticsearch"&gt;1. ä»€ä¹ˆæ˜¯ Elasticsearchï¼Ÿ
&lt;/h2&gt;&lt;p&gt;Elasticsearch æ˜¯ä¸€ä¸ªåŸºäº &lt;strong&gt;Apache Lucene&lt;/strong&gt; æ„å»ºçš„å¼€æºã€åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ã€‚å®ƒèƒ½å¤Ÿå¯¹æµ·é‡æ•°æ®è¿›è¡Œè¿‘å®æ—¶çš„å­˜å‚¨ã€æœç´¢å’Œåˆ†æã€‚&lt;/p&gt;
&lt;h3 id="æ ¸å¿ƒç‰¹æ€§"&gt;æ ¸å¿ƒç‰¹æ€§
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆ†å¸ƒå¼æ¶æ„&lt;/strong&gt;ï¼šå¤©ç”Ÿæ”¯æŒé›†ç¾¤æ¨¡å¼ï¼Œå¯æ°´å¹³æ‰©å±•è‡³æ•°ç™¾ä¸ªèŠ‚ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®æ—¶æœç´¢&lt;/strong&gt;ï¼šæ•°æ®ä»å†™å…¥åˆ°å¯è¢«æœç´¢ä»…éœ€ç§’çº§å»¶è¿Ÿã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¨æ–‡æ£€ç´¢&lt;/strong&gt;ï¼šæ”¯æŒå¤æ‚çš„æ¨¡ç³ŠåŒ¹é…ã€åˆ†è¯ã€é«˜äº®æ˜¾ç¤ºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;RESTful API&lt;/strong&gt;ï¼šé€šè¿‡æ ‡å‡†çš„ HTTP æ¥å£å³å¯å®Œæˆæ‰€æœ‰æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜åº¦å¯å®šåˆ¶&lt;/strong&gt;ï¼šçµæ´»çš„åˆ†è¯å™¨ã€æŸ¥è¯¢è¯­æ³•ï¼Œé€‚åº”å¤šå˜ä¸šåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="2-æ ¸å¿ƒæ¦‚å¿µå¯¹æ¯”"&gt;2. æ ¸å¿ƒæ¦‚å¿µå¯¹æ¯”
&lt;/h2&gt;&lt;p&gt;ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥å°† Elasticsearch çš„æ¦‚å¿µä¸ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚ MySQLï¼‰è¿›è¡Œç±»æ¯”ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Elasticsearch&lt;/th&gt;
&lt;th&gt;å…³ç³»å‹æ•°æ®åº“ (RDBMS)&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Index (ç´¢å¼•)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Table (è¡¨)&lt;/td&gt;
&lt;td&gt;æ•°æ®çš„é€»è¾‘å®¹å™¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Document (æ–‡æ¡£)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Row (è¡Œ)&lt;/td&gt;
&lt;td&gt;æœ€å°çš„æ•°æ®å•ä½ï¼ˆJSON æ ¼å¼ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Field (å­—æ®µ)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Column (åˆ—)&lt;/td&gt;
&lt;td&gt;æ–‡æ¡£çš„å±æ€§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Mapping (æ˜ å°„)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Schema (è¡¨ç»“æ„)&lt;/td&gt;
&lt;td&gt;å®šä¹‰å­—æ®µç±»å‹åŠå…¶è¡Œä¸º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;DSL (æŸ¥è¯¢è¯­è¨€)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;SQL&lt;/td&gt;
&lt;td&gt;æœç´¢æ•°æ®çš„ä¸“ç”¨è¯­è¨€&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="æ‰©å±•æ¦‚å¿µ"&gt;æ‰©å±•æ¦‚å¿µï¼š
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Clusterï¼ˆé›†ç¾¤ï¼‰&lt;/strong&gt;ï¼šç”±ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ç»„æˆï¼Œå…±åŒæ‰¿æ‹…å‹åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Nodeï¼ˆèŠ‚ç‚¹ï¼‰&lt;/strong&gt;ï¼šé›†ç¾¤ä¸­çš„å•ä¸ªè¿è¡Œå®ä¾‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Shardï¼ˆåˆ†ç‰‡ï¼‰&lt;/strong&gt;ï¼šå°†ç´¢å¼•æ°´å¹³åˆ‡åˆ†ï¼Œåˆ†å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹ä»¥æå‡æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Replicaï¼ˆå‰¯æœ¬ï¼‰&lt;/strong&gt;ï¼šåˆ†ç‰‡çš„æ‹·è´ï¼Œæä¾›å†—ä½™å¤‡ä»½å¹¶æå‡æŸ¥è¯¢ååé‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="3-å¿«é€Ÿéƒ¨ç½²-docker"&gt;3. å¿«é€Ÿéƒ¨ç½² (Docker)
&lt;/h2&gt;&lt;h3 id="å¯åŠ¨-elasticsearch"&gt;å¯åŠ¨ Elasticsearch
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;docker run -d &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; --name es7 &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; -p 9200:9200 -p 9300:9300 &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; -e &lt;span class="s2"&gt;&amp;#34;discovery.type=single-node&amp;#34;&lt;/span&gt; &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; -e &lt;span class="nv"&gt;ES_JAVA_OPTS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;-Xms1024m -Xmx1024m&amp;#34;&lt;/span&gt; &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; -v /home/xfff/docker/elasticsearch/config:/usr/share/elasticsearch/config &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; -v /home/xfff/docker/elasticsearch/data:/usr/share/elasticsearch/data &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; -v /home/xfff/docker/elasticsearch/plugins:/usr/share/elasticsearch/plugins &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; -v /home/xfff/docker/elasticsearch/logs:/usr/share/elasticsearch/logs &lt;span class="se"&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="se"&gt;&lt;/span&gt; elasticsearch:7.3.0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="å¯åŠ¨-kibana-å¯è§†åŒ–å·¥å…·"&gt;å¯åŠ¨ Kibana å¯è§†åŒ–å·¥å…·
&lt;/h3&gt;&lt;p&gt;Kibana ç”¨äºæ•°æ®æ¢ç´¢å’Œ Dev Tools è°ƒè¯•ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¯åŠ¨å®¹å™¨&lt;/strong&gt;ï¼š&lt;code&gt;docker run -d --name kibana -p 5601:5601 kibana:7.3.0&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é…ç½®&lt;/strong&gt;ï¼šä¿®æ”¹ &lt;code&gt;kibana.yml&lt;/code&gt; é…ç½®æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yaml" data-lang="yaml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;server.name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;kibana&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;server.host&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;elasticsearch.hosts&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;http://&amp;lt;å®¿ä¸»æœºIP&amp;gt;:9200&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nt"&gt;i18n.locale&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;#34;zh-CN&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# è®¾ç½®ä¸­æ–‡ç•Œé¢&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ol start="3"&gt;
&lt;li&gt;&lt;strong&gt;è®¿é—®&lt;/strong&gt;ï¼š&lt;code&gt;http://æœåŠ¡å™¨IP:5601&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2 id="4-åŸºç¡€è¯­æ³•æ“ä½œ-dev-tools"&gt;4. åŸºç¡€è¯­æ³•æ“ä½œ (Dev Tools)
&lt;/h2&gt;&lt;h3 id="41-ç´¢å¼•ç®¡ç†"&gt;4.1 ç´¢å¼•ç®¡ç†
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åˆ›å»ºç´¢å¼•ï¼ˆæŒ‡å®šåˆ†ç‰‡ä¸å‰¯æœ¬ï¼‰&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-http" data-lang="http"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;PUT /note
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;settings&amp;#34;: {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;number_of_shards&amp;#34;: 2,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;number_of_replicas&amp;#34;: 2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç»“æ„åŒ–åˆ›å»ºï¼ˆæŒ‡å®š Mappingï¼‰&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-http" data-lang="http"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;PUT /note
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;mappings&amp;#34;: {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;properties&amp;#34;: {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;title&amp;#34;: {&amp;#34;type&amp;#34;: &amp;#34;text&amp;#34;},
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;create_time&amp;#34;: {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;type&amp;#34;: &amp;#34;date&amp;#34;,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;format&amp;#34;: &amp;#34;yyyy-MM-dd HH:mm:ss&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="42-æ–‡æ¡£-crud"&gt;4.2 æ–‡æ¡£ CRUD
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ·»åŠ /å…¨é‡æ›´æ–°&lt;/strong&gt;ï¼š&lt;code&gt;PUT /note/_doc/1 { &amp;quot;title&amp;quot;: &amp;quot;å†…å®¹&amp;quot; }&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŒ‡å®šå­—æ®µæ›´æ–°&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-http" data-lang="http"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;POST /note/_update/1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;{ &amp;#34;doc&amp;#34;: { &amp;#34;title&amp;#34;: &amp;#34;æ–°æ ‡é¢˜&amp;#34; } }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¼ºåˆ¶åˆ›å»ºï¼ˆå·²å­˜åœ¨åˆ™æŠ¥é”™ï¼‰&lt;/strong&gt;ï¼š&lt;code&gt;PUT /note/_create/1 { ... }&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ é™¤&lt;/strong&gt;ï¼š&lt;code&gt;DELETE /note/_doc/1&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="5-é«˜çº§æœç´¢ä¸è¿‡æ»¤"&gt;5. é«˜çº§æœç´¢ä¸è¿‡æ»¤
&lt;/h2&gt;&lt;h3 id="51-åˆ†é¡µä¸æ’åº"&gt;5.1 åˆ†é¡µä¸æ’åº
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-http" data-lang="http"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;GET /note/_search
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;query&amp;#34;: { &amp;#34;match_all&amp;#34;: {} },
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;from&amp;#34;: 0,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;size&amp;#34;: 10,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;sort&amp;#34;: [ { &amp;#34;create_time&amp;#34;: { &amp;#34;order&amp;#34;: &amp;#34;desc&amp;#34; } } ]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="52-æ ¸å¿ƒæŸ¥è¯¢åŒºåˆ«match-vs-term"&gt;5.2 æ ¸å¿ƒæŸ¥è¯¢åŒºåˆ«ï¼šMatch vs Term
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;match&lt;/code&gt;&lt;/strong&gt;ï¼šå…¨æ–‡æ£€ç´¢ã€‚ä¼šå°†æœç´¢è¯å…ˆåˆ†è¯ï¼Œå†åŒ¹é…ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;term&lt;/code&gt;&lt;/strong&gt;ï¼šç²¾ç¡®åŒ¹é…ã€‚ä¸åˆ†è¯ï¼Œæœç´¢è¯å¿…é¡»ä¸ç´¢å¼•ä¸­çš„è¯é¡¹å®Œå…¨ä¸€è‡´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;âš ï¸ è¸©å‘æç¤º&lt;/strong&gt;ï¼šé»˜è®¤åˆ†è¯ä¸‹ï¼Œä¸­æ–‡ä¼šè¢«æ‹†åˆ†ä¸ºå•ä¸ªæ±‰å­—ã€‚è‹¥ç”¨ &lt;code&gt;term&lt;/code&gt; æœç´¢â€œç§‹å­£â€ï¼Œè€Œç´¢å¼•ä¸­åªæœ‰â€œç§‹â€å’Œâ€œå­£â€ï¼Œåˆ™æ— æ³•åŒ¹é…ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="53-filter-è¿‡æ»¤"&gt;5.3 Filter è¿‡æ»¤
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;filter&lt;/code&gt; åŒ…å«åœ¨ &lt;code&gt;bool&lt;/code&gt; æŸ¥è¯¢ä¸­ï¼Œå…¶ç‰¹ç‚¹æ˜¯ä¸è®¡ç®—ç›¸å…³æ€§è¯„åˆ†ï¼Œ&lt;strong&gt;æ€§èƒ½æ›´é«˜ä¸”æ”¯æŒç¼“å­˜&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;span class="lnt"&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-http" data-lang="http"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;GET /note/_search
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;query&amp;#34;: {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;bool&amp;#34;: {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;filter&amp;#34;: { &amp;#34;match&amp;#34;: { &amp;#34;title&amp;#34;: &amp;#34;ç§‹å­£&amp;#34; } }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="54-èšåˆæŸ¥è¯¢-aggregation"&gt;5.4 èšåˆæŸ¥è¯¢ (Aggregation)
&lt;/h3&gt;&lt;p&gt;ç±»ä¼¼äº SQL çš„ &lt;code&gt;GROUP BY&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;span class="lnt"&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-http" data-lang="http"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;GET /note/_search
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;aggs&amp;#34;: {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;group_by_time&amp;#34;: {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; &amp;#34;terms&amp;#34;: { &amp;#34;field&amp;#34;: &amp;#34;create_time&amp;#34; }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="err"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;hr&gt;
&lt;h2 id="6-åº”ç”¨åœºæ™¯"&gt;6. åº”ç”¨åœºæ™¯
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ELK æ—¥å¿—åˆ†æ&lt;/strong&gt;ï¼šLogstash æ”¶é›† ES å­˜å‚¨ Kibana å±•ç¤ºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‚ç›´æœç´¢&lt;/strong&gt;ï¼šç”µå•†å•†å“æœç´¢ã€ç«™å†…æœç´¢ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ—¶åºæ•°æ®&lt;/strong&gt;ï¼šç›‘æ§æŒ‡æ ‡å­˜å‚¨ä¸å®æ—¶å‘Šè­¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¨èç³»ç»Ÿ&lt;/strong&gt;ï¼šåŸºäºèšåˆåˆ†æçš„ç”¨æˆ·ç”»åƒåˆ†æã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;</description></item><item><title>ä¸€æ¬¡ STW GC å¼•å‘çš„è¶…å–äº‹æ•…åˆ†æ</title><link>https://0607pass.github.io/Blog/p/%E4%B8%80%E6%AC%A1-stw-gc-%E5%BC%95%E5%8F%91%E7%9A%84%E8%B6%85%E5%8D%96%E4%BA%8B%E6%95%85%E5%88%86%E6%9E%90/</link><pubDate>Sat, 03 Jan 2026 13:39:13 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/%E4%B8%80%E6%AC%A1-stw-gc-%E5%BC%95%E5%8F%91%E7%9A%84%E8%B6%85%E5%8D%96%E4%BA%8B%E6%95%85%E5%88%86%E6%9E%90/</guid><description>&lt;img src="https://0607pass.github.io/Blog/images/postCover/java.png" alt="Featured image of post ä¸€æ¬¡ STW GC å¼•å‘çš„è¶…å–äº‹æ•…åˆ†æ" /&gt;&lt;h2 id="äº‹æ•…ç°åœº"&gt;äº‹æ•…ç°åœº
&lt;/h2&gt;&lt;p&gt;ç¬¬ä¸€ä¸ªçº¿ç¨‹è¦å»åˆ›å»ºè®¢å•ï¼Œæ­£å¥½è¦å»æ•°æ®åº“åˆ›å»ºè®¢å•çš„æ—¶å€™ å‘ç”Ÿgc å‘ç”Ÿäº†stw gcç»“æŸä¹‹åï¼Œ åæŸ¥è¯¢è¯·æ±‚è¿›æ¥å å…ˆæ‹¿åˆ°äº†cpuè¿›è¡Œäº†å›æ»šåº“å­˜æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™åˆ›å»ºè®¢å•é‚£ä¸ªè¯·æ±‚åˆæ‹¿åˆ°äº†cpu å°±å‡ºç°äº† è¶…å–&lt;/p&gt;
&lt;h2 id="ä¸€è¿™æ®µè¯åˆ°åº•åœ¨è¯´ä»€ä¹ˆ"&gt;ä¸€ã€è¿™æ®µè¯åˆ°åº•åœ¨è¯´ä»€ä¹ˆï¼Ÿ
&lt;/h2&gt;&lt;p&gt;è¿™äº‹å„¿æˆ‘ä¸€å¼€å§‹ä¹Ÿæ‡µï¼Œåæ¥ä»”ç»†æƒ³äº†æƒ³ï¼Œå…¶å®æ˜¯ä¸ªæŒºéšè”½çš„å¹¶å‘é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç®€å•è¯´å°±æ˜¯ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;çº¿ç¨‹Aæ‰£å®Œåº“å­˜ï¼Œæ­£å‡†å¤‡åˆ›å»ºè®¢å•ï¼Œç»“æœJVMçªç„¶STW GCï¼Œæ•´ä¸ªä¸–ç•Œæš‚åœäº†ã€‚GCç»“æŸåï¼Œçº¿ç¨‹Bå…ˆæŠ¢åˆ°CPUï¼Œå‘ç°è®¢å•ä¸å­˜åœ¨å°±æŠŠåº“å­˜å›æ»šäº†ã€‚ç„¶åçº¿ç¨‹Aæ‰æ¢å¤ï¼Œç»§ç»­åˆ›å»ºè®¢å•æˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç»“æœï¼š&lt;/strong&gt; è®¢å•æœ‰äº†ï¼Œä½†åº“å­˜è¢«è¯¯å›æ»šï¼Œå¯¼è‡´è¶…å–ã€‚&lt;/p&gt;
&lt;h2 id="äºŒå®Œæ•´æ—¶é—´çº¿ä¸€æ­¥ä¸€æ­¥çœ‹"&gt;äºŒã€å®Œæ•´æ—¶é—´çº¿ï¼ˆä¸€æ­¥ä¸€æ­¥çœ‹ï¼‰
&lt;/h2&gt;&lt;p&gt;å‡è®¾åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Redisåº“å­˜è¿˜å‰©1ä»¶&lt;/li&gt;
&lt;li&gt;ç”¨çš„æ˜¯&amp;quot;å¤±è´¥å°±å›æ»šåº“å­˜&amp;quot;çš„æ–¹æ¡ˆ&lt;/li&gt;
&lt;li&gt;æ²¡æœ‰å†»ç»“åº“å­˜çŠ¶æ€&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="çº¿ç¨‹aç”¨æˆ·ä¸‹å•"&gt;çº¿ç¨‹Aï¼ˆç”¨æˆ·ä¸‹å•ï¼‰
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;T1ï¼š&lt;/strong&gt; Redisæ‰£åº“å­˜æˆåŠŸï¼Œåº“å­˜=0&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;T2ï¼š&lt;/strong&gt; å‡†å¤‡æ’å…¥æ•°æ®åº“è®¢å•&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;T3ï¼š&lt;/strong&gt; JVMçªç„¶STW GCï¼Œçº¿ç¨‹Aè¢«æš‚åœ&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;âš ï¸ STWæ˜¯&amp;quot;æ•´ä¸ªJVMæ‰€æœ‰çº¿ç¨‹&amp;quot;éƒ½æš‚åœï¼Œä¸æ˜¯åªæœ‰çº¿ç¨‹A&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="gcç»“æŸå"&gt;GCç»“æŸå
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;GCç»“æŸ â‰  çº¿ç¨‹Aç«‹å³æ¢å¤&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ“ä½œç³»ç»Ÿé‡æ–°è°ƒåº¦ï¼Œè°å…ˆæŠ¢åˆ°CPUä¸ç¡®å®š&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id="çº¿ç¨‹bè¡¥å¿é€»è¾‘"&gt;çº¿ç¨‹Bï¼ˆè¡¥å¿é€»è¾‘ï¼‰
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;T4ï¼š&lt;/strong&gt; çº¿ç¨‹BæŠ¢åˆ°CPUï¼Œè¿›å…¥è®¢å•å¤±è´¥è¡¥å¿&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;T5ï¼š&lt;/strong&gt; åæŸ¥æ•°æ®åº“ï¼Œè®¢å•è¿˜æ²¡åˆ›å»ºï¼ˆçº¿ç¨‹Aè¿˜æ²¡æ¥å¾—åŠinsertï¼‰&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;T6ï¼š&lt;/strong&gt; åˆ¤å®šè®¢å•ä¸å­˜åœ¨ï¼Œå›æ»šåº“å­˜ï¼Œåº“å­˜+1&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ“Œ æ­¤æ—¶åº“å­˜å·²ç»è¢«è¯¯å›æ»š&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h3 id="çº¿ç¨‹aæ¢å¤"&gt;çº¿ç¨‹Aæ¢å¤
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;T7ï¼š&lt;/strong&gt; çº¿ç¨‹AæŠ¢åˆ°CPUï¼Œç»§ç»­æ‰§è¡Œinsertï¼Œè®¢å•åˆ›å»ºæˆåŠŸ&lt;/p&gt;
&lt;h2 id="ä¸‰æœ€ç»ˆç»“æœ"&gt;ä¸‰ã€æœ€ç»ˆç»“æœ
&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;é¡¹ç›®&lt;/th&gt;
&lt;th&gt;çŠ¶æ€&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;è®¢å•è¡¨&lt;/td&gt;
&lt;td&gt;æœ‰è®¢å•&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Redisåº“å­˜&lt;/td&gt;
&lt;td&gt;1ï¼ˆè¢«è¯¯å›æ»šï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å®é™…å–å‡º&lt;/td&gt;
&lt;td&gt;1ä»¶ï¼Œä½†åº“å­˜æ˜¾ç¤ºè¿˜å‰©1ä»¶&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;ä¸‹ä¸€ä¸ªç”¨æˆ·è¿›æ¥åˆèƒ½ä¹°ï¼Œè¶…å–äº†ï¼&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id="å››ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µ"&gt;å››ã€ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Ÿ
&lt;/h2&gt;&lt;h3 id="1-stw-gcä¸å¯æ§"&gt;1. STW GCä¸å¯æ§
&lt;/h3&gt;&lt;p&gt;Full GCã€CMS remarkã€G1 mixedéƒ½ä¼šSTWã€‚ZGCè™½ç„¶çŸ­ï¼Œä½†ä¹Ÿä¸æ˜¯0ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä»»ä½•JVMéƒ½æ— æ³•é¿å…STWã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id="2-ä¸šåŠ¡é€»è¾‘å‡è®¾é”™äº†"&gt;2. ä¸šåŠ¡é€»è¾‘å‡è®¾é”™äº†
&lt;/h3&gt;&lt;p&gt;æˆ‘ä»¬å‡è®¾ï¼šçº¿ç¨‹Aè¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚&lt;/p&gt;
&lt;p&gt;ä½†ç°å®æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;çº¿ç¨‹å¯ä»¥è¢«ä»»æ„æ—¶åˆ»æš‚åœ&lt;/li&gt;
&lt;li&gt;æ¢å¤é¡ºåºä¸å¯é¢„æµ‹&lt;/li&gt;
&lt;li&gt;è¡¥å¿é€»è¾‘å¯èƒ½åœ¨è®¢å•åˆ›å»ºä¹‹å‰æ‰§è¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="3-æ•°æ®åº“çŠ¶æ€--çœŸå®çŠ¶æ€"&gt;3. æ•°æ®åº“çŠ¶æ€ â‰  çœŸå®çŠ¶æ€
&lt;/h3&gt;&lt;p&gt;è¡¥å¿é€»è¾‘æŸ¥æ•°æ®åº“ï¼š&amp;ldquo;ç°åœ¨æœ‰æ²¡æœ‰è®¢å•ï¼Ÿ&amp;rdquo;&lt;/p&gt;
&lt;p&gt;ä½†åº”è¯¥é—®çš„æ˜¯ï¼š&amp;ldquo;è¿™ä¸ªè¯·æ±‚æœ€ç»ˆä¼šä¸ä¼šåˆ›å»ºè®¢å•ï¼Ÿ&amp;rdquo;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¿™æ˜¯æ ¹æœ¬æ€§çš„é€»è¾‘é”™è¯¯ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id="äº”æ ¸å¿ƒé—®é¢˜"&gt;äº”ã€æ ¸å¿ƒé—®é¢˜
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;ä½ ç”¨&amp;quot;å½“å‰ç¬æ—¶çŠ¶æ€&amp;quot;å»åˆ¤æ–­&amp;quot;æœªæ¥ä¼šä¸ä¼šæˆåŠŸ&amp;quot;ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä½†JVM + OS + GCå®Œå…¨ä¸ä¿è¯è¿™ä¸ªæ—¶åºã€‚&lt;/p&gt;
&lt;h2 id="æ€ä¹ˆè§£å†³"&gt;æ€ä¹ˆè§£å†³ï¼Ÿ
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;æ­£ç¡®åšæ³•ï¼š&lt;/strong&gt; ä¸è¦åœ¨åŒæ­¥é“¾è·¯ä¸­å›æ»šåº“å­˜ï¼Œè€Œæ˜¯å¼•å…¥åº“å­˜å†»ç»“çŠ¶æ€æˆ–å¼‚æ­¥è¡¥å¿æœºåˆ¶ï¼Œç¡®ä¿åº“å­˜å›é€€åªå‘ç”Ÿåœ¨è®¢å•è¿›å…¥ç»ˆæ€ä¹‹åã€‚&lt;/p&gt;
&lt;hr&gt;</description></item><item><title>Spring Boot 3.x æ•´åˆRocketMQ</title><link>https://0607pass.github.io/Blog/p/spring-boot-3.x-%E6%95%B4%E5%90%88rocketmq/</link><pubDate>Mon, 22 Dec 2025 13:52:39 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/spring-boot-3.x-%E6%95%B4%E5%90%88rocketmq/</guid><description>&lt;h2 id="1æ·»åŠ ä¾èµ–"&gt;1ã€æ·»åŠ ä¾èµ–
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;span class="lnt"&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-xml" data-lang="xml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="c"&gt;&amp;lt;!-- Rocket MQ --&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;rocketmq.version&amp;gt;&lt;/span&gt;2.2.3&lt;span class="nt"&gt;&amp;lt;/rocketmq.version&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.apache.rocketmq&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;rocketmq-spring-boot-starter&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;${rocketmq.version}&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id="2é…ç½®"&gt;2ã€é…ç½®
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-yml" data-lang="yml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;rocketmq&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name-server&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;127.0.0.1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="m"&gt;9876&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# name server åœ°å€&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;producer&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;group&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;xfff_group&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;send-message-timeout&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;3000&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æ¶ˆæ¯å‘é€è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ 3s&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;retry-times-when-send-failed&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# åŒæ­¥å‘é€æ¶ˆæ¯å¤±è´¥åï¼Œé‡è¯•çš„æ¬¡æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;retry-times-when-send-async-failed&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# å¼‚æ­¥å‘é€æ¶ˆæ¯å¤±è´¥åï¼Œé‡è¯•çš„æ¬¡æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;max-message-size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;4096&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æ¶ˆæ¯æœ€å¤§å¤§å°ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;consumer&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;group&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l"&gt;xfff_group&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;pull-batch-size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c"&gt;# æ¯æ¬¡æ‹‰å–çš„æœ€å¤§æ¶ˆæ¯æ•°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id="3å¼•å…¥-rocketmqconfigç±»"&gt;3ã€å¼•å…¥ RocketMQConfigç±»
&lt;/h2&gt;&lt;p&gt;ç”±äº rocketmq-spring-boot-starter æœ¬èº«æ˜¯åŸºäº Spring Boot 2.x å¼€å‘çš„ï¼Œ2.xå’Œ 3.x åœ¨å®šä¹‰ starter æ—¶çš„æ ¼å¼æ˜¯æœ‰åŒºåˆ«çš„ï¼Œå­˜åœ¨å…¼å®¹æ€§é—®é¢˜ã€‚ä¸ºäº†èƒ½å¤Ÿåœ¨ Spring Boot 3.x ä¸­ä½¿ç”¨å®ƒï¼Œéœ€è¦åœ¨ /config åŒ…ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ª RocketMQConfig é…ç½®ç±»ï¼Œå¹¶æ·»åŠ  @Import(RocketMQAutoConfiguration.class) , æ‰‹åŠ¨å¼•å…¥ä¸€ä¸‹è‡ªåŠ¨é…ç½®ç±»ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;span class="lnt"&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;org.apache.rocketmq.spring.autoconfigure.RocketMQAutoConfiguration&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;org.springframework.context.annotation.Configuration&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;org.springframework.context.annotation.Import&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Configuration&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Import&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RocketMQAutoConfiguration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;RocketMQConfig&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id="4ç”Ÿäº§è€…"&gt;4ã€ç”Ÿäº§è€…
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åŒæ­¥å‘é€å¹¿æ’­æ¨¡å¼ MQï¼Œå°†æ‰€æœ‰å®ä¾‹ä¸­çš„æœ¬åœ°ç¼“å­˜éƒ½åˆ é™¤æ‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;rocketMQTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;syncSend&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MQConstants&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;TOPIC_DELETE_NOTE_LOCAL_CACHE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;noteId&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id="5æ¶ˆè´¹è€…"&gt;5ã€æ¶ˆè´¹è€…
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;lombok.extern.slf4j.Slf4j&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;org.apache.rocketmq.spring.annotation.MessageModel&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;org.apache.rocketmq.spring.annotation.RocketMQMessageListener&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;org.apache.rocketmq.spring.core.RocketMQListener&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;org.springframework.stereotype.Component&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Component&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Slf4j&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@RocketMQMessageListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;consumerGroup&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;xfff_group&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Group&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;topic&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MQConstants&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;TOPIC_DELETE_NOTE_LOCAL_CACHE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ¶ˆè´¹çš„ä¸»é¢˜ Topic&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;messageModel&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MessageModel&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;BROADCASTING&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¹¿æ’­æ¨¡å¼&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DeleteNoteLocalCacheConsumer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RocketMQListener&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;onMessage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;noteId&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;valueOf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;## æ¶ˆè´¹è€…æ¶ˆè´¹æˆåŠŸ, noteId: {}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;noteId&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id="å¦‚ä½•å®ç°å»¶è¿Ÿæ¶ˆæ¯çš„å¤„ç†"&gt;å¦‚ä½•å®ç°å»¶è¿Ÿæ¶ˆæ¯çš„å¤„ç†
&lt;/h2&gt;&lt;p&gt;ç”Ÿäº§è€…&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// ä¸€è‡´æ€§ä¿è¯ï¼šå»¶è¿ŸåŒåˆ ç­–ç•¥&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;// å¼‚æ­¥å‘é€å»¶æ—¶æ¶ˆæ¯&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;Message&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MessageBuilder&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;withPayload&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;valueOf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;noteId&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;rocketMQTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;asyncSend&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MQConstants&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;TOPIC_DELAY_DELETE_NOTE_REDIS_CACHE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SendCallback&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;onSuccess&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SendResult&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sendResult&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;## å»¶æ—¶åˆ é™¤ Redis ç¬”è®°ç¼“å­˜æ¶ˆæ¯å‘é€æˆåŠŸ...&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;onException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Throwable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;## å»¶æ—¶åˆ é™¤ Redis ç¬”è®°ç¼“å­˜æ¶ˆæ¯å‘é€å¤±è´¥...&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;3000&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è¶…æ—¶æ—¶é—´(æ¯«ç§’)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å»¶è¿Ÿçº§åˆ«ï¼Œ1 è¡¨ç¤ºå»¶æ—¶ 1s&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å»¶è¿Ÿçº§åˆ«
&lt;img src="https://0607pass.github.io/Blog/p/spring-boot-3.x-%E6%95%B4%E5%90%88rocketmq/PixPin_2025-12-22_14-04-55.png"
width="1224"
height="805"
srcset="https://0607pass.github.io/Blog/p/spring-boot-3.x-%E6%95%B4%E5%90%88rocketmq/PixPin_2025-12-22_14-04-55_hu_7c629df63a76c43c.png 480w, https://0607pass.github.io/Blog/p/spring-boot-3.x-%E6%95%B4%E5%90%88rocketmq/PixPin_2025-12-22_14-04-55_hu_e38826cc01c820ef.png 1024w"
loading="lazy"
alt="alt text"
class="gallery-image"
data-flex-grow="152"
data-flex-basis="364px"
&gt;&lt;/p&gt;
&lt;p&gt;æ¶ˆè´¹è€…&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Component&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Slf4j&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@RocketMQMessageListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;consumerGroup&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;xfff_group_&amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MQConstants&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;TOPIC_DELAY_DELETE_NOTE_REDIS_CACHE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// Group&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;topic&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;MQConstants&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;TOPIC_DELAY_DELETE_NOTE_REDIS_CACHE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ¶ˆè´¹çš„ä¸»é¢˜ Topic&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DelayDeleteNoteRedisCacheConsumer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RocketMQListener&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;onMessage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;noteId&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;valueOf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;## å»¶è¿Ÿæ¶ˆæ¯æ¶ˆè´¹æˆåŠŸ, noteId: {}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;noteId&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä¸‰ã€æ–‡æ¡£å¤„ç†ä¸å­˜å‚¨è§„èŒƒ&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; 3.1 æ–‡æ¡£åˆ‡åˆ†è§„åˆ™
æ‰€æœ‰ä¸Šä¼ åˆ°çŸ¥è¯†åº“çš„æ–‡æ¡£ï¼Œå¿…é¡»éµå¾ªä»¥ä¸‹åˆ‡åˆ†è§„åˆ™ï¼š
&lt;/code&gt;&lt;/pre&gt;</description></item><item><title>çº¢åŒ…ç”Ÿæˆç®—æ³•</title><link>https://0607pass.github.io/Blog/p/%E7%BA%A2%E5%8C%85%E7%94%9F%E6%88%90%E7%AE%97%E6%B3%95/</link><pubDate>Sun, 21 Dec 2025 10:14:19 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/%E7%BA%A2%E5%8C%85%E7%94%9F%E6%88%90%E7%AE%97%E6%B3%95/</guid><description>&lt;h2 id="äºŒå€å‡å€¼æ³•"&gt;äºŒå€å‡å€¼æ³•
&lt;/h2&gt;&lt;p&gt;ç‰¹ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®ç°ç®€å•&lt;/li&gt;
&lt;li&gt;ä¸ä¼šè¶…å‘ã€å°‘å‘&lt;/li&gt;
&lt;li&gt;æœ‰éšæœºæ€§&lt;/li&gt;
&lt;li&gt;é‡‘é¢åˆ†å¸ƒè‡ªç„¶ï¼Œä¸æç«¯
æ½œåœ¨é—®é¢˜ï¼š å¯èƒ½å‡ºç°â€œå‰é¢å¾ˆå¤§ï¼Œåé¢å¾ˆå°â€
ä»£ç ç¤ºä¾‹ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cm"&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * ç”Ÿæˆçº¢åŒ…é‡‘é¢Listé›†åˆæ•°æ®
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @param totalPrice
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @param totalCount
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; */&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;createRedPacketPriceList&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;totalPrice&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;totalCount&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redPacketPriceList&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ArrayList&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;totalCount&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;totalCount&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;//å¦‚æœæ˜¯æœ€åä¸€ä¸ªçº¢åŒ…&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;totalCount&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redPacketPriceList&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;totalPrice&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;maxLimit&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;totalPrice&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;totalCount&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;currentPrice&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ThreadLocalRandom&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;current&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;nextInt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;maxLimit&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;totalPrice&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;currentPrice&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redPacketPriceList&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;currentPrice&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redPacketPriceList&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</description></item><item><title>å¦‚ä½•ç¡®ä¿ç¼“å­˜å’Œæ•°æ®çš„ä¸€è‡´æ€§</title><link>https://0607pass.github.io/Blog/p/%E5%A6%82%E4%BD%95%E7%A1%AE%E4%BF%9D%E7%BC%93%E5%AD%98%E5%92%8C%E6%95%B0%E6%8D%AE%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7/</link><pubDate>Sat, 20 Dec 2025 21:11:20 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/%E5%A6%82%E4%BD%95%E7%A1%AE%E4%BF%9D%E7%BC%93%E5%AD%98%E5%92%8C%E6%95%B0%E6%8D%AE%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7/</guid><description>&lt;h2 id="0ä¸ºä»€ä¹ˆä¸è€ƒè™‘æ›´æ–°ç¼“å­˜"&gt;0ã€ä¸ºä»€ä¹ˆä¸è€ƒè™‘æ›´æ–°ç¼“å­˜
&lt;/h2&gt;&lt;p&gt;æ›´æ–°ç¼“å­˜çš„åŠ¨ä½œï¼Œç›¸æ¯”äºç›´æ¥åˆ é™¤ç¼“å­˜ï¼Œæ“ä½œè¿‡ç¨‹æ¯”è¾ƒçš„å¤æ‚ï¼Œè€Œä¸”ä¹Ÿå®¹æ˜“å‡ºé”™ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨&amp;quot;å†™å†™å¹¶å‘&amp;quot;çš„åœºæ™¯ä¸­ï¼Œå¦‚æœåŒæ—¶æ›´æ–°ç¼“å­˜å’Œæ•°æ®åº“ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“ä¼šå‡ºç°å› ä¸ºå¹¶å‘çš„é—®é¢˜å¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;å…ˆå†™æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ—¶é—´&lt;/th&gt;
&lt;th&gt;çº¿ç¨‹ A&lt;/th&gt;
&lt;th&gt;çº¿ç¨‹ B&lt;/th&gt;
&lt;th&gt;æ•°æ®åº“(DB)&lt;/th&gt;
&lt;th&gt;ç¼“å­˜(Cache)&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;t1&lt;/td&gt;
&lt;td&gt;å†™æ•°æ®åº“ï¼š20&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;td&gt;æ—§å€¼&lt;/td&gt;
&lt;td&gt;A å…ˆæ›´æ–° DB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;t2&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;å†™æ•°æ®åº“ï¼š10&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;æ—§å€¼&lt;/td&gt;
&lt;td&gt;B åæ›´æ–° DB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;t3&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;å†™ç¼“å­˜ï¼š10&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;B æ›´æ–°ç¼“å­˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;t4&lt;/td&gt;
&lt;td&gt;å†™ç¼“å­˜ï¼š20&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;20 âŒ&lt;/td&gt;
&lt;td&gt;A è¦†ç›–ç¼“å­˜ï¼Œäº§ç”Ÿä¸ä¸€è‡´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å…ˆæ›´æ–°ç¼“å­˜ï¼Œåå†™æ•°æ®åº“ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ—¶é—´&lt;/th&gt;
&lt;th&gt;çº¿ç¨‹ A&lt;/th&gt;
&lt;th&gt;çº¿ç¨‹ B&lt;/th&gt;
&lt;th&gt;ç¼“å­˜(Cache)&lt;/th&gt;
&lt;th&gt;æ•°æ®åº“(DB)&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;t1&lt;/td&gt;
&lt;td&gt;æ›´æ–°ç¼“å­˜ï¼š20&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;td&gt;æ—§å€¼&lt;/td&gt;
&lt;td&gt;A å†™ç¼“å­˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;t2&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;æ›´æ–°ç¼“å­˜ï¼š10&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;æ—§å€¼&lt;/td&gt;
&lt;td&gt;B è¦†ç›–ç¼“å­˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;t3&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;å†™æ•°æ®åº“ï¼š10&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;B å†™ DB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;t4&lt;/td&gt;
&lt;td&gt;å†™æ•°æ®åº“ï¼š20&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;20 âŒ&lt;/td&gt;
&lt;td&gt;A åå†™ DB&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œ&lt;strong&gt;å¦‚æœæ˜¯åšç¼“å­˜çš„åˆ é™¤çš„è¯ï¼Œåœ¨å†™å†™å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œç¼“å­˜ä¸­çš„æ•°æ®éƒ½æ˜¯è¦è¢«æ¸…é™¤çš„ï¼Œæ‰€ä»¥å°±ä¸ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œåˆ é™¤ç¼“å­˜ç›¸æ¯”æ›´æ–°ç¼“å­˜è¿˜æ˜¯æœ‰ä¸€ä¸ªå°çš„ç¼ºç‚¹ï¼Œé‚£å°±æ˜¯å¸¦æ¥çš„ä¸€æ¬¡é¢å¤–çš„cache missï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨åˆ é™¤ç¼“å­˜åçš„ä¸‹ä¸€æ¬¡æŸ¥è¯¢ä¼šæ— æ³•å‘½ä¸­ç¼“å­˜ï¼Œè¦æŸ¥è¯¢ä¸€ä¸‹æ•°æ®åº“ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§&lt;strong&gt;cache miss&lt;/strong&gt;åœ¨æŸç§ç¨‹åº¦ä¸Šå¯èƒ½ä¼šå¯¼è‡´ç¼“å­˜å‡»ç©¿ï¼Œä¹Ÿå°±æ˜¯åˆšå¥½ç¼“å­˜è¢«åˆ é™¤ä¹‹åï¼ŒåŒä¸€ä¸ªKeyæœ‰å¤§é‡çš„è¯·æ±‚è¿‡æ¥ï¼Œå¯¼è‡´ç¼“å­˜è¢«å‡»ç©¿ï¼Œå¤§é‡è¯·æ±‚è®¿é—®åˆ°æ•°æ®åº“ã€‚&lt;/p&gt;
&lt;h2 id="1å…ˆæ›´æ–°æ•°æ®åº“å†åˆ ç¼“å­˜"&gt;1ã€å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ ç¼“å­˜
&lt;/h2&gt;&lt;p&gt;é—®é¢˜ï¼š
å¦‚æœæ˜¯è¯»å†™åˆ†ç¦»æ¶æ„ä¼šæœ‰ä»¥ä¸‹é—®é¢˜&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ—¶é—´&lt;/th&gt;
&lt;th&gt;çº¿ç¨‹ Aï¼ˆå†™ï¼‰&lt;/th&gt;
&lt;th&gt;çº¿ç¨‹ Bï¼ˆè¯»ï¼‰&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;t1&lt;/td&gt;
&lt;td&gt;ä¸»åº“ UPDATE â†’ 2&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;t2&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ç¼“å­˜ miss&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;t3&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;ä»åº“è¯»åˆ°æ—§å€¼ 1&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;t4&lt;/td&gt;
&lt;td&gt;åˆ é™¤ç¼“å­˜&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;t5&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;å›å¡«ç¼“å­˜ = 1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å¦‚æœæ˜¯å•ç‚¹æ¶æ„ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ—¶é—´&lt;/th&gt;
&lt;th&gt;çº¿ç¨‹ Aï¼ˆå†™ï¼‰&lt;/th&gt;
&lt;th&gt;çº¿ç¨‹ Bï¼ˆè¯»ï¼‰&lt;/th&gt;
&lt;th&gt;æ•°æ®åº“(DB)&lt;/th&gt;
&lt;th&gt;ç¼“å­˜(Cache)&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;t1&lt;/td&gt;
&lt;td&gt;UPDATE â†’ 2&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;DB å·²æ›´æ–°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;t2&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;è¯»ç¼“å­˜ï¼ˆå‘½ä¸­ï¼‰&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;1 âŒ&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å‘½ä¸­æ—§ç¼“å­˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;t3&lt;/td&gt;
&lt;td&gt;åˆ é™¤ç¼“å­˜&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;æ— &lt;/td&gt;
&lt;td&gt;ç¼“å­˜è¢«æ¸…ç†&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;t4&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;ä¸‹æ¬¡è¯»ç¼“å­˜ miss&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;æ— &lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;t5&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;æŸ¥ DB å›å¡« = 2&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;ä¸€è‡´æ¢å¤&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æ¦‚ç‡è¾ƒä½ t2çš„æ—¶é—´çª—å£å¾ˆçŸ­&lt;/p&gt;
&lt;h2 id="2å…ˆåˆ ç¼“å­˜æ›´æ–°æ•°æ®åº“"&gt;2ã€å…ˆåˆ ç¼“å­˜ï¼Œæ›´æ–°æ•°æ®åº“
&lt;/h2&gt;&lt;p&gt;é—®é¢˜ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ—¶é—´&lt;/th&gt;
&lt;th&gt;å†™çº¿ç¨‹&lt;/th&gt;
&lt;th&gt;è¯»çº¿ç¨‹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;t1&lt;/td&gt;
&lt;td&gt;åˆ é™¤ç¼“å­˜&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;t2&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;è¯»ç¼“å­˜æœªå‘½ä¸­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;t3&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;æŸ¥ DBï¼ˆæ—§å€¼ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;t4&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;å›å¡«æ—§å€¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;t5&lt;/td&gt;
&lt;td&gt;æ›´æ–° DBï¼ˆæ–°å€¼ï¼‰&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æ¦‚ç‡æ¯”è¾ƒå¤§ï¼Œæ—¶é—´çª—å£å¾ˆå¤§ ï¼Œæ›´æ–°DBæ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥è€ƒè™‘ä½¿ç”¨å»¶è¿ŸåŒåˆ ï¼Œæˆ–è€…åŸºäº cancalç›‘å¬binglogå®ç°åˆ é™¤ï¼Œå¯ä¸æ–­é‡è¯•ã€‚&lt;/p&gt;
&lt;h2 id="å»¶è¿ŸåŒåˆ çš„-ä¸¤æ¬¡åˆ é™¤çš„å¿…è¦æ€§"&gt;å»¶è¿ŸåŒåˆ çš„ ä¸¤æ¬¡åˆ é™¤çš„å¿…è¦æ€§
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;ç¬¬ä¸€æ¬¡&lt;/strong&gt;ä¹‹æ‰€ä»¥è¦é€‰æ‹©å…ˆåˆ é™¤ç¼“å­˜ï¼Œè€Œä¸æ˜¯ç›´æ¥æ›´æ–°æ•°æ®åº“ï¼Œä¸»è¦æ˜¯å› ä¸ºå…ˆå†™æ•°æ®åº“ä¼šå­˜åœ¨ä¸€ä¸ªæ¯”è¾ƒå…³é”®çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯ç¼“å­˜çš„æ›´æ–°å’Œæ•°æ®åº“çš„æ›´æ–°ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œé‚£ä¹ˆå°±å­˜åœ¨å¤±è´¥çš„å¯èƒ½æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå†™æ•°æ®åº“æˆåŠŸäº†ï¼Œä½†æ˜¯åˆ ç¼“å­˜å¤±è´¥äº†ï¼é‚£ä¹ˆå°±ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚&lt;/p&gt;
&lt;p&gt;è€Œå¦‚æœå…ˆåˆ ç¼“å­˜æˆåŠŸäº†ï¼Œåæ›´æ–°æ•°æ®åº“å¤±è´¥äº†ï¼Œæ²¡å…³ç³»ï¼Œå› ä¸ºç¼“å­˜åˆ é™¤äº†å°±åˆ é™¤äº†ï¼Œåˆä¸æ˜¯æ›´æ–°ï¼Œä¸ä¼šæœ‰é”™è¯¯æ•°æ®ï¼Œä¹Ÿæ²¡æœ‰ä¸ä¸€è‡´é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;å¹¶ä¸”ï¼Œç›¸å¯¹äºç¼“å­˜å’Œæ•°æ®åº“æ¥è¯´ï¼Œæ•°æ®åº“çš„å¤±è´¥çš„æ¦‚ç‡æ›´å¤§ä¸€äº›ï¼Œå¹¶ä¸”åˆ é™¤åŠ¨ä½œå’Œæ›´æ–°åŠ¨ä½œæ¥è¯´ï¼Œæ›´æ–°çš„å¤±è´¥çš„æ¦‚ç‡ä¹Ÿä¼šæ›´å¤§ä¸€äº›ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œä¸ºäº†é¿å…è¿™ä¸ªå› ä¸ºä¸¤ä¸ªæ“ä½œæ— æ³•ä½œä¸ºä¸€ä¸ªåŸå­æ“ä½œè€Œå¯¼è‡´çš„ä¸ä¸€è‡´é—®é¢˜ï¼Œæˆ‘ä»¬é€‰æ‹©å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ã€‚è¿™æ˜¯ç¬¬ä¸€æ¬¡åˆ é™¤ç¼“å­˜çš„åŸå› ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬äºŒæ¬¡&lt;/strong&gt;ï¼š å› ä¸º&amp;quot;è¯»å†™å¹¶å‘&amp;quot;çš„é—®é¢˜ä¼šå¯¼è‡´å¹¶å‘å‘ç”Ÿåï¼Œç¼“å­˜ä¸­çš„æ•°è¢«è¯»çº¿ç¨‹å†™è¿›å»è„æ•°æ®ï¼Œé‚£ä¹ˆå°±åªéœ€è¦åœ¨å†™çº¿ç¨‹åœ¨åˆ ç¼“å­˜ã€å†™æ•°æ®åº“ä¹‹åï¼Œå»¶è¿Ÿä¸€æ®µæ—¶é—´ï¼Œå†æ‰§è¡Œä¸€æŠŠåˆ é™¤åŠ¨ä½œå°±è¡Œäº†ã€‚&lt;/p&gt;</description></item><item><title>CompletableFuture ä»‹ç»ä»¥åŠåŸºæœ¬ä½¿ç”¨æ–¹æ³•</title><link>https://0607pass.github.io/Blog/p/completablefuture-%E4%BB%8B%E7%BB%8D%E4%BB%A5%E5%8F%8A%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/</link><pubDate>Sat, 20 Dec 2025 16:05:28 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/completablefuture-%E4%BB%8B%E7%BB%8D%E4%BB%A5%E5%8F%8A%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/</guid><description>&lt;p&gt;&lt;code&gt;CompletableFuture&lt;/code&gt; æ˜¯ &lt;code&gt;Future&lt;/code&gt; çš„ä¸€ä¸ªæ‰©å±•ï¼Œèƒ½å¤Ÿç®€åŒ–å¼‚æ­¥ç¼–ç¨‹ã€‚å®ƒå…è®¸ä½ æ›´å®¹æ˜“åœ°ç»„åˆå’Œå˜æ¢ä»»åŠ¡çš„ç»“æœï¼Œå¹¶æä¾›äº†ä¸°å¯Œçš„ API æ¥å¤„ç†é”™è¯¯å’Œå–æ¶ˆæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;åˆ›å»ºä¸€ä¸ª CompletableFuture çš„å¸¸è§æ–¹å¼æ˜¯é€šè¿‡é™æ€å·¥å‚æ–¹æ³•ï¼Œå¦‚ supplyAsync æˆ– runAsyncã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;java.util.concurrent.CompletableFuture&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;java.util.concurrent.ExecutionException&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CompletableFutureExample&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;throws&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ExecutionException&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;InterruptedException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;supplyAsync&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ¨¡æ‹Ÿä¸€ä¸ªè€—æ—¶çš„ä»»åŠ¡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Thread&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;2000&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;InterruptedException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Thread&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;currentThread&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;interrupt&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;42&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è¿”å›ä»»åŠ¡çš„ç»“æœ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç­‰å¾…ä»»åŠ¡å®Œæˆ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Result: &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id="é“¾å¼è°ƒç”¨"&gt;é“¾å¼è°ƒç”¨
&lt;/h2&gt;&lt;p&gt;CompletableFuture çš„ä¸€å¤§ä¼˜ç‚¹æ˜¯æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°å°†å¤šä¸ªå¼‚æ­¥æ“ä½œé“¾æ¥åœ¨ä¸€èµ·ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ thenApply å’Œ thenCompose æ–¹æ³•çš„ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;java.util.concurrent.CompletableFuture&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;java.util.concurrent.ExecutionException&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CompletableFutureChainExample&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;throws&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ExecutionException&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;InterruptedException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;supplyAsync&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Hello&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;thenApply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toUpperCase&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è½¬æ¢æˆå¤§å†™&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;thenCompose&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;supplyAsync&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34; World!&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç»„åˆå­—ç¬¦ä¸²&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Result: &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id="é”™è¯¯å¤„ç†"&gt;é”™è¯¯å¤„ç†
&lt;/h2&gt;&lt;p&gt;CompletableFuture æä¾›äº†å‡ ç§æ–¹æ³•æ¥å¤„ç†å¼‚å¸¸æƒ…å†µï¼ŒåŒ…æ‹¬ exceptionally å’Œ handle æ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;java.util.concurrent.CompletableFuture&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;java.util.concurrent.ExecutionException&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CompletableFutureErrorHandling&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;throws&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ExecutionException&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;InterruptedException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;supplyAsync&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Math&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;random&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è·å–ä¸€ä¸ªéšæœºæ•°ï¼Œè‹¥å°äº 0.5ï¼Œ åˆ™æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;throw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RuntimeException&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Something went wrong!&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Success!&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¦åˆ™ï¼Œè¿”å› Success&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;exceptionally&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¤„ç†å¼‚å¸¸&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Caught exception: &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getMessage&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Error occurred&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Result: &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id="å–æ¶ˆæ“ä½œ"&gt;å–æ¶ˆæ“ä½œ
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;span class="lnt"&gt;22
&lt;/span&gt;&lt;span class="lnt"&gt;23
&lt;/span&gt;&lt;span class="lnt"&gt;24
&lt;/span&gt;&lt;span class="lnt"&gt;25
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;java.util.concurrent.CompletableFuture&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;java.util.concurrent.ExecutionException&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CompletableFutureCancellation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;throws&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ExecutionException&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;InterruptedException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;supplyAsync&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Thread&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;2000&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;InterruptedException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Thread&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;currentThread&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;interrupt&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Done!&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;cancel&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å°è¯•å–æ¶ˆä»»åŠ¡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;future&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Result: &amp;#34;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;CancellationException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Task was cancelled.&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;é¡¹ç›®çš„ä½¿ç”¨&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;span class="lnt"&gt;22
&lt;/span&gt;&lt;span class="lnt"&gt;23
&lt;/span&gt;&lt;span class="lnt"&gt;24
&lt;/span&gt;&lt;span class="lnt"&gt;25
&lt;/span&gt;&lt;span class="lnt"&gt;26
&lt;/span&gt;&lt;span class="lnt"&gt;27
&lt;/span&gt;&lt;span class="lnt"&gt;28
&lt;/span&gt;&lt;span class="lnt"&gt;29
&lt;/span&gt;&lt;span class="lnt"&gt;30
&lt;/span&gt;&lt;span class="lnt"&gt;31
&lt;/span&gt;&lt;span class="lnt"&gt;32
&lt;/span&gt;&lt;span class="lnt"&gt;33
&lt;/span&gt;&lt;span class="lnt"&gt;34
&lt;/span&gt;&lt;span class="lnt"&gt;35
&lt;/span&gt;&lt;span class="lnt"&gt;36
&lt;/span&gt;&lt;span class="lnt"&gt;37
&lt;/span&gt;&lt;span class="lnt"&gt;38
&lt;/span&gt;&lt;span class="lnt"&gt;39
&lt;/span&gt;&lt;span class="lnt"&gt;40
&lt;/span&gt;&lt;span class="lnt"&gt;41
&lt;/span&gt;&lt;span class="lnt"&gt;42
&lt;/span&gt;&lt;span class="lnt"&gt;43
&lt;/span&gt;&lt;span class="lnt"&gt;44
&lt;/span&gt;&lt;span class="lnt"&gt;45
&lt;/span&gt;&lt;span class="lnt"&gt;46
&lt;/span&gt;&lt;span class="lnt"&gt;47
&lt;/span&gt;&lt;span class="lnt"&gt;48
&lt;/span&gt;&lt;span class="lnt"&gt;49
&lt;/span&gt;&lt;span class="lnt"&gt;50
&lt;/span&gt;&lt;span class="lnt"&gt;51
&lt;/span&gt;&lt;span class="lnt"&gt;52
&lt;/span&gt;&lt;span class="lnt"&gt;53
&lt;/span&gt;&lt;span class="lnt"&gt;54
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¹¶å‘æŸ¥è¯¢ä¼˜åŒ–&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// RPC: è°ƒç”¨ç”¨æˆ·æœåŠ¡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;creatorId&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;noteDO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getCreatorId&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;FindUserByIdRspDTO&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userResultFuture&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;supplyAsync&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userRpcService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;creatorId&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;threadPoolTaskExecutor&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// RPC: è°ƒç”¨ K-V å­˜å‚¨æœåŠ¡è·å–å†…å®¹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;contentResultFuture&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;completedFuture&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Objects&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;equals&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;noteDO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getIsContentEmpty&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Boolean&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;FALSE&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;contentResultFuture&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;supplyAsync&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;keyValueRpcService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findNoteContent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;noteDO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getContentUuid&lt;/span&gt;&lt;span class="p"&gt;()),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;threadPoolTaskExecutor&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;finalContentResultFuture&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;contentResultFuture&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;FindNoteDetailRspVO&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;resultFuture&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CompletableFuture&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;allOf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;userResultFuture&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;contentResultFuture&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;thenApply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è·å– Future è¿”å›çš„ç»“æœ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FindUserByIdRspDTO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;findUserByIdRspDTO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;userResultFuture&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;join&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;finalContentResultFuture&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;join&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç¬”è®°ç±»å‹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;noteType&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;noteDO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getType&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å›¾æ–‡ç¬”è®°å›¾ç‰‡é“¾æ¥(å­—ç¬¦ä¸²)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;imgUrisStr&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;noteDO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getImgUris&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å›¾æ–‡ç¬”è®°å›¾ç‰‡é“¾æ¥(é›†åˆ)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;imgUris&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å¦‚æœæŸ¥è¯¢çš„æ˜¯å›¾æ–‡ç¬”è®°ï¼Œéœ€è¦å°†å›¾ç‰‡é“¾æ¥çš„é€—å·åˆ†éš”å¼€ï¼Œè½¬æ¢æˆé›†åˆ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Objects&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;equals&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;noteType&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NoteTypeEnum&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;IMAGE_TEXT&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getCode&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;StringUtils&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;isNotBlank&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;imgUrisStr&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;imgUris&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;of&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;imgUrisStr&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;,&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ„å»ºè¿”å‚ VO å®ä½“ç±»&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FindNoteDetailRspVO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;id&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;noteDO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getId&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;noteDO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getType&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;title&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;noteDO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getTitle&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;content&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;imgUris&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;imgUris&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;topicId&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;noteDO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getTopicId&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;topicName&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;noteDO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getTopicName&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;creatorId&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;noteDO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getCreatorId&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;creatorName&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;findUserByIdRspDTO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getNickName&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;avatar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;findUserByIdRspDTO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getAvatar&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;videoUri&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;noteDO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getVideoUri&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;updateTime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;noteDO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getUpdateTime&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;visible&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;noteDO&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getVisible&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è·å–æ‹¼è£…åçš„ FindNoteDetailRspVO&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;FindNoteDetailRspVO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;findNoteDetailRspVO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;resultFuture&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</description></item><item><title>ç¼“å­˜æ·˜æ±°ç®—æ³•</title><link>https://0607pass.github.io/Blog/p/%E7%BC%93%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AE%97%E6%B3%95/</link><pubDate>Sat, 20 Dec 2025 15:06:42 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/%E7%BC%93%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AE%97%E6%B3%95/</guid><description>&lt;p&gt;ç¼“å­˜æ·˜æ±°ç®—æ³•ï¼ˆCache eviction policiesï¼‰æ˜¯æŒ‡åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ç”¨äºå†³å®šå½“ç¼“å­˜æ»¡æ—¶åº”è¯¥ç§»é™¤å“ªäº›æ•°æ®é¡¹ä»¥è…¾å‡ºç©ºé—´çš„ç­–ç•¥ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ç¼“å­˜æ·˜æ±°ç®—æ³•åŠè¯´æ˜ï¼š&lt;/p&gt;
&lt;h2 id="1å…ˆè¿›å…ˆå‡ºfifo-first-in-first-out"&gt;1ã€å…ˆè¿›å…ˆå‡ºï¼ˆFIFO, First-In-First-Outï¼‰ï¼š
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;åŸç†ï¼šæœ€å…ˆè¿›å…¥ç¼“å­˜çš„æ•°æ®æœ€å…ˆè¢«ç§»é™¤ã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜ç‚¹ï¼šå®ç°ç®€å•ã€‚&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹ï¼šä¸è€ƒè™‘æ•°æ®é¡¹çš„é‡è¦æ€§æˆ–ä½¿ç”¨é¢‘ç‡ï¼Œå¯èƒ½å¯¼è‡´ç»å¸¸ä½¿ç”¨çš„æ•°æ®è¢«é¢‘ç¹æ›¿æ¢å‡ºå»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="2æœ€è¿‘æœ€å°‘ä½¿ç”¨lru-least-recently-used"&gt;2ã€æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRU, Least Recently Usedï¼‰ï¼š
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;åŸç†ï¼šæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®é¡¹å°†è¢«é¦–å…ˆç§»é™¤ã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜ç‚¹ï¼šè¾ƒå¥½åœ°åæ˜ äº†æ•°æ®çš„è®¿é—®æ¨¡å¼ï¼Œå³æœ€è¿‘è¢«è®¿é—®è¿‡çš„æ•°æ®å¾ˆå¯èƒ½å†æ¬¡è¢«è®¿é—®ã€‚&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹ï¼šç»´æŠ¤â€œæœ€è¿‘ä½¿ç”¨â€çš„çŠ¶æ€éœ€è¦é¢å¤–çš„ç©ºé—´å’Œè®¡ç®—èµ„æºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸¾ä¸ªä¾‹å­
å‡è®¾å®¹é‡ä¸º ï¼š3
è®¿é—®é¡ºåºï¼š A â†’ B â†’ C â†’ A â†’ D&lt;/p&gt;
&lt;/blockquote&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ­¥éª¤&lt;/th&gt;
&lt;th&gt;ç¼“å­˜å†…å®¹&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;A&lt;/td&gt;
&lt;td&gt;A&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;B&lt;/td&gt;
&lt;td&gt;A B&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;C&lt;/td&gt;
&lt;td&gt;A B C&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;A&lt;/td&gt;
&lt;td&gt;B C A&lt;/td&gt;
&lt;td&gt;A æœ€è¿‘è®¿é—®ï¼Œç§»åˆ°â€œæœ€æ–°â€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;D&lt;/td&gt;
&lt;td&gt;C A D&lt;/td&gt;
&lt;td&gt;B æœ€ä¹…æœªè®¿é—®ï¼Œè¢«æ·˜æ±°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ·˜æ±°B&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;å®ç°æ–¹å¼ï¼šHashMap + åŒå‘é“¾è¡¨&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="3æœ€ä¸ç»å¸¸ä½¿ç”¨lfu-least-frequently-used"&gt;3ã€æœ€ä¸ç»å¸¸ä½¿ç”¨ï¼ˆLFU, Least Frequently Usedï¼‰ï¼š
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;åŸç†ï¼šæœ€ä¸ç»å¸¸ä½¿ç”¨çš„æ•°æ®é¡¹è¢«ä¼˜å…ˆç§»é™¤ã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜ç‚¹ï¼šèƒ½å¤Ÿæ ¹æ®æ•°æ®çš„ä½¿ç”¨é¢‘ç‡åšå‡ºæ›´åˆç†çš„å†³ç­–ã€‚&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹ï¼šéœ€è¦ç»´æŠ¤æ¯ä¸ªæ•°æ®é¡¹çš„ä½¿ç”¨è®¡æ•°ï¼Œå¢åŠ äº†å®ç°å¤æ‚åº¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸¾ä¸ªä¾‹å­
å‡è®¾å®¹é‡ä¸º ï¼š3
A â†’ A â†’ B â†’ C â†’ D&lt;/p&gt;
&lt;/blockquote&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ•°æ®&lt;/th&gt;
&lt;th&gt;æ¬¡æ•°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;A&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;B&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;C&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æ’å…¥ D æ—¶ æ·˜æ±° B (Bã€C)æ¬¡æ•°ä¸€æ ·ï¼Œä¼˜å…ˆæ·˜æ±°æœ€æ—©è¿›æ¥çš„&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å®ç°æ–¹å¼ï¼š HashMap + é¢‘ç‡é“¾è¡¨&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id="redisä¸­çš„å†…å­˜æ·˜æ±°ç­–ç•¥æ˜¯ä»€ä¹ˆ"&gt;Redisä¸­çš„å†…å­˜æ·˜æ±°ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ
&lt;/h1&gt;&lt;p&gt;Redis çš„æ·˜æ±°ç­–ç•¥ç”±é…ç½®é¡¹æ§åˆ¶ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code class="language-conf" data-lang="conf"&gt;maxmemory-policy &amp;lt;policy&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸»è¦åˆ†ä¸º3 å¤§ç±»&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;noevictionï¼ˆé»˜è®¤ï¼‰ï¼š å³ä¸æ·˜æ±°ä»»ä½•key å†…å­˜æ»¡äº†ä¹‹åï¼Œå†™è¯·æ±‚æŠ¥é”™ï¼Œè¯»è¯·æ±‚æ­£å¸¸&lt;/li&gt;
&lt;li&gt;volatileï¼ˆåªæ·˜æ±°è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ keyï¼‰
&lt;ul&gt;
&lt;li&gt;volatile-lru&lt;/li&gt;
&lt;li&gt;volatile-lfu&lt;/li&gt;
&lt;li&gt;volatile-random&lt;/li&gt;
&lt;li&gt;volatile-ttl&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;allkeysï¼ˆå¯ä»¥æ·˜æ±°æ‰€æœ‰ keyï¼‰
&lt;ol&gt;
&lt;li&gt;allkeys-lruï¼ˆ å¸¸ç”¨ï¼‰&lt;/li&gt;
&lt;li&gt;allkeys-lfuï¼ˆ Redis 4.0+ æ¨èï¼‰&lt;/li&gt;
&lt;li&gt;allkeys-random&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Redisä¸­çš„ LFU æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ ¸å¿ƒæ•°æ®ç»“æ„ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;span class="lnt"&gt;8
&lt;/span&gt;&lt;span class="lnt"&gt;9
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-c" data-lang="c"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;typedef&lt;/span&gt; &lt;span class="k"&gt;struct&lt;/span&gt; &lt;span class="n"&gt;redisObject&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="nl"&gt;type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="nl"&gt;encoding&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="nl"&gt;lru&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;LRU_BITS&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* LRU time (relative to global lru_clock) or
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * LFU data (least significant 8 bits frequency
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * and most significant 16 bits access time). */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;refcount&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;ptr&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="n"&gt;robj&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</description></item><item><title>Spring AI 1.1.0 é›†æˆ OpenGauss å‘é‡æ•°æ®åº“å®ç° RAG æ£€ç´¢</title><link>https://0607pass.github.io/Blog/p/spring-ai-1.1.0-%E9%9B%86%E6%88%90-opengauss-%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E7%8E%B0-rag-%E6%A3%80%E7%B4%A2/</link><pubDate>Sat, 20 Dec 2025 10:19:03 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/spring-ai-1.1.0-%E9%9B%86%E6%88%90-opengauss-%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E7%8E%B0-rag-%E6%A3%80%E7%B4%A2/</guid><description>&lt;img src="https://0607pass.github.io/Blog/images/postCover/spring.png" alt="Featured image of post Spring AI 1.1.0 é›†æˆ OpenGauss å‘é‡æ•°æ®åº“å®ç° RAG æ£€ç´¢" /&gt;&lt;h1 id="1å‰è¨€"&gt;1ã€å‰è¨€
&lt;/h1&gt;&lt;p&gt;æœ€è¿‘åœ¨åš RAG é¡¹ç›®æ—¶ï¼Œå‘ç°å¾ˆå¤šäººè¿˜åœ¨ç”¨ PGVector æˆ–è€… Milvusï¼Œå…¶å®å›½äº§æ•°æ®åº“ OpenGauss çš„å‘é‡èƒ½åŠ›å·²ç»ç›¸å½“æˆç†Ÿäº†ã€‚ç‰¹åˆ«æ˜¯å®ƒçš„å‘é‡ç´¢å¼•å’ŒæŸ¥è¯¢ä¼˜åŒ–ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒçš„è¡¨ç°æ¯”é¢„æœŸè¦å¥½ä¸å°‘ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« ä¸»è¦è®°å½•ä¸€ä¸‹å¦‚ä½•ç”¨ Spring AI 1.1.0 é›†æˆ OpenGauss çš„å‘é‡æ£€ç´¢èƒ½åŠ›ï¼Œä»¥åŠ OpenGauss åœ¨å‘é‡å­˜å‚¨æ–¹é¢çš„ä¸€äº›ç‰¹æ€§ã€‚ä¸æé‚£äº›è™šçš„ï¼Œç›´æ¥ä¸Šæ‰‹å¹²ã€‚&lt;/p&gt;
&lt;h1 id="2opengauss-å‘é‡æ•°æ®åº“ç‰¹æ€§"&gt;2ã€OpenGauss å‘é‡æ•°æ®åº“ç‰¹æ€§
&lt;/h1&gt;&lt;h2 id="21-å‘é‡ç±»å‹æ”¯æŒ"&gt;2.1 å‘é‡ç±»å‹æ”¯æŒ
&lt;/h2&gt;&lt;p&gt;OpenGauss åŸç”Ÿæ”¯æŒä¸‰ç§å‘é‡ç±»å‹ï¼Œè¿™ä¸ªè®¾è®¡è¿˜æŒºæœ‰æ„æ€çš„ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;-- æµ®ç‚¹å‘é‡ï¼Œæœ€å¸¸ç”¨ï¼Œæ”¯æŒåˆ° 16000 ç»´
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TABLE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;BIGSERIAL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;PRIMARY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;KEY&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;embedding&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;VECTOR&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1536&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;-- OpenAI åµŒå…¥ç»´åº¦
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;-- ä½å‘é‡ï¼Œé€‚åˆäºŒè¿›åˆ¶å“ˆå¸Œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TABLE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;binary_index&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;BIGINT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hash_bits&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;BITVEC&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;-- ç¨€ç–å‘é‡ï¼Œé€‚åˆé«˜ç»´ç¨€ç–åœºæ™¯
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TABLE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sparse_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;BIGINT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;features&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SPARSEVEC&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1000000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;-- ç†è®ºç»´åº¦å¾ˆå¤§ï¼Œä½†éé›¶å…ƒç´ æœ€å¤š 16000 ä¸ª
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å®é™…é¡¹ç›®ä¸­ï¼Œ&lt;code&gt;VECTOR&lt;/code&gt; ç±»å‹ç”¨å¾—æœ€å¤šï¼Œç‰¹åˆ«æ˜¯é…åˆ OpenAI çš„ text-embedding-3-small æˆ–è€… bge-small è¿™ç±»æ¨¡å‹ï¼Œ1536 ç»´åˆšåˆšå¥½ã€‚&lt;/p&gt;
&lt;h2 id="22-ç´¢å¼•ç±»å‹é€‰æ‹©"&gt;2.2 ç´¢å¼•ç±»å‹é€‰æ‹©
&lt;/h2&gt;&lt;p&gt;OpenGauss æä¾›äº†å››ç§å‘é‡ç´¢å¼•ï¼Œå„æœ‰é€‚ç”¨åœºæ™¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;IVFFLAT&lt;/strong&gt; - ç®€å•ç²—æš´ï¼Œé€‚åˆæ•°æ®é‡ä¸å¤§ï¼ˆ&amp;lt;100ä¸‡ï¼‰çš„åœºæ™¯&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INDEX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;idx_ivfflat&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;USING&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ivfflat&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;embedding&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vector_l2_ops&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WITH&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lists&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;IVF-PQ&lt;/strong&gt; - é‡åŒ–å‹ç¼©ï¼Œçœå†…å­˜ä½†ç²¾åº¦æœ‰æŸå¤±&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INDEX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;idx_ivf_pq&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;USING&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ivfflat&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;embedding&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vector_l2_ops&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;WITH&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lists&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;encoding&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;pq&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;encoding_params&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;dim=1536,subquant=8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;HNSW&lt;/strong&gt; - å½“å‰æœ€ç«çš„å›¾ç´¢å¼•ï¼ŒæŸ¥è¯¢å¿«ä½†æ„å»ºæ…¢&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INDEX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;idx_hnsw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;USING&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hnsw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;embedding&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vector_l2_ops&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;WITH&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ef_construction&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;HNSW-PQ&lt;/strong&gt; - HNSW + é‡åŒ–ï¼Œå¹³è¡¡å‹é€‰æ‹©&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INDEX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;idx_hnsw_pq&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;USING&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hnsw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;embedding&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vector_l2_ops&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;WITH&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ef_construction&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;encoding&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;pq&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ç”Ÿäº§ç¯å¢ƒå»ºè®®ï¼š&lt;strong&gt;HNSW&lt;/strong&gt; æ˜¯æœ€ç¨³å¦¥çš„é€‰æ‹©ï¼Œè™½ç„¶æ„å»ºæ—¶é—´é•¿ç‚¹ï¼Œä½†æŸ¥è¯¢æ€§èƒ½ç¡®å®é¦™ã€‚&lt;/p&gt;
&lt;h2 id="23-ç›¸ä¼¼åº¦è®¡ç®—"&gt;2.3 ç›¸ä¼¼åº¦è®¡ç®—
&lt;/h2&gt;&lt;p&gt;OpenGauss æ”¯æŒä¸‰ç§è·ç¦»ç®—æ³•ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;span class="lnt"&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;-- L2 è·ç¦»ï¼ˆæ¬§æ°è·ç¦»ï¼‰ï¼Œæ•°å€¼è¶Šå°è¶Šç›¸ä¼¼
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ORDER&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;BY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;embedding&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;[0.1,0.2,...]&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;LIMIT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;-- ä½™å¼¦è·ç¦»ï¼Œæ•°å€¼è¶Šå°è¶Šç›¸ä¼¼ï¼ˆæ³¨æ„æ˜¯è·ç¦»ï¼Œä¸æ˜¯ç›¸ä¼¼åº¦ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ORDER&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;BY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;embedding&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;=&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;[0.1,0.2,...]&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;LIMIT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;-- å†…ç§¯ï¼Œæ•°å€¼è¶Šå¤§è¶Šç›¸ä¼¼
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ORDER&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;BY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;embedding&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;#&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;[0.1,0.2,...]&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;LIMIT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å¦‚æœæ˜¯ç”¨ OpenAI æˆ–è€… BGE ç³»åˆ—çš„åµŒå…¥å‘é‡ï¼Œæ¨èç”¨ä½™å¼¦è·ç¦»ï¼ˆ&lt;code&gt;&amp;lt;=&amp;gt;&lt;/code&gt;ï¼‰ï¼Œå› ä¸ºè¿™äº›æ¨¡å‹è®­ç»ƒæ—¶å°±æ˜¯ä¼˜åŒ–ä½™å¼¦ç›¸ä¼¼åº¦ã€‚&lt;/p&gt;
&lt;h1 id="3spring-ai-110-é›†æˆå®æˆ˜"&gt;3ã€Spring AI 1.1.0 é›†æˆå®æˆ˜
&lt;/h1&gt;&lt;h2 id="31-ä¾èµ–é…ç½®"&gt;3.1 ä¾èµ–é…ç½®
&lt;/h2&gt;&lt;p&gt;Spring AI 1.1.0 å¯¹ OpenGauss çš„æ”¯æŒè¿˜åœ¨å®Œå–„ä¸­ï¼Œç›®å‰éœ€è¦é€šè¿‡ JDBC æ–¹å¼æ¥å…¥ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-xml" data-lang="xml"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;dependencies&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="c"&gt;&amp;lt;!-- Spring AI æ ¸å¿ƒ --&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.springframework.ai&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;spring-ai-core&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;1.1.0&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="c"&gt;&amp;lt;!-- æ•°æ®åº“è¿æ¥ --&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.postgresql&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;postgresql&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;42.7.2&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="c"&gt;&amp;lt;!-- è¿æ¥æ±  --&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.zaxxer&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;HikariCP&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nt"&gt;&amp;lt;/dependencies&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æ³¨æ„ï¼šOpenGauss çš„ JDBC é©±åŠ¨å’Œ PostgreSQL å…¼å®¹ï¼Œç›´æ¥ç”¨ PG çš„é©±åŠ¨å°±è¡Œã€‚&lt;/p&gt;
&lt;h2 id="32-å‘é‡å­˜å‚¨å®ç°"&gt;3.2 å‘é‡å­˜å‚¨å®ç°
&lt;/h2&gt;&lt;p&gt;Spring AI çš„ &lt;code&gt;VectorStore&lt;/code&gt; æ¥å£éœ€è¦è‡ªå·±å®ç°ï¼Œè¿™é‡Œç»™ä¸ªå®Œæ•´çš„ä¾‹å­ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;span class="lnt"&gt;22
&lt;/span&gt;&lt;span class="lnt"&gt;23
&lt;/span&gt;&lt;span class="lnt"&gt;24
&lt;/span&gt;&lt;span class="lnt"&gt;25
&lt;/span&gt;&lt;span class="lnt"&gt;26
&lt;/span&gt;&lt;span class="lnt"&gt;27
&lt;/span&gt;&lt;span class="lnt"&gt;28
&lt;/span&gt;&lt;span class="lnt"&gt;29
&lt;/span&gt;&lt;span class="lnt"&gt;30
&lt;/span&gt;&lt;span class="lnt"&gt;31
&lt;/span&gt;&lt;span class="lnt"&gt;32
&lt;/span&gt;&lt;span class="lnt"&gt;33
&lt;/span&gt;&lt;span class="lnt"&gt;34
&lt;/span&gt;&lt;span class="lnt"&gt;35
&lt;/span&gt;&lt;span class="lnt"&gt;36
&lt;/span&gt;&lt;span class="lnt"&gt;37
&lt;/span&gt;&lt;span class="lnt"&gt;38
&lt;/span&gt;&lt;span class="lnt"&gt;39
&lt;/span&gt;&lt;span class="lnt"&gt;40
&lt;/span&gt;&lt;span class="lnt"&gt;41
&lt;/span&gt;&lt;span class="lnt"&gt;42
&lt;/span&gt;&lt;span class="lnt"&gt;43
&lt;/span&gt;&lt;span class="lnt"&gt;44
&lt;/span&gt;&lt;span class="lnt"&gt;45
&lt;/span&gt;&lt;span class="lnt"&gt;46
&lt;/span&gt;&lt;span class="lnt"&gt;47
&lt;/span&gt;&lt;span class="lnt"&gt;48
&lt;/span&gt;&lt;span class="lnt"&gt;49
&lt;/span&gt;&lt;span class="lnt"&gt;50
&lt;/span&gt;&lt;span class="lnt"&gt;51
&lt;/span&gt;&lt;span class="lnt"&gt;52
&lt;/span&gt;&lt;span class="lnt"&gt;53
&lt;/span&gt;&lt;span class="lnt"&gt;54
&lt;/span&gt;&lt;span class="lnt"&gt;55
&lt;/span&gt;&lt;span class="lnt"&gt;56
&lt;/span&gt;&lt;span class="lnt"&gt;57
&lt;/span&gt;&lt;span class="lnt"&gt;58
&lt;/span&gt;&lt;span class="lnt"&gt;59
&lt;/span&gt;&lt;span class="lnt"&gt;60
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Component&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;OpenGaussVectorStore&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;VectorStore&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JdbcTemplate&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;jdbcTemplate&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EmbeddingClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;embeddingClient&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;OpenGaussVectorStore&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;JdbcTemplate&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;jdbcTemplate&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EmbeddingClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;embeddingClient&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;jdbcTemplate&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;jdbcTemplate&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;embeddingClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;embeddingClient&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;documents&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;doc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;documents&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç”ŸæˆåµŒå…¥å‘é‡&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;float&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;embedding&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;embeddingClient&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;embed&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getText&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å­˜å…¥æ•°æ®åº“&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;jdbcTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;update&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;INSERT INTO documents (content, embedding, metadata) VALUES (?, ?, ?)&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getText&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Vector&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;embedding&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getMetadata&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;similaritySearch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SearchRequest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;float&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;queryEmbedding&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;embeddingClient&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;embed&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getQuery&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s"&gt; SELECT id, content, metadata, embedding &amp;lt;=&amp;gt; ? as distance
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s"&gt; FROM documents
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s"&gt; ORDER BY embedding &amp;lt;=&amp;gt; ?
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s"&gt; LIMIT ?
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s"&gt; &amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;jdbcTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rs&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rowNum&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;doc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rs&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getMetadata&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rs&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getLong&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getMetadata&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;distance&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rs&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getFloat&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;distance&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Vector&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;queryEmbedding&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Vector&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;queryEmbedding&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getTopK&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;delete&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docIds&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;DELETE FROM documents WHERE id = ?&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docIds&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;jdbcTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;update&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Long&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;parseLong&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿™é‡Œæœ‰ä¸ªå°å‘ï¼šSpring AI çš„ &lt;code&gt;Vector&lt;/code&gt; ç±»å‹éœ€è¦è‡ªå·±å¤„ç†ï¼ŒOpenGauss çš„ JDBC é©±åŠ¨å¯¹å‘é‡ç±»å‹æ”¯æŒè¿˜ä¸å¤Ÿå®Œå–„ï¼Œå»ºè®®ç”¨ &lt;code&gt;float[]&lt;/code&gt; æ•°ç»„é…åˆè‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨ã€‚&lt;/p&gt;
&lt;h2 id="33-rag-æœåŠ¡å°è£…"&gt;3.3 RAG æœåŠ¡å°è£…
&lt;/h2&gt;&lt;p&gt;æœ‰äº†å‘é‡å­˜å‚¨ï¼ŒRAG æœåŠ¡å°±ç®€å•äº†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;span class="lnt"&gt;22
&lt;/span&gt;&lt;span class="lnt"&gt;23
&lt;/span&gt;&lt;span class="lnt"&gt;24
&lt;/span&gt;&lt;span class="lnt"&gt;25
&lt;/span&gt;&lt;span class="lnt"&gt;26
&lt;/span&gt;&lt;span class="lnt"&gt;27
&lt;/span&gt;&lt;span class="lnt"&gt;28
&lt;/span&gt;&lt;span class="lnt"&gt;29
&lt;/span&gt;&lt;span class="lnt"&gt;30
&lt;/span&gt;&lt;span class="lnt"&gt;31
&lt;/span&gt;&lt;span class="lnt"&gt;32
&lt;/span&gt;&lt;span class="lnt"&gt;33
&lt;/span&gt;&lt;span class="lnt"&gt;34
&lt;/span&gt;&lt;span class="lnt"&gt;35
&lt;/span&gt;&lt;span class="lnt"&gt;36
&lt;/span&gt;&lt;span class="lnt"&gt;37
&lt;/span&gt;&lt;span class="lnt"&gt;38
&lt;/span&gt;&lt;span class="lnt"&gt;39
&lt;/span&gt;&lt;span class="lnt"&gt;40
&lt;/span&gt;&lt;span class="lnt"&gt;41
&lt;/span&gt;&lt;span class="lnt"&gt;42
&lt;/span&gt;&lt;span class="lnt"&gt;43
&lt;/span&gt;&lt;span class="lnt"&gt;44
&lt;/span&gt;&lt;span class="lnt"&gt;45
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;RagService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;OpenGaussVectorStore&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vectorStore&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ChatClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chatClient&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;RagService&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;OpenGaussVectorStore&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vectorStore&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ChatClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chatClient&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;vectorStore&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vectorStore&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;chatClient&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chatClient&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// 1. å‘é‡æ£€ç´¢&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;documents&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vectorStore&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;similaritySearch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SearchRequest&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;withTopK&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// 2. æ„å»ºæç¤ºè¯&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;documents&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="n"&gt;getText&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;collect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Collectors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;joining&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;\n\n&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;prompt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s"&gt; åŸºäºä»¥ä¸‹ä¸Šä¸‹æ–‡ä¿¡æ¯å›ç­”é—®é¢˜ï¼š
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s"&gt; ä¸Šä¸‹æ–‡ï¼š
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s"&gt; %s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s"&gt; é—®é¢˜ï¼š%s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s"&gt; è¯·ç»™å‡ºå‡†ç¡®ã€ç®€æ´çš„å›ç­”ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="s"&gt; &amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// 3. è°ƒç”¨å¤§æ¨¡å‹&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;chatClient&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;call&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;prompt&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ‰¹é‡å¯¼å…¥æ–‡æ¡£&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;importDocuments&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;texts&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;texts&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;collect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Collectors&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toList&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vectorStore&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;docs&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id="4æ€§èƒ½ä¼˜åŒ–å®è·µ"&gt;4ã€æ€§èƒ½ä¼˜åŒ–å®è·µ
&lt;/h1&gt;&lt;h2 id="41-ç´¢å¼•è°ƒä¼˜"&gt;4.1 ç´¢å¼•è°ƒä¼˜
&lt;/h2&gt;&lt;p&gt;åœ¨å®é™…æµ‹è¯•ä¸­ï¼ŒHNSW ç´¢å¼•çš„å‚æ•°è°ƒä¼˜å¾ˆå…³é”®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;-- m: æ¯ä¸ªèŠ‚ç‚¹çš„é‚»å±…æ•°ï¼Œè¶Šå¤§è¶Šç²¾ç¡®ä½†ç´¢å¼•è¶Šå¤§ï¼Œé€šå¸¸ 16-32
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;-- ef_construction: æ„å»ºæ—¶çš„æœç´¢èŒƒå›´ï¼Œè¶Šå¤§è´¨é‡è¶Šå¥½ä½†æ„å»ºæ…¢
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INDEX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;idx_hnsw_optimized&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;documents&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;USING&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hnsw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;embedding&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vector_l2_ops&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;WITH&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ef_construction&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;300&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;-- æŸ¥è¯¢æ—¶çš„æ‰©å±•å› å­ï¼Œè¶Šå¤§è¶Šç²¾ç¡®ä½†æŸ¥è¯¢æ…¢
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;SET&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hnsw&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ef_search&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å®æµ‹æ•°æ®ï¼š100ä¸‡æ¡å‘é‡ï¼Œm=24, ef_construction=300 æ—¶ï¼ŒæŸ¥è¯¢å»¶è¿Ÿåœ¨ 10-20msï¼Œå¬å›ç‡ 95%+ã€‚&lt;/p&gt;
&lt;h2 id="42-æ‰¹é‡æ“ä½œä¼˜åŒ–"&gt;4.2 æ‰¹é‡æ“ä½œä¼˜åŒ–
&lt;/h2&gt;&lt;p&gt;å‘é‡æ’å…¥æ˜¯æ€§èƒ½ç“¶é¢ˆï¼Œå»ºè®®æ‰¹é‡å¤„ç†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;span class="lnt"&gt;22
&lt;/span&gt;&lt;span class="lnt"&gt;23
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;batchAdd&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;documents&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batchSize&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batches&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Lists&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;partition&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;documents&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batchSize&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batches&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;jdbcTemplate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;batchUpdate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;INSERT INTO documents (content, embedding) VALUES (?, ?)&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;BatchPreparedStatementSetter&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;setValues&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;PreparedStatement&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ps&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;throws&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SQLException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Document&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;doc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batch&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;float&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;embedding&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;embeddingClient&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;embed&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getText&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ps&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getText&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ps&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setObject&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Vector&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;embedding&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getBatchSize&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;batch&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;size&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id="43-å†·çƒ­åˆ†ç¦»"&gt;4.3 å†·çƒ­åˆ†ç¦»
&lt;/h2&gt;&lt;p&gt;å¯¹äºè¶…å¤§è§„æ¨¡æ•°æ®ï¼Œå¯ä»¥è€ƒè™‘å†·çƒ­åˆ†ç¦»ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;-- çƒ­æ•°æ®ï¼šæœ€è¿‘ 7 å¤©ï¼Œç”¨ HNSW ç´¢å¼•
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TABLE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;documents_hot&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;BIGSERIAL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;PRIMARY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;KEY&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;embedding&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;VECTOR&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1536&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;created_at&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TIMESTAMP&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;DEFAULT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NOW&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INDEX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;idx_hnsw_hot&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;documents_hot&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;USING&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hnsw&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;embedding&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vector_l2_ops&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;-- å†·æ•°æ®ï¼šå†å²æ•°æ®ï¼Œç”¨ IVFFLAT ç´¢å¼•çœå†…å­˜
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TABLE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;documents_cold&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;BIGSERIAL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;PRIMARY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;KEY&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;TEXT&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;embedding&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;VECTOR&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1536&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;created_at&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TIMESTAMP&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INDEX&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;idx_ivfflat_cold&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;ON&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;documents_cold&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;USING&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ivfflat&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;embedding&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vector_l2_ops&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;WITH&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lists&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;500&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æŸ¥è¯¢æ—¶å…ˆæŸ¥çƒ­è¡¨ï¼Œç»“æœä¸è¶³å†æŸ¥å†·è¡¨ã€‚&lt;/p&gt;
&lt;h1 id="5è¸©å‘è®°å½•"&gt;5ã€è¸©å‘è®°å½•
&lt;/h1&gt;&lt;h2 id="51-å‘é‡ç»´åº¦ä¸åŒ¹é…"&gt;5.1 å‘é‡ç»´åº¦ä¸åŒ¹é…
&lt;/h2&gt;&lt;p&gt;OpenGauss åˆ›å»ºè¡¨æ—¶æŒ‡å®šäº†å‘é‡ç»´åº¦ï¼Œæ’å…¥æ—¶å¿…é¡»ä¸¥æ ¼åŒ¹é…ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;-- é”™è¯¯ï¼šç»´åº¦ä¸åŒ¹é…
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TABLE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;embedding&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;VECTOR&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;768&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;INSERT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INTO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;VALUES&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;[0.1,0.2]&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;-- 2ç»´ï¼ŒæŠ¥é”™
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="c1"&gt;-- æ­£ç¡®ï¼šç»´åº¦ä¸€è‡´
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TABLE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;embedding&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;VECTOR&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1536&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;INSERT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INTO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;docs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;VALUES&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;ARRAY&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,...]::&lt;/span&gt;&lt;span class="nb"&gt;float&lt;/span&gt;&lt;span class="p"&gt;[]);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;-- 1536ç»´
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id="52-é©±åŠ¨å…¼å®¹æ€§é—®é¢˜"&gt;5.2 é©±åŠ¨å…¼å®¹æ€§é—®é¢˜
&lt;/h2&gt;&lt;p&gt;OpenGauss çš„å‘é‡ç±»å‹åœ¨æ ‡å‡† PG é©±åŠ¨ä¸­ä¸è¢«è¯†åˆ«ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;// è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;VectorTypeHandler&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;implements&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;TypeHandler&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kt"&gt;float&lt;/span&gt;&lt;span class="o"&gt;[]&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;setParameter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;PreparedStatement&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ps&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;float&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;parameter&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;JdbcType&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;jdbcType&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;throws&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SQLException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è½¬æ¢ä¸º PostgreSQL æ•°ç»„æ ¼å¼&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;arrayStr&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Arrays&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;parameter&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;[&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;{&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="na"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;]&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#34;}&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ps&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;setObject&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;arrayStr&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Types&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;OTHER&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;float&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getResult&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ResultSet&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rs&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;columnName&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;throws&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SQLException&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;arrayStr&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rs&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getString&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;columnName&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;parseVector&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arrayStr&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id="53-å†…å­˜å ç”¨"&gt;5.3 å†…å­˜å ç”¨
&lt;/h2&gt;&lt;p&gt;HNSW ç´¢å¼•è™½ç„¶æŸ¥è¯¢å¿«ï¼Œä½†å†…å­˜å ç”¨ä¸å°ã€‚100ä¸‡æ¡ 1536 ç»´å‘é‡ï¼Œå¤§çº¦éœ€è¦ 8-10GB å†…å­˜ã€‚å¦‚æœå†…å­˜ç´§å¼ ï¼Œå¯ä»¥è€ƒè™‘ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨ IVF-PQ å‹ç¼©&lt;/li&gt;
&lt;li&gt;é™ä½å‘é‡ç»´åº¦ï¼ˆç”¨ PCA é™ç»´ï¼‰&lt;/li&gt;
&lt;li&gt;åˆ†ç‰‡å­˜å‚¨&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="6æ€»ç»“"&gt;6ã€æ€»ç»“
&lt;/h1&gt;&lt;p&gt;OpenGauss çš„å‘é‡èƒ½åŠ›ç¡®å®ä¸é”™ï¼Œç‰¹åˆ«æ˜¯ HNSW ç´¢å¼•çš„æ€§èƒ½è¡¨ç°ã€‚å’Œ Spring AI é›†æˆæ—¶ï¼Œä¸»è¦å·¥ä½œé‡åœ¨ JDBC é©±åŠ¨é€‚é…å’Œç±»å‹å¤„ç†ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;ç›¸æ¯”å…¶ä»–å‘é‡æ•°æ®åº“ï¼ŒOpenGauss çš„ä¼˜åŠ¿åœ¨äºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸç”Ÿ SQL æ”¯æŒï¼Œå­¦ä¹ æˆæœ¬ä½&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡ä¸€è‡´æ€§ï¼Œæ•°æ®å¯é æ€§é«˜&lt;/li&gt;
&lt;li&gt;å›½äº§åŒ–ï¼Œåˆè§„æ€§å¥½&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼ºç‚¹æ˜¯ç”Ÿæ€è¿˜åœ¨å®Œå–„ä¸­ï¼Œä¸€äº›é«˜çº§åŠŸèƒ½éœ€è¦è‡ªå·±é€ è½®å­ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºæƒ³åœ¨ç°æœ‰ç³»ç»Ÿä¸­åŠ å…¥ RAG èƒ½åŠ›çš„å›¢é˜Ÿï¼ŒOpenGauss æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œç‰¹åˆ«æ˜¯å·²ç»åœ¨ç”¨ PG æˆ–è€… OpenGauss çš„åœºæ™¯ï¼Œè¿ç§»æˆæœ¬å¾ˆä½ã€‚&lt;/p&gt;
&lt;p&gt;ä»£ç ç¤ºä¾‹å’Œå®Œæ•´é¡¹ç›®ç»“æ„ï¼Œå¯ä»¥å‚è€ƒä¸Šé¢çš„å®ç°æ€è·¯ï¼Œæ ¹æ®å…·ä½“ä¸šåŠ¡è°ƒæ•´å³å¯ã€‚&lt;/p&gt;</description></item><item><title>å¦‚ä½•å‹æµ‹ï¼Ÿï¼Ÿ</title><link>https://0607pass.github.io/Blog/p/%E5%A6%82%E4%BD%95%E5%8E%8B%E6%B5%8B/</link><pubDate>Tue, 16 Dec 2025 15:19:46 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/%E5%A6%82%E4%BD%95%E5%8E%8B%E6%B5%8B/</guid><description>&lt;h1 id="1æ€§èƒ½æµ‹è¯•æ ¸å¿ƒæœ¯è¯­"&gt;1ã€æ€§èƒ½æµ‹è¯•æ ¸å¿ƒæœ¯è¯­
&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;å¹¶å‘ç”¨æˆ·ï¼šåœ¨æ€§èƒ½æµ‹è¯•å·¥å…·ä¸­ï¼Œä¸€èˆ¬ç§°ä¸ºè™šæ‹Ÿç”¨æˆ·ï¼ˆVirtual Userï¼Œç®€ç§° VUï¼‰ï¼ŒæŒ‡çš„æ˜¯ç°å®ç³»ç»Ÿä¸­æ“ä½œä¸šåŠ¡çš„ç”¨æˆ·ã€‚&lt;/li&gt;
&lt;li&gt;QPS (Queries Per Second)ï¼šæ¯ç§’æ‰§è¡Œçš„æŸ¥è¯¢æ¬¡æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªç½‘ç«™çš„é¦–é¡µæ¯ç§’å¯ä»¥å“åº” 100 æ¬¡ç”¨æˆ·è¯·æ±‚ï¼Œåˆ™è¯¥é¡µé¢çš„ QPS ä¸º 100ã€‚&lt;/li&gt;
&lt;li&gt;TPS (Transaction Per Second): æ¯ç§’äº‹åŠ¡æ•°ï¼ˆååé‡ï¼‰ï¼Œæ˜¯è¡¡é‡ç³»ç»Ÿæ€§èƒ½çš„ä¸€ä¸ªéå¸¸é‡è¦çš„æŒ‡æ ‡ã€‚äº‹åŠ¡é€šå¸¸æ˜¯æŒ‡ä¸€ç³»åˆ—ç›¸å…³çš„æ“ä½œï¼Œä¾‹å¦‚ä¸€ä¸ªåœ¨çº¿å•†åŸï¼Œåœ¨é«˜å³°æœŸå¹³å‡æ¯ç§’èƒ½å¤Ÿå®Œæˆå¤šå°‘ç¬”äº¤æ˜“ã€‚&lt;/li&gt;
&lt;li&gt;RPSï¼ˆRequest Per Secondï¼‰ï¼šæ¯ç§’è¯·æ±‚æ•°ã€‚RPSæ¨¡å¼é€‚åˆç”¨äºå®¹é‡è§„åˆ’å’Œä½œä¸ºé™æµç®¡æ§çš„å‚è€ƒä¾æ®ã€‚&lt;/li&gt;
&lt;li&gt;RTï¼ˆResponse Timeï¼‰ï¼šå“åº”æ—¶é—´ï¼ŒæŒ‡çš„æ˜¯ä¸šåŠ¡ä»å®¢æˆ·ç«¯å‘èµ·åˆ°å®¢æˆ·ç«¯æ¥æ”¶çš„æ—¶é—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="12-æ˜“æ··æ·†çš„æœ¯è¯­"&gt;1.2 ã€æ˜“æ··æ·†çš„æœ¯è¯­
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;TPS vs. QPS:
&lt;ul&gt;
&lt;li&gt;TPS å…³æ³¨çš„æ˜¯æ•´ä¸ªä¸šåŠ¡æµç¨‹çš„å®Œæˆæƒ…å†µï¼Œä¾‹å¦‚å®Œæˆä¸€ç¬”è®¢å•äº¤æ˜“ã€‚&lt;/li&gt;
&lt;li&gt;QPS æ›´åŠ ç»†åŒ–ï¼Œä¸“æ³¨äºå•ä¸ªæ•°æ®åº“æŸ¥è¯¢æˆ– API è°ƒç”¨çš„é€Ÿåº¦ã€‚ä¸€ä¸ªTPSå¯èƒ½åŒ…å«å¤šä¸ªQPSã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;QPS vs. RPS:
&lt;ul&gt;
&lt;li&gt;QPS é€šå¸¸ç‰¹æŒ‡æ•°æ®åº“æŸ¥è¯¢çš„é¢‘ç‡ï¼ŒAPI æ¥å£çš„è°ƒç”¨é€Ÿç‡ã€‚&lt;/li&gt;
&lt;li&gt;RPS æ˜¯æŒ‡ HTTP è¯·æ±‚çš„é¢‘ç‡ï¼Œå¯ä»¥åŒ…æ‹¬GETã€POSTç­‰ä¸åŒç±»å‹çš„æ“ä½œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;TPS vs. RPS:
&lt;ul&gt;
&lt;li&gt;TPS å…³æ³¨çš„æ˜¯ä¸šåŠ¡å±‚é¢çš„äº‹åŠ¡å¤„ç†é€Ÿåº¦ã€‚&lt;/li&gt;
&lt;li&gt;RPS åˆ™æ˜¯é’ˆå¯¹ HTTP åè®®çš„è¯·æ±‚å¤„ç†é€Ÿåº¦ï¼Œé€šå¸¸æ¯” TPS æ›´åŠ é¢‘ç¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="vu-å¹¶å‘ç”¨æˆ·-å’Œ-tps-æ¢ç®—"&gt;VU (å¹¶å‘ç”¨æˆ·) å’Œ TPS æ¢ç®—
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;å…¬å¼æè¿°ï¼šTPS = VU/RTï¼Œï¼ˆRTå•ä½ï¼šç§’ï¼‰ã€‚
ä¸¾ä¾‹è¯´æ˜ï¼šå‡å¦‚1ä¸ªè™šæ‹Ÿç”¨æˆ·åœ¨ 1 ç§’å†…å®Œæˆ 1 ç¬”äº‹åŠ¡ï¼Œé‚£ä¹ˆ TPS æ˜æ˜¾å°±æ˜¯1ã€‚å¦‚æœæŸç¬”ä¸šåŠ¡å“åº”æ—¶é—´æ˜¯1 msï¼Œé‚£ä¹ˆ1ä¸ªè™šæ‹Ÿç”¨æˆ·åœ¨1så†…èƒ½å®Œæˆ1000ç¬”äº‹åŠ¡ï¼ŒTPSå°±æ˜¯1000 äº†ï¼›å¦‚æœæŸç¬”ä¸šåŠ¡å“åº”æ—¶é—´æ˜¯ 1sï¼Œé‚£ä¹ˆ 1 ä¸ªè™šæ‹Ÿç”¨æˆ·åœ¨1så†…åªèƒ½å®Œæˆ1ç¬”äº‹åŠ¡ï¼Œè¦æƒ³è¾¾åˆ°1000 TPSï¼Œå°±éœ€è¦1000ä¸ªè™šæ‹Ÿç”¨æˆ·ã€‚å› æ­¤å¯ä»¥è¯´1ä¸ªè™šæ‹Ÿç”¨æˆ·å¯ä»¥äº§ç”Ÿ1000 TPSï¼Œ1000ä¸ªè™šæ‹Ÿç”¨æˆ·ä¹Ÿå¯ä»¥äº§ç”Ÿ1000 TPSï¼Œæ— éæ˜¯çœ‹å“åº”æ—¶é—´å¿«æ…¢ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</description></item><item><title>Gitå‘½ä»¤</title><link>https://0607pass.github.io/Blog/p/git%E5%91%BD%E4%BB%A4/</link><pubDate>Sat, 13 Dec 2025 19:32:03 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/git%E5%91%BD%E4%BB%A4/</guid><description>&lt;img src="https://0607pass.github.io/Blog/images/postCover/git.png" alt="Featured image of post Gitå‘½ä»¤" /&gt;&lt;h1 id="git"&gt;Git
&lt;/h1&gt;&lt;h2 id="1git-pull--git-fetchçš„åŒºåˆ«"&gt;1ã€git pull git fetchçš„åŒºåˆ«
&lt;/h2&gt;&lt;p&gt;git pull ä¼šè‡ªåŠ¨ merge fetchéœ€è¦è‡ªå·±æ‰‹åŠ¨åˆå¹¶&lt;/p&gt;
&lt;h2 id="2å†™ä»£ç æ—¶å†™åˆ°ä¸€åŠå¿˜è®°åˆ‡åˆ†æ”¯æ€ä¹ˆåŠ"&gt;2ã€å†™ä»£ç æ—¶ï¼Œå†™åˆ°ä¸€åŠå¿˜è®°åˆ‡åˆ†æ”¯æ€ä¹ˆåŠï¼Ÿ
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;å¦‚ä½•æƒ³è¦åˆ‡æ¢çš„åˆ†æ”¯ä¸å½“å‰åˆ†æ”¯æ²¡æœ‰å†²çªï¼Œå¯ç›´æ¥ checkout ä¼šè‡ªåŠ¨å°†å·¥ä½œåŒºçš„æ›´æ”¹å¸¦è¿‡å»&lt;/li&gt;
&lt;li&gt;å¦‚æœæœ‰å†²çª&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;span class="lnt"&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# 1. å…ˆæŠŠä¿®æ”¹æš‚å­˜èµ·æ¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;git stash
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# 2. åˆ‡åˆ°æ­£ç¡®åˆ†æ”¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;git checkout brach-target
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# 3. æŠŠä¿®æ”¹æ‹¿å›æ¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;git stash pop
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id="3cherry-pick-æ˜¯ä»€ä¹ˆ"&gt;3ã€cherry pick æ˜¯ä»€ä¹ˆï¼Ÿ
&lt;/h2&gt;&lt;p&gt;å¯ä»¥å°† æŸä¸ªåˆ†æ”¯çš„å‡ ä¸ªæäº¤ï¼Œåˆå¹¶åˆ°å¦å¤–ä¸€ä¸ªåˆ†æ”¯ä¸Š&lt;/p&gt;
&lt;h2 id="4åæ‚”è¯"&gt;4ã€&amp;ldquo;åæ‚”è¯&amp;rdquo;
&lt;/h2&gt;&lt;h3 id="æœªæäº¤æ—¶æƒ³æ”¾å¼ƒæ›´æ”¹"&gt;æœªæäº¤æ—¶ï¼Œæƒ³æ”¾å¼ƒæ›´æ”¹
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;git reset &amp;ndash;hard HEAD
ä¸¢å¼ƒ å·¥ä½œåŒº + æš‚å­˜åŒº çš„æ‰€æœ‰ä¿®æ”¹&lt;/li&gt;
&lt;li&gt;git checkout &amp;ndash; .
ä¸å½±å“æš‚å­˜åŒº&lt;/li&gt;
&lt;li&gt;å·²ç» add ä½†æ˜¯æ²¡ commit&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;#å…ˆå–æ¶ˆæš‚å­˜&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;git reset HEAD .
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;#ä¸¢å¼ƒä¿®æ”¹ &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;git reset HEAD .
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="å·²ç»æäº¤å¦‚ä½•æ’¤å›æäº¤"&gt;å·²ç»æäº¤ï¼Œå¦‚ä½•æ’¤å›æäº¤
&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;git reset &amp;ndash;soft HEAD~1
æ’¤å› æœ€è¿‘ä¸€æ¬¡ commit ä»£ç è¿˜åœ¨æš‚å­˜åŒº&lt;/li&gt;
&lt;li&gt;git reset HEAD~1
ä»£ç åœ¨ å·¥ä½œåŒº&lt;/li&gt;
&lt;li&gt;git reset &amp;ndash;hard HEAD~1
æ’¤å› commitï¼Œä»£ç ä¹Ÿä¸è¦äº†&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="å·²ç»pushæƒ³æ’¤å›push"&gt;å·²ç»pushï¼Œæƒ³æ’¤å›push
&lt;/h3&gt;&lt;p&gt;git revert commit-id&lt;/p&gt;
&lt;p&gt;git push&lt;/p&gt;</description></item><item><title>Redisä¸­Hashæ•°æ®ç»“æ„ï¼ŒåŠrehash</title><link>https://0607pass.github.io/Blog/p/redis%E4%B8%ADhash%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8F%8Arehash/</link><pubDate>Thu, 11 Dec 2025 14:57:56 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/redis%E4%B8%ADhash%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8F%8Arehash/</guid><description>&lt;img src="https://0607pass.github.io/Blog/images/postCover/redis.png" alt="Featured image of post Redisä¸­Hashæ•°æ®ç»“æ„ï¼ŒåŠrehash" /&gt;&lt;h2 id="hashæ•°æ®ç»“æ„"&gt;Hashæ•°æ®ç»“æ„
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-c" data-lang="c"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;struct&lt;/span&gt; &lt;span class="n"&gt;dict&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;dictType&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="cm"&gt;/*æŒ‡å‘ä¸¤ä¸ªht_table ç”¨æ¥rehash */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;dictEntry&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;ht_table&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="kt"&gt;long&lt;/span&gt; &lt;span class="n"&gt;ht_used&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;long&lt;/span&gt; &lt;span class="n"&gt;rehashidx&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* rehashing not in progress if rehashidx == -1 */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="cm"&gt;/* Keep small vars at end for optimal (minimal) struct padding */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;int16_t&lt;/span&gt; &lt;span class="n"&gt;pauserehash&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* If &amp;gt;0 rehashing is paused (&amp;lt;0 indicates coding error) */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;signed&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;ht_size_exp&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt; &lt;span class="cm"&gt;/* exponent of size. (size = 1&amp;lt;&amp;lt;exp) */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;dictType å¹²ä»€ä¹ˆç”¨çš„ï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å¦ä¸€ä¸ªç»“æ„ä½“ &lt;code&gt;dictType&lt;/code&gt;ï¼Œå®ƒå®šä¹‰äº†è¿™ä¸ªå­—å…¸çš„â€œè¡Œä¸ºå‡½æ•°â€ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚ä½•è®¡ç®— key çš„å“ˆå¸Œå€¼ï¼ˆ&lt;code&gt;hashFunction&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;å¦‚ä½•æ¯”è¾ƒ key æ˜¯å¦ç›¸ç­‰ï¼ˆ&lt;code&gt;keyCompare&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;å¦‚ä½•é‡Šæ”¾å†…å­˜ï¼ˆ&lt;code&gt;keyDestructor&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;dictEntry **ht_table[2] ä»€ä¹ˆä½œç”¨&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«ä¸¤ä¸ªæŒ‡é’ˆï¼Œæ¯ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªâ€œå“ˆå¸Œæ¡¶æ•°ç»„â€ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼ŒRedis çš„å­—å…¸ç»“æ„åŒ…å« &lt;strong&gt;ä¸¤ä¸ªå“ˆå¸Œè¡¨&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¯ä¸ª &lt;code&gt;ht_table[i]&lt;/code&gt; æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ˆæ•°ç»„é‡Œçš„æ¯ä¸€é¡¹éƒ½æ˜¯é“¾è¡¨å¤´ &lt;code&gt;dictEntry*&lt;/code&gt;ï¼‰ï¼Œç”¨æ¥å¤„ç†å“ˆå¸Œå†²çªã€‚&lt;/p&gt;
&lt;h2 id="ä¸ºä»€ä¹ˆæœ‰ä¸¤ä¸ªå“ˆå¸Œè¡¨"&gt;ä¸ºä»€ä¹ˆæœ‰ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Ÿ
&lt;/h2&gt;&lt;p&gt;ä¸ºäº†æ”¯æŒ &lt;strong&gt;æ¸è¿›å¼ rehashï¼ˆæ…¢æ…¢è¿ç§»ï¼Œä¸ä¸€æ¬¡è¿ç§»æ‰€æœ‰é”®ï¼‰&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Redis ä¼šå…ˆåœ¨ &lt;code&gt;ht_table[0]&lt;/code&gt; ä¸Šå·¥ä½œã€‚&lt;/li&gt;
&lt;li&gt;å½“éœ€è¦æ‰©å®¹æˆ–ç¼©å®¹æ—¶ï¼Œä¼šç”³è¯·æ–°çš„å“ˆå¸Œè¡¨ &lt;code&gt;ht_table[1]&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åé€æ­¥æŠŠæ—§æ•°æ®ä» &lt;code&gt;ht_table[0]&lt;/code&gt; è¿ç§»åˆ° &lt;code&gt;ht_table[1]&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™æ ·é¿å…äº†æš‚åœæ•´ä¸ªæœåŠ¡å™¨åš rehash çš„é—®é¢˜ï¼Œæå‡å“åº”æ€§ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;unsigned long ht_used[2]&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™ä¸ªæ•°ç»„è®°å½•äº†ä¸¤ä¸ªå“ˆå¸Œè¡¨ä¸­å®é™…å­˜å‚¨äº†å¤šå°‘ä¸ªé”®å€¼å¯¹ï¼ˆèŠ‚ç‚¹ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ht_used[0]&lt;/code&gt;: ä¸»è¡¨å·²ç”¨çš„ entry æ•°é‡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ht_used[1]&lt;/code&gt;: è¿ç§»ç›®æ ‡è¡¨çš„ entry æ•°é‡ï¼ˆrehash æœŸé—´ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;long rehashidx;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;rehash çš„&lt;strong&gt;å½“å‰ä½ç½®ç´¢å¼•&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœç­‰äº &lt;code&gt;-1&lt;/code&gt;ï¼Œè¡¨ç¤ºå½“å‰æ²¡æœ‰åœ¨è¿›è¡Œ rehashï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœå¤§äºç­‰äº &lt;code&gt;0&lt;/code&gt;ï¼Œè¯´æ˜æ­£åœ¨è¿›è¡Œ rehashï¼Œå€¼è¡¨ç¤ºå½“å‰å·²ç»è¿ç§»åˆ°å“ªä¸€ä¸ªæ¡¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Redis æ¯æ¬¡æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œä¼šé¡ºä¾¿è¿ç§»ä¸€å°éƒ¨åˆ†æ¡¶ï¼ˆæ¸è¿›å¼è¿ç§»ï¼‰ï¼Œé€šè¿‡è¿™ä¸ªå˜é‡è·Ÿè¸ªè¿›åº¦ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;int16_t pauserehash;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ˜¯å¦æš‚åœ rehash æ“ä½œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;0&lt;/code&gt;ï¼šæ­£å¸¸&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;gt;0&lt;/code&gt;ï¼šrehash è¢«æš‚æ—¶æš‚åœï¼ˆæŸäº›å‘½ä»¤æˆ–æ“ä½œæœŸé—´ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;0&lt;/code&gt;ï¼šè¡¨ç¤ºæœ‰ bugï¼ŒRedis ä¼šæŠ¥é”™ï¼ˆç†è®ºä¸Šä¸ä¼šå‡ºç°ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;signed char ht_size_exp[2];&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¡¨ç¤ºä¸¤ä¸ªå“ˆå¸Œè¡¨çš„&lt;strong&gt;å¤§å°çš„æŒ‡æ•°&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å“ˆå¸Œè¡¨çš„å®¹é‡æ˜¯ &lt;code&gt;2 çš„å¹‚æ¬¡æ–¹&lt;/code&gt;ï¼Œå³ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-c" data-lang="c"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;ht_size_exp&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¿™æ¯”å­˜å‚¨å®é™…å¤§å°æ›´èŠ‚çœç©ºé—´ï¼Œè€Œä¸”æ–¹ä¾¿ Redis ä½¿ç”¨ä½è¿ç®—è®¡ç®—å“ˆå¸Œå€¼å’Œæ¡¶ä½ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="å“ˆå¸Œè¡¨çš„æ•°æ®ç»“æ„"&gt;å“ˆå¸Œè¡¨çš„æ•°æ®ç»“æ„
&lt;/h1&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-c" data-lang="c"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;typedef&lt;/span&gt; &lt;span class="k"&gt;struct&lt;/span&gt; &lt;span class="n"&gt;dictEntry&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;union&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;val&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;uint64_t&lt;/span&gt; &lt;span class="n"&gt;u64&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;int64_t&lt;/span&gt; &lt;span class="n"&gt;s64&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;struct&lt;/span&gt; &lt;span class="n"&gt;dictEntry&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;next&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* Next entry in the same hash bucket. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;[];&lt;/span&gt; &lt;span class="cm"&gt;/* An arbitrary number of bytes (starting at a
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * pointer-aligned address) of size as returned
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * by dictType&amp;#39;s dictEntryMetadataBytes(). */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="n"&gt;dictEntry&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;dictEntry ç»“æ„é‡Œé”®å€¼å¯¹ä¸­çš„å€¼æ˜¯ä¸€ä¸ªã€Œè”åˆä½“ vã€å®šä¹‰çš„ï¼Œå› æ­¤ï¼Œé”®å€¼å¯¹ä¸­çš„å€¼å¯ä»¥æ˜¯ä¸€ä¸ªæŒ‡å‘å®é™…å€¼çš„æŒ‡é’ˆï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªæ— ç¬¦å·çš„ 64 ä½æ•´æ•°æˆ–æœ‰ç¬¦å·çš„ 64 ä½æ•´æ•°æˆ–double ç±»çš„å€¼ã€‚è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯å¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´ï¼Œå› ä¸ºå½“ã€Œå€¼ã€æ˜¯æ•´æ•°æˆ–æµ®ç‚¹æ•°æ—¶ï¼Œå°±å¯ä»¥å°†å€¼çš„æ•°æ®å†…åµŒåœ¨ dictEntry ç»“æ„é‡Œï¼Œæ— éœ€å†ç”¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å®é™…çš„å€¼ï¼Œä»è€ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ã€‚&lt;/p&gt;</description></item><item><title>Redissonä¸­çš„Watch Dogæœºåˆ¶</title><link>https://0607pass.github.io/Blog/p/redisson%E4%B8%AD%E7%9A%84watch-dog%E6%9C%BA%E5%88%B6/</link><pubDate>Thu, 11 Dec 2025 14:57:05 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/redisson%E4%B8%AD%E7%9A%84watch-dog%E6%9C%BA%E5%88%B6/</guid><description>&lt;img src="https://0607pass.github.io/Blog/images/postCover/redis.png" alt="Featured image of post Redissonä¸­çš„Watch Dogæœºåˆ¶" /&gt;&lt;h1 id="redissonä¸­é»˜è®¤é”è¡Œä¸º"&gt;Redissonä¸­é»˜è®¤é”è¡Œä¸º
&lt;/h1&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;RLock&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lock&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisson&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getLock&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;anyLock&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;lock&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;lock&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;ä¸æŒ‡å®šè¿‡æœŸæ—¶é—´ï¼›&lt;/li&gt;
&lt;li&gt;é»˜è®¤ç”±çœ‹é—¨ç‹—æœºåˆ¶æ§åˆ¶é”çš„ç”Ÿå‘½å‘¨æœŸï¼›&lt;/li&gt;
&lt;li&gt;é»˜è®¤é”è¿‡æœŸæ—¶é—´ä¸º 30 ç§’ï¼›&lt;/li&gt;
&lt;li&gt;æ¯ 10 ç§’è‡ªåŠ¨ç»­æœŸï¼ˆå³ï¼šæ¯æ¬¡é‡è®¾ä¸º 30 ç§’åè¿‡æœŸï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="ä¸ºä»€ä¹ˆé€‰æ‹©æ¯10ç§’ç»­æœŸ"&gt;ä¸ºä»€ä¹ˆé€‰æ‹©æ¯10ç§’ç»­æœŸ
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;æœ‰å®¹é”™ï¼Œå¦‚ä½•æœ‰ç½‘ç»œå¼‚å¸¸å¯¼è‡´ç¬¬ä¸€æ¬¡ç»­æœŸæ²¡æœ‰æˆåŠŸåˆ™è¿˜æœ‰2 æœºä¼šã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœç»­æœŸå¤ªé¢‘ç¹ï¼ˆå¦‚æ¯ 1 ç§’ï¼‰ï¼Œä¼šå¢åŠ  Redis çš„å‹åŠ›ï¼ˆé¢‘ç¹ PEXPIRE è°ƒç”¨ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœç»­æœŸå¤ªå°‘ï¼ˆæ¯”å¦‚ 25 ç§’æ‰ç»­æœŸä¸€æ¬¡ï¼‰ï¼Œå®¹é”™ç©ºé—´å¤ªå°ï¼Œä¸€æ—¦æŸä¸€æ¬¡å¤±è´¥å°±ä¼šå¾ˆå±é™©ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="é»˜è®¤è¿‡æœŸæ—¶é—´30ç§’å¯ä»¥ä¿®æ”¹"&gt;é»˜è®¤è¿‡æœŸæ—¶é—´30ç§’å¯ä»¥ä¿®æ”¹
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;lockWatchdogTimeout
Redisson ä¼šä»¥ lockWatchdogTimeout / 3 çš„é¢‘ç‡è¿›è¡Œç»­æœŸã€‚&lt;/p&gt;
&lt;/blockquote&gt;</description></item><item><title>Redisæœ‰å“ªäº›å·§å¦™çš„è®¾è®¡ï¼Œä¸¾å‡ ä¸ªä¾‹å­</title><link>https://0607pass.github.io/Blog/p/redis%E6%9C%89%E5%93%AA%E4%BA%9B%E5%B7%A7%E5%A6%99%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%BE%E5%87%A0%E4%B8%AA%E4%BE%8B%E5%AD%90/</link><pubDate>Thu, 11 Dec 2025 14:54:01 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/redis%E6%9C%89%E5%93%AA%E4%BA%9B%E5%B7%A7%E5%A6%99%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%BE%E5%87%A0%E4%B8%AA%E4%BE%8B%E5%AD%90/</guid><description>&lt;img src="https://0607pass.github.io/Blog/images/postCover/redis.png" alt="Featured image of post Redisæœ‰å“ªäº›å·§å¦™çš„è®¾è®¡ï¼Œä¸¾å‡ ä¸ªä¾‹å­" /&gt;&lt;h1 id="5ä¸ªæ–¹é¢"&gt;5ä¸ªæ–¹é¢
&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;çº¿ç¨‹æ¨¡å‹ã€æ•°æ®ç»“æ„ã€å…±äº«å¯¹è±¡æ± ã€è¿‡æœŸè®¾è®¡ã€æ•°æ®æŒä¹…åŒ–è®¾è®¡&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id="ä¸€çº¿ç¨‹æ¨¡å‹"&gt;ä¸€ã€çº¿ç¨‹æ¨¡å‹
&lt;/h2&gt;&lt;p&gt;Redis ä½¿ç”¨&lt;strong&gt;å•çº¿ç¨‹æ¨¡å‹&lt;/strong&gt;æ¥å¤„ç†æ‰€æœ‰çš„å®¢æˆ·ç«¯è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶çœ‹ä¼¼å•çº¿ç¨‹ç®€å•ï¼Œä½†è¿™ç§è®¾è®¡å‡å°‘äº†ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œé”çš„å¼€é”€ï¼Œé¿å…äº†å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­çš„å¤æ‚æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å¹¶ä¸”é€šè¿‡&lt;strong&gt;å¤šè·¯å¤ç”¨&lt;/strong&gt;ï¼ˆepollã€select ç­‰ï¼‰+ &lt;strong&gt;äº‹ä»¶é©±åŠ¨&lt;/strong&gt;æœºåˆ¶ï¼ŒRedis ä»ç„¶èƒ½å¤Ÿå¤„ç†å¤§é‡çš„å¹¶å‘è¿æ¥ã€‚&lt;/p&gt;
&lt;h2 id="äºŒæ•°æ®ç»“æ„"&gt;äºŒã€æ•°æ®ç»“æ„
&lt;/h2&gt;&lt;p&gt;Redis å¯¹å¾ˆå¤šæ•°æ®ç»“æ„è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¾‹å¦‚ sdsã€ziplistï¼Œè¿˜æœ‰å“ˆå¸Œè¡¨çš„æ‰©å®¹æœºåˆ¶ã€‚&lt;/p&gt;
&lt;h3 id="sdssimple-dynamic-string"&gt;SDS(Simple Dynamic String)
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-c" data-lang="c"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;struct&lt;/span&gt; &lt;span class="nf"&gt;__attribute__&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;__packed__&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="n"&gt;sdshdr16&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;uint16_t&lt;/span&gt; &lt;span class="n"&gt;len&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* used */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;uint16_t&lt;/span&gt; &lt;span class="n"&gt;alloc&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* excluding the header and null terminator */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;flags&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* 3 lsb of type, 5 unused bits */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;[];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æ‰©å±•å’Œç©ºé—´é¢„åˆ†é…&lt;/strong&gt;ï¼šSDS æ”¯æŒè‡ªåŠ¨æ‰©å±•ã€‚å½“å­—ç¬¦ä¸²é•¿åº¦å¢åŠ æ—¶ï¼ŒSDS ä¼šè‡ªåŠ¨åˆ†é…æ›´å¤§çš„å†…å­˜ç©ºé—´ï¼Œå¹¶ä¸”é€šå¸¸ä¼šé¢å¤–é¢„ç•™ä¸€éƒ¨åˆ†ç©ºé—´ï¼Œå‡å°‘é¢‘ç¹çš„å†…å­˜åˆ†é…æ“ä½œï¼Œè¿™æ ·å°±é¿å…äº†æ¯æ¬¡ä¿®æ”¹å­—ç¬¦ä¸²æ—¶éƒ½éœ€è¦é‡æ–°åˆ†é…å†…å­˜çš„å¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äºŒè¿›åˆ¶å®‰å…¨:&lt;/strong&gt; ä¸ C å­—ç¬¦ä¸²ä¸åŒï¼ŒSDS æ”¯æŒå­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ï¼Œå› ä¸ºå®ƒä¸ä¼šä¾èµ–äºç©ºå­—ç¬¦ï¼ˆ&amp;rsquo;\0&amp;rsquo;ï¼‰æ¥æ ‡è¯†å­—ç¬¦ä¸²çš„ç»“æŸã€‚è¿™ä½¿å¾— SDS å¯ä»¥å®‰å…¨åœ°å­˜å‚¨å’Œå¤„ç†ä»»æ„äºŒè¿›åˆ¶æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¸¸æ•°æ—¶é—´è·å–å­—ç¬¦ä¸²çš„é•¿åº¦&lt;/strong&gt; ï¼šSDS ç»“æ„ä¸­ä¼šé¢å¤–å­˜å‚¨å­—ç¬¦ä¸²çš„å½“å‰é•¿åº¦ï¼Œè¿™ä½¿å¾—è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ“ä½œå¯ä»¥åœ¨ O(1) æ—¶é—´å†…å®Œæˆï¼Œè€Œä¸åƒ C å­—ç¬¦ä¸²é‚£æ ·éœ€è¦éå†æ•´ä¸ªå­—ç¬¦ä¸²æ¥è®¡ç®—é•¿åº¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é˜²æ­¢ç¼“å†²åŒºæº¢å‡º&lt;/strong&gt;ï¼šSDS é€šè¿‡ç»´æŠ¤åˆ†é…ç©ºé—´çš„æ€»é•¿åº¦å’Œå·²ç”¨é•¿åº¦ï¼Œèƒ½å¤Ÿæœ‰æ•ˆé˜²æ­¢ç¼“å†²åŒºæº¢å‡ºé—®é¢˜ã€‚è¿™åœ¨ä½¿ç”¨ C å­—ç¬¦ä¸²æ—¶æ˜¯ä¸€ä¸ªå¸¸è§çš„å®‰å…¨éšæ‚£ï¼Œä½†åœ¨ SDS ä¸­å¾—åˆ°äº†å¾ˆå¥½è§£å†³ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æƒ°æ€§ç©ºé—´é‡Šæ”¾&lt;/strong&gt; ï¼š å½“ SDS ä¸­çš„å­—ç¬¦ä¸²é•¿åº¦ç¼©çŸ­æ—¶ï¼Œå¹¶ä¸ä¼šç«‹å³ç¼©å‡å†…å­˜ç©ºé—´ï¼Œè€Œæ˜¯ä¼šä¿ç•™éƒ¨åˆ†ç¼©çŸ­åçš„ç©ºé—´ï¼Œè¿™æ ·å¯ä»¥é¿å…é¢‘ç¹çš„å†…å­˜é‡æ–°åˆ†é…æ“ä½œã€‚è¿™ç§ç­–ç•¥ä¹Ÿæ˜¯ Redis çš„å†…å­˜ä¼˜åŒ–çš„ä¸€éƒ¨åˆ†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="ziplistå‹ç¼©åˆ—è¡¨"&gt;ziplist(å‹ç¼©åˆ—è¡¨)
&lt;/h3&gt;&lt;p&gt;å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰æ˜¯ Redis ç”¨äºå®ç°åˆ—è¡¨å’Œå“ˆå¸Œè¡¨çš„åº•å±‚æ•°æ®ç»“æ„ä¹‹ä¸€ã€‚&lt;/p&gt;
&lt;p&gt;å½“åˆ—è¡¨æˆ–å“ˆå¸Œè¡¨ä¸­çš„æ•°æ®é‡è¾ƒå°ï¼Œä¸”å…ƒç´ é•¿åº¦è¾ƒçŸ­æ—¶ï¼ŒRedis ä¼šé€‰æ‹©ä½¿ç”¨å‹ç¼©åˆ—è¡¨æ¥å­˜å‚¨æ•°æ®ï¼Œ&lt;strong&gt;è¾¾åˆ°èŠ‚çœå†…å­˜æ¶ˆè€—çš„ç›®çš„&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å…³é”®è®¾è®¡å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å†…å­˜ç´§å‡‘ï¼šå‹ç¼©åˆ—è¡¨å°†æ‰€æœ‰å…ƒç´ ç´§å‡‘åœ°å­˜å‚¨åœ¨ä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œæ²¡æœ‰æŒ‡é’ˆç­‰é¢å¤–å¼€é”€ã€‚æ¯ä¸ªå…ƒç´ å‰éƒ½æœ‰ä¸€ä¸ªå‰å‘ç¼–ç å’Œåå‘ç¼–ç ï¼Œç”¨äºæŒ‡ç¤ºå‰ä¸€ä¸ªå…ƒç´ çš„é•¿åº¦ï¼Œè¿™æ ·å¯ä»¥å¿«é€Ÿåœ°è¿›è¡Œå‰åéå†ï¼Œé¿å…äº†é“¾è¡¨ä¸­æŒ‡é’ˆçš„é¢å¤–å¼€é”€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;çµæ´»æ€§ï¼šå‹ç¼©åˆ—è¡¨æ ¹æ®å­˜å‚¨çš„å…ƒç´ é•¿åº¦åŠ¨æ€è°ƒæ•´ç¼–ç æ–¹å¼ï¼Œå°äº 1 å­—èŠ‚çš„æ•´æ•°ã€1 å­—èŠ‚çš„æ•´æ•°ã€3 å­—èŠ‚çš„æ•´æ•°ç­‰ä¸åŒé•¿åº¦çš„ç¼–ç æ–¹å¼ï¼Œèƒ½å¤Ÿæå¤§åœ°èŠ‚çœå†…å­˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ€§èƒ½ä¸ç©ºé—´çš„å¹³è¡¡ï¼šå½“åˆ—è¡¨æˆ–å“ˆå¸Œè¡¨å˜å¾—å¾ˆå¤§æ—¶ï¼ŒRedis ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°æ›´é«˜æ•ˆçš„é“¾è¡¨æˆ–å“ˆå¸Œè¡¨ç»“æ„ã€‚è¿™ç§æŒ‰éœ€è°ƒæ•´çš„æ•°æ®ç»“æ„è®¾è®¡ï¼Œç¡®ä¿äº†åœ¨ä¸åŒåœºæ™¯ä¸‹çš„æ€§èƒ½æœ€ä¼˜ã€‚&lt;/p&gt;
&lt;h4 id="æ•´ä½“ç»“æ„å¸ƒå±€"&gt;æ•´ä½“ç»“æ„å¸ƒå±€
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;area |&amp;lt;---- ziplist header ----&amp;gt;|&amp;lt;----------- entries -------------&amp;gt;|&amp;lt;-end-&amp;gt;|
size 4 bytes 4 bytes 2 bytes ? ? ? 1 byte
+---------+--------+-------+--------+--------+--------+-------+
| zlbytes | zltail | zllen | entry1 | entry2 | ... | zlend |
+---------+--------+-------+--------+--------+--------+-------+
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;####Header éƒ¨åˆ†è¯¦è§£&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µå&lt;/th&gt;
&lt;th&gt;é•¿åº¦/ç±»å‹&lt;/th&gt;
&lt;th&gt;ä½œç”¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;zlbytes&lt;/td&gt;
&lt;td&gt;uint32_t (4å­—èŠ‚)&lt;/td&gt;
&lt;td&gt;æ•´ä¸ª ziplist å ç”¨çš„å†…å­˜å­—èŠ‚æ•°ï¼Œç”¨äºå†…å­˜é‡åˆ†é…å’Œè®¡ç®—æœ«ç«¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;zltail&lt;/td&gt;
&lt;td&gt;uint32_t (4å­—èŠ‚)&lt;/td&gt;
&lt;td&gt;åˆ°è¾¾ ziplist è¡¨å°¾èŠ‚ç‚¹çš„åç§»é‡ï¼Œå¯ä»¥ç›´æ¥å®šä½åˆ°å°¾èŠ‚ç‚¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;zllen&lt;/td&gt;
&lt;td&gt;uint16_t (2å­—èŠ‚)&lt;/td&gt;
&lt;td&gt;ziplist ä¸­èŠ‚ç‚¹çš„æ•°é‡ã€‚å½“å€¼å°äº 65535 æ—¶ä¸ºå®é™…æ•°é‡ï¼›ç­‰äº 65535 æ—¶éœ€è¦éå†è®¡ç®—&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;zlend&lt;/td&gt;
&lt;td&gt;uint8_t (1å­—èŠ‚)&lt;/td&gt;
&lt;td&gt;å€¼ä¸º 255(0xFF)ï¼Œæ ‡è®° ziplist çš„æœ«ç«¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;span class="lnt"&gt;22
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-c" data-lang="c"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt;/* We use this function to receive information about a ziplist entry.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * Note that this is not how the data is actually encoded, is just what we
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * get filled by a function in order to operate more easily. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;typedef&lt;/span&gt; &lt;span class="k"&gt;struct&lt;/span&gt; &lt;span class="n"&gt;zlentry&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;prevrawlensize&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* Bytes used to encode the previous entry len*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;prevrawlen&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* Previous entry len. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;lensize&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* Bytes used to encode this entry type/len.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; For example strings have a 1, 2 or 5 bytes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; header. Integers always use a single byte.*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;len&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* Bytes used to represent the actual entry.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; For strings this is just the string length
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; while for integers it is 1, 2, 3, 4, 8 or
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; 0 (for 4 bit immediate) depending on the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; number range. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;headersize&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* prevrawlensize + lensize. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;encoding&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* Set to ZIP_STR_* or ZIP_INT_* depending on
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; the entry encoding. However for 4 bits
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; immediate integers this can assume a range
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; of values and must be range-checked. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* Pointer to the very start of the entry, that
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; is, this points to prev-entry-len field. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="n"&gt;zlentry&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h4 id="æ¸è¿›å¼-rehash"&gt;æ¸è¿›å¼ rehash
&lt;/h4&gt;&lt;p&gt;Redis çš„å“ˆå¸Œè¡¨åœ¨æ‰©å®¹æˆ–ç¼©å®¹æ—¶ä¸ä¼šä¸€æ¬¡æ€§è¿›è¡Œå…¨é‡ rehashã€‚&lt;/p&gt;
&lt;p&gt;ç›¸åï¼Œå®ƒé‡‡å–äº†&lt;strong&gt;æ¸è¿›å¼ rehash çš„æ–¹å¼&lt;/strong&gt;ï¼Œå°† rehash æ“ä½œåˆ†æ‘Šåˆ°åç»­çš„å¢åˆ æ”¹æŸ¥æ“ä½œä¸­ï¼Œä»è€Œé¿å…äº†é›†ä¸­çš„æ€§èƒ½æŠ–åŠ¨ã€‚&lt;/p&gt;
&lt;h2 id="3å…±äº«å¯¹è±¡æ± "&gt;3ã€å…±äº«å¯¹è±¡æ± 
&lt;/h2&gt;&lt;p&gt;Redis ä¸­æœ‰è®¸å¤šå¸¸ç”¨çš„å°æ•´æ•°ï¼Œä¾‹å¦‚ 0 åˆ° 9999ã€‚è¿™äº›æ•´æ•°é¢‘ç¹åœ°å‡ºç°åœ¨å„ç§å‘½ä»¤å’Œæ•°æ®æ“ä½œä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å‡å°‘å†…å­˜åˆ†é…å’Œé‡Šæ”¾çš„å¼€é”€ï¼ŒRedis ä½¿ç”¨äº† &lt;strong&gt;å…±äº«å¯¹è±¡æ± ï¼ˆShared Object Poolï¼‰&lt;/strong&gt;ï¼Œå®ç°äº†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¯¹è±¡å¤ç”¨ï¼šå¯¹äºå¸¸ç”¨çš„å°æ•´æ•°ï¼ŒRedis ä¼šåœ¨å¯åŠ¨æ—¶é¢„å…ˆåˆ›å»ºè¿™äº›å¯¹è±¡ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨ä¸€ä¸ªå…±äº«å¯¹è±¡æ± ä¸­ã€‚å½“ç³»ç»Ÿéœ€è¦è¿™äº›æ•´æ•°å¯¹è±¡æ—¶ï¼Œç›´æ¥ä»æ± ä¸­è·å–ï¼Œè€Œä¸éœ€è¦é‡å¤åˆ†é…å†…å­˜ã€‚è¿™å¤§å¤§å‡å°‘äº†å†…å­˜åˆ†é…å’Œé‡Šæ”¾çš„å¼€é”€ï¼Œæé«˜äº†ç³»ç»Ÿçš„æ•ˆç‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å†…å­˜èŠ‚çœï¼šå…±äº«å¯¹è±¡æ± æœ‰æ•ˆåœ°èŠ‚çœäº†å†…å­˜ï¼Œå°¤å…¶æ˜¯åœ¨å¤§è§„æ¨¡ä½¿ç”¨è¿™äº›å¸¸é‡çš„åœºæ™¯ä¸­ã€‚é€šè¿‡å¯¹è±¡å¤ç”¨ï¼Œé¿å…äº†é¢‘ç¹çš„å†…å­˜ç”³è¯·å’Œåƒåœ¾å›æ”¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="4è¿‡æœŸè®¾è®¡"&gt;4ã€è¿‡æœŸè®¾è®¡
&lt;/h2&gt;&lt;p&gt;Redis æ”¯æŒä¸ºé”®è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚å½“é”®è¿‡æœŸåï¼Œå®ƒåº”è¯¥è¢«è‡ªåŠ¨åˆ é™¤ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œè¿‡æœŸé”®çš„å¤„ç†éœ€è¦åœ¨æ€§èƒ½å’Œå‡†ç¡®æ€§ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ã€‚Redis é‡‡ç”¨äº†ä¸€ç§ &lt;strong&gt;æƒ°æ€§åˆ é™¤ä¸å®šæœŸåˆ é™¤ç›¸ç»“åˆçš„ç­–ç•¥&lt;/strong&gt; æ¥å¤„ç†è¿‡æœŸé”®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æƒ°æ€§åˆ é™¤ï¼šå½“å®¢æˆ·ç«¯è®¿é—®ä¸€ä¸ªé”®æ—¶ï¼ŒRedis ä¼šæ£€æŸ¥è¯¥é”®æ˜¯å¦å·²ç»è¿‡æœŸã€‚å¦‚æœè¿‡æœŸï¼Œåˆ™ç«‹å³åˆ é™¤ã€‚è¿™ç§æ–¹å¼ä¸ä¼šå¢åŠ ç³»ç»Ÿè´Ÿæ‹…ï¼Œå› ä¸ºåªåœ¨è®¿é—®æ—¶æ‰æ£€æŸ¥é”®çš„çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;å®šæœŸåˆ é™¤ï¼šRedis æ¯éš”ä¸€æ®µæ—¶é—´ä¼šéšæœºæŠ½å–ä¸€éƒ¨åˆ†é”®è¿›è¡Œè¿‡æœŸæ£€æŸ¥ï¼Œå¹¶åˆ é™¤å…¶ä¸­å·²è¿‡æœŸçš„é”®ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒRedis å¯ä»¥é¿å…ç³»ç»Ÿä¸­å¤§é‡å­˜åœ¨è¿‡æœŸé”®è€Œæ— æ³•åŠæ—¶æ¸…ç†çš„æƒ…å†µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æƒ°æ€§åˆ é™¤ç¡®ä¿è®¿é—®æ€§èƒ½ï¼Œå®šæœŸåˆ é™¤é¿å…å†…å­˜æ³„æ¼ã€‚é€šè¿‡æƒ°æ€§åˆ é™¤å’Œå®šæœŸåˆ é™¤ç›¸ç»“åˆï¼ŒRedis å®ç°äº†è¿‡æœŸé”®çš„é«˜æ•ˆç®¡ç†ã€‚&lt;/p&gt;
&lt;h2 id="5æ•°æ®æŒä¹…åŒ–aof-é‡å†™æœºåˆ¶"&gt;5ã€æ•°æ®æŒä¹…åŒ–ï¼šAOF é‡å†™æœºåˆ¶
&lt;/h2&gt;&lt;p&gt;AOFï¼ˆAppend Only Fileï¼‰ æ˜¯ Redis çš„ä¸€ç§æ•°æ®æŒä¹…åŒ–æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;Redis ä¼šå°†æ‰€æœ‰å†™æ“ä½œä»¥è¿½åŠ çš„æ–¹å¼è®°å½•åˆ° AOF æ–‡ä»¶ä¸­ï¼Œä»¥ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚ç„¶è€Œï¼Œ&lt;strong&gt;éšç€æ—¶é—´æ¨ç§»ï¼ŒAOF æ–‡ä»¶å¯èƒ½ä¼šå˜å¾—éå¸¸å¤§&lt;/strong&gt;ï¼Œå½±å“æ¢å¤é€Ÿåº¦ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRedis å¼•å…¥äº† &lt;strong&gt;AOF é‡å†™ï¼ˆAOF Rewriteï¼‰&lt;/strong&gt; æœºåˆ¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¢é‡é‡å†™ï¼šAOF é‡å†™å¹¶ä¸ä¼šä¸­æ–­æ­£å¸¸çš„å†™æ“ä½œã€‚åœ¨é‡å†™æœŸé—´ï¼ŒRedis ä»ç„¶å¯ä»¥å°†æ–°çš„å†™æ“ä½œç»§ç»­è¿½åŠ åˆ°æ—§çš„ AOF æ–‡ä»¶ä¸­ï¼Œç¡®ä¿äº†é«˜å¹¶å‘å†™å…¥æ—¶çš„æŒä¹…åŒ–æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ç©ºé—´ä¼˜åŒ–ï¼šAOF é‡å†™è¿‡ç¨‹ä¸­ï¼ŒRedis å¹¶ä¸ä¼šç®€å•åœ°å¤åˆ¶æ‰€æœ‰å‘½ä»¤ï¼Œè€Œæ˜¯æ ¹æ®å½“å‰çš„æ•°æ®çŠ¶æ€ï¼Œç”Ÿæˆæœ€ç²¾ç®€çš„å‘½ä»¤é›†ã€‚å³ä½¿ä¸€ä¸ªé”®å€¼ç»è¿‡å¤šæ¬¡ä¿®æ”¹ï¼Œæœ€ç»ˆçš„ AOF æ–‡ä»¶ä¸­åªä¼šä¿ç•™ä¸€æ¡æœ€æœ‰æ•ˆçš„å‘½ä»¤ï¼Œä»è€Œå¤§å¹…å‡å°‘äº†æ–‡ä»¶å¤§å°ã€‚&lt;/li&gt;
&lt;li&gt;å¼‚æ­¥æ‰§è¡Œï¼šAOF é‡å†™æ˜¯é€šè¿‡å­è¿›ç¨‹å¼‚æ­¥æ‰§è¡Œçš„ï¼Œä¸»è¿›ç¨‹ä¸ä¼šå—åˆ°å½±å“ï¼Œè¿™ä¿è¯äº†åœ¨æ‰§è¡Œé‡å†™çš„åŒæ—¶ï¼ŒRedis ä»ç„¶å¯ä»¥æä¾›é«˜æ•ˆçš„æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ğŸ˜‚ğŸ˜‚ğŸ˜‚&lt;/p&gt;</description></item><item><title>Redisä¸ºä»€ä¹ˆå¿«</title><link>https://0607pass.github.io/Blog/p/redis%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB/</link><pubDate>Thu, 11 Dec 2025 14:47:00 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/redis%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB/</guid><description>&lt;img src="https://0607pass.github.io/Blog/images/postCover/redis.png" alt="Featured image of post Redisä¸ºä»€ä¹ˆå¿«" /&gt;&lt;h1 id="redisä¸ºä»€ä¹ˆå¿«"&gt;Redisä¸ºä»€ä¹ˆå¿«
&lt;/h1&gt;&lt;p&gt;&lt;img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F0b01e080-d346-48d6-aad1-5fad59cd4f56_3573x2280.jpeg"
loading="lazy"
alt="img"
&gt;&lt;/p&gt;
&lt;h2 id="ä¸»è¦æœ‰-3-ä¸ªæ–¹é¢çš„åŸå› åˆ†åˆ«æ˜¯å­˜å‚¨æ–¹å¼ä¼˜ç§€çš„çº¿ç¨‹æ¨¡å‹ä»¥åŠ-io-æ¨¡å‹é«˜æ•ˆçš„æ•°æ®ç»“æ„"&gt;ä¸»è¦æœ‰ 3 ä¸ªæ–¹é¢çš„åŸå› ï¼Œåˆ†åˆ«æ˜¯å­˜å‚¨æ–¹å¼ã€ä¼˜ç§€çš„çº¿ç¨‹æ¨¡å‹ä»¥åŠ IO æ¨¡å‹ã€é«˜æ•ˆçš„æ•°æ®ç»“æ„ã€‚
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Redis å°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæä¾›å¿«é€Ÿçš„è¯»å†™é€Ÿåº¦ï¼Œç›¸æ¯”äºä¼ ç»Ÿçš„ç£ç›˜æ•°æ®åº“ï¼Œå†…å­˜è®¿é—®é€Ÿåº¦å¿«å¾—å¤šã€‚&lt;/li&gt;
&lt;li&gt;Redis ä½¿ç”¨å•çº¿ç¨‹äº‹ä»¶é©±åŠ¨æ¨¡å‹ç»“åˆ I/O å¤šè·¯å¤ç”¨ï¼Œé¿å…äº†å¤šçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶ï¼Œæé«˜äº†å¹¶å‘å¤„ç†æ•ˆç‡ã€‚&lt;/li&gt;
&lt;li&gt;Redis æä¾›å¤šç§é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼ˆå¦‚å­—ç¬¦ä¸²ã€å“ˆå¸Œã€åˆ—è¡¨ã€é›†åˆç­‰ï¼‰ï¼Œè¿™äº›ç»“æ„ç»è¿‡ä¼˜åŒ–ï¼Œèƒ½å¤Ÿå¿«é€Ÿå®Œæˆå„ç§æ“ä½œ&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>å•ä¾‹è®¾è®¡æ¨¡å¼</title><link>https://0607pass.github.io/Blog/p/%E5%8D%95%E4%BE%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</link><pubDate>Thu, 11 Dec 2025 14:40:29 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/%E5%8D%95%E4%BE%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</guid><description>&lt;img src="https://0607pass.github.io/Blog/images/postCover/design.png" alt="Featured image of post å•ä¾‹è®¾è®¡æ¨¡å¼" /&gt;&lt;h1 id="ä»€ä¹ˆæ˜¯å•ä¾‹è®¾è®¡æ¨¡å¼"&gt;ä»€ä¹ˆæ˜¯å•ä¾‹è®¾è®¡æ¨¡å¼
&lt;/h1&gt;&lt;p&gt;å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå°±æ˜¯è¯´ï¼šä¸€ä¸ªç±»åœ¨æ•´ä¸ªåº”ç”¨è¿è¡ŒæœŸé—´ï¼Œåªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œè€Œä¸”è¿™ä¸ªå®ä¾‹å¯¹å¤–æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚&lt;/p&gt;
&lt;h2 id="å•ä¾‹æ¨¡å¼çš„å‡ ç§å®ç°"&gt;å•ä¾‹æ¨¡å¼çš„å‡ ç§å®ç°
&lt;/h2&gt;&lt;h3 id="1é¥¿æ±‰å¼eager-initialization"&gt;1ï¼‰é¥¿æ±‰å¼ï¼ˆEager Initializationï¼‰
&lt;/h3&gt;&lt;p&gt;é¥¿æ±‰å¼æ˜¯åœ¨ç±»â€åŠ è½½é˜¶æ®µå°±å®Œæˆå®ä¾‹åŒ–ï¼Œä¿â¢è¯ä»ç¬¬ä¸€æ¬¡è®¿é—®è¯¥ç±»åˆ°ç¨‹åºç»“æŸï¼Œå…¨å±€åªæœ‰è¿™ä¸€ä¸ªå®ä¾‹ï¿½ã€‚å®ƒä¾èµ– JVM çš„ç±»åŠ â€è½½æœºåˆ¶æ¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @author 32500
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @date 2025/6/9 10:19
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; */&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SingletonEager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SingletonEager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SingletonEager&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;SingletonEager&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SingletonEager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getInstance&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="2æ‡’æ±‰å¼synchronized-lazy-"&gt;2ï¼‰æ‡’æ±‰å¼ï¼ˆSynchronized Lazy ï¼‰
&lt;/h3&gt;&lt;p&gt;æ‡’æ±‰å¼åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ &lt;code&gt;getInstance()&lt;/code&gt; æ—¶æ‰åˆ›å»ºå®ä¾‹ï¼Œé€šè¿‡å¯¹è¯¥æ–¹æ³•åŠ é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œé€‚åˆå¯¹å¯åŠ¨æ€§èƒ½æœ‰è¦æ±‚ä¸”å®ä¾‹ä¸ä¸€å®šé©¬ä¸Šéœ€è¦çš„åœºæ™¯ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @author 32500
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @date 2025/6/9 10:30
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * æ¯æ¬¡è°ƒç”¨ getInstance() éƒ½ä¼šåŠ é”ï¼Œå³ä½¿ instance å·²ç»åˆå§‹åŒ–å®Œæˆï¼Œè¿™ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * é‡‡ç”¨åŒæ£€é”ä¼˜åŒ–
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; */&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SingletonLazy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SingletonLazy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;SingletonLazy&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;synchronized&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SingletonLazy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getInstance&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SingletonLazy&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="3-åŒæ£€é”"&gt;3 ï¼‰åŒæ£€é”
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;span class="lnt"&gt;22
&lt;/span&gt;&lt;span class="lnt"&gt;23
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @author 32500
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @date 2025/6/9 10:35
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * åŒæ£€æœºåˆ¶
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * é˜²æ­¢å¤šçº¿ç¨‹é‡å¤åˆ¤æ–­
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; */&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DoubleCheckSingletonLazy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;volatile&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DoubleCheckSingletonLazy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;DoubleCheckSingletonLazy&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DoubleCheckSingletonLazy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getInstance&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;synchronized&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;DoubleCheckSingletonLazy&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DoubleCheckSingletonLazy&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="4-é™æ€å†…éƒ¨ç±»"&gt;4 ï¼‰é™æ€å†…éƒ¨ç±»
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @author 32500
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @date 2025/6/9 11:10
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * é™æ€å†…éƒ¨ç±»å®ç°å•ä¾‹æ¨¡å¼
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * åˆ©ç”¨ JVM åœ¨åŠ è½½å¤–éƒ¨ç±»æ—¶å¹¶ä¸ç«‹å³åŠ è½½å†…éƒ¨ç±»çš„ç‰¹æ€§ï¼Œå°†å®ä¾‹çš„åˆ›å»ºå»¶è¿Ÿåˆ°çœŸæ­£è®¿é—®å†…éƒ¨ç±»æ—¶ã€‚æ—¢èƒ½å»¶è¿ŸåŠ è½½ï¼Œåˆèƒ½å€ŸåŠ©ç±»åŠ è½½çš„çº¿ç¨‹å®‰å…¨ç‰¹æ€§ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; */&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;InnerStaticSingleton&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Holder&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;InnerStaticSingleton&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;InnerStaticSingleton&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;InnerStaticSingleton&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;InnerStaticSingleton&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getInstance&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Holder&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="5--æšä¸¾-å¤©ç„¶çš„å•ä¾‹"&gt;5 ï¼‰ æšä¸¾ å¤©ç„¶çš„å•ä¾‹
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;span class="lnt"&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @author 32500
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @date 2025/6/9 11:13
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * æšä¸¾å®ç° å•ä¾‹æ¨¡å¼
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; */&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;enum&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EnumSingleton&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;INSTANCE&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</description></item><item><title>å¦‚ä½•è¿›è¡ŒSQLè°ƒä¼˜</title><link>https://0607pass.github.io/Blog/p/%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8Csql%E8%B0%83%E4%BC%98/</link><pubDate>Thu, 11 Dec 2025 10:48:40 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8Csql%E8%B0%83%E4%BC%98/</guid><description>&lt;img src="https://0607pass.github.io/Blog/images/postCover/sql.png" alt="Featured image of post å¦‚ä½•è¿›è¡ŒSQLè°ƒä¼˜" /&gt;&lt;h1 id="1å¦‚ä½•è¿›è¡Œsqlè°ƒä¼˜"&gt;1ã€å¦‚ä½•è¿›è¡ŒSQLè°ƒä¼˜
&lt;/h1&gt;&lt;h2 id="11-å®šä½æ…¢sql"&gt;1.1 å®šä½æ…¢SQL
&lt;/h2&gt;&lt;p&gt;é¦–å…ˆéœ€è¦å®šä½åˆ°å…·ä½“çš„SQLè¯­å¥ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡å„ç±»ç›‘æ§å¹³å°æˆ–è€…å·¥å…·æ¥å®ç°ï¼Œé€šè¿‡å®šä½åˆ°SQLè¯­å¥ä¹‹åï¼Œå°±èƒ½çŸ¥é“å…·ä½“æ˜¯å“ªå¼ è¡¨ã€å“ªä¸ªSQLæ…¢äº†ã€‚&lt;/p&gt;
&lt;h2 id="12-åˆ†ææ…¢sql"&gt;1.2 åˆ†ææ…¢SQL
&lt;/h2&gt;&lt;p&gt;æ…¢SQLå¯èƒ½æœ‰ä»¥ä¸‹åŸå› &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç´¢å¼•å¤±æ•ˆ&lt;/li&gt;
&lt;li&gt;å¤šè¡¨join&lt;/li&gt;
&lt;li&gt;æŸ¥è¯¢å­—æ®µå¤ªå¤š&lt;/li&gt;
&lt;li&gt;è¡¨ä¸­æ•°æ®é‡å¤ªå¤§&lt;/li&gt;
&lt;li&gt;ç´¢å¼•åŒºåˆ†åº¦ä¸é«˜&lt;/li&gt;
&lt;li&gt;æ•°æ®åº“è¿æ¥æ•°ä¸å¤Ÿ&lt;/li&gt;
&lt;li&gt;æ•°æ®åº“è¡¨çš„ç»“æ„è®¾è®¡ä¸åˆç†&lt;/li&gt;
&lt;li&gt;æ•°æ®åº“IOæˆ–è€…CPUæ¯”è¾ƒé«˜&lt;/li&gt;
&lt;li&gt;æ•°æ®åº“å‚æ•°ä¸åˆç†&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡æ¯”è¾ƒé•¿&lt;/li&gt;
&lt;li&gt;é”ç«äº‰å¯¼è‡´çš„ç­‰å¾…&lt;/li&gt;
&lt;li&gt;æ·±åˆ†é¡µé—®é¢˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="121-ç´¢å¼•å¤±æ•ˆé—®é¢˜"&gt;1.2.1 ç´¢å¼•å¤±æ•ˆé—®é¢˜
&lt;/h3&gt;&lt;p&gt;ç´¢å¼•å¤±æ•ˆçš„é—®é¢˜ä¸€èˆ¬æ˜¯å…ˆé€šè¿‡æ‰§è¡Œè®¡åˆ’åˆ†ææ˜¯å¦èµ°äº†ç´¢å¼•ï¼Œä»¥åŠæ‰€èµ°çš„ç´¢å¼•æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œå¦‚æœå› ä¸ºç´¢å¼•è®¾è®¡çš„ä¸åˆç†ã€æˆ–è€…ç´¢å¼•å¤±æ•ˆå¯¼è‡´çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä¿®æ”¹ç´¢å¼•ï¼Œæˆ–è€…ä¿®æ”¹SQLè¯­å¥ã€‚æˆ–è€…å¼ºåˆ¶æ‰§è¡Œä½¿ç”¨æŸä¸ªç´¢å¼•ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;span class="lnt"&gt;22
&lt;/span&gt;&lt;span class="lnt"&gt;23
&lt;/span&gt;&lt;span class="lnt"&gt;24
&lt;/span&gt;&lt;span class="lnt"&gt;25
&lt;/span&gt;&lt;span class="lnt"&gt;26
&lt;/span&gt;&lt;span class="lnt"&gt;27
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;TABLE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;t2&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;INT&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;varchar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;64&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NOT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;varchar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;64&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NOT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="k"&gt;c&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;varchar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;64&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NOT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;varchar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;64&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NOT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;varchar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;64&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;DEFAULT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;PRIMARY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;KEY&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;UNIQUE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;KEY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;KEY&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;idx_abc&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="k"&gt;c&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ENGINE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;InnoDB&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;DEFAULT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;CHARSET&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;latin1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;INSERT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;INTO&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;t2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;c&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;VALUES&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;a1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;b1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;c1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;d1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;f001&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;a2&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;b2&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;c2&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;d2&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;f002&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;a3&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;b3&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;c3&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;d3&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;f003&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;a4&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;b4&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;c4&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;d4&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;f004&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;a5&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;b5&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;c5&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;d5&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;f005&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;a6&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;b6&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;c6&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;d6&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;f006&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;a7&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;b7&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;c7&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;d7&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;f007&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;a8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;b8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;c8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;d8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;f008&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;a9&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;b9&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;c9&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;d9&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;f009&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;a10&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;b10&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;c10&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;d10&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;f010&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;a11&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;b11&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;c11&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;d11&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;f011&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;a12&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;b12&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;c12&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;d12&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;f012&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;a13&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;b13&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;c13&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;d13&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;f013&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;a14&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;b14&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;c14&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;d14&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;f014&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;a15&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;b15&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;c15&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;d15&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;f015&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;explain æŸ¥çœ‹SQLçš„æ‰§è¡Œè®¡åˆ’ï¼Œä¸»è¦å…³æ³¨typeã€keyå’Œextraè¿™å‡ ä¸ªå­—æ®µã€‚ ä¸€ä¸ªæ‰§è¡Œè®¡åˆ’ä¸­ï¼Œå…±æœ‰12ä¸ªå­—æ®µ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;**id: **æ‰§è¡Œè®¡åˆ’ä¸­æ¯ä¸ªæ“ä½œçš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚å¯¹äºä¸€æ¡æŸ¥è¯¢è¯­å¥ï¼Œæ¯ä¸ªæ“ä½œéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„idã€‚ä½†æ˜¯åœ¨å¤šè¡¨joinçš„æ—¶å€™ï¼Œä¸€æ¬¡explainä¸­çš„å¤šæ¡è®°å½•çš„idæ˜¯ç›¸åŒçš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;select_typeï¼š&lt;strong&gt;æ“ä½œçš„ç±»å‹ã€‚å¸¸è§çš„ç±»å‹åŒ…æ‹¬&lt;/strong&gt;SIMPLEã€PRIMARYã€SUBQUERYã€UNION&lt;/strong&gt;ç­‰ã€‚ä¸åŒç±»å‹çš„æ“ä½œä¼šå½±å“æŸ¥è¯¢çš„æ‰§è¡Œæ•ˆç‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;**tableï¼š**å½“å‰æ“ä½œæ‰€æ¶‰åŠçš„è¡¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;partitionsï¼šå½“å‰æ“ä½œæ‰€æ¶‰åŠçš„åˆ†åŒºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;typeï¼šè¡¨ç¤ºæŸ¥è¯¢æ—¶æ‰€ä½¿ç”¨çš„ç´¢å¼•ç±»å‹ï¼ŒåŒ…æ‹¬&lt;strong&gt;ALLã€indexã€rangeã€refã€eq_refã€constã€system&lt;/strong&gt;ç­‰ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;systemï¼šç³»ç»Ÿè¡¨ï¼Œå°‘é‡æ•°æ®ï¼Œå¾€å¾€ä¸éœ€è¦è¿›è¡Œç£ç›˜IO&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;constant: ä½¿ç”¨å¸¸æ•°ç´¢å¼•ï¼ŒMySQL åªä¼šåœ¨æŸ¥è¯¢æ—¶ä½¿ç”¨å¸¸æ•°å€¼è¿›è¡ŒåŒ¹é…ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;explain select * from t2 where f='f010';&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å”¯ä¸€æ€§ç´¢å¼•åšå”¯ä¸€æŸ¥è¯¢&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;eq_refï¼šå”¯ä¸€ç´¢å¼•æ‰«æï¼Œåªä¼šæ‰«æç´¢å¼•æ ‘ä¸­çš„ä¸€ä¸ªåŒ¹é…è¡Œã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;explain select * from t1 join t2 on t1.id = t2.id where t1.f1 = 's';&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å½“åœ¨è¿æ¥æ“ä½œä¸­ä½¿ç”¨äº†å”¯ä¸€ç´¢å¼•æˆ–ä¸»é”®ç´¢å¼•ï¼Œå¹¶ä¸”è¿æ¥æ¡ä»¶æ˜¯åŸºäºè¿™äº›ç´¢å¼•çš„ç­‰å€¼æ¡ä»¶æ—¶ï¼ŒMySQLé€šå¸¸ä¼šé€‰æ‹© eq_ref è¿æ¥ç±»å‹ï¼Œä»¥æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;refï¼šéå”¯ä¸€ç´¢å¼•æ‰«æï¼Œ åªä¼šæ‰«æç´¢å¼•æ ‘ä¸­çš„ä¸€éƒ¨åˆ†æ¥æŸ¥æ‰¾åŒ¹é…çš„è¡Œã€‚ï¼ˆä½¿ç”¨éå”¯ä¸€ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢ï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;explain select * from t2 where a = 'a15';&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨éå”¯ä¸€ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;rangeï¼šèŒƒå›´æ‰«æï¼Œ åªä¼šæ‰«æç´¢å¼•æ ‘ä¸­çš„ä¸€ä¸ªèŒƒå›´æ¥æŸ¥æ‰¾åŒ¹é…çš„è¡Œã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;explain select * from t2 where a &amp;gt; 'a' and a &amp;lt; 'a15';&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ€§èŒƒå›´æŸ¥è¯¢&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;indexï¼šå…¨ç´¢å¼•æ‰«æï¼Œ ä¼šéå†ç´¢å¼•æ ‘æ¥æŸ¥æ‰¾åŒ¹é…çš„è¡Œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;explain select c from t2 where b = 'b1';&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ä¸ç¬¦åˆæœ€å·¦å‰ç¼€åŒ¹é…çš„æŸ¥è¯¢&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ALLï¼šå…¨è¡¨æ‰«æï¼Œ å°†éå†å…¨è¡¨æ¥æ‰¾åˆ°åŒ¹é…çš„è¡Œã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;explain select * from t2 where d = &amp;ldquo;d10&amp;rdquo;;&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨éç´¢å¼•å­—æ®µæŸ¥è¯¢&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„indexè¡¨ç¤ºçš„æ˜¯åšäº†ç´¢å¼•æ ‘æ‰«æï¼Œæ•ˆç‡å¹¶ä¸é«˜ã€‚ä»¥ä¸Šç±»å‹ç”±å¿«åˆ°æ…¢ï¼š
system&amp;gt; const &amp;gt; eq_ref &amp;gt;ref&amp;gt;range&amp;gt; index &amp;gt;ALL&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;**possible_keysï¼š**è¡¨ç¤ºå¯èƒ½è¢«æŸ¥è¯¢ä¼˜åŒ–å™¨é€‰æ‹©ä½¿ç”¨çš„ç´¢å¼•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;**keyï¼š**è¡¨ç¤ºæŸ¥è¯¢ä¼˜åŒ–å™¨é€‰æ‹©ä½¿ç”¨çš„ç´¢å¼•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;key_lenï¼šè¡¨ç¤ºç´¢å¼•çš„é•¿åº¦ã€‚ç´¢å¼•çš„é•¿åº¦è¶ŠçŸ­ï¼ŒæŸ¥è¯¢æ—¶çš„æ•ˆç‡è¶Šé«˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;refï¼šç”¨æ¥è¡¨ç¤ºå“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨æ¥ä¸keyåˆ—ä¸­å‘½åçš„ç´¢å¼•è¿›è¡Œæ¯”è¾ƒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;rowsï¼šè¡¨ç¤ºæ­¤æ“ä½œéœ€è¦æ‰«æçš„è¡Œæ•°ï¼Œå³æ‰«æè¡¨ä¸­å¤šå°‘è¡Œæ‰èƒ½å¾—åˆ°ç»“æœã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;filteredï¼šè¡¨ç¤ºæ­¤æ“ä½œè¿‡æ»¤ä¸­ä¿ç•™çš„çš„è¡Œæ•°å æ‰«æè¡Œæ•°çš„ç™¾åˆ†æ¯”ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;**Extraï¼š**è¡¨ç¤ºå…¶ä»–é¢å¤–çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬Using indexã€Using filesortã€Using temporaryç­‰ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Using whereï¼šè¡¨ç¤º MySQL å°†åœ¨å­˜å‚¨å¼•æ“æ£€ç´¢è¡Œåï¼Œå†è¿›è¡Œæ¡ä»¶è¿‡æ»¤ï¼ˆä½¿ç”¨ WHERE å­å¥ï¼‰ï¼›æŸ¥è¯¢çš„åˆ—æœªè¢«ç´¢å¼•è¦†ç›–ï¼Œwhereç­›é€‰æ¡ä»¶éç´¢å¼•çš„å‰å¯¼åˆ—æˆ–è€…whereç­›é€‰æ¡ä»¶éç´¢å¼•åˆ—ã€‚
&lt;ul&gt;
&lt;li&gt;explain select * from t2 where d = &amp;ldquo;d5&amp;rdquo;; éç´¢å¼•å­—æ®µæŸ¥è¯¢&lt;/li&gt;
&lt;li&gt;explain select d from t2 where b = &amp;ldquo;b5&amp;rdquo;; æœªç´¢å¼•è¦†ç›–ï¼Œç”¨è”åˆç´¢å¼•çš„éå‰å¯¼åˆ—æŸ¥è¯¢&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Using indexï¼šè¡¨ç¤º MySQL ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼ˆä¹Ÿç§°ä¸ºç´¢å¼•è¦†ç›–ï¼‰ä¼˜åŒ–ï¼Œåªéœ€è¦æ‰«æç´¢å¼•ï¼Œè€Œæ— éœ€å›åˆ°æ•°æ®è¡¨ä¸­æ£€ç´¢è¡Œï¼›
&lt;ul&gt;
&lt;li&gt;explain select b,c from t2 where a = &amp;ldquo;a5&amp;rdquo;; ç´¢å¼•è¦†ç›–&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Using index conditionï¼šè¡¨ç¤ºæŸ¥è¯¢åœ¨ç´¢å¼•ä¸Šæ‰§è¡Œäº†éƒ¨åˆ†æ¡ä»¶è¿‡æ»¤ã€‚è¿™é€šå¸¸å’Œç´¢å¼•ä¸‹æ¨æœ‰å…³ã€‚
&lt;ul&gt;
&lt;li&gt;explain select d from t2 where a = &amp;ldquo;a5&amp;rdquo; and b like &amp;ldquo;b%&amp;rdquo;; ä½¿ç”¨åˆ°ç´¢å¼•ä¸‹æ¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Using where; Using indexï¼šæŸ¥è¯¢çš„åˆ—è¢«ç´¢å¼•è¦†ç›–ï¼Œå¹¶ä¸”whereç­›é€‰æ¡ä»¶æ˜¯ç´¢å¼•åˆ—ä¹‹ä¸€ï¼Œä½†ä¸æ˜¯ç´¢å¼•çš„å‰å¯¼åˆ—ï¼Œæˆ–è€…whereç­›é€‰æ¡ä»¶æ˜¯ç´¢å¼•åˆ—å‰å¯¼åˆ—çš„ä¸€ä¸ªèŒƒå›´
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;explain select a from t2 where b = &amp;quot;b5&amp;quot;;&lt;/code&gt; ç´¢å¼•è¦†ç›–ï¼Œä½†æ˜¯ä¸ç¬¦åˆæœ€å·¦å‰ç¼€&lt;/li&gt;
&lt;li&gt;&lt;code&gt;explain select b from t2 where a in ('a1','a5','a6');&lt;/code&gt; ç´¢å¼•è¦†ç›–ï¼Œä½†æ˜¯å‰å¯¼åˆ—æ˜¯ä¸ªèŒƒå›´&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Using join bufferï¼šè¡¨ç¤º MySQL ä½¿ç”¨äº†è¿æ¥ç¼“å­˜ï¼›
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;explain select * from t1 join t2 on t1.id = t2.id where a = 'a1'&lt;/code&gt;;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Using temporaryï¼šè¡¨ç¤º MySQL åˆ›å»ºäº†ä¸´æ—¶è¡¨æ¥å­˜å‚¨æŸ¥è¯¢ç»“æœã€‚è¿™é€šå¸¸æ˜¯åœ¨æ’åºæˆ–åˆ†ç»„æ—¶å‘ç”Ÿçš„ï¼›&lt;/li&gt;
&lt;li&gt;Using filesortï¼šè¡¨ç¤º MySQL å°†ä½¿ç”¨æ–‡ä»¶æ’åºè€Œä¸æ˜¯ç´¢å¼•æ’åºï¼Œè¿™é€šå¸¸å‘ç”Ÿåœ¨æ— æ³•ä½¿ç”¨ç´¢å¼•æ¥è¿›è¡Œæ’åºæ—¶ï¼›
&lt;ul&gt;
&lt;li&gt;explain select count(*),b from t2 group by b;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Using index for group-byï¼šè¡¨ç¤º MySQL åœ¨åˆ†ç»„æ“ä½œä¸­ä½¿ç”¨äº†ç´¢å¼•ã€‚è¿™é€šå¸¸æ˜¯åœ¨åˆ†ç»„æ“ä½œæ¶‰åŠåˆ°ç´¢å¼•ä¸­çš„æ‰€æœ‰åˆ—æ—¶å‘ç”Ÿçš„ï¼›&lt;/li&gt;
&lt;li&gt;Using filesort for group-byï¼šè¡¨ç¤º MySQL åœ¨åˆ†ç»„æ“ä½œä¸­ä½¿ç”¨äº†æ–‡ä»¶æ’åºã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨æ— æ³•ä½¿ç”¨ç´¢å¼•è¿›è¡Œåˆ†ç»„æ“ä½œæ—¶ï¼›&lt;/li&gt;
&lt;li&gt;Range checked for each recordï¼šè¡¨ç¤º MySQL åœ¨ä½¿ç”¨ç´¢å¼•èŒƒå›´æŸ¥æ‰¾æ—¶ï¼Œéœ€è¦æ£€æŸ¥æ¯ä¸€æ¡è®°å½•ï¼›&lt;/li&gt;
&lt;li&gt;Using index for order byï¼šè¡¨ç¤º MySQL åœ¨æ’åºæ“ä½œä¸­ä½¿ç”¨äº†ç´¢å¼•ï¼Œè¿™é€šå¸¸å‘ç”Ÿåœ¨æ’åºæ¶‰åŠåˆ°ç´¢å¼•ä¸­çš„æ‰€æœ‰åˆ—æ—¶ï¼›&lt;/li&gt;
&lt;li&gt;Using filesort for order byï¼šè¡¨ç¤º MySQL åœ¨æ’åºæ“ä½œä¸­ä½¿ç”¨äº†æ–‡ä»¶æ’åºï¼Œè¿™é€šå¸¸å‘ç”Ÿåœ¨æ— æ³•ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åºæ—¶ï¼›&lt;/li&gt;
&lt;li&gt;Using index for group-by; Using index for order byï¼šè¡¨ç¤º MySQL åœ¨åˆ†ç»„å’Œæ’åºæ“ä½œä¸­éƒ½ä½¿ç”¨äº†ç´¢å¼•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚æœé€šè¿‡æ‰§è¡Œè®¡åˆ’ä¹‹åï¼Œå‘ç°ä¸€æ¡SQLæ²¡æœ‰èµ°ç´¢å¼•ï¼Œæ¯”å¦‚ type = ALLï¼Œ key = NULL , extra = Using where&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆå°±è¦è¿›ä¸€æ­¥åˆ†ææ²¡æœ‰èµ°ç´¢å¼•çš„åŸå› äº†ã€‚æˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œåˆ°åº•è¦ä¸è¦èµ°ç´¢å¼•ï¼Œèµ°å“ªä¸ªç´¢å¼•ï¼Œæ˜¯MySQLçš„ä¼˜åŒ–å™¨å†³å®šçš„ï¼Œä»–ä¼šæ ¹æ®é¢„ä¼°çš„æˆæœ¬æ¥åšä¸€ä¸ªå†³å®šã€‚æœ‰ä»¥ä¸‹è¿™ä¹ˆå‡ ç§æƒ…å†µå¯èƒ½ä¼šå¯¼è‡´æ²¡èµ°ç´¢å¼•ï¼š&lt;/p&gt;
&lt;p&gt;1ã€æ²¡æœ‰æ­£ç¡®åˆ›å»ºç´¢å¼•ï¼šå½“æŸ¥è¯¢è¯­å¥ä¸­çš„whereæ¡ä»¶ä¸­çš„å­—æ®µï¼Œæ²¡æœ‰åˆ›å»ºç´¢å¼•ï¼Œæˆ–è€…ä¸ç¬¦åˆæœ€å·¦å‰ç¼€åŒ¹é…çš„è¯ï¼Œå°±æ˜¯æ²¡æœ‰æ­£ç¡®çš„åˆ›å»ºç´¢å¼•ã€‚
2ã€ç´¢å¼•åŒºåˆ†åº¦ä¸é«˜ï¼šå¦‚æœç´¢å¼•çš„åŒºåˆ†åº¦ä¸å¤Ÿé«˜ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šä¸èµ°ç´¢å¼•ï¼Œå› ä¸ºè¿™ç§æƒ…å†µä¸‹èµ°ç´¢å¼•çš„æ•ˆç‡å¹¶ä¸é«˜ã€‚
3ã€è¡¨å¤ªå°ï¼šå½“è¡¨ä¸­çš„æ•°æ®å¾ˆå°ï¼Œä¼˜åŒ–å™¨è®¤ä¸ºæ‰«å…¨è¡¨çš„æˆæœ¬ä¹Ÿä¸é«˜çš„æ—¶å€™ï¼Œä¹Ÿå¯èƒ½ä¸èµ°ç´¢å¼•
4ã€æŸ¥è¯¢è¯­å¥ä¸­ï¼Œç´¢å¼•å­—æ®µå› ä¸ºç”¨åˆ°äº†å‡½æ•°ã€ç±»å‹ä¸ä¸€è‡´ç­‰å¯¼è‡´äº†ç´¢å¼•å¤±æ•ˆ&lt;/p&gt;
&lt;p&gt;å¦‚ä½•è§£å†³ï¼Ÿ&lt;/p&gt;
&lt;p&gt;1ã€å¦‚æœæ²¡æœ‰æ­£ç¡®åˆ›å»ºç´¢å¼•ï¼Œé‚£ä¹ˆå°±æ ¹æ®SQLè¯­å¥ï¼Œåˆ›å»ºåˆé€‚çš„ç´¢å¼•ã€‚å¦‚æœæ²¡æœ‰éµå®ˆæœ€å·¦å‰ç¼€é‚£ä¹ˆå°±è°ƒæ•´ä¸€ä¸‹ç´¢å¼•æˆ–è€…ä¿®æ”¹SQLè¯­å¥
2ã€ç´¢å¼•åŒºåˆ†åº¦ä¸é«˜çš„è¯ï¼Œé‚£ä¹ˆå°±è€ƒè™‘æ¢ä¸€ä¸ªç´¢å¼•å­—æ®µã€‚
3ã€è¡¨å¤ªå°è¿™ç§æƒ…å†µç¡®å®ä¹Ÿæ²¡å•¥ä¼˜åŒ–çš„å¿…è¦äº†ï¼Œç”¨ä¸ç”¨ç´¢å¼•å¯èƒ½å½±å“ä¸å¤§çš„
4ã€æ’æŸ¥å…·ä½“çš„å¤±æ•ˆåŸå› ï¼Œç„¶åé’ˆå¯¹æ€§çš„è°ƒæ•´SQLè¯­å¥å°±è¡Œäº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¯èƒ½å¯¼è‡´ç´¢å¼•å¤±æ•ˆçš„æƒ…å†µ&lt;/strong&gt;ï¼Ÿï¼Ÿï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="122-å¤šè¡¨joiné—®é¢˜"&gt;1.2.2 å¤šè¡¨joiné—®é¢˜
&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆå¤§å‚ä¸å»ºè®®ä½¿ç”¨å¤šè¡¨joinï¼Ÿ&lt;/p&gt;
&lt;p&gt;æœ€ä¸»è¦çš„åŸå› å°±æ˜¯joinçš„æ•ˆç‡æ¯”è¾ƒä½ã€‚&lt;/p&gt;
&lt;p&gt;MySQLæ˜¯ä½¿ç”¨äº†åµŒå¥—å¾ªç¯ï¼ˆNested-Loop Joinï¼‰çš„æ–¹å¼æ¥å®ç°å…³è”æŸ¥è¯¢çš„ï¼Œç®€å•ç‚¹è¯´å°±æ˜¯è¦é€šè¿‡ä¸¤å±‚å¾ªç¯ï¼Œç”¨ç¬¬ä¸€å¼ è¡¨åšå¤–å¾ªç¯ï¼Œç¬¬äºŒå¼ è¡¨åšå†…å¾ªç¯ï¼Œå¤–å¾ªç¯çš„æ¯ä¸€æ¡è®°å½•è·Ÿå†…å¾ªç¯ä¸­çš„è®°å½•ä½œæ¯”è¾ƒï¼Œç¬¦åˆæ¡ä»¶çš„å°±è¾“å‡ºã€‚&lt;/p&gt;
&lt;p&gt;è€Œå…·ä½“åˆ°ç®—æ³•å®ç°ä¸Šä¸»è¦æœ‰simple nested loopï¼Œblock nested loopå’Œindex nested loopè¿™ä¸‰ç§ã€‚è€Œä¸”è¿™ä¸‰ç§çš„æ•ˆç‡éƒ½æ²¡æœ‰ç‰¹åˆ«é«˜ã€‚&lt;/p&gt;
&lt;p&gt;MySQLæ˜¯ä½¿ç”¨äº†åµŒå¥—å¾ªç¯ï¼ˆNested-Loop Joinï¼‰çš„æ–¹å¼æ¥å®ç°å…³è”æŸ¥è¯¢çš„ï¼Œå¦‚æœæœ‰2å¼ è¡¨joinçš„è¯ï¼Œå¤æ‚åº¦æœ€é«˜æ˜¯O(n^2)ï¼Œ3å¼ è¡¨åˆ™æ˜¯O(n^3)&amp;hellip;éšç€è¡¨è¶Šå¤šï¼Œè¡¨ä¸­çš„æ•°æ®é‡è¶Šå¤šï¼ŒJOINçš„æ•ˆç‡ä¼šå‘ˆæŒ‡æ•°çº§ä¸‹é™ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;ä¸èƒ½ç”¨joinå¦‚ä½•åšå…³è”æŸ¥è¯¢&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;1ã€åœ¨å†…å­˜ä¸­è‡ªå·±åšå…³è”ï¼Œå³å…ˆä»æ•°æ®åº“ä¸­æŠŠæ•°æ®æŸ¥å‡ºæ¥ä¹‹åï¼Œæˆ‘ä»¬åœ¨ä»£ç ä¸­å†è¿›è¡ŒäºŒæ¬¡æŸ¥è¯¢ï¼Œç„¶åå†è¿›è¡Œå…³è”ã€‚&lt;/p&gt;
&lt;p&gt;2ã€æ•°æ®å†—ä½™ï¼Œé‚£å°±æ˜¯æŠŠä¸€äº›é‡è¦çš„æ•°æ®åœ¨è¡¨ä¸­åšå†—ä½™ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…å…³è”æŸ¥è¯¢äº†ã€‚&lt;/p&gt;
&lt;p&gt;3ã€å®½è¡¨ï¼Œå°±æ˜¯åŸºäºä¸€å®šçš„joinå…³ç³»ï¼ŒæŠŠæ•°æ®åº“ä¸­å¤šå¼ è¡¨çš„æ•°æ®æ‰“å¹³åšä¸€å¼ å¤§å®½è¡¨ï¼Œå¯ä»¥åŒæ­¥åˆ°ESæˆ–è€…å¹²è„†ç›´æ¥åœ¨æ•°æ®åº“ä¸­ç›´æ¥æŸ¥éƒ½å¯ä»¥&lt;/p&gt;
&lt;h3 id="123-ç´¢å¼•åŒºåˆ†åº¦ä¸é«˜é—®é¢˜"&gt;1.2.3 ç´¢å¼•åŒºåˆ†åº¦ä¸é«˜é—®é¢˜
&lt;/h3&gt;&lt;p&gt;è¿™ä¸ªå…¶å®ä¹Ÿå’Œç´¢å¼•ä¸åˆç†æœ‰å…³ï¼Œä½†æ˜¯å…¶å®åˆ°åº•å¿«ä¸å¿«ï¼Œç”¨ä¸ç”¨ç´¢å¼•ï¼Œå¹¶ä¸æ˜¯å› ä¸ºåŒºåˆ†åº¦é«˜ä¸é«˜å¯¼è‡´ï¼Œå…¶å®è¿˜æ˜¯ç´¢å¼•æ‰«æçš„è¡Œæ•°çš„æˆæœ¬å¯¼è‡´ã€‚æ‰€ä»¥ï¼Œæœ‰çš„æ—¶å€™ä¸èƒ½è®¤ä¸ºåŒºåˆ†åº¦ä¸é«˜å°±ä¸€å®šä¼šæ•ˆç‡ä½ï¼Œæˆ–è€…ä¸€å®šå°±ä¸é€‚åˆåˆ›å»ºç´¢å¼•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åŒºåˆ†åº¦ä¸é«˜çš„å­—æ®µå»ºç´¢å¼•ä¸€å®šæ²¡ç”¨å—ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸ä¸€å®š çœ‹ç´¢å¼•æ‰«æçš„è¡Œæ•°çš„æˆæœ¬&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚è¡¨ä¸­æœ‰ä¸€ä¸ªæ€§åˆ«å­—æ®µï¼Œä»–çš„åŒºåˆ†åº¦è‚¯å®šæ˜¯ä¸é«˜çš„ï¼Œåªæœ‰ç”·å’Œå¥³ä¸¤ç§ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœè¡¨ä¸­æ•°æ®é‡å¾ˆå¤§çš„è¯ï¼Œç”¨è¿™ä¸ªå­—æ®µæŸ¥è¯¢ä¼šå¯¼è‡´æ²¡åŠæ³•è¿‡æ»¤æ‰å¾ˆå¤šæ•°æ®ï¼Œå°±å¯èƒ½æ²¡åŠæ³•å‘æŒ¥ç´¢å¼•çš„æ•ˆæœã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œå¦‚æœæœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå¦‚ç”·å¥³æ¯”ä¾‹æ˜¯95:5ï¼Œé‚£ä¹ˆï¼Œè¿™æ—¶å€™ï¼Œå¦‚æœæˆ‘ç”¨&amp;quot;å¥³&amp;rsquo;ä½œä¸ºæ€§åˆ«çš„æŸ¥è¯¢æ¡ä»¶çš„è¯ï¼Œè¿˜æ˜¯å¯ä»¥èµ°ç´¢å¼•ï¼Œå¹¶ä¸”æœ‰å¾ˆå¤§çš„æ€§èƒ½æå‡çš„ï¼ŒåŸå› å°±æ˜¯å› ä¸ºä»–å¯ä»¥è¿‡æ»¤æ‰å¤§éƒ¨åˆ†æ•°æ®ã€‚èµ°ç´¢å¼•å¯ä»¥å¤§å¤§æå‡æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§ä¸€èˆ¬åœ¨ä»»åŠ¡è¡¨ä¸­æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚ä»»åŠ¡è¡¨ä¸­æœ‰çŠ¶æ€ï¼Œä¸¤ç§æƒ…å†µï¼šFAILå’ŒSUCCESSï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä»»åŠ¡éƒ½æ˜¯SUCCESSçš„ï¼Œåªæœ‰ä¸€å°‘éƒ¨åˆ†æ˜¯FAILï¼Œè¿™æ—¶å€™å°±å¯ä»¥ç»™è¿™ä¸ªå­—æ®µåŠ ç´¢å¼•ã€‚è¿™æ ·å½“æˆ‘ä»¬æ‰«æä»»åŠ¡è¡¨æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ï¼Œè¿˜æ˜¯å¯ä»¥å¤§å¤§æå‡æŸ¥è¯¢æ•ˆç‡çš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="124-æŸ¥è¯¢å­—æ®µå¤ªå¤š"&gt;1.2.4 æŸ¥è¯¢å­—æ®µå¤ªå¤š
&lt;/h3&gt;&lt;p&gt;æŸ¥è¯¢å­—æ®µå¤ªå¤šï¼Œè¿™ä¸ªæœ‰çš„æ—¶å€™æ˜¯å› ä¸ºæˆ‘ä»¬é”™è¯¯çš„ç”¨åˆ°äº†select * å¯¼è‡´çš„ï¼Œä¸€èˆ¬æ¥è¯´ï¼ŒæŸ¥è¯¢å­—æ®µå°äº100ä¸ªï¼Œéƒ½ä¸æ˜¯ç‰¹åˆ«å¤§çš„é—®é¢˜ï¼Œé™¤éçœŸçš„æ˜¯å­—æ®µæ•°ç‰¹åˆ«å¤šï¼Œè¿™æ—¶å€™å¯ä»¥é‡‡ç”¨ä¸¤ç§åŠæ³•è§£å†³ã€‚ç¬¬ä¸€ä¸ªå°±æ˜¯ä¸è¦æŸ¥è¯¢é‚£äº›ä½ ä¸å…³å¿ƒçš„å­—æ®µï¼ŒåªæŸ¥è¯¢å°‘éƒ¨åˆ†å­—æ®µã€‚ç¬¬äºŒä¸ªå°±æ˜¯åšåˆ†è¡¨ï¼Œå‚ç›´åˆ†è¡¨ï¼ŒæŠŠæ•°æ®æ‹†åˆ†åˆ°å¤šå¼ è¡¨ä¸­ã€‚ä½†æ˜¯è¿™ä¹ˆåšå¯èƒ½ä¹Ÿä¼šå¸¦æ¥éœ€è¦å¤šè¡¨joinçš„é—®é¢˜ï¼Œæ‰€ä»¥æ‹†åˆ†çš„æ—¶å€™ä¹Ÿéœ€è¦è€ƒè™‘å†—ä½™ã€‚&lt;/p&gt;
&lt;h3 id="125-è¡¨ä¸­æ•°æ®é‡å¤ªå¤§"&gt;1.2.5 è¡¨ä¸­æ•°æ®é‡å¤ªå¤§
&lt;/h3&gt;&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼Œå•è¡¨è¶…è¿‡1000ä¸‡ï¼Œä¼šå¯¼è‡´æŸ¥è¯¢æ•ˆç‡å˜ä½ï¼Œå³ä½¿ä½¿ç”¨ç´¢å¼•å¯èƒ½ä¹Ÿä¼šæ¯”è¾ƒæ…¢ï¼Œæ‰€ä»¥å¦‚æœè¡¨ä¸­æ•°æ®é‡å¤ªå¤§çš„è¯ï¼Œè¿™æ—¶å€™å¯èƒ½é€šè¿‡å»ºç´¢å¼•å¹¶ä¸ä¸€å®šèƒ½å®Œå…¨è§£å†³äº†ã€‚é‚£ä¹ˆå…·ä½“çš„è§£å†³æ–¹æ¡ˆæœ‰å‡ ç§ï¼š&lt;/p&gt;
&lt;p&gt;1ã€æ•°æ®å½’æ¡£ï¼ŒæŠŠå†å²æ•°æ®ç§»å‡ºå»ï¼Œæ¯”å¦‚åªä¿ç•™æœ€è¿‘åŠå¹´çš„æ•°æ®ï¼ŒåŠå¹´å‰çš„æ•°æ®åšå½’æ¡£ã€‚
2ã€åˆ†åº“åˆ†è¡¨ã€åˆ†åŒºã€‚æŠŠæ•°æ®æ‹†åˆ†å¼€ï¼Œåˆ†æ•£åˆ°å¤šä¸ªåœ°æ–¹å»ã€‚
3ã€ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„æ•°æ®åº“ï¼Œæ¯”å¦‚æŠŠæ•°æ®åŒæ­¥åˆ°æ”¯æŒå¤§æ•°é‡æŸ¥è¯¢çš„åˆ†å¸ƒå¼æ•°æ®åº“ä¸­ï¼Œå¦‚oceanbaseã€tidbï¼Œæˆ–è€…æœç´¢å¼•æ“ä¸­ï¼Œå¦‚ESç­‰ã€‚&lt;/p&gt;
&lt;h3 id="126-æ•°æ®åº“è¿æ¥æ•°ä¸å¤Ÿ"&gt;1.2.6 &lt;strong&gt;æ•°æ®åº“è¿æ¥æ•°ä¸å¤Ÿ&lt;/strong&gt;
&lt;/h3&gt;&lt;p&gt;è¿™ä¸ªä¹Ÿéœ€è¦å…·ä½“åˆ†æï¼Œåˆ°åº•æ˜¯ä»€ä¹ˆåŸå› ï¼Œå¯èƒ½çš„åŸå› æœ‰å‡ ä¸ªï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯ä¸šåŠ¡é‡å¤ªå¤§äº†ï¼Œå•åº“ç¡®å®æ‰›ä¸ä½äº†ï¼Œé‚£å°±é€‰æ‹©åˆ†åº“å§ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå¯èƒ½å°±æ˜¯å­˜åœ¨ä¸€äº›æ…¢SQLã€æˆ–è€…é•¿äº‹åŠ¡å¯¼è‡´çš„ï¼Œæ…¢SQLå ç”¨æ•°æ®åº“é“¾æ¥ï¼Œæ•°æ®åº“è¿æ¥æ•°ä¸å¤Ÿï¼Œå…¶ä»–çš„æŸ¥è¯¢å°±ä¼šé˜»å¡ï¼Œå°±æ›´æ…¢ã€‚&lt;/p&gt;
&lt;p&gt;æ•°æ®åº“çš„è¡¨ç»“æ„ä¸åˆç†ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ªå…³é”®åŸå› ï¼Œæœ‰çš„æ—¶å€™æ¯”å¦‚æŸä¸ªå­—æ®µä¸­å­˜äº†å¾ˆé•¿çš„å†…å®¹ï¼Œæˆ–è€…æ²¡æœ‰åšåˆç†çš„å†—ä½™éœ€è¦å¤šè¡¨å…³è”æŸ¥è¯¢ç­‰ç­‰ã€‚è§£å†³æ€è·¯å°±æ˜¯é‡æ„ï¼Œæˆ–è€…åˆ†è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;æ•°æ®åº“IOæˆ–è€…CPUæ¯”è¾ƒé«˜ï¼Œè¿™ç§é—®é¢˜ä¹Ÿå¸¸è§çš„ï¼Œå½“æ•°æ®åº“æ•´ä½“IOæˆ–è€…CPUé£™é«˜çš„æ—¶å€™ï¼ŒæŸ¥è¯¢é€Ÿåº¦å°±æœ‰å¯èƒ½ä¸‹é™ï¼Œæ‰€ä»¥éœ€è¦åˆ†æèƒŒåçš„åŸå› åŠè§£å†³æ€è·¯&lt;/p&gt;
&lt;p&gt;å­˜åœ¨é•¿äº‹åŠ¡ï¼Œè¿™ä¸ªå’Œæ…¢SQLåŒç†ï¼Œéƒ½æ˜¯å ç”¨äº†æ•°æ®åº“é“¾æ¥ï¼Œå¯¼è‡´å…¶ä»–è¯·æ±‚è¦ç­‰å¾…ã€‚&lt;/p&gt;
&lt;p&gt;é”ç«äº‰å¯¼è‡´çš„ç­‰å¾…ï¼Œå½“æœ‰å¤§å¹¶å‘äº‰æŠ¢å…±äº«èµ„æºçš„æ—¶å€™ï¼Œå°±ä¼šå¯¼è‡´é”ç­‰å¾…ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±ä¼šæ‹‰é•¿è€—æ—¶ï¼Œå¯¼è‡´SQLå˜æ…¢ã€‚è¿™ä¸ªä¹Ÿå¯ä»¥å‚è€ƒä¸Šé¢çš„CPUè¢«æ‰“æ»¡çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æ•°æ®åº“å‚æ•°ä¸åˆç†ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ç»å¸¸ä¼šé‡åˆ°çš„ï¼Œé’ˆå¯¹æˆ‘ä»¬å…·ä½“çš„ä¸šåŠ¡åœºæ™¯ï¼Œåšä¸€äº›é€‚å½“çš„å‚æ•°è°ƒæ•´ï¼Œæœ‰æ—¶å€™ä¹Ÿèƒ½å¤§å¤§çš„æå‡SQLçš„æ•ˆç‡ã€‚æ¯”å¦‚è°ƒæ•´å†…å­˜å¤§å°ã€ç¼“å­˜å¤§å°ã€çº¿ç¨‹æ± å¤§å°ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æ·±åº¦åˆ†é¡µé—®é¢˜æ˜¯æŒ‡åœ¨æ•°æ®åº“æŸ¥è¯¢ä¸­ï¼Œå½“ä½ å°è¯•è®¿é—®é€šè¿‡åˆ†é¡µæŸ¥è¯¢è¿”å›çš„ç»“æœé›†çš„åé¢éƒ¨åˆ†ï¼ˆå³æ·±å±‚é¡µç ï¼‰æ—¶é‡åˆ°çš„æ€§èƒ½é—®é¢˜ã€‚å¯ä»¥è€ƒè™‘ä½¿ç”¨å­æŸ¥è¯¢ä»¥åŠè®°å½•ä¸Šä¸€é¡µIDçš„æ–¹æ¡ˆè§£å†³ã€‚&lt;/p&gt;
&lt;h2 id="13-å‚æ•°ä¼˜åŒ–"&gt;1.3 å‚æ•°ä¼˜åŒ–
&lt;/h2&gt;&lt;p&gt;å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º mydb çš„æ•°æ®åº“ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º mytable çš„ InnoDB è¡¨ã€‚è¯¥è¡¨æœ‰ä¸€ä¸ªè‡ªå¢ä¸»é”® idï¼Œä¸€ä¸ªæ•´æ•°ç±»å‹å­—æ®µ age å’Œä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹å­—æ®µ nameï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹è¯¥è¡¨è¿›è¡Œä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SHOW VARIABLES LIKE &amp;lsquo;innodb%&amp;rsquo;; å‘½ä»¤æŸ¥çœ‹å½“å‰çš„ InnoDB å‚æ•°è®¾ç½®ã€‚è¿™äº›å‚æ•°åŒ…æ‹¬ç¼“å†²æ± å¤§å°ã€åˆ·æ–°é—´éš”ã€æ—¥å¿—å¤§å°ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•è°ƒæ•´ä»¥ä¸‹å‡ ä¸ªå‚æ•°æ¥ä¼˜åŒ–æ•°æ®åº“æ€§èƒ½ï¼š&lt;/p&gt;
&lt;p&gt;innodb_buffer_pool_size: ç¼“å†²æ± å¤§å°æ˜¯ InnoDB å­˜å‚¨å¼•æ“çš„æ ¸å¿ƒå‚æ•°ä¹‹ä¸€ï¼Œå®ƒæ§åˆ¶ç€ InnoDB å­˜å‚¨å¼•æ“ä½¿ç”¨çš„å†…å­˜å¤§å°ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¯¥å‚æ•°è®¾ç½®ä¸ºç³»ç»Ÿå¯ç”¨å†…å­˜çš„ 70%-80%ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç³»ç»Ÿæœ‰ 8GB å†…å­˜å¯ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥å°† innodb_buffer_pool_size è®¾ç½®ä¸º 6GBã€‚åœ¨ MySQL ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œè®¾ç½®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;SET&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;GLOBAL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;innodb_buffer_pool_size&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="k"&gt;G&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;innodb_read_io_threads&lt;/strong&gt; å’Œ &lt;strong&gt;innodb_write_io_threads&lt;/strong&gt;: è¿™ä¸¤ä¸ªå‚æ•°æ§åˆ¶ InnoDB å­˜å‚¨å¼•æ“ä½¿ç”¨çš„ I/O çº¿ç¨‹æ•°é‡ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸¤ä¸ªå‚æ•°è®¾ç½®ä¸º CPU æ ¸å¿ƒæ•°çš„ä¸€åŠã€‚åœ¨ MySQL ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œè®¾ç½®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;SET&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;GLOBAL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;innodb_read_io_threads&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="k"&gt;SET&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;GLOBAL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;innodb_write_io_threads&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;innodb_log_file_size:&lt;/strong&gt; è¿™ä¸ªå‚æ•°æ§åˆ¶äº‹åŠ¡æ—¥å¿—æ–‡ä»¶çš„å¤§å°ã€‚è¿™ä¸ªå€¼çš„é»˜è®¤ä¸º5Mï¼Œæ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚åœ¨ MySQL ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œè®¾ç½®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-sql" data-lang="sql"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;SET&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;GLOBAL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;innodb_log_file_size&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="k"&gt;G&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä¸€èˆ¬åœ¨è®¾ç½®è¿™ä¸ªå­—æ®µçš„æ—¶å€™ï¼Œéƒ½æ˜¯éœ€è¦å…ˆè¿›è¡Œæ•°æ®é‡‡æ ·ï¼Œçœ‹ä¸€ä¸‹ä¸€èˆ¬åœ¨ä¸šåŠ¡é«˜å³°æœŸï¼Œ2å°æ—¶å·¦å³å¯ä»¥å†™å…¥å¤šå°‘æ—¥å¿—ï¼Œç„¶åæŠŠè¿™ä¸ªé‡ä½œä¸ºä½ çš„æ—¥å¿—æ–‡ä»¶çš„å¤§å°å³å¯ã€‚å¦‚æœç®€å•ç‚¹çš„è¯ï¼Œä¸€èˆ¬è®¾ç½®ä¸º1Gå·¦å³ï¼Œæˆ–è€…ç³»ç»Ÿå†…å­˜çš„1/4å³å¯ã€‚&lt;/p&gt;</description></item><item><title>ä»€ä¹ˆæ˜¯TCPçš„ç²˜åŒ…ã€æ‹†åŒ…é—®é¢˜ï¼Ÿ</title><link>https://0607pass.github.io/Blog/p/%E4%BB%80%E4%B9%88%E6%98%AFtcp%E7%9A%84%E7%B2%98%E5%8C%85%E6%8B%86%E5%8C%85%E9%97%AE%E9%A2%98/</link><pubDate>Tue, 09 Dec 2025 20:53:37 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/%E4%BB%80%E4%B9%88%E6%98%AFtcp%E7%9A%84%E7%B2%98%E5%8C%85%E6%8B%86%E5%8C%85%E9%97%AE%E9%A2%98/</guid><description>&lt;img src="https://0607pass.github.io/Blog/images/postCover/network.png" alt="Featured image of post ä»€ä¹ˆæ˜¯TCPçš„ç²˜åŒ…ã€æ‹†åŒ…é—®é¢˜ï¼Ÿ" /&gt;&lt;p&gt;TCPç²˜åŒ…å’Œæ‹†åŒ…é—®é¢˜æ˜¯æŒ‡åœ¨è¿›è¡ŒTCPé€šä¿¡æ—¶ï¼Œè€ŒTCPæ˜¯é¢å‘æµçš„ï¼Œæ‰€ä»¥å‘é€æ–¹åœ¨ä¼ è¾“æ•°æ®æ—¶å¯èƒ½ä¼šå°†å¤šä¸ªå°çš„æ•°æ®åŒ…ç²˜åˆåœ¨ä¸€èµ·å‘é€ï¼Œè€Œæ¥æ”¶æ–¹åˆ™å¯èƒ½å°†è¿™äº›æ•°æ®åŒ…æ‹†åˆ†æˆå¤šä¸ªå°çš„æ•°æ®åŒ…è¿›è¡Œæ¥æ”¶ï¼Œä»è€Œå¯¼è‡´æ•°æ®æ¥æ”¶å‡ºç°é”™è¯¯æˆ–è€…æ•°æ®ç²˜è¿çš„é—®é¢˜ã€‚
TCPç²˜åŒ…å’Œæ‹†åŒ…é—®é¢˜ä¸»è¦å‡ºç°åœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å‘é€æ–¹è¿ç»­å‘é€å¤šä¸ªå°æ•°æ®åŒ…ï¼šç”±äºTCPæ˜¯åŸºäºæµçš„åè®®ï¼Œå‘é€æ–¹åœ¨ä¼ è¾“æ•°æ®æ—¶å¯èƒ½ä¼šå°†å¤šä¸ªå°æ•°æ®åŒ…ç»„åˆæˆä¸€ä¸ªå¤§æ•°æ®åŒ…è¿›è¡Œå‘é€ï¼Œä»è€Œå¯¼è‡´æ¥æ”¶æ–¹åœ¨æ¥æ”¶æ•°æ®æ—¶æ— æ³•åŒºåˆ†ä¸åŒæ•°æ®åŒ…ä¹‹é—´çš„ç•Œé™ã€‚&lt;/li&gt;
&lt;li&gt;æ¥æ”¶æ–¹ç¼“å­˜åŒºå¤§å°é™åˆ¶ï¼šæ¥æ”¶æ–¹åœ¨æ¥æ”¶æ•°æ®æ—¶ï¼Œå¦‚æœæ¥æ”¶ç¼“å­˜åŒºçš„å¤§å°æœ‰é™ï¼Œå¯èƒ½ä¼šå°†ä¸€ä¸ªå¤§çš„æ•°æ®åŒ…æ‹†åˆ†æˆå¤šä¸ªå°æ•°æ®åŒ…è¿›è¡Œæ¥æ”¶ï¼Œä»è€Œå¯¼è‡´ç²˜åŒ…å’Œæ‹†åŒ…é—®é¢˜çš„å‡ºç°ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="å¦‚ä½•è§£å†³"&gt;å¦‚ä½•è§£å†³ï¼Ÿï¼Ÿï¼Ÿ
&lt;/h2&gt;&lt;p&gt;å¯¹åŒ…æ ¼å¼è¿›è¡Œçº¦æŸï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å°†ä¸šåŠ¡å±‚åè®®åŒ…çš„é•¿åº¦å›ºå®šä¸‹æ¥ï¼Œæ¯ä¸ªåŒ…éƒ½å›ºå®šé•¿åº¦ï¼Œæ¯”å¦‚512ä¸ªå­—èŠ‚å¤§å°ï¼Œå¦‚æœå®¢æˆ·ç«¯å‘é€çš„æ•°æ®é•¿åº¦ä¸è¶³512ä¸ªå­—èŠ‚ï¼Œåˆ™é€šè¿‡è¡¥å……ç©ºæ ¼çš„æ–¹å¼è¡¥å…¨åˆ°æŒ‡å®šé•¿åº¦ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨æ¯ä¸ªåŒ…çš„æœ«å°¾ä½¿ç”¨å›ºå®šçš„åˆ†éš”ç¬¦ï¼Œå¦‚æ¢è¡Œç¬¦/nï¼Œå¦‚æœä¸€ä¸ªåŒ…è¢«æ‹†åˆ†äº†ï¼Œåˆ™ç­‰å¾…ä¸‹ä¸€ä¸ªåŒ…å‘é€è¿‡æ¥ä¹‹åæ‰¾åˆ°å…¶ä¸­çš„\nï¼Œç„¶åå¯¹å…¶æ‹†åˆ†åçš„å¤´éƒ¨éƒ¨åˆ†ä¸å‰ä¸€ä¸ªåŒ…çš„å‰©ä½™éƒ¨åˆ†è¿›è¡Œåˆå¹¶å³å¯ï¼›&lt;/li&gt;
&lt;li&gt;ä»¿ç…§TCP/IPåè®®æ ˆï¼Œå°†æ¶ˆæ¯åˆ†ä¸ºheaderå’Œbodyï¼Œåœ¨headä¸­ä¿å­˜æœ‰å½“å‰æ•´ä¸ªæ¶ˆæ¯çš„é•¿åº¦ï¼Œåªæœ‰åœ¨è¯»å–åˆ°è¶³å¤Ÿé•¿åº¦çš„æ¶ˆæ¯ä¹‹åæ‰ç®—æ˜¯è¯»åˆ°äº†ä¸€ä¸ªå®Œæ•´çš„æ¶ˆæ¯ï¼›&lt;/li&gt;
&lt;li&gt;é€šè¿‡è‡ªå®šä¹‰åè®®è¿›è¡Œç²˜åŒ…å’Œæ‹†åŒ…çš„å¤„ç†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="nettyå¦‚ä½•è§£å†³çš„"&gt;Nettyå¦‚ä½•è§£å†³çš„ï¼Ÿ
&lt;/h2&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯åŸºäºä¸Šè¿°ç¬¬3ç‚¹å®ç°çš„&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;span class="lnt"&gt;22
&lt;/span&gt;&lt;span class="lnt"&gt;23
&lt;/span&gt;&lt;span class="lnt"&gt;24
&lt;/span&gt;&lt;span class="lnt"&gt;25
&lt;/span&gt;&lt;span class="lnt"&gt;26
&lt;/span&gt;&lt;span class="lnt"&gt;27
&lt;/span&gt;&lt;span class="lnt"&gt;28
&lt;/span&gt;&lt;span class="lnt"&gt;29
&lt;/span&gt;&lt;span class="lnt"&gt;30
&lt;/span&gt;&lt;span class="lnt"&gt;31
&lt;/span&gt;&lt;span class="lnt"&gt;32
&lt;/span&gt;&lt;span class="lnt"&gt;33
&lt;/span&gt;&lt;span class="lnt"&gt;34
&lt;/span&gt;&lt;span class="lnt"&gt;35
&lt;/span&gt;&lt;span class="lnt"&gt;36
&lt;/span&gt;&lt;span class="lnt"&gt;37
&lt;/span&gt;&lt;span class="lnt"&gt;38
&lt;/span&gt;&lt;span class="lnt"&gt;39
&lt;/span&gt;&lt;span class="lnt"&gt;40
&lt;/span&gt;&lt;span class="lnt"&gt;41
&lt;/span&gt;&lt;span class="lnt"&gt;42
&lt;/span&gt;&lt;span class="lnt"&gt;43
&lt;/span&gt;&lt;span class="lnt"&gt;44
&lt;/span&gt;&lt;span class="lnt"&gt;45
&lt;/span&gt;&lt;span class="lnt"&gt;46
&lt;/span&gt;&lt;span class="lnt"&gt;47
&lt;/span&gt;&lt;span class="lnt"&gt;48
&lt;/span&gt;&lt;span class="lnt"&gt;49
&lt;/span&gt;&lt;span class="lnt"&gt;50
&lt;/span&gt;&lt;span class="lnt"&gt;51
&lt;/span&gt;&lt;span class="lnt"&gt;52
&lt;/span&gt;&lt;span class="lnt"&gt;53
&lt;/span&gt;&lt;span class="lnt"&gt;54
&lt;/span&gt;&lt;span class="lnt"&gt;55
&lt;/span&gt;&lt;span class="lnt"&gt;56
&lt;/span&gt;&lt;span class="lnt"&gt;57
&lt;/span&gt;&lt;span class="lnt"&gt;58
&lt;/span&gt;&lt;span class="lnt"&gt;59
&lt;/span&gt;&lt;span class="lnt"&gt;60
&lt;/span&gt;&lt;span class="lnt"&gt;61
&lt;/span&gt;&lt;span class="lnt"&gt;62
&lt;/span&gt;&lt;span class="lnt"&gt;63
&lt;/span&gt;&lt;span class="lnt"&gt;64
&lt;/span&gt;&lt;span class="lnt"&gt;65
&lt;/span&gt;&lt;span class="lnt"&gt;66
&lt;/span&gt;&lt;span class="lnt"&gt;67
&lt;/span&gt;&lt;span class="lnt"&gt;68
&lt;/span&gt;&lt;span class="lnt"&gt;69
&lt;/span&gt;&lt;span class="lnt"&gt;70
&lt;/span&gt;&lt;span class="lnt"&gt;71
&lt;/span&gt;&lt;span class="lnt"&gt;72
&lt;/span&gt;&lt;span class="lnt"&gt;73
&lt;/span&gt;&lt;span class="lnt"&gt;74
&lt;/span&gt;&lt;span class="lnt"&gt;75
&lt;/span&gt;&lt;span class="lnt"&gt;76
&lt;/span&gt;&lt;span class="lnt"&gt;77
&lt;/span&gt;&lt;span class="lnt"&gt;78
&lt;/span&gt;&lt;span class="lnt"&gt;79
&lt;/span&gt;&lt;span class="lnt"&gt;80
&lt;/span&gt;&lt;span class="lnt"&gt;81
&lt;/span&gt;&lt;span class="lnt"&gt;82
&lt;/span&gt;&lt;span class="lnt"&gt;83
&lt;/span&gt;&lt;span class="lnt"&gt;84
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * Create a frame out of the {@link ByteBuf} and return it.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @param ctx the {@link ChannelHandlerContext} which this {@link ByteToMessageDecoder} belongs to
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @param in the {@link ByteBuf} from which to read data
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @return the {@link ByteBuf} frame, or {@code null} if no frame could be created.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; */&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;protected&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ChannelHandlerContext&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ctx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ByteBuf&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;throws&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Exception&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLength&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// frameLengthInt æ˜¯ç±»çš„æˆå‘˜å˜é‡ï¼Œç”¨äºè®°å½•å½“å‰å¾…åˆ‡å¸§çš„ â€œç›®æ ‡å¸§æ€»é•¿åº¦â€&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åˆå§‹åŒ–ä¸º -1 è¡¨ç¤º â€œè¿˜æ²¡ç¡®å®šå½“å‰å¸§é•¿åº¦ (new frame)â€&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;frameLengthInt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// new frame&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è‹¥ä¹‹å‰å¤„äºä¸¢å¼ƒæ¨¡å¼ï¼Œå…ˆæ‰§è¡Œä¸¢å¼ƒé€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;discardingTooLongFrame&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;discardingTooLongFrame&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç¼“å†²åŒºæœªåˆ°è¾¾é•¿åº¦å­—æ®µç»“æŸä½ç½®ï¼Œæ— æ³•å¾—å‡ºå¸§é•¿ â†’ ç­‰å¾…æ›´å¤šå­—èŠ‚&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;readableBytes&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lengthFieldEndOffset&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è®¡ç®—é•¿åº¦å­—æ®µåœ¨ç¼“å†²åŒºä¸­çš„çœŸå®åç§»&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;actualLengthFieldOffset&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;readerIndex&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lengthFieldOffset&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è¯»å–åŸå§‹é•¿åº¦å€¼&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLength&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;getUnadjustedFrameLength&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;actualLengthFieldOffset&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lengthFieldLength&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;byteOrder&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é•¿åº¦å€¼ä¸èƒ½ä¸ºè´Ÿ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;frameLength&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;failOnNegativeLengthField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLength&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lengthFieldEndOffset&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åŠ ä¸Š lengthAdjustment å’Œ header é•¿åº¦ï¼ˆlengthFieldEndOffsetï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLength&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lengthAdjustment&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lengthFieldEndOffset&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ ¡éªŒï¼šæ•´å¸§é•¿åº¦ä¸åº”å°äº header&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;frameLength&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lengthFieldEndOffset&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;failOnFrameLengthLessThanLengthFieldEndOffset&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLength&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lengthFieldEndOffset&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ ¡éªŒï¼šå¸§æ˜¯å¦è¶…è¿‡æœ€å¤§å¤§å°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;frameLength&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;maxFrameLength&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exceededFrameLength&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLength&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¿å­˜æœ€ç»ˆå¸§é•¿åº¦ï¼ˆä¸ä¼šæº¢å‡ºï¼Œå› ä¸ºå·²ä¿è¯ &amp;lt; maxFrameLengthï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLengthInt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLength&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å½“å‰å¸§é•¿åº¦å·²ç¡®å®šï¼Œæ£€æŸ¥æ˜¯å¦æ”¶åˆ°å…¨éƒ¨æ•°æ®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;readableBytes&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLengthInt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ•°æ®ä¸è¶³ â†’ åŠåŒ… â†’ ç­‰å¾…æ›´å¤šå­—èŠ‚&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ ¡éªŒï¼šstrip çš„å­—èŠ‚ä¸åº”è¶…è¿‡å¸§é•¿åº¦&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;initialBytesToStrip&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLengthInt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;failOnFrameLengthLessThanInitialBytesToStrip&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLength&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;initialBytesToStrip&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è·³è¿‡ initialBytesToStrip å­—èŠ‚ï¼ˆé€šå¸¸æ˜¯è·³è¿‡ header/length-fieldï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;skipBytes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;initialBytesToStrip&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// extract frame&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;readerIndex&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;readerIndex&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;actualFrameLength&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLengthInt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;initialBytesToStrip&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ByteBuf&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;extractFrame&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ctx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;readerIndex&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;actualFrameLength&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç§»åŠ¨ readerIndexï¼Œè·³è¿‡æ•´å¸§&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;readerIndex&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;readerIndex&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;actualFrameLength&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é‡ç½®ï¼Œå‡†å¤‡ä¸‹ä¸€å¸§&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLengthInt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿˜æœ‰ FixedLengthFrameDecoder (å›ºå®šåŒ…é•¿) DelimiterBasedFrameDecoder(åŸºäºåˆ†éš”ç¬¦)&lt;/p&gt;
&lt;h2 id="udpæœ‰æ²¡æœ‰è¿™ç§æƒ…å†µ"&gt;UDPæœ‰æ²¡æœ‰è¿™ç§æƒ…å†µ
&lt;/h2&gt;&lt;p&gt;ä¸ä¼šå‡ºç°ï¼Œå› ä¸º UDP æ˜¯åŸºäºâ€œæ•°æ®æŠ¥ï¼ˆDatagramï¼‰â€çš„æ¶ˆæ¯åè®®ã€‚
UDPç‰¹æ€§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰æ¶ˆæ¯è¾¹ç•Œ&lt;/li&gt;
&lt;li&gt;ä¸€æ¬¡è¯»å–æ°¸è¿œå¯¹åº”ä¸€æ¬¡ sendto() çš„åŒ…&lt;/li&gt;
&lt;li&gt;è¦ä¹ˆæ•´åŒ…æ”¶åˆ°&lt;/li&gt;
&lt;li&gt;è¦ä¹ˆä¸¢åŒ…&lt;/li&gt;
&lt;li&gt;ä¸ä¼šç²˜ï¼Œä¸ä¼šæ‹†&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>Hugoå¸¸ç”¨å‘½ä»¤</title><link>https://0607pass.github.io/Blog/p/hugo%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</link><pubDate>Sun, 07 Dec 2025 16:52:54 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/hugo%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</guid><description>&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;hugo new content/post/&lt;span class="s2"&gt;&amp;#34;titile&amp;#34;&lt;/span&gt;/index.md
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# è®© Hugo æ¸²æŸ“è‰ç¨¿ï¼ˆdraftï¼‰å†…å®¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;hugo server -D
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# å…³é—­ Hugo çš„â€œå¿«é€Ÿæ¸²æŸ“â€æ¨¡å¼ Hugo åœ¨æœ¬åœ°é¢„è§ˆæ—¶æœ‰ä¸€ä¸ªä¼˜åŒ–æœºåˆ¶ï¼šFast Renderï¼ˆå¿«é€Ÿæ¸²æŸ“ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# å®ƒåªé‡æ–°æ¸²æŸ“ä½ ä¿®æ”¹è¿‡çš„éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯é‡æ–°æ„å»ºæ•´ä¸ªç«™ç‚¹ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;hugo server --disableFastRender
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# è‡ªåŠ¨éƒ¨ç½²åˆ°github&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;git add .
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;git commit -m &lt;span class="s2"&gt;&amp;#34;commit messages&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;git push origin master
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# ç­‰å¾…è‡ªåŠ¨éƒ¨ç½²&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</description></item><item><title>Springäº‹åŠ¡å¤±æ•ˆçš„æƒ…å†µ</title><link>https://0607pass.github.io/Blog/p/spring%E4%BA%8B%E5%8A%A1%E5%A4%B1%E6%95%88%E7%9A%84%E6%83%85%E5%86%B5/</link><pubDate>Sun, 07 Dec 2025 16:39:20 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/spring%E4%BA%8B%E5%8A%A1%E5%A4%B1%E6%95%88%E7%9A%84%E6%83%85%E5%86%B5/</guid><description>&lt;img src="https://0607pass.github.io/Blog/images/postCover/spring.png" alt="Featured image of post Springäº‹åŠ¡å¤±æ•ˆçš„æƒ…å†µ" /&gt;&lt;p&gt;Springä¸­æ¯”è¾ƒå®¹æ˜“å¤±æ•ˆçš„å°±æ˜¯é€šè¿‡@Transactional å®šä¹‰çš„å£°æ˜å¼äº‹åŠ¡ï¼Œä»–åœ¨ä»¥ä¸‹å‡ ä¸ªåœºæ™¯ä¸­ä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆï¼Œé¦–å…ˆï¼Œå°±æ˜¯Springçš„@Transactionalæ˜¯åŸºäºSpringçš„AOPæœºåˆ¶å®ç°çš„ï¼Œè€ŒAOPæœºåˆ¶åˆæ˜¯åŸºäºåŠ¨æ€ä»£ç†å®ç°çš„ã€‚é‚£ä¹ˆå¦‚æœä»£ç†å¤±æ•ˆäº†ï¼Œäº‹åŠ¡ä¹Ÿå°±ä¼šå¤±æ•ˆã€‚&lt;/p&gt;
&lt;h1 id="ä»€ä¹ˆæƒ…å†µä¸‹ä»£ç†ä¼šç”Ÿæ•ˆ"&gt;ä»€ä¹ˆæƒ…å†µä¸‹ä»£ç†ä¼šç”Ÿæ•ˆ
&lt;/h1&gt;&lt;h2 id="transactional-åº”ç”¨åœ¨é-public-ä¿®é¥°çš„æ–¹æ³•ä¸Š"&gt;@Transactional åº”ç”¨åœ¨é public ä¿®é¥°çš„æ–¹æ³•ä¸Š
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MyService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;doInternal&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Doing internal work...&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;privateæ–¹æ³•ï¼Œåªä¼šåœ¨å½“å‰å¯¹è±¡ä¸­çš„å…¶ä»–æ–¹æ³•ä¸­è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯ä¼šè¿›è¡Œå¯¹è±¡çš„è‡ªè°ƒç”¨ï¼Œè¿™ç§æƒ…å†µæ˜¯ç”¨thisè°ƒç”¨çš„ï¼Œå¹¶ä¸ä¼šèµ°åˆ°ä»£ç†å¯¹è±¡ï¼Œè€Œ@Transactionalæ˜¯åŸºäºåŠ¨æ€ä»£ç†å®ç°çš„ï¼Œæ‰€ä»¥ä»£ç†ä¼šå¤±æ•ˆã€‚&lt;/p&gt;
&lt;h2 id="åŒä¸€ä¸ªç±»ä¸­æ–¹æ³•è°ƒç”¨å¯¼è‡´transactionalå¤±æ•ˆ"&gt;åŒä¸€ä¸ªç±»ä¸­æ–¹æ³•è°ƒç”¨ï¼Œå¯¼è‡´@Transactionalå¤±æ•ˆ
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MyService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;doSomething&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;doInternal&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è‡ªè°ƒç”¨æ–¹æ³•&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;doInternal&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Doing internal work...&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æ ¹æœ¬ä¸ä¼šèµ°ä»£ç†&lt;/p&gt;
&lt;h2 id="finalstaticæ–¹æ³•"&gt;finalã€staticæ–¹æ³•
&lt;/h2&gt;&lt;p&gt;ç”±äºAOPæ˜¯é€šè¿‡åˆ›å»ºä»£ç†å¯¹è±¡æ¥å®ç°çš„ï¼Œè€Œæ— æ³•å¯¹finalæ–¹æ³•è¿›è¡Œå­ç±»åŒ–å’Œè¦†ç›–ï¼Œæ‰€ä»¥æ— æ³•æ‹¦æˆªè¿™äº›æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰å°±æ˜¯è°ƒç”¨staticæ–¹æ³•ï¼Œå› ä¸ºè¿™ç±»æ–¹æ³•æ˜¯å±äºè¿™ä¸ªç±»çš„ï¼Œå¹¶ä¸æ˜¯å¯¹è±¡çš„ï¼Œæ‰€ä»¥æ— æ³•è¢«AOPã€‚&lt;/p&gt;
&lt;h2 id="æ²¡æœ‰ä»£ç†"&gt;æ²¡æœ‰ä»£ç†
&lt;/h2&gt;&lt;p&gt;è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œé‚£å°±æ˜¯æ ¹æœ¬å°±æ²¡æœ‰ä»£ç†å¯¹è±¡ï¼Œæ¯”å¦‚è¯´ä½ çš„Beanæ²¡æœ‰è¢«Springç®¡ç†ï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰é€šè¿‡@Serviceç­‰æ³¨è§£æŠŠä»–æ ‡æ³¨æˆä¸€ä¸ªBeanï¼Œè€Œæ˜¯è‡ªå·±newäº†ä¸€ä¸ªçš„è¯ï¼Œé‚£é‡Œé¢çš„æ–¹æ³•å°±ä¹Ÿä¼šäº‹åŠ¡å¤±æ•ˆã€‚&lt;/p&gt;
&lt;h2 id="transactionalç”¨çš„ä¸å¯¹"&gt;@Transactionalç”¨çš„ä¸å¯¹
&lt;/h2&gt;&lt;p&gt;1 ã€ @Transactional æ³¨è§£å±æ€§ propagation è®¾ç½®é”™è¯¯&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;span class="lnt"&gt;22
&lt;/span&gt;&lt;span class="lnt"&gt;23
&lt;/span&gt;&lt;span class="lnt"&gt;24
&lt;/span&gt;&lt;span class="lnt"&gt;25
&lt;/span&gt;&lt;span class="lnt"&gt;26
&lt;/span&gt;&lt;span class="lnt"&gt;27
&lt;/span&gt;&lt;span class="lnt"&gt;28
&lt;/span&gt;&lt;span class="lnt"&gt;29
&lt;/span&gt;&lt;span class="lnt"&gt;30
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ExampleService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ExampleRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;repository&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;propagation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Propagation&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;NOT_SUPPORTED&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodA&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;repository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;someDatabaseOperation&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;repository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;anotherDatabaseOperation&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SomeService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ExampleService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exampleService&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;doSomething&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è¿™é‡Œæ‰§è¡Œä¸€äº›ä¸šåŠ¡é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exampleService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;methodA&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è¿™ä¸ªæ–¹æ³•ç”±äº NOT_SUPPORTED å±æ€§ï¼Œä¼šåœ¨éäº‹åŠ¡ä¸‹æ‰§è¡Œ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exampleService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä»¥ä¸Šï¼Œå¦‚æœäº‹åŠ¡å‘ç”Ÿå›æ»šï¼Œåˆ™methodAå¹¶ä¸ä¼šå›æ»šã€‚å› ä¸ºä»–çš„propagationæ˜¯ä¸æ”¯æŒäº‹åŠ¡ï¼Œé‚£ä¹ˆå®ƒå°±ä¸ä¼šä¸€èµ·å›æ»šã€‚&lt;/p&gt;
&lt;p&gt;2ã€@Transactional æ³¨è§£å±æ€§ rollbackFor è®¾ç½®é”™è¯¯&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MyService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rollbackFor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RuntimeException&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;doInternal&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Doing internal work...&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä»¥ä¸Šï¼Œå¦‚æœå‘ç”ŸéRuntimeExceptionï¼Œåˆ™äº‹åŠ¡ä¸ä¼šå›æ»šï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆã€‚æ‰€ä»¥éœ€è¦æŒ‡å®šä¸º(rollbackFor = Exception.class)&lt;/p&gt;
&lt;h2 id="å¼‚å¸¸è¢«æ•è·"&gt;å¼‚å¸¸è¢«æ•è·
&lt;/h2&gt;&lt;p&gt;å¼‚å¸¸è¢«catchæ•è·å¯¼è‡´@Transactionalå¤±æ•ˆ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MyService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;doSomething&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;doInternal&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Exception&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å› ä¸ºå¼‚å¸¸è¢«æ•è·ï¼Œæ‰€ä»¥å°±æ²¡åŠæ³•åŸºäºå¼‚å¸¸è¿›è¡Œrollbackäº†ï¼Œæ‰€ä»¥äº‹åŠ¡ä¼šå¤±æ•ˆã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œä½ åœ¨æ–¹æ³•ä¸ŠåŠ äº†å¦å¤–ä¸€ä¸ªæ³¨è§£ï¼Œé‚£ä¸ªæ³¨è§£çš„AOPé‡Œé¢æ•è·äº†å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;h2 id="äº‹åŠ¡ä¸­ç”¨äº†å¤šçº¿ç¨‹"&gt;äº‹åŠ¡ä¸­ç”¨äº†å¤šçº¿ç¨‹
&lt;/h2&gt;&lt;p&gt;@Transactional çš„äº‹åŠ¡ç®¡ç†ä½¿ç”¨çš„æ˜¯ ThreadLocal æœºåˆ¶æ¥å­˜å‚¨äº‹åŠ¡ä¸Šä¸‹æ–‡ï¼Œè€Œ ThreadLocal å˜é‡æ˜¯çº¿ç¨‹éš”ç¦»çš„ï¼Œå³æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„äº‹åŠ¡ä¸Šä¸‹æ–‡å‰¯æœ¬ã€‚å› æ­¤ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼ŒSpring çš„å£°æ˜å¼äº‹åŠ¡ä¼šå¤±æ•ˆï¼Œå³æ–°çº¿ç¨‹ä¸­çš„æ“ä½œä¸ä¼šè¢«åŒ…å«åœ¨åŸæœ‰çš„äº‹åŠ¡ä¸­ã€‚&lt;/p&gt;
&lt;h2 id="æ•°æ®åº“ä¸æ”¯æŒäº‹åŠ¡"&gt;æ•°æ®åº“ä¸æ”¯æŒäº‹åŠ¡
&lt;/h2&gt;&lt;p&gt;å¦‚myisamï¼Œä¸æ”¯æŒçš„è‚¯å®šå°±ä¸è¡Œäº†ã€‚&lt;/p&gt;</description></item></channel></rss>