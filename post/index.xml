<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on XFFF çš„ç‹¬ç«‹åšå®¢</title><link>https://0607pass.github.io/Blog/post/</link><description>Recent content in Posts on XFFF çš„ç‹¬ç«‹åšå®¢</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><copyright>Â© {year} XFFF</copyright><lastBuildDate>Mon, 01 Jan 0001 00:00:00 +0000</lastBuildDate><atom:link href="https://0607pass.github.io/Blog/post/index.xml" rel="self" type="application/rss+xml"/><item><title>Redisä¸­Hashæ•°æ®ç»“æ„ï¼ŒåŠrehash</title><link>https://0607pass.github.io/Blog/p/redis%E4%B8%ADhash%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8F%8Arehash/</link><pubDate>Thu, 11 Dec 2025 14:57:56 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/redis%E4%B8%ADhash%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%8F%8Arehash/</guid><description>&lt;img src="https://0607pass.github.io/Blog/images/postCover/redis.png" alt="Featured image of post Redisä¸­Hashæ•°æ®ç»“æ„ï¼ŒåŠrehash" /&gt;&lt;h2 id="hashæ•°æ®ç»“æ„"&gt;Hashæ•°æ®ç»“æ„
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-c" data-lang="c"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;struct&lt;/span&gt; &lt;span class="n"&gt;dict&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;dictType&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="cm"&gt;/*æŒ‡å‘ä¸¤ä¸ªht_table ç”¨æ¥rehash */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;dictEntry&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;ht_table&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="kt"&gt;long&lt;/span&gt; &lt;span class="n"&gt;ht_used&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;long&lt;/span&gt; &lt;span class="n"&gt;rehashidx&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* rehashing not in progress if rehashidx == -1 */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="cm"&gt;/* Keep small vars at end for optimal (minimal) struct padding */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;int16_t&lt;/span&gt; &lt;span class="n"&gt;pauserehash&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* If &amp;gt;0 rehashing is paused (&amp;lt;0 indicates coding error) */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;signed&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;ht_size_exp&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt; &lt;span class="cm"&gt;/* exponent of size. (size = 1&amp;lt;&amp;lt;exp) */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;dictType å¹²ä»€ä¹ˆç”¨çš„ï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å¦ä¸€ä¸ªç»“æ„ä½“ &lt;code&gt;dictType&lt;/code&gt;ï¼Œå®ƒå®šä¹‰äº†è¿™ä¸ªå­—å…¸çš„â€œè¡Œä¸ºå‡½æ•°â€ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚ä½•è®¡ç®— key çš„å“ˆå¸Œå€¼ï¼ˆ&lt;code&gt;hashFunction&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;å¦‚ä½•æ¯”è¾ƒ key æ˜¯å¦ç›¸ç­‰ï¼ˆ&lt;code&gt;keyCompare&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;å¦‚ä½•é‡Šæ”¾å†…å­˜ï¼ˆ&lt;code&gt;keyDestructor&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;dictEntry **ht_table[2] ä»€ä¹ˆä½œç”¨&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«ä¸¤ä¸ªæŒ‡é’ˆï¼Œæ¯ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªâ€œå“ˆå¸Œæ¡¶æ•°ç»„â€ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼ŒRedis çš„å­—å…¸ç»“æ„åŒ…å« &lt;strong&gt;ä¸¤ä¸ªå“ˆå¸Œè¡¨&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¯ä¸ª &lt;code&gt;ht_table[i]&lt;/code&gt; æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ˆæ•°ç»„é‡Œçš„æ¯ä¸€é¡¹éƒ½æ˜¯é“¾è¡¨å¤´ &lt;code&gt;dictEntry*&lt;/code&gt;ï¼‰ï¼Œç”¨æ¥å¤„ç†å“ˆå¸Œå†²çªã€‚&lt;/p&gt;
&lt;h2 id="ä¸ºä»€ä¹ˆæœ‰ä¸¤ä¸ªå“ˆå¸Œè¡¨"&gt;ä¸ºä»€ä¹ˆæœ‰ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Ÿ
&lt;/h2&gt;&lt;p&gt;ä¸ºäº†æ”¯æŒ &lt;strong&gt;æ¸è¿›å¼ rehashï¼ˆæ…¢æ…¢è¿ç§»ï¼Œä¸ä¸€æ¬¡è¿ç§»æ‰€æœ‰é”®ï¼‰&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Redis ä¼šå…ˆåœ¨ &lt;code&gt;ht_table[0]&lt;/code&gt; ä¸Šå·¥ä½œã€‚&lt;/li&gt;
&lt;li&gt;å½“éœ€è¦æ‰©å®¹æˆ–ç¼©å®¹æ—¶ï¼Œä¼šç”³è¯·æ–°çš„å“ˆå¸Œè¡¨ &lt;code&gt;ht_table[1]&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åé€æ­¥æŠŠæ—§æ•°æ®ä» &lt;code&gt;ht_table[0]&lt;/code&gt; è¿ç§»åˆ° &lt;code&gt;ht_table[1]&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™æ ·é¿å…äº†æš‚åœæ•´ä¸ªæœåŠ¡å™¨åš rehash çš„é—®é¢˜ï¼Œæå‡å“åº”æ€§ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;unsigned long ht_used[2]&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™ä¸ªæ•°ç»„è®°å½•äº†ä¸¤ä¸ªå“ˆå¸Œè¡¨ä¸­å®é™…å­˜å‚¨äº†å¤šå°‘ä¸ªé”®å€¼å¯¹ï¼ˆèŠ‚ç‚¹ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ht_used[0]&lt;/code&gt;: ä¸»è¡¨å·²ç”¨çš„ entry æ•°é‡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ht_used[1]&lt;/code&gt;: è¿ç§»ç›®æ ‡è¡¨çš„ entry æ•°é‡ï¼ˆrehash æœŸé—´ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;long rehashidx;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;rehash çš„&lt;strong&gt;å½“å‰ä½ç½®ç´¢å¼•&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœç­‰äº &lt;code&gt;-1&lt;/code&gt;ï¼Œè¡¨ç¤ºå½“å‰æ²¡æœ‰åœ¨è¿›è¡Œ rehashï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœå¤§äºç­‰äº &lt;code&gt;0&lt;/code&gt;ï¼Œè¯´æ˜æ­£åœ¨è¿›è¡Œ rehashï¼Œå€¼è¡¨ç¤ºå½“å‰å·²ç»è¿ç§»åˆ°å“ªä¸€ä¸ªæ¡¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Redis æ¯æ¬¡æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œä¼šé¡ºä¾¿è¿ç§»ä¸€å°éƒ¨åˆ†æ¡¶ï¼ˆæ¸è¿›å¼è¿ç§»ï¼‰ï¼Œé€šè¿‡è¿™ä¸ªå˜é‡è·Ÿè¸ªè¿›åº¦ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;int16_t pauserehash;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ˜¯å¦æš‚åœ rehash æ“ä½œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;0&lt;/code&gt;ï¼šæ­£å¸¸&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;gt;0&lt;/code&gt;ï¼šrehash è¢«æš‚æ—¶æš‚åœï¼ˆæŸäº›å‘½ä»¤æˆ–æ“ä½œæœŸé—´ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&amp;lt;0&lt;/code&gt;ï¼šè¡¨ç¤ºæœ‰ bugï¼ŒRedis ä¼šæŠ¥é”™ï¼ˆç†è®ºä¸Šä¸ä¼šå‡ºç°ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;signed char ht_size_exp[2];&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¡¨ç¤ºä¸¤ä¸ªå“ˆå¸Œè¡¨çš„&lt;strong&gt;å¤§å°çš„æŒ‡æ•°&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å“ˆå¸Œè¡¨çš„å®¹é‡æ˜¯ &lt;code&gt;2 çš„å¹‚æ¬¡æ–¹&lt;/code&gt;ï¼Œå³ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-c" data-lang="c"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;ht_size_exp&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¿™æ¯”å­˜å‚¨å®é™…å¤§å°æ›´èŠ‚çœç©ºé—´ï¼Œè€Œä¸”æ–¹ä¾¿ Redis ä½¿ç”¨ä½è¿ç®—è®¡ç®—å“ˆå¸Œå€¼å’Œæ¡¶ä½ç½®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="å“ˆå¸Œè¡¨çš„æ•°æ®ç»“æ„"&gt;å“ˆå¸Œè¡¨çš„æ•°æ®ç»“æ„
&lt;/h1&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-c" data-lang="c"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;typedef&lt;/span&gt; &lt;span class="k"&gt;struct&lt;/span&gt; &lt;span class="n"&gt;dictEntry&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;union&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;val&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;uint64_t&lt;/span&gt; &lt;span class="n"&gt;u64&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;int64_t&lt;/span&gt; &lt;span class="n"&gt;s64&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;double&lt;/span&gt; &lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="n"&gt;v&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;struct&lt;/span&gt; &lt;span class="n"&gt;dictEntry&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;next&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* Next entry in the same hash bucket. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;[];&lt;/span&gt; &lt;span class="cm"&gt;/* An arbitrary number of bytes (starting at a
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * pointer-aligned address) of size as returned
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * by dictType&amp;#39;s dictEntryMetadataBytes(). */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="n"&gt;dictEntry&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;dictEntry ç»“æ„é‡Œé”®å€¼å¯¹ä¸­çš„å€¼æ˜¯ä¸€ä¸ªã€Œè”åˆä½“ vã€å®šä¹‰çš„ï¼Œå› æ­¤ï¼Œé”®å€¼å¯¹ä¸­çš„å€¼å¯ä»¥æ˜¯ä¸€ä¸ªæŒ‡å‘å®é™…å€¼çš„æŒ‡é’ˆï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªæ— ç¬¦å·çš„ 64 ä½æ•´æ•°æˆ–æœ‰ç¬¦å·çš„ 64 ä½æ•´æ•°æˆ–double ç±»çš„å€¼ã€‚è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯å¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´ï¼Œå› ä¸ºå½“ã€Œå€¼ã€æ˜¯æ•´æ•°æˆ–æµ®ç‚¹æ•°æ—¶ï¼Œå°±å¯ä»¥å°†å€¼çš„æ•°æ®å†…åµŒåœ¨ dictEntry ç»“æ„é‡Œï¼Œæ— éœ€å†ç”¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å®é™…çš„å€¼ï¼Œä»è€ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ã€‚&lt;/p&gt;</description></item><item><title>Redissonä¸­çš„Watch Dogæœºåˆ¶</title><link>https://0607pass.github.io/Blog/p/redisson%E4%B8%AD%E7%9A%84watch-dog%E6%9C%BA%E5%88%B6/</link><pubDate>Thu, 11 Dec 2025 14:57:05 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/redisson%E4%B8%AD%E7%9A%84watch-dog%E6%9C%BA%E5%88%B6/</guid><description>&lt;img src="https://0607pass.github.io/Blog/images/postCover/redis.png" alt="Featured image of post Redissonä¸­çš„Watch Dogæœºåˆ¶" /&gt;&lt;h1 id="redissonä¸­é»˜è®¤é”è¡Œä¸º"&gt;Redissonä¸­é»˜è®¤é”è¡Œä¸º
&lt;/h1&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;RLock&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lock&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;redisson&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getLock&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;anyLock&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="n"&gt;lock&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;lock&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;ä¸æŒ‡å®šè¿‡æœŸæ—¶é—´ï¼›&lt;/li&gt;
&lt;li&gt;é»˜è®¤ç”±çœ‹é—¨ç‹—æœºåˆ¶æ§åˆ¶é”çš„ç”Ÿå‘½å‘¨æœŸï¼›&lt;/li&gt;
&lt;li&gt;é»˜è®¤é”è¿‡æœŸæ—¶é—´ä¸º 30 ç§’ï¼›&lt;/li&gt;
&lt;li&gt;æ¯ 10 ç§’è‡ªåŠ¨ç»­æœŸï¼ˆå³ï¼šæ¯æ¬¡é‡è®¾ä¸º 30 ç§’åè¿‡æœŸï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="ä¸ºä»€ä¹ˆé€‰æ‹©æ¯10ç§’ç»­æœŸ"&gt;ä¸ºä»€ä¹ˆé€‰æ‹©æ¯10ç§’ç»­æœŸ
&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;æœ‰å®¹é”™ï¼Œå¦‚ä½•æœ‰ç½‘ç»œå¼‚å¸¸å¯¼è‡´ç¬¬ä¸€æ¬¡ç»­æœŸæ²¡æœ‰æˆåŠŸåˆ™è¿˜æœ‰2 æœºä¼šã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœç»­æœŸå¤ªé¢‘ç¹ï¼ˆå¦‚æ¯ 1 ç§’ï¼‰ï¼Œä¼šå¢åŠ  Redis çš„å‹åŠ›ï¼ˆé¢‘ç¹ PEXPIRE è°ƒç”¨ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœç»­æœŸå¤ªå°‘ï¼ˆæ¯”å¦‚ 25 ç§’æ‰ç»­æœŸä¸€æ¬¡ï¼‰ï¼Œå®¹é”™ç©ºé—´å¤ªå°ï¼Œä¸€æ—¦æŸä¸€æ¬¡å¤±è´¥å°±ä¼šå¾ˆå±é™©ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="é»˜è®¤è¿‡æœŸæ—¶é—´30ç§’å¯ä»¥ä¿®æ”¹"&gt;é»˜è®¤è¿‡æœŸæ—¶é—´30ç§’å¯ä»¥ä¿®æ”¹
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;lockWatchdogTimeout
Redisson ä¼šä»¥ lockWatchdogTimeout / 3 çš„é¢‘ç‡è¿›è¡Œç»­æœŸã€‚&lt;/p&gt;
&lt;/blockquote&gt;</description></item><item><title>Redisæœ‰å“ªäº›å·§å¦™çš„è®¾è®¡ï¼Œä¸¾å‡ ä¸ªä¾‹å­</title><link>https://0607pass.github.io/Blog/p/redis%E6%9C%89%E5%93%AA%E4%BA%9B%E5%B7%A7%E5%A6%99%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%BE%E5%87%A0%E4%B8%AA%E4%BE%8B%E5%AD%90/</link><pubDate>Thu, 11 Dec 2025 14:54:01 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/redis%E6%9C%89%E5%93%AA%E4%BA%9B%E5%B7%A7%E5%A6%99%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%BE%E5%87%A0%E4%B8%AA%E4%BE%8B%E5%AD%90/</guid><description>&lt;img src="https://0607pass.github.io/Blog/images/postCover/redis.png" alt="Featured image of post Redisæœ‰å“ªäº›å·§å¦™çš„è®¾è®¡ï¼Œä¸¾å‡ ä¸ªä¾‹å­" /&gt;&lt;h1 id="5ä¸ªæ–¹é¢"&gt;5ä¸ªæ–¹é¢
&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;çº¿ç¨‹æ¨¡å‹ã€æ•°æ®ç»“æ„ã€å…±äº«å¯¹è±¡æ± ã€è¿‡æœŸè®¾è®¡ã€æ•°æ®æŒä¹…åŒ–è®¾è®¡&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id="ä¸€çº¿ç¨‹æ¨¡å‹"&gt;ä¸€ã€çº¿ç¨‹æ¨¡å‹
&lt;/h2&gt;&lt;p&gt;Redis ä½¿ç”¨&lt;strong&gt;å•çº¿ç¨‹æ¨¡å‹&lt;/strong&gt;æ¥å¤„ç†æ‰€æœ‰çš„å®¢æˆ·ç«¯è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶çœ‹ä¼¼å•çº¿ç¨‹ç®€å•ï¼Œä½†è¿™ç§è®¾è®¡å‡å°‘äº†ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œé”çš„å¼€é”€ï¼Œé¿å…äº†å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­çš„å¤æ‚æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å¹¶ä¸”é€šè¿‡&lt;strong&gt;å¤šè·¯å¤ç”¨&lt;/strong&gt;ï¼ˆepollã€select ç­‰ï¼‰+ &lt;strong&gt;äº‹ä»¶é©±åŠ¨&lt;/strong&gt;æœºåˆ¶ï¼ŒRedis ä»ç„¶èƒ½å¤Ÿå¤„ç†å¤§é‡çš„å¹¶å‘è¿æ¥ã€‚&lt;/p&gt;
&lt;h2 id="äºŒæ•°æ®ç»“æ„"&gt;äºŒã€æ•°æ®ç»“æ„
&lt;/h2&gt;&lt;p&gt;Redis å¯¹å¾ˆå¤šæ•°æ®ç»“æ„è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¾‹å¦‚ sdsã€ziplistï¼Œè¿˜æœ‰å“ˆå¸Œè¡¨çš„æ‰©å®¹æœºåˆ¶ã€‚&lt;/p&gt;
&lt;h3 id="sdssimple-dynamic-string"&gt;SDS(Simple Dynamic String)
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-c" data-lang="c"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;struct&lt;/span&gt; &lt;span class="nf"&gt;__attribute__&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;__packed__&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="n"&gt;sdshdr16&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;uint16_t&lt;/span&gt; &lt;span class="n"&gt;len&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* used */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;uint16_t&lt;/span&gt; &lt;span class="n"&gt;alloc&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* excluding the header and null terminator */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;flags&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* 3 lsb of type, 5 unused bits */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;[];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åŠ¨æ€æ‰©å±•å’Œç©ºé—´é¢„åˆ†é…&lt;/strong&gt;ï¼šSDS æ”¯æŒè‡ªåŠ¨æ‰©å±•ã€‚å½“å­—ç¬¦ä¸²é•¿åº¦å¢åŠ æ—¶ï¼ŒSDS ä¼šè‡ªåŠ¨åˆ†é…æ›´å¤§çš„å†…å­˜ç©ºé—´ï¼Œå¹¶ä¸”é€šå¸¸ä¼šé¢å¤–é¢„ç•™ä¸€éƒ¨åˆ†ç©ºé—´ï¼Œå‡å°‘é¢‘ç¹çš„å†…å­˜åˆ†é…æ“ä½œï¼Œè¿™æ ·å°±é¿å…äº†æ¯æ¬¡ä¿®æ”¹å­—ç¬¦ä¸²æ—¶éƒ½éœ€è¦é‡æ–°åˆ†é…å†…å­˜çš„å¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äºŒè¿›åˆ¶å®‰å…¨:&lt;/strong&gt; ä¸ C å­—ç¬¦ä¸²ä¸åŒï¼ŒSDS æ”¯æŒå­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ï¼Œå› ä¸ºå®ƒä¸ä¼šä¾èµ–äºç©ºå­—ç¬¦ï¼ˆ&amp;rsquo;\0&amp;rsquo;ï¼‰æ¥æ ‡è¯†å­—ç¬¦ä¸²çš„ç»“æŸã€‚è¿™ä½¿å¾— SDS å¯ä»¥å®‰å…¨åœ°å­˜å‚¨å’Œå¤„ç†ä»»æ„äºŒè¿›åˆ¶æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¸¸æ•°æ—¶é—´è·å–å­—ç¬¦ä¸²çš„é•¿åº¦&lt;/strong&gt; ï¼šSDS ç»“æ„ä¸­ä¼šé¢å¤–å­˜å‚¨å­—ç¬¦ä¸²çš„å½“å‰é•¿åº¦ï¼Œè¿™ä½¿å¾—è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ“ä½œå¯ä»¥åœ¨ O(1) æ—¶é—´å†…å®Œæˆï¼Œè€Œä¸åƒ C å­—ç¬¦ä¸²é‚£æ ·éœ€è¦éå†æ•´ä¸ªå­—ç¬¦ä¸²æ¥è®¡ç®—é•¿åº¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é˜²æ­¢ç¼“å†²åŒºæº¢å‡º&lt;/strong&gt;ï¼šSDS é€šè¿‡ç»´æŠ¤åˆ†é…ç©ºé—´çš„æ€»é•¿åº¦å’Œå·²ç”¨é•¿åº¦ï¼Œèƒ½å¤Ÿæœ‰æ•ˆé˜²æ­¢ç¼“å†²åŒºæº¢å‡ºé—®é¢˜ã€‚è¿™åœ¨ä½¿ç”¨ C å­—ç¬¦ä¸²æ—¶æ˜¯ä¸€ä¸ªå¸¸è§çš„å®‰å…¨éšæ‚£ï¼Œä½†åœ¨ SDS ä¸­å¾—åˆ°äº†å¾ˆå¥½è§£å†³ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æƒ°æ€§ç©ºé—´é‡Šæ”¾&lt;/strong&gt; ï¼š å½“ SDS ä¸­çš„å­—ç¬¦ä¸²é•¿åº¦ç¼©çŸ­æ—¶ï¼Œå¹¶ä¸ä¼šç«‹å³ç¼©å‡å†…å­˜ç©ºé—´ï¼Œè€Œæ˜¯ä¼šä¿ç•™éƒ¨åˆ†ç¼©çŸ­åçš„ç©ºé—´ï¼Œè¿™æ ·å¯ä»¥é¿å…é¢‘ç¹çš„å†…å­˜é‡æ–°åˆ†é…æ“ä½œã€‚è¿™ç§ç­–ç•¥ä¹Ÿæ˜¯ Redis çš„å†…å­˜ä¼˜åŒ–çš„ä¸€éƒ¨åˆ†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="ziplistå‹ç¼©åˆ—è¡¨"&gt;ziplist(å‹ç¼©åˆ—è¡¨)
&lt;/h3&gt;&lt;p&gt;å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰æ˜¯ Redis ç”¨äºå®ç°åˆ—è¡¨å’Œå“ˆå¸Œè¡¨çš„åº•å±‚æ•°æ®ç»“æ„ä¹‹ä¸€ã€‚&lt;/p&gt;
&lt;p&gt;å½“åˆ—è¡¨æˆ–å“ˆå¸Œè¡¨ä¸­çš„æ•°æ®é‡è¾ƒå°ï¼Œä¸”å…ƒç´ é•¿åº¦è¾ƒçŸ­æ—¶ï¼ŒRedis ä¼šé€‰æ‹©ä½¿ç”¨å‹ç¼©åˆ—è¡¨æ¥å­˜å‚¨æ•°æ®ï¼Œ&lt;strong&gt;è¾¾åˆ°èŠ‚çœå†…å­˜æ¶ˆè€—çš„ç›®çš„&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å…³é”®è®¾è®¡å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å†…å­˜ç´§å‡‘ï¼šå‹ç¼©åˆ—è¡¨å°†æ‰€æœ‰å…ƒç´ ç´§å‡‘åœ°å­˜å‚¨åœ¨ä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œæ²¡æœ‰æŒ‡é’ˆç­‰é¢å¤–å¼€é”€ã€‚æ¯ä¸ªå…ƒç´ å‰éƒ½æœ‰ä¸€ä¸ªå‰å‘ç¼–ç å’Œåå‘ç¼–ç ï¼Œç”¨äºæŒ‡ç¤ºå‰ä¸€ä¸ªå…ƒç´ çš„é•¿åº¦ï¼Œè¿™æ ·å¯ä»¥å¿«é€Ÿåœ°è¿›è¡Œå‰åéå†ï¼Œé¿å…äº†é“¾è¡¨ä¸­æŒ‡é’ˆçš„é¢å¤–å¼€é”€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;çµæ´»æ€§ï¼šå‹ç¼©åˆ—è¡¨æ ¹æ®å­˜å‚¨çš„å…ƒç´ é•¿åº¦åŠ¨æ€è°ƒæ•´ç¼–ç æ–¹å¼ï¼Œå°äº 1 å­—èŠ‚çš„æ•´æ•°ã€1 å­—èŠ‚çš„æ•´æ•°ã€3 å­—èŠ‚çš„æ•´æ•°ç­‰ä¸åŒé•¿åº¦çš„ç¼–ç æ–¹å¼ï¼Œèƒ½å¤Ÿæå¤§åœ°èŠ‚çœå†…å­˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ€§èƒ½ä¸ç©ºé—´çš„å¹³è¡¡ï¼šå½“åˆ—è¡¨æˆ–å“ˆå¸Œè¡¨å˜å¾—å¾ˆå¤§æ—¶ï¼ŒRedis ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°æ›´é«˜æ•ˆçš„é“¾è¡¨æˆ–å“ˆå¸Œè¡¨ç»“æ„ã€‚è¿™ç§æŒ‰éœ€è°ƒæ•´çš„æ•°æ®ç»“æ„è®¾è®¡ï¼Œç¡®ä¿äº†åœ¨ä¸åŒåœºæ™¯ä¸‹çš„æ€§èƒ½æœ€ä¼˜ã€‚&lt;/p&gt;
&lt;h4 id="æ•´ä½“ç»“æ„å¸ƒå±€"&gt;æ•´ä½“ç»“æ„å¸ƒå±€
&lt;/h4&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;area |&amp;lt;---- ziplist header ----&amp;gt;|&amp;lt;----------- entries -------------&amp;gt;|&amp;lt;-end-&amp;gt;|
size 4 bytes 4 bytes 2 bytes ? ? ? 1 byte
+---------+--------+-------+--------+--------+--------+-------+
| zlbytes | zltail | zllen | entry1 | entry2 | ... | zlend |
+---------+--------+-------+--------+--------+--------+-------+
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;####Header éƒ¨åˆ†è¯¦è§£&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µå&lt;/th&gt;
&lt;th&gt;é•¿åº¦/ç±»å‹&lt;/th&gt;
&lt;th&gt;ä½œç”¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;zlbytes&lt;/td&gt;
&lt;td&gt;uint32_t (4å­—èŠ‚)&lt;/td&gt;
&lt;td&gt;æ•´ä¸ª ziplist å ç”¨çš„å†…å­˜å­—èŠ‚æ•°ï¼Œç”¨äºå†…å­˜é‡åˆ†é…å’Œè®¡ç®—æœ«ç«¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;zltail&lt;/td&gt;
&lt;td&gt;uint32_t (4å­—èŠ‚)&lt;/td&gt;
&lt;td&gt;åˆ°è¾¾ ziplist è¡¨å°¾èŠ‚ç‚¹çš„åç§»é‡ï¼Œå¯ä»¥ç›´æ¥å®šä½åˆ°å°¾èŠ‚ç‚¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;zllen&lt;/td&gt;
&lt;td&gt;uint16_t (2å­—èŠ‚)&lt;/td&gt;
&lt;td&gt;ziplist ä¸­èŠ‚ç‚¹çš„æ•°é‡ã€‚å½“å€¼å°äº 65535 æ—¶ä¸ºå®é™…æ•°é‡ï¼›ç­‰äº 65535 æ—¶éœ€è¦éå†è®¡ç®—&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;zlend&lt;/td&gt;
&lt;td&gt;uint8_t (1å­—èŠ‚)&lt;/td&gt;
&lt;td&gt;å€¼ä¸º 255(0xFF)ï¼Œæ ‡è®° ziplist çš„æœ«ç«¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;span class="lnt"&gt;22
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-c" data-lang="c"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt;/* We use this function to receive information about a ziplist entry.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * Note that this is not how the data is actually encoded, is just what we
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * get filled by a function in order to operate more easily. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;typedef&lt;/span&gt; &lt;span class="k"&gt;struct&lt;/span&gt; &lt;span class="n"&gt;zlentry&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;prevrawlensize&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* Bytes used to encode the previous entry len*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;prevrawlen&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* Previous entry len. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;lensize&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* Bytes used to encode this entry type/len.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; For example strings have a 1, 2 or 5 bytes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; header. Integers always use a single byte.*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;len&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* Bytes used to represent the actual entry.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; For strings this is just the string length
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; while for integers it is 1, 2, 3, 4, 8 or
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; 0 (for 4 bit immediate) depending on the
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; number range. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;headersize&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* prevrawlensize + lensize. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="n"&gt;encoding&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* Set to ZIP_STR_* or ZIP_INT_* depending on
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; the entry encoding. However for 4 bits
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; immediate integers this can assume a range
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; of values and must be range-checked. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="kt"&gt;unsigned&lt;/span&gt; &lt;span class="kt"&gt;char&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="cm"&gt;/* Pointer to the very start of the entry, that
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; is, this points to prev-entry-len field. */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="n"&gt;zlentry&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h4 id="æ¸è¿›å¼-rehash"&gt;æ¸è¿›å¼ rehash
&lt;/h4&gt;&lt;p&gt;Redis çš„å“ˆå¸Œè¡¨åœ¨æ‰©å®¹æˆ–ç¼©å®¹æ—¶ä¸ä¼šä¸€æ¬¡æ€§è¿›è¡Œå…¨é‡ rehashã€‚&lt;/p&gt;
&lt;p&gt;ç›¸åï¼Œå®ƒé‡‡å–äº†&lt;strong&gt;æ¸è¿›å¼ rehash çš„æ–¹å¼&lt;/strong&gt;ï¼Œå°† rehash æ“ä½œåˆ†æ‘Šåˆ°åç»­çš„å¢åˆ æ”¹æŸ¥æ“ä½œä¸­ï¼Œä»è€Œé¿å…äº†é›†ä¸­çš„æ€§èƒ½æŠ–åŠ¨ã€‚&lt;/p&gt;
&lt;h2 id="3å…±äº«å¯¹è±¡æ± "&gt;3ã€å…±äº«å¯¹è±¡æ± 
&lt;/h2&gt;&lt;p&gt;Redis ä¸­æœ‰è®¸å¤šå¸¸ç”¨çš„å°æ•´æ•°ï¼Œä¾‹å¦‚ 0 åˆ° 9999ã€‚è¿™äº›æ•´æ•°é¢‘ç¹åœ°å‡ºç°åœ¨å„ç§å‘½ä»¤å’Œæ•°æ®æ“ä½œä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å‡å°‘å†…å­˜åˆ†é…å’Œé‡Šæ”¾çš„å¼€é”€ï¼ŒRedis ä½¿ç”¨äº† &lt;strong&gt;å…±äº«å¯¹è±¡æ± ï¼ˆShared Object Poolï¼‰&lt;/strong&gt;ï¼Œå®ç°äº†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¯¹è±¡å¤ç”¨ï¼šå¯¹äºå¸¸ç”¨çš„å°æ•´æ•°ï¼ŒRedis ä¼šåœ¨å¯åŠ¨æ—¶é¢„å…ˆåˆ›å»ºè¿™äº›å¯¹è±¡ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨ä¸€ä¸ªå…±äº«å¯¹è±¡æ± ä¸­ã€‚å½“ç³»ç»Ÿéœ€è¦è¿™äº›æ•´æ•°å¯¹è±¡æ—¶ï¼Œç›´æ¥ä»æ± ä¸­è·å–ï¼Œè€Œä¸éœ€è¦é‡å¤åˆ†é…å†…å­˜ã€‚è¿™å¤§å¤§å‡å°‘äº†å†…å­˜åˆ†é…å’Œé‡Šæ”¾çš„å¼€é”€ï¼Œæé«˜äº†ç³»ç»Ÿçš„æ•ˆç‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å†…å­˜èŠ‚çœï¼šå…±äº«å¯¹è±¡æ± æœ‰æ•ˆåœ°èŠ‚çœäº†å†…å­˜ï¼Œå°¤å…¶æ˜¯åœ¨å¤§è§„æ¨¡ä½¿ç”¨è¿™äº›å¸¸é‡çš„åœºæ™¯ä¸­ã€‚é€šè¿‡å¯¹è±¡å¤ç”¨ï¼Œé¿å…äº†é¢‘ç¹çš„å†…å­˜ç”³è¯·å’Œåƒåœ¾å›æ”¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="4è¿‡æœŸè®¾è®¡"&gt;4ã€è¿‡æœŸè®¾è®¡
&lt;/h2&gt;&lt;p&gt;Redis æ”¯æŒä¸ºé”®è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚å½“é”®è¿‡æœŸåï¼Œå®ƒåº”è¯¥è¢«è‡ªåŠ¨åˆ é™¤ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œè¿‡æœŸé”®çš„å¤„ç†éœ€è¦åœ¨æ€§èƒ½å’Œå‡†ç¡®æ€§ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ã€‚Redis é‡‡ç”¨äº†ä¸€ç§ &lt;strong&gt;æƒ°æ€§åˆ é™¤ä¸å®šæœŸåˆ é™¤ç›¸ç»“åˆçš„ç­–ç•¥&lt;/strong&gt; æ¥å¤„ç†è¿‡æœŸé”®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æƒ°æ€§åˆ é™¤ï¼šå½“å®¢æˆ·ç«¯è®¿é—®ä¸€ä¸ªé”®æ—¶ï¼ŒRedis ä¼šæ£€æŸ¥è¯¥é”®æ˜¯å¦å·²ç»è¿‡æœŸã€‚å¦‚æœè¿‡æœŸï¼Œåˆ™ç«‹å³åˆ é™¤ã€‚è¿™ç§æ–¹å¼ä¸ä¼šå¢åŠ ç³»ç»Ÿè´Ÿæ‹…ï¼Œå› ä¸ºåªåœ¨è®¿é—®æ—¶æ‰æ£€æŸ¥é”®çš„çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;å®šæœŸåˆ é™¤ï¼šRedis æ¯éš”ä¸€æ®µæ—¶é—´ä¼šéšæœºæŠ½å–ä¸€éƒ¨åˆ†é”®è¿›è¡Œè¿‡æœŸæ£€æŸ¥ï¼Œå¹¶åˆ é™¤å…¶ä¸­å·²è¿‡æœŸçš„é”®ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒRedis å¯ä»¥é¿å…ç³»ç»Ÿä¸­å¤§é‡å­˜åœ¨è¿‡æœŸé”®è€Œæ— æ³•åŠæ—¶æ¸…ç†çš„æƒ…å†µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æƒ°æ€§åˆ é™¤ç¡®ä¿è®¿é—®æ€§èƒ½ï¼Œå®šæœŸåˆ é™¤é¿å…å†…å­˜æ³„æ¼ã€‚é€šè¿‡æƒ°æ€§åˆ é™¤å’Œå®šæœŸåˆ é™¤ç›¸ç»“åˆï¼ŒRedis å®ç°äº†è¿‡æœŸé”®çš„é«˜æ•ˆç®¡ç†ã€‚&lt;/p&gt;
&lt;h2 id="5æ•°æ®æŒä¹…åŒ–aof-é‡å†™æœºåˆ¶"&gt;5ã€æ•°æ®æŒä¹…åŒ–ï¼šAOF é‡å†™æœºåˆ¶
&lt;/h2&gt;&lt;p&gt;AOFï¼ˆAppend Only Fileï¼‰ æ˜¯ Redis çš„ä¸€ç§æ•°æ®æŒä¹…åŒ–æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;Redis ä¼šå°†æ‰€æœ‰å†™æ“ä½œä»¥è¿½åŠ çš„æ–¹å¼è®°å½•åˆ° AOF æ–‡ä»¶ä¸­ï¼Œä»¥ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚ç„¶è€Œï¼Œ&lt;strong&gt;éšç€æ—¶é—´æ¨ç§»ï¼ŒAOF æ–‡ä»¶å¯èƒ½ä¼šå˜å¾—éå¸¸å¤§&lt;/strong&gt;ï¼Œå½±å“æ¢å¤é€Ÿåº¦ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRedis å¼•å…¥äº† &lt;strong&gt;AOF é‡å†™ï¼ˆAOF Rewriteï¼‰&lt;/strong&gt; æœºåˆ¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¢é‡é‡å†™ï¼šAOF é‡å†™å¹¶ä¸ä¼šä¸­æ–­æ­£å¸¸çš„å†™æ“ä½œã€‚åœ¨é‡å†™æœŸé—´ï¼ŒRedis ä»ç„¶å¯ä»¥å°†æ–°çš„å†™æ“ä½œç»§ç»­è¿½åŠ åˆ°æ—§çš„ AOF æ–‡ä»¶ä¸­ï¼Œç¡®ä¿äº†é«˜å¹¶å‘å†™å…¥æ—¶çš„æŒä¹…åŒ–æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ç©ºé—´ä¼˜åŒ–ï¼šAOF é‡å†™è¿‡ç¨‹ä¸­ï¼ŒRedis å¹¶ä¸ä¼šç®€å•åœ°å¤åˆ¶æ‰€æœ‰å‘½ä»¤ï¼Œè€Œæ˜¯æ ¹æ®å½“å‰çš„æ•°æ®çŠ¶æ€ï¼Œç”Ÿæˆæœ€ç²¾ç®€çš„å‘½ä»¤é›†ã€‚å³ä½¿ä¸€ä¸ªé”®å€¼ç»è¿‡å¤šæ¬¡ä¿®æ”¹ï¼Œæœ€ç»ˆçš„ AOF æ–‡ä»¶ä¸­åªä¼šä¿ç•™ä¸€æ¡æœ€æœ‰æ•ˆçš„å‘½ä»¤ï¼Œä»è€Œå¤§å¹…å‡å°‘äº†æ–‡ä»¶å¤§å°ã€‚&lt;/li&gt;
&lt;li&gt;å¼‚æ­¥æ‰§è¡Œï¼šAOF é‡å†™æ˜¯é€šè¿‡å­è¿›ç¨‹å¼‚æ­¥æ‰§è¡Œçš„ï¼Œä¸»è¿›ç¨‹ä¸ä¼šå—åˆ°å½±å“ï¼Œè¿™ä¿è¯äº†åœ¨æ‰§è¡Œé‡å†™çš„åŒæ—¶ï¼ŒRedis ä»ç„¶å¯ä»¥æä¾›é«˜æ•ˆçš„æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ğŸ˜‚ğŸ˜‚ğŸ˜‚&lt;/p&gt;</description></item><item><title>Redisä¸ºä»€ä¹ˆå¿«</title><link>https://0607pass.github.io/Blog/p/redis%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB/</link><pubDate>Thu, 11 Dec 2025 14:47:00 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/redis%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB/</guid><description>&lt;img src="https://0607pass.github.io/Blog/images/postCover/redis.png" alt="Featured image of post Redisä¸ºä»€ä¹ˆå¿«" /&gt;&lt;h1 id="redisä¸ºä»€ä¹ˆå¿«"&gt;Redisä¸ºä»€ä¹ˆå¿«
&lt;/h1&gt;&lt;p&gt;&lt;img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F0b01e080-d346-48d6-aad1-5fad59cd4f56_3573x2280.jpeg"
loading="lazy"
alt="img"
&gt;&lt;/p&gt;
&lt;h2 id="ä¸»è¦æœ‰-3-ä¸ªæ–¹é¢çš„åŸå› åˆ†åˆ«æ˜¯å­˜å‚¨æ–¹å¼ä¼˜ç§€çš„çº¿ç¨‹æ¨¡å‹ä»¥åŠ-io-æ¨¡å‹é«˜æ•ˆçš„æ•°æ®ç»“æ„"&gt;ä¸»è¦æœ‰ 3 ä¸ªæ–¹é¢çš„åŸå› ï¼Œåˆ†åˆ«æ˜¯å­˜å‚¨æ–¹å¼ã€ä¼˜ç§€çš„çº¿ç¨‹æ¨¡å‹ä»¥åŠ IO æ¨¡å‹ã€é«˜æ•ˆçš„æ•°æ®ç»“æ„ã€‚
&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Redis å°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæä¾›å¿«é€Ÿçš„è¯»å†™é€Ÿåº¦ï¼Œç›¸æ¯”äºä¼ ç»Ÿçš„ç£ç›˜æ•°æ®åº“ï¼Œå†…å­˜è®¿é—®é€Ÿåº¦å¿«å¾—å¤šã€‚&lt;/li&gt;
&lt;li&gt;Redis ä½¿ç”¨å•çº¿ç¨‹äº‹ä»¶é©±åŠ¨æ¨¡å‹ç»“åˆ I/O å¤šè·¯å¤ç”¨ï¼Œé¿å…äº†å¤šçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶ï¼Œæé«˜äº†å¹¶å‘å¤„ç†æ•ˆç‡ã€‚&lt;/li&gt;
&lt;li&gt;Redis æä¾›å¤šç§é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼ˆå¦‚å­—ç¬¦ä¸²ã€å“ˆå¸Œã€åˆ—è¡¨ã€é›†åˆç­‰ï¼‰ï¼Œè¿™äº›ç»“æ„ç»è¿‡ä¼˜åŒ–ï¼Œèƒ½å¤Ÿå¿«é€Ÿå®Œæˆå„ç§æ“ä½œ&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>å•ä¾‹è®¾è®¡æ¨¡å¼</title><link>https://0607pass.github.io/Blog/p/%E5%8D%95%E4%BE%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</link><pubDate>Thu, 11 Dec 2025 14:40:29 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/%E5%8D%95%E4%BE%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</guid><description>&lt;img src="https://0607pass.github.io/Blog/images/postCover/design.png" alt="Featured image of post å•ä¾‹è®¾è®¡æ¨¡å¼" /&gt;&lt;h1 id="ä»€ä¹ˆæ˜¯å•ä¾‹è®¾è®¡æ¨¡å¼"&gt;ä»€ä¹ˆæ˜¯å•ä¾‹è®¾è®¡æ¨¡å¼
&lt;/h1&gt;&lt;p&gt;å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå°±æ˜¯è¯´ï¼šä¸€ä¸ªç±»åœ¨æ•´ä¸ªåº”ç”¨è¿è¡ŒæœŸé—´ï¼Œåªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œè€Œä¸”è¿™ä¸ªå®ä¾‹å¯¹å¤–æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚&lt;/p&gt;
&lt;h2 id="å•ä¾‹æ¨¡å¼çš„å‡ ç§å®ç°"&gt;å•ä¾‹æ¨¡å¼çš„å‡ ç§å®ç°
&lt;/h2&gt;&lt;h3 id="1é¥¿æ±‰å¼eager-initialization"&gt;1ï¼‰é¥¿æ±‰å¼ï¼ˆEager Initializationï¼‰
&lt;/h3&gt;&lt;p&gt;é¥¿æ±‰å¼æ˜¯åœ¨ç±»â€åŠ è½½é˜¶æ®µå°±å®Œæˆå®ä¾‹åŒ–ï¼Œä¿â¢è¯ä»ç¬¬ä¸€æ¬¡è®¿é—®è¯¥ç±»åˆ°ç¨‹åºç»“æŸï¼Œå…¨å±€åªæœ‰è¿™ä¸€ä¸ªå®ä¾‹ï¿½ã€‚å®ƒä¾èµ– JVM çš„ç±»åŠ â€è½½æœºåˆ¶æ¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @author 32500
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @date 2025/6/9 10:19
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; */&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SingletonEager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SingletonEager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SingletonEager&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;SingletonEager&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SingletonEager&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getInstance&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="2æ‡’æ±‰å¼synchronized-lazy-"&gt;2ï¼‰æ‡’æ±‰å¼ï¼ˆSynchronized Lazy ï¼‰
&lt;/h3&gt;&lt;p&gt;æ‡’æ±‰å¼åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ &lt;code&gt;getInstance()&lt;/code&gt; æ—¶æ‰åˆ›å»ºå®ä¾‹ï¼Œé€šè¿‡å¯¹è¯¥æ–¹æ³•åŠ é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œé€‚åˆå¯¹å¯åŠ¨æ€§èƒ½æœ‰è¦æ±‚ä¸”å®ä¾‹ä¸ä¸€å®šé©¬ä¸Šéœ€è¦çš„åœºæ™¯ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @author 32500
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @date 2025/6/9 10:30
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * æ¯æ¬¡è°ƒç”¨ getInstance() éƒ½ä¼šåŠ é”ï¼Œå³ä½¿ instance å·²ç»åˆå§‹åŒ–å®Œæˆï¼Œè¿™ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * é‡‡ç”¨åŒæ£€é”ä¼˜åŒ–
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; */&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SingletonLazy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SingletonLazy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;SingletonLazy&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;synchronized&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SingletonLazy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getInstance&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;SingletonLazy&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="3-åŒæ£€é”"&gt;3 ï¼‰åŒæ£€é”
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;span class="lnt"&gt;22
&lt;/span&gt;&lt;span class="lnt"&gt;23
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @author 32500
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @date 2025/6/9 10:35
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * åŒæ£€æœºåˆ¶
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * é˜²æ­¢å¤šçº¿ç¨‹é‡å¤åˆ¤æ–­
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; */&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DoubleCheckSingletonLazy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;volatile&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DoubleCheckSingletonLazy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;DoubleCheckSingletonLazy&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DoubleCheckSingletonLazy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getInstance&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;synchronized&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;DoubleCheckSingletonLazy&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;DoubleCheckSingletonLazy&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="4-é™æ€å†…éƒ¨ç±»"&gt;4 ï¼‰é™æ€å†…éƒ¨ç±»
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @author 32500
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @date 2025/6/9 11:10
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * é™æ€å†…éƒ¨ç±»å®ç°å•ä¾‹æ¨¡å¼
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * åˆ©ç”¨ JVM åœ¨åŠ è½½å¤–éƒ¨ç±»æ—¶å¹¶ä¸ç«‹å³åŠ è½½å†…éƒ¨ç±»çš„ç‰¹æ€§ï¼Œå°†å®ä¾‹çš„åˆ›å»ºå»¶è¿Ÿåˆ°çœŸæ­£è®¿é—®å†…éƒ¨ç±»æ—¶ã€‚æ—¢èƒ½å»¶è¿ŸåŠ è½½ï¼Œåˆèƒ½å€ŸåŠ©ç±»åŠ è½½çš„çº¿ç¨‹å®‰å…¨ç‰¹æ€§ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; */&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;InnerStaticSingleton&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Holder&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;InnerStaticSingleton&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;InnerStaticSingleton&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;InnerStaticSingleton&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;InnerStaticSingleton&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;getInstance&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Holder&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="5--æšä¸¾-å¤©ç„¶çš„å•ä¾‹"&gt;5 ï¼‰ æšä¸¾ å¤©ç„¶çš„å•ä¾‹
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;span class="lnt"&gt;7
&lt;/span&gt;&lt;span class="lnt"&gt;8
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @author 32500
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @date 2025/6/9 11:13
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * æšä¸¾å®ç° å•ä¾‹æ¨¡å¼
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; */&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;enum&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;EnumSingleton&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;INSTANCE&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</description></item><item><title>ä»€ä¹ˆæ˜¯TCPçš„ç²˜åŒ…ã€æ‹†åŒ…é—®é¢˜ï¼Ÿ</title><link>https://0607pass.github.io/Blog/p/%E4%BB%80%E4%B9%88%E6%98%AFtcp%E7%9A%84%E7%B2%98%E5%8C%85%E6%8B%86%E5%8C%85%E9%97%AE%E9%A2%98/</link><pubDate>Tue, 09 Dec 2025 20:53:37 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/%E4%BB%80%E4%B9%88%E6%98%AFtcp%E7%9A%84%E7%B2%98%E5%8C%85%E6%8B%86%E5%8C%85%E9%97%AE%E9%A2%98/</guid><description>&lt;img src="https://0607pass.github.io/Blog/images/postCover/network.png" alt="Featured image of post ä»€ä¹ˆæ˜¯TCPçš„ç²˜åŒ…ã€æ‹†åŒ…é—®é¢˜ï¼Ÿ" /&gt;&lt;p&gt;TCPç²˜åŒ…å’Œæ‹†åŒ…é—®é¢˜æ˜¯æŒ‡åœ¨è¿›è¡ŒTCPé€šä¿¡æ—¶ï¼Œè€ŒTCPæ˜¯é¢å‘æµçš„ï¼Œæ‰€ä»¥å‘é€æ–¹åœ¨ä¼ è¾“æ•°æ®æ—¶å¯èƒ½ä¼šå°†å¤šä¸ªå°çš„æ•°æ®åŒ…ç²˜åˆåœ¨ä¸€èµ·å‘é€ï¼Œè€Œæ¥æ”¶æ–¹åˆ™å¯èƒ½å°†è¿™äº›æ•°æ®åŒ…æ‹†åˆ†æˆå¤šä¸ªå°çš„æ•°æ®åŒ…è¿›è¡Œæ¥æ”¶ï¼Œä»è€Œå¯¼è‡´æ•°æ®æ¥æ”¶å‡ºç°é”™è¯¯æˆ–è€…æ•°æ®ç²˜è¿çš„é—®é¢˜ã€‚
TCPç²˜åŒ…å’Œæ‹†åŒ…é—®é¢˜ä¸»è¦å‡ºç°åœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å‘é€æ–¹è¿ç»­å‘é€å¤šä¸ªå°æ•°æ®åŒ…ï¼šç”±äºTCPæ˜¯åŸºäºæµçš„åè®®ï¼Œå‘é€æ–¹åœ¨ä¼ è¾“æ•°æ®æ—¶å¯èƒ½ä¼šå°†å¤šä¸ªå°æ•°æ®åŒ…ç»„åˆæˆä¸€ä¸ªå¤§æ•°æ®åŒ…è¿›è¡Œå‘é€ï¼Œä»è€Œå¯¼è‡´æ¥æ”¶æ–¹åœ¨æ¥æ”¶æ•°æ®æ—¶æ— æ³•åŒºåˆ†ä¸åŒæ•°æ®åŒ…ä¹‹é—´çš„ç•Œé™ã€‚&lt;/li&gt;
&lt;li&gt;æ¥æ”¶æ–¹ç¼“å­˜åŒºå¤§å°é™åˆ¶ï¼šæ¥æ”¶æ–¹åœ¨æ¥æ”¶æ•°æ®æ—¶ï¼Œå¦‚æœæ¥æ”¶ç¼“å­˜åŒºçš„å¤§å°æœ‰é™ï¼Œå¯èƒ½ä¼šå°†ä¸€ä¸ªå¤§çš„æ•°æ®åŒ…æ‹†åˆ†æˆå¤šä¸ªå°æ•°æ®åŒ…è¿›è¡Œæ¥æ”¶ï¼Œä»è€Œå¯¼è‡´ç²˜åŒ…å’Œæ‹†åŒ…é—®é¢˜çš„å‡ºç°ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="å¦‚ä½•è§£å†³"&gt;å¦‚ä½•è§£å†³ï¼Ÿï¼Ÿï¼Ÿ
&lt;/h2&gt;&lt;p&gt;å¯¹åŒ…æ ¼å¼è¿›è¡Œçº¦æŸï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å°†ä¸šåŠ¡å±‚åè®®åŒ…çš„é•¿åº¦å›ºå®šä¸‹æ¥ï¼Œæ¯ä¸ªåŒ…éƒ½å›ºå®šé•¿åº¦ï¼Œæ¯”å¦‚512ä¸ªå­—èŠ‚å¤§å°ï¼Œå¦‚æœå®¢æˆ·ç«¯å‘é€çš„æ•°æ®é•¿åº¦ä¸è¶³512ä¸ªå­—èŠ‚ï¼Œåˆ™é€šè¿‡è¡¥å……ç©ºæ ¼çš„æ–¹å¼è¡¥å…¨åˆ°æŒ‡å®šé•¿åº¦ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨æ¯ä¸ªåŒ…çš„æœ«å°¾ä½¿ç”¨å›ºå®šçš„åˆ†éš”ç¬¦ï¼Œå¦‚æ¢è¡Œç¬¦/nï¼Œå¦‚æœä¸€ä¸ªåŒ…è¢«æ‹†åˆ†äº†ï¼Œåˆ™ç­‰å¾…ä¸‹ä¸€ä¸ªåŒ…å‘é€è¿‡æ¥ä¹‹åæ‰¾åˆ°å…¶ä¸­çš„\nï¼Œç„¶åå¯¹å…¶æ‹†åˆ†åçš„å¤´éƒ¨éƒ¨åˆ†ä¸å‰ä¸€ä¸ªåŒ…çš„å‰©ä½™éƒ¨åˆ†è¿›è¡Œåˆå¹¶å³å¯ï¼›&lt;/li&gt;
&lt;li&gt;ä»¿ç…§TCP/IPåè®®æ ˆï¼Œå°†æ¶ˆæ¯åˆ†ä¸ºheaderå’Œbodyï¼Œåœ¨headä¸­ä¿å­˜æœ‰å½“å‰æ•´ä¸ªæ¶ˆæ¯çš„é•¿åº¦ï¼Œåªæœ‰åœ¨è¯»å–åˆ°è¶³å¤Ÿé•¿åº¦çš„æ¶ˆæ¯ä¹‹åæ‰ç®—æ˜¯è¯»åˆ°äº†ä¸€ä¸ªå®Œæ•´çš„æ¶ˆæ¯ï¼›&lt;/li&gt;
&lt;li&gt;é€šè¿‡è‡ªå®šä¹‰åè®®è¿›è¡Œç²˜åŒ…å’Œæ‹†åŒ…çš„å¤„ç†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="nettyå¦‚ä½•è§£å†³çš„"&gt;Nettyå¦‚ä½•è§£å†³çš„ï¼Ÿ
&lt;/h2&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯åŸºäºä¸Šè¿°ç¬¬3ç‚¹å®ç°çš„&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;span class="lnt"&gt;22
&lt;/span&gt;&lt;span class="lnt"&gt;23
&lt;/span&gt;&lt;span class="lnt"&gt;24
&lt;/span&gt;&lt;span class="lnt"&gt;25
&lt;/span&gt;&lt;span class="lnt"&gt;26
&lt;/span&gt;&lt;span class="lnt"&gt;27
&lt;/span&gt;&lt;span class="lnt"&gt;28
&lt;/span&gt;&lt;span class="lnt"&gt;29
&lt;/span&gt;&lt;span class="lnt"&gt;30
&lt;/span&gt;&lt;span class="lnt"&gt;31
&lt;/span&gt;&lt;span class="lnt"&gt;32
&lt;/span&gt;&lt;span class="lnt"&gt;33
&lt;/span&gt;&lt;span class="lnt"&gt;34
&lt;/span&gt;&lt;span class="lnt"&gt;35
&lt;/span&gt;&lt;span class="lnt"&gt;36
&lt;/span&gt;&lt;span class="lnt"&gt;37
&lt;/span&gt;&lt;span class="lnt"&gt;38
&lt;/span&gt;&lt;span class="lnt"&gt;39
&lt;/span&gt;&lt;span class="lnt"&gt;40
&lt;/span&gt;&lt;span class="lnt"&gt;41
&lt;/span&gt;&lt;span class="lnt"&gt;42
&lt;/span&gt;&lt;span class="lnt"&gt;43
&lt;/span&gt;&lt;span class="lnt"&gt;44
&lt;/span&gt;&lt;span class="lnt"&gt;45
&lt;/span&gt;&lt;span class="lnt"&gt;46
&lt;/span&gt;&lt;span class="lnt"&gt;47
&lt;/span&gt;&lt;span class="lnt"&gt;48
&lt;/span&gt;&lt;span class="lnt"&gt;49
&lt;/span&gt;&lt;span class="lnt"&gt;50
&lt;/span&gt;&lt;span class="lnt"&gt;51
&lt;/span&gt;&lt;span class="lnt"&gt;52
&lt;/span&gt;&lt;span class="lnt"&gt;53
&lt;/span&gt;&lt;span class="lnt"&gt;54
&lt;/span&gt;&lt;span class="lnt"&gt;55
&lt;/span&gt;&lt;span class="lnt"&gt;56
&lt;/span&gt;&lt;span class="lnt"&gt;57
&lt;/span&gt;&lt;span class="lnt"&gt;58
&lt;/span&gt;&lt;span class="lnt"&gt;59
&lt;/span&gt;&lt;span class="lnt"&gt;60
&lt;/span&gt;&lt;span class="lnt"&gt;61
&lt;/span&gt;&lt;span class="lnt"&gt;62
&lt;/span&gt;&lt;span class="lnt"&gt;63
&lt;/span&gt;&lt;span class="lnt"&gt;64
&lt;/span&gt;&lt;span class="lnt"&gt;65
&lt;/span&gt;&lt;span class="lnt"&gt;66
&lt;/span&gt;&lt;span class="lnt"&gt;67
&lt;/span&gt;&lt;span class="lnt"&gt;68
&lt;/span&gt;&lt;span class="lnt"&gt;69
&lt;/span&gt;&lt;span class="lnt"&gt;70
&lt;/span&gt;&lt;span class="lnt"&gt;71
&lt;/span&gt;&lt;span class="lnt"&gt;72
&lt;/span&gt;&lt;span class="lnt"&gt;73
&lt;/span&gt;&lt;span class="lnt"&gt;74
&lt;/span&gt;&lt;span class="lnt"&gt;75
&lt;/span&gt;&lt;span class="lnt"&gt;76
&lt;/span&gt;&lt;span class="lnt"&gt;77
&lt;/span&gt;&lt;span class="lnt"&gt;78
&lt;/span&gt;&lt;span class="lnt"&gt;79
&lt;/span&gt;&lt;span class="lnt"&gt;80
&lt;/span&gt;&lt;span class="lnt"&gt;81
&lt;/span&gt;&lt;span class="lnt"&gt;82
&lt;/span&gt;&lt;span class="lnt"&gt;83
&lt;/span&gt;&lt;span class="lnt"&gt;84
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * Create a frame out of the {@link ByteBuf} and return it.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @param ctx the {@link ChannelHandlerContext} which this {@link ByteToMessageDecoder} belongs to
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @param in the {@link ByteBuf} from which to read data
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; * @return the {@link ByteBuf} frame, or {@code null} if no frame could be created.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="cm"&gt; */&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;protected&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ChannelHandlerContext&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ctx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ByteBuf&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;throws&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Exception&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;long&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLength&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// frameLengthInt æ˜¯ç±»çš„æˆå‘˜å˜é‡ï¼Œç”¨äºè®°å½•å½“å‰å¾…åˆ‡å¸§çš„ â€œç›®æ ‡å¸§æ€»é•¿åº¦â€&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åˆå§‹åŒ–ä¸º -1 è¡¨ç¤º â€œè¿˜æ²¡ç¡®å®šå½“å‰å¸§é•¿åº¦ (new frame)â€&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;frameLengthInt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// new frame&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è‹¥ä¹‹å‰å¤„äºä¸¢å¼ƒæ¨¡å¼ï¼Œå…ˆæ‰§è¡Œä¸¢å¼ƒé€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;discardingTooLongFrame&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;discardingTooLongFrame&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç¼“å†²åŒºæœªåˆ°è¾¾é•¿åº¦å­—æ®µç»“æŸä½ç½®ï¼Œæ— æ³•å¾—å‡ºå¸§é•¿ â†’ ç­‰å¾…æ›´å¤šå­—èŠ‚&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;readableBytes&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lengthFieldEndOffset&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è®¡ç®—é•¿åº¦å­—æ®µåœ¨ç¼“å†²åŒºä¸­çš„çœŸå®åç§»&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;actualLengthFieldOffset&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;readerIndex&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lengthFieldOffset&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è¯»å–åŸå§‹é•¿åº¦å€¼&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLength&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;getUnadjustedFrameLength&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;actualLengthFieldOffset&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lengthFieldLength&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;byteOrder&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é•¿åº¦å€¼ä¸èƒ½ä¸ºè´Ÿ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;frameLength&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;failOnNegativeLengthField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLength&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lengthFieldEndOffset&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// åŠ ä¸Š lengthAdjustment å’Œ header é•¿åº¦ï¼ˆlengthFieldEndOffsetï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLength&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lengthAdjustment&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lengthFieldEndOffset&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ ¡éªŒï¼šæ•´å¸§é•¿åº¦ä¸åº”å°äº header&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;frameLength&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lengthFieldEndOffset&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;failOnFrameLengthLessThanLengthFieldEndOffset&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLength&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;lengthFieldEndOffset&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ ¡éªŒï¼šå¸§æ˜¯å¦è¶…è¿‡æœ€å¤§å¤§å°&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;frameLength&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;maxFrameLength&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exceededFrameLength&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLength&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ä¿å­˜æœ€ç»ˆå¸§é•¿åº¦ï¼ˆä¸ä¼šæº¢å‡ºï¼Œå› ä¸ºå·²ä¿è¯ &amp;lt; maxFrameLengthï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLengthInt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLength&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// å½“å‰å¸§é•¿åº¦å·²ç¡®å®šï¼Œæ£€æŸ¥æ˜¯å¦æ”¶åˆ°å…¨éƒ¨æ•°æ®&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;readableBytes&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLengthInt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ•°æ®ä¸è¶³ â†’ åŠåŒ… â†’ ç­‰å¾…æ›´å¤šå­—èŠ‚&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// æ ¡éªŒï¼šstrip çš„å­—èŠ‚ä¸åº”è¶…è¿‡å¸§é•¿åº¦&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;initialBytesToStrip&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLengthInt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;failOnFrameLengthLessThanInitialBytesToStrip&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLength&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;initialBytesToStrip&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è·³è¿‡ initialBytesToStrip å­—èŠ‚ï¼ˆé€šå¸¸æ˜¯è·³è¿‡ header/length-fieldï¼‰&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;skipBytes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;initialBytesToStrip&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// extract frame&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;readerIndex&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;readerIndex&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;actualFrameLength&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLengthInt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;initialBytesToStrip&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ByteBuf&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;extractFrame&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ctx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;readerIndex&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;actualFrameLength&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ç§»åŠ¨ readerIndexï¼Œè·³è¿‡æ•´å¸§&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;in&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;readerIndex&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;readerIndex&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;actualFrameLength&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// é‡ç½®ï¼Œå‡†å¤‡ä¸‹ä¸€å¸§&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frameLengthInt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿˜æœ‰ FixedLengthFrameDecoder (å›ºå®šåŒ…é•¿) DelimiterBasedFrameDecoder(åŸºäºåˆ†éš”ç¬¦)&lt;/p&gt;
&lt;h2 id="udpæœ‰æ²¡æœ‰è¿™ç§æƒ…å†µ"&gt;UDPæœ‰æ²¡æœ‰è¿™ç§æƒ…å†µ
&lt;/h2&gt;&lt;p&gt;ä¸ä¼šå‡ºç°ï¼Œå› ä¸º UDP æ˜¯åŸºäºâ€œæ•°æ®æŠ¥ï¼ˆDatagramï¼‰â€çš„æ¶ˆæ¯åè®®ã€‚
UDPç‰¹æ€§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœ‰æ¶ˆæ¯è¾¹ç•Œ&lt;/li&gt;
&lt;li&gt;ä¸€æ¬¡è¯»å–æ°¸è¿œå¯¹åº”ä¸€æ¬¡ sendto() çš„åŒ…&lt;/li&gt;
&lt;li&gt;è¦ä¹ˆæ•´åŒ…æ”¶åˆ°&lt;/li&gt;
&lt;li&gt;è¦ä¹ˆä¸¢åŒ…&lt;/li&gt;
&lt;li&gt;ä¸ä¼šç²˜ï¼Œä¸ä¼šæ‹†&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>Hugoå¸¸ç”¨å‘½ä»¤</title><link>https://0607pass.github.io/Blog/p/hugo%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</link><pubDate>Sun, 07 Dec 2025 16:52:54 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/hugo%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</guid><description>&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;hugo new content/post/&lt;span class="s2"&gt;&amp;#34;titile&amp;#34;&lt;/span&gt;/index.md
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# è®© Hugo æ¸²æŸ“è‰ç¨¿ï¼ˆdraftï¼‰å†…å®¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;hugo server -D
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# å…³é—­ Hugo çš„â€œå¿«é€Ÿæ¸²æŸ“â€æ¨¡å¼ Hugo åœ¨æœ¬åœ°é¢„è§ˆæ—¶æœ‰ä¸€ä¸ªä¼˜åŒ–æœºåˆ¶ï¼šFast Renderï¼ˆå¿«é€Ÿæ¸²æŸ“ï¼‰&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# å®ƒåªé‡æ–°æ¸²æŸ“ä½ ä¿®æ”¹è¿‡çš„éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯é‡æ–°æ„å»ºæ•´ä¸ªç«™ç‚¹ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;hugo server --disableFastRender
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# è‡ªåŠ¨éƒ¨ç½²åˆ°github&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;git add .
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;git commit -m &lt;span class="s2"&gt;&amp;#34;commit messages&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;git push origin master
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="c1"&gt;# ç­‰å¾…è‡ªåŠ¨éƒ¨ç½²&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</description></item><item><title>Springäº‹åŠ¡å¤±æ•ˆçš„æƒ…å†µ</title><link>https://0607pass.github.io/Blog/p/spring%E4%BA%8B%E5%8A%A1%E5%A4%B1%E6%95%88%E7%9A%84%E6%83%85%E5%86%B5/</link><pubDate>Sun, 07 Dec 2025 16:39:20 +0800</pubDate><guid>https://0607pass.github.io/Blog/p/spring%E4%BA%8B%E5%8A%A1%E5%A4%B1%E6%95%88%E7%9A%84%E6%83%85%E5%86%B5/</guid><description>&lt;img src="https://0607pass.github.io/Blog/images/postCover/spring.png" alt="Featured image of post Springäº‹åŠ¡å¤±æ•ˆçš„æƒ…å†µ" /&gt;&lt;p&gt;Springä¸­æ¯”è¾ƒå®¹æ˜“å¤±æ•ˆçš„å°±æ˜¯é€šè¿‡@Transactional å®šä¹‰çš„å£°æ˜å¼äº‹åŠ¡ï¼Œä»–åœ¨ä»¥ä¸‹å‡ ä¸ªåœºæ™¯ä¸­ä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆï¼Œé¦–å…ˆï¼Œå°±æ˜¯Springçš„@Transactionalæ˜¯åŸºäºSpringçš„AOPæœºåˆ¶å®ç°çš„ï¼Œè€ŒAOPæœºåˆ¶åˆæ˜¯åŸºäºåŠ¨æ€ä»£ç†å®ç°çš„ã€‚é‚£ä¹ˆå¦‚æœä»£ç†å¤±æ•ˆäº†ï¼Œäº‹åŠ¡ä¹Ÿå°±ä¼šå¤±æ•ˆã€‚&lt;/p&gt;
&lt;h1 id="ä»€ä¹ˆæƒ…å†µä¸‹ä»£ç†ä¼šç”Ÿæ•ˆ"&gt;ä»€ä¹ˆæƒ…å†µä¸‹ä»£ç†ä¼šç”Ÿæ•ˆ
&lt;/h1&gt;&lt;h2 id="transactional-åº”ç”¨åœ¨é-public-ä¿®é¥°çš„æ–¹æ³•ä¸Š"&gt;@Transactional åº”ç”¨åœ¨é public ä¿®é¥°çš„æ–¹æ³•ä¸Š
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MyService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;doInternal&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Doing internal work...&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;privateæ–¹æ³•ï¼Œåªä¼šåœ¨å½“å‰å¯¹è±¡ä¸­çš„å…¶ä»–æ–¹æ³•ä¸­è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯ä¼šè¿›è¡Œå¯¹è±¡çš„è‡ªè°ƒç”¨ï¼Œè¿™ç§æƒ…å†µæ˜¯ç”¨thisè°ƒç”¨çš„ï¼Œå¹¶ä¸ä¼šèµ°åˆ°ä»£ç†å¯¹è±¡ï¼Œè€Œ@Transactionalæ˜¯åŸºäºåŠ¨æ€ä»£ç†å®ç°çš„ï¼Œæ‰€ä»¥ä»£ç†ä¼šå¤±æ•ˆã€‚&lt;/p&gt;
&lt;h2 id="åŒä¸€ä¸ªç±»ä¸­æ–¹æ³•è°ƒç”¨å¯¼è‡´transactionalå¤±æ•ˆ"&gt;åŒä¸€ä¸ªç±»ä¸­æ–¹æ³•è°ƒç”¨ï¼Œå¯¼è‡´@Transactionalå¤±æ•ˆ
&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MyService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;doSomething&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;doInternal&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è‡ªè°ƒç”¨æ–¹æ³•&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;doInternal&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Doing internal work...&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æ ¹æœ¬ä¸ä¼šèµ°ä»£ç†&lt;/p&gt;
&lt;h2 id="finalstaticæ–¹æ³•"&gt;finalã€staticæ–¹æ³•
&lt;/h2&gt;&lt;p&gt;ç”±äºAOPæ˜¯é€šè¿‡åˆ›å»ºä»£ç†å¯¹è±¡æ¥å®ç°çš„ï¼Œè€Œæ— æ³•å¯¹finalæ–¹æ³•è¿›è¡Œå­ç±»åŒ–å’Œè¦†ç›–ï¼Œæ‰€ä»¥æ— æ³•æ‹¦æˆªè¿™äº›æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰å°±æ˜¯è°ƒç”¨staticæ–¹æ³•ï¼Œå› ä¸ºè¿™ç±»æ–¹æ³•æ˜¯å±äºè¿™ä¸ªç±»çš„ï¼Œå¹¶ä¸æ˜¯å¯¹è±¡çš„ï¼Œæ‰€ä»¥æ— æ³•è¢«AOPã€‚&lt;/p&gt;
&lt;h2 id="æ²¡æœ‰ä»£ç†"&gt;æ²¡æœ‰ä»£ç†
&lt;/h2&gt;&lt;p&gt;è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œé‚£å°±æ˜¯æ ¹æœ¬å°±æ²¡æœ‰ä»£ç†å¯¹è±¡ï¼Œæ¯”å¦‚è¯´ä½ çš„Beanæ²¡æœ‰è¢«Springç®¡ç†ï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰é€šè¿‡@Serviceç­‰æ³¨è§£æŠŠä»–æ ‡æ³¨æˆä¸€ä¸ªBeanï¼Œè€Œæ˜¯è‡ªå·±newäº†ä¸€ä¸ªçš„è¯ï¼Œé‚£é‡Œé¢çš„æ–¹æ³•å°±ä¹Ÿä¼šäº‹åŠ¡å¤±æ•ˆã€‚&lt;/p&gt;
&lt;h2 id="transactionalç”¨çš„ä¸å¯¹"&gt;@Transactionalç”¨çš„ä¸å¯¹
&lt;/h2&gt;&lt;p&gt;1 ã€ @Transactional æ³¨è§£å±æ€§ propagation è®¾ç½®é”™è¯¯&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;span class="lnt"&gt;22
&lt;/span&gt;&lt;span class="lnt"&gt;23
&lt;/span&gt;&lt;span class="lnt"&gt;24
&lt;/span&gt;&lt;span class="lnt"&gt;25
&lt;/span&gt;&lt;span class="lnt"&gt;26
&lt;/span&gt;&lt;span class="lnt"&gt;27
&lt;/span&gt;&lt;span class="lnt"&gt;28
&lt;/span&gt;&lt;span class="lnt"&gt;29
&lt;/span&gt;&lt;span class="lnt"&gt;30
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ExampleService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ExampleRepository&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;repository&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;propagation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Propagation&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;NOT_SUPPORTED&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodA&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;repository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;someDatabaseOperation&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;repository&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;anotherDatabaseOperation&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Service&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;SomeService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Autowired&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ExampleService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exampleService&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;doSomething&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è¿™é‡Œæ‰§è¡Œä¸€äº›ä¸šåŠ¡é€»è¾‘&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exampleService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;methodA&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// è¿™ä¸ªæ–¹æ³•ç”±äº NOT_SUPPORTED å±æ€§ï¼Œä¼šåœ¨éäº‹åŠ¡ä¸‹æ‰§è¡Œ&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;exampleService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;methodB&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// ...&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä»¥ä¸Šï¼Œå¦‚æœäº‹åŠ¡å‘ç”Ÿå›æ»šï¼Œåˆ™methodAå¹¶ä¸ä¼šå›æ»šã€‚å› ä¸ºä»–çš„propagationæ˜¯ä¸æ”¯æŒäº‹åŠ¡ï¼Œé‚£ä¹ˆå®ƒå°±ä¸ä¼šä¸€èµ·å›æ»šã€‚&lt;/p&gt;
&lt;p&gt;2ã€@Transactional æ³¨è§£å±æ€§ rollbackFor è®¾ç½®é”™è¯¯&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MyService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rollbackFor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;RuntimeException&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;private&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;doInternal&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;Doing internal work...&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä»¥ä¸Šï¼Œå¦‚æœå‘ç”ŸéRuntimeExceptionï¼Œåˆ™äº‹åŠ¡ä¸ä¼šå›æ»šï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆã€‚æ‰€ä»¥éœ€è¦æŒ‡å®šä¸º(rollbackFor = Exception.class)&lt;/p&gt;
&lt;h2 id="å¼‚å¸¸è¢«æ•è·"&gt;å¼‚å¸¸è¢«æ•è·
&lt;/h2&gt;&lt;p&gt;å¼‚å¸¸è¢«catchæ•è·å¯¼è‡´@Transactionalå¤±æ•ˆ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-java" data-lang="java"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;MyService&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nd"&gt;@Transactional&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;doSomething&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;doInternal&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Exception&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="na"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;å› ä¸ºå¼‚å¸¸è¢«æ•è·ï¼Œæ‰€ä»¥å°±æ²¡åŠæ³•åŸºäºå¼‚å¸¸è¿›è¡Œrollbackäº†ï¼Œæ‰€ä»¥äº‹åŠ¡ä¼šå¤±æ•ˆã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œä½ åœ¨æ–¹æ³•ä¸ŠåŠ äº†å¦å¤–ä¸€ä¸ªæ³¨è§£ï¼Œé‚£ä¸ªæ³¨è§£çš„AOPé‡Œé¢æ•è·äº†å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;h2 id="äº‹åŠ¡ä¸­ç”¨äº†å¤šçº¿ç¨‹"&gt;äº‹åŠ¡ä¸­ç”¨äº†å¤šçº¿ç¨‹
&lt;/h2&gt;&lt;p&gt;@Transactional çš„äº‹åŠ¡ç®¡ç†ä½¿ç”¨çš„æ˜¯ ThreadLocal æœºåˆ¶æ¥å­˜å‚¨äº‹åŠ¡ä¸Šä¸‹æ–‡ï¼Œè€Œ ThreadLocal å˜é‡æ˜¯çº¿ç¨‹éš”ç¦»çš„ï¼Œå³æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„äº‹åŠ¡ä¸Šä¸‹æ–‡å‰¯æœ¬ã€‚å› æ­¤ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼ŒSpring çš„å£°æ˜å¼äº‹åŠ¡ä¼šå¤±æ•ˆï¼Œå³æ–°çº¿ç¨‹ä¸­çš„æ“ä½œä¸ä¼šè¢«åŒ…å«åœ¨åŸæœ‰çš„äº‹åŠ¡ä¸­ã€‚&lt;/p&gt;
&lt;h2 id="æ•°æ®åº“ä¸æ”¯æŒäº‹åŠ¡"&gt;æ•°æ®åº“ä¸æ”¯æŒäº‹åŠ¡
&lt;/h2&gt;&lt;p&gt;å¦‚myisamï¼Œä¸æ”¯æŒçš„è‚¯å®šå°±ä¸è¡Œäº†ã€‚&lt;/p&gt;</description></item></channel></rss>